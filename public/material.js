/*! time: 2022/11/16 上午9:22:25 */
!function(n){var i={};function r(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}r.m=n,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=544)}([function(e,t,n){"use strict";var i=Array.isArray;e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=t.shortcut=t.model=t.Model=void 0;var i=BI.Decorators,r=i.shortcut,o=i.Model,a=i.model,i=i.store;t.store=i,t.model=a,t.Model=o,t.shortcut=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSequenceProd=t.isBranchingProd=t.isOptionalProd=t.getProductionDslName=t.GAstVisitor=t.serializeProduction=t.serializeGrammar=t.Alternative=t.Alternation=t.RepetitionWithSeparator=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Repetition=t.Option=t.NonTerminal=t.Terminal=t.Rule=void 0;var i=n(94),r=(Object.defineProperty(t,"Rule",{enumerable:!0,get:function(){return i.Rule}}),Object.defineProperty(t,"Terminal",{enumerable:!0,get:function(){return i.Terminal}}),Object.defineProperty(t,"NonTerminal",{enumerable:!0,get:function(){return i.NonTerminal}}),Object.defineProperty(t,"Option",{enumerable:!0,get:function(){return i.Option}}),Object.defineProperty(t,"Repetition",{enumerable:!0,get:function(){return i.Repetition}}),Object.defineProperty(t,"RepetitionMandatory",{enumerable:!0,get:function(){return i.RepetitionMandatory}}),Object.defineProperty(t,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return i.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"RepetitionWithSeparator",{enumerable:!0,get:function(){return i.RepetitionWithSeparator}}),Object.defineProperty(t,"Alternation",{enumerable:!0,get:function(){return i.Alternation}}),Object.defineProperty(t,"Alternative",{enumerable:!0,get:function(){return i.Alternative}}),Object.defineProperty(t,"serializeGrammar",{enumerable:!0,get:function(){return i.serializeGrammar}}),Object.defineProperty(t,"serializeProduction",{enumerable:!0,get:function(){return i.serializeProduction}}),n(492)),o=(Object.defineProperty(t,"GAstVisitor",{enumerable:!0,get:function(){return r.GAstVisitor}}),n(493));Object.defineProperty(t,"getProductionDslName",{enumerable:!0,get:function(){return o.getProductionDslName}}),Object.defineProperty(t,"isOptionalProd",{enumerable:!0,get:function(){return o.isOptionalProd}}),Object.defineProperty(t,"isBranchingProd",{enumerable:!0,get:function(){return o.isBranchingProd}}),Object.defineProperty(t,"isSequenceProd",{enumerable:!0,get:function(){return o.isSequenceProd}})},function(e,t,n){"use strict";var i=n(227),r=n(21),o=n(450),a=n(0);e.exports=function(e,t){return(a(e)?i:r)(e,o(t))}},function(e,t,n){"use strict";var i=n(32),r=n(13),o=n(445),a=n(0);e.exports=function(e,t){return(a(e)?i:o)(e,r(t,3))}},function(e,i,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(n({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(i,"__esModule",{value:!0}),i.EmbeddedActionsParser=i.CstParser=i.Parser=i.EMPTY_ALT=i.ParserDefinitionErrorType=i.DEFAULT_RULE_CONFIG=i.DEFAULT_PARSER_CONFIG=i.END_OF_FILE=void 0,a(t(8))),l=a(t(4)),c=a(t(3)),u=a(t(15)),h=a(t(7)),d=a(t(17)),p=t(37),f=t(477),a=t(26),m=t(41),g=t(511),y=t(246),b=t(516),v=t(517),x=t(521),I=t(522),S=t(523),_=t(524),C=t(525),w=t(526),E=t(527),T=t(528),B=t(67);i.END_OF_FILE=(0,a.createTokenInstance)(a.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(i.END_OF_FILE),i.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:m.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),i.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){return undefined},resyncEnabled:!0}),(t=i.ParserDefinitionErrorType||(i.ParserDefinitionErrorType={}))[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION",i.EMPTY_ALT=function(e){return void 0===e&&(e=undefined),function(){return e}};R.performSelfAnalysis=function(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.\t\nUse the **instance** method with the same name instead.")},R.prototype.performSelfAnalysis=function(){var r=this;this.TRACE_INIT("performSelfAnalysis",function(){r.selfAnalysisDone=!0;var e,n=r.className,i=(r.TRACE_INIT("toFastProps",function(){(0,p.toFastProperties)(r)}),r.TRACE_INIT("Grammar Recording",function(){try{r.enableRecording(),(0,c["default"])(r.definedRulesNames,function(e){var t,n=r[e].originalGrammarAction;r.TRACE_INIT("".concat(e," Rule"),function(){t=r.topLevelRuleRecord(e,n)}),r.gastProductionsCache[e]=t})}finally{r.disableRecording()}}),[]);if(r.TRACE_INIT("Grammar Resolving",function(){i=(0,g.resolveGrammar)({rules:(0,u["default"])(r.gastProductionsCache)}),r.definitionErrors=r.definitionErrors.concat(i)}),r.TRACE_INIT("Grammar Validations",function(){var e,t;(0,s["default"])(i)&&!1===r.skipValidations&&(e=(0,g.validateGrammar)({rules:(0,u["default"])(r.gastProductionsCache),tokenTypes:(0,u["default"])(r.tokensMap),errMsgProvider:m.defaultGrammarValidatorErrorProvider,grammarName:n}),t=(0,B.validateLookahead)({lookaheadStrategy:r.lookaheadStrategy,rules:(0,u["default"])(r.gastProductionsCache),tokenTypes:(0,u["default"])(r.tokensMap),grammarName:n}),r.definitionErrors=r.definitionErrors.concat(e,t))}),(0,s["default"])(r.definitionErrors)&&(r.recoveryEnabled&&r.TRACE_INIT("computeAllProdsFollows",function(){var e=(0,f.computeAllProdsFollows)((0,u["default"])(r.gastProductionsCache));r.resyncFollows=e}),r.TRACE_INIT("ComputeLookaheadFunctions",function(){var e,t;null!=(t=(e=r.lookaheadStrategy).initialize)&&t.call(e,{rules:(0,u["default"])(r.gastProductionsCache)}),r.preComputeLookaheadFunctions((0,u["default"])(r.gastProductionsCache))})),!R.DEFER_DEFINITION_ERRORS_HANDLING&&!(0,s["default"])(r.definitionErrors))throw e=(0,l["default"])(r.definitionErrors,function(e){return e.message}),new Error("Parser Definition Errors detected:\n ".concat(e.join("\n-------------------------------\n")))})},R.DEFER_DEFINITION_ERRORS_HANDLING=!1;a=R;function R(e,t){this.definitionErrors=[],this.selfAnalysisDone=!1;var n=this;if(n.initErrorHandler(t),n.initLexerAdapter(),n.initLooksAhead(t),n.initRecognizerEngine(e,t),n.initRecoverable(t),n.initTreeBuilder(t),n.initContentAssist(),n.initGastRecorder(t),n.initPerformanceTracer(t),(0,h["default"])(t,"ignoredIssues"))throw new Error("The <ignoredIssues> IParserConfig property has been deprecated.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n\tSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n\tFor further details.");this.skipValidations=((0,h["default"])(t,"skipValidations")?t:i.DEFAULT_PARSER_CONFIG).skipValidations}i.Parser=a,(0,T.applyMixins)(a,[y.Recoverable,b.LooksAhead,v.TreeBuilder,x.LexerAdapter,S.RecognizerEngine,I.RecognizerApi,_.ErrorHandler,C.ContentAssist,w.GastRecorder,E.PerformanceTracer]);o(O,N=a);var N,t=O;function O(e,t){void 0===t&&(t=i.DEFAULT_PARSER_CONFIG);t=(0,d["default"])(t);return t.outputCst=!0,N.call(this,e,t)||this}i.CstParser=t;o(k,L=a);var L,T=k;function k(e,t){void 0===t&&(t=i.DEFAULT_PARSER_CONFIG);t=(0,d["default"])(t);return t.outputCst=!1,L.call(this,e,t)||this}i.EmbeddedActionsParser=T},function(e,t,n){"use strict";var i=n(221),r=n(74),o=n(9);e.exports=function(e){return(o(e)?i:r)(e)}},function(e,t,n){"use strict";var i=n(452),r=n(225);e.exports=function(e,t){return null!=e&&r(e,t,i)}},function(e,t,n){"use strict";var i=n(74),r=n(24),o=n(50),a=n(0),s=n(9),l=n(51),c=n(29),u=n(77),h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null!=e){if(s(e)&&(a(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||u(e)||o(e)))return!e.length;var t,n=r(e);if("[object Map]"==n||"[object Set]"==n)return!e.size;if(c(e))return!i(e).length;for(t in e)if(h.call(e,t))return!1}return!0}},function(e,t,n){"use strict";var i=n(30),r=n(76);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=n(211),r="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,n=n||r||Function("return this")();e.exports=n},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=i(e);return null!=e&&("object"==t||"function"==t)}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return null!=e&&"object"==i(e)}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=n(404),o=n(436),a=n(35),s=n(0),l=n(443);e.exports=function(e){return"function"==typeof e?e:null==e?a:"object"==i(e)?s(e)?o(e[0],e[1]):r(e):l(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInput=function(e){e=i[e];if(BI.isNull(e))throw new TypeError;return e.xtype},t.input=function(t){return function(e){i[t]=e}};var i={}},function(e,t,n){"use strict";var i=n(451),r=n(6);e.exports=function(e){return null==e?[]:i(e,r(e))}},function(e,t,n){"use strict";var i=n(98);e.exports=function(e){return(null==e?0:e.length)?i(e,1):[]}},function(e,t,n){"use strict";var i=n(453);e.exports=function(e){return i(e,4)}},function(e,t,n){"use strict";var r=n(97),o=n(9),a=n(39),s=n(38),l=n(15),c=Math.max;e.exports=function(e,t,n,i){return e=o(e)?e:l(e),n=n&&!i?s(n):0,i=e.length,n<0&&(n=c(i+n,0)),a(e)?n<=i&&-1<e.indexOf(t,n):!!i&&-1<r(e,t,n)}},function(e,t,n){"use strict";var i=n(393),r=n(398);e.exports=function(e,t){return e=r(e,t),i(e)?e:undefined}},function(e,t,n){"use strict";var i=n(25),r=n(394),o=n(395),a=i?i.toStringTag:undefined;e.exports=function(e){return null==e?e===undefined?"[object Undefined]":"[object Null]":(a&&a in Object(e)?r:o)(e)}},function(e,t,n){"use strict";var i=n(446),n=n(449)(i);e.exports=n},function(e,t,n){"use strict";e.exports=function(e){return e===undefined}},function(e,t,n){"use strict";var o=n(508),a=n(21),s=n(13),l=n(509),c=n(0);e.exports=function(e,t,n){var i=c(e)?o:l,r=arguments.length<3;return i(e,s(t,4),n,r,a)}},function(e,t,n){"use strict";var i=n(392),r=n(75),o=n(399),a=n(213),s=n(400),l=n(20),c=n(212),u="[object Map]",h="[object Promise]",d="[object Set]",p="[object WeakMap]",f="[object DataView]",m=c(i),g=c(r),y=c(o),b=c(a),v=c(s),x=l;(i&&x(new i(new ArrayBuffer(1)))!=f||r&&x(new r)!=u||o&&x(o.resolve())!=h||a&&x(new a)!=d||s&&x(new s)!=p)&&(x=function x(e){var t=l(e),e="[object Object]"==t?e.constructor:undefined,e=e?c(e):"";if(e)switch(e){case m:return f;case g:return u;case y:return h;case b:return d;case v:return p}return t}),e.exports=x},function(e,t,n){"use strict";n=n(10).Symbol;e.exports=n},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.tokenMatcher=t.createTokenInstance=t.EOF=t.createToken=t.hasTokenLabel=t.tokenName=t.tokenLabel=void 0,i(n(39))),o=i(n(7)),a=i(n(22)),i=n(65),s=n(27);function l(e){return(0,r["default"])(e.LABEL)&&""!==e.LABEL}t.tokenLabel=function(e){return l(e)?e.LABEL:e.name},t.tokenName=function(e){return e.name},t.hasTokenLabel=l;var c="parent",u="categories",h="label",d="group",p="push_mode",f="pop_mode",m="longer_alt",g="line_breaks",y="start_chars_hint";function b(e){var t=e.pattern,n={};if(n.name=e.name,(0,a["default"])(t)||(n.PATTERN=t),(0,o["default"])(e,c))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";return(0,o["default"])(e,u)&&(n.CATEGORIES=e[u]),(0,s.augmentTokenTypes)([n]),(0,o["default"])(e,h)&&(n.LABEL=e[h]),(0,o["default"])(e,d)&&(n.GROUP=e[d]),(0,o["default"])(e,f)&&(n.POP_MODE=e[f]),(0,o["default"])(e,p)&&(n.PUSH_MODE=e[p]),(0,o["default"])(e,m)&&(n.LONGER_ALT=e[m]),(0,o["default"])(e,g)&&(n.LINE_BREAKS=e[g]),(0,o["default"])(e,y)&&(n.START_CHARS_HINT=e[y]),n}t.createToken=b,t.EOF=b({name:"EOF",pattern:i.Lexer.NA}),(0,s.augmentTokenTypes)([t.EOF]),t.createTokenInstance=function(e,t,n,i,r,o,a,s){return{image:t,startOffset:n,endOffset:i,startLine:r,endLine:o,startColumn:a,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return(0,s.tokenStructuredMatcher)(e,t)}},function(e,i,t){"use strict";var n=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(i,"__esModule",{value:!0}),i.isTokenType=i.hasExtendingTokensTypesMapProperty=i.hasExtendingTokensTypesProperty=i.hasCategoriesProperty=i.hasShortKeyProperty=i.singleAssignCategoriesToksMap=i.assignCategoriesMapProp=i.assignCategoriesTokensProp=i.assignTokenDefaultProps=i.expandCategories=i.augmentTokenTypes=i.tokenIdxToClass=i.tokenShortNameIdx=i.tokenStructuredMatcherNoCategories=i.tokenStructuredMatcher=void 0,n(t(8))),a=n(t(66)),r=n(t(0)),s=n(t(16)),l=n(t(103)),c=n(t(4)),u=n(t(3)),h=n(t(7)),d=n(t(18)),p=n(t(17));function f(e){for(var t=(0,p["default"])(e),n=e,i=!0;i;){var n=(0,a["default"])((0,s["default"])((0,c["default"])(n,function(e){return e.CATEGORIES}))),r=(0,l["default"])(n,t),t=t.concat(r);(0,o["default"])(r)?i=!1:n=r}return t}function m(e){(0,u["default"])(e,function(e){v(e)||((i.tokenIdxToClass[i.tokenShortNameIdx]=e).tokenTypeIdx=i.tokenShortNameIdx++),x(e)&&!(0,r["default"])(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),x(e)||(e.CATEGORIES=[]),I(e)||(e.categoryMatches=[]),S(e)||(e.categoryMatchesMap={})})}function g(e){(0,u["default"])(e,function(n){n.categoryMatches=[],(0,u["default"])(n.categoryMatchesMap,function(e,t){n.categoryMatches.push(i.tokenIdxToClass[t].tokenTypeIdx)})})}function y(e){(0,u["default"])(e,function(e){b([],e)})}function b(n,i){(0,u["default"])(n,function(e){i.categoryMatchesMap[e.tokenTypeIdx]=!0}),(0,u["default"])(i.CATEGORIES,function(e){var t=n.concat(i);(0,d["default"])(t,e)||b(t,e)})}function v(e){return(0,h["default"])(e,"tokenTypeIdx")}function x(e){return(0,h["default"])(e,"CATEGORIES")}function I(e){return(0,h["default"])(e,"categoryMatches")}function S(e){return(0,h["default"])(e,"categoryMatchesMap")}i.tokenStructuredMatcher=function(e,t){return(e=e.tokenTypeIdx)===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[e]},i.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},i.tokenShortNameIdx=1,i.tokenIdxToClass={},i.augmentTokenTypes=function(e){m(e=f(e)),y(e),g(e),(0,u["default"])(e,function(e){e.isParent=0<e.categoryMatches.length})},i.expandCategories=f,i.assignTokenDefaultProps=m,i.assignCategoriesTokensProp=g,i.assignCategoriesMapProp=y,i.singleAssignCategoriesToksMap=b,i.hasShortKeyProperty=v,i.hasCategoriesProperty=x,i.hasExtendingTokensTypesProperty=I,i.hasExtendingTokensTypesMapProperty=S,i.isTokenType=function(e){return(0,h["default"])(e,"tokenTypeIdx")}},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaInserter=void 0;var i=n(1),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{"default":e};t=s(t);if(t&&t.has(e))return t.get(e);var n,i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=r?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n])}i["default"]=e,t&&t.set(e,i);return i}(n(304)),f=n(47);function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function s(e){return e?n:t})(e))}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function c(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var m=/(\$[{][^}]*[}])/,n=(0,i.shortcut)()((n=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return c(o(e=r.call.apply(r,[this].concat(n))||this),"formulaEditor",void 0),c(o(e),"props",{value:{formula:""}}),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.getToolbarLayout=function(){return{type:BI.Layout.xtype}},n.render=function(){var t=this;return{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.FormulaEditor.xtype,cls:"bi-border",ref:function(e){t.formulaEditor=e},watermark:BI.i18nText("BI-Basic_Formula_Watermark"),listeners:[{eventName:BI.FormulaEditor.EVENT_CHANGE,action:function(){t.validate()}},{eventName:"EVENT_SHOW_HINT",action:function(e){t.fireEvent("EVENT_SHOW_HINT",BI.first(e))}},{eventName:"EVENT_SELECT_HINT",action:function(e){t.fireEvent("EVENT_SELECT_HINT",e)}}]},height:155},this.getToolbarLayout()]}},n.mounted=function(){this.setValue(this.options.value.formula)},n.insertFunction=function(e){this.formulaEditor.insertFunction(e)},n.insertField=function(e){this.formulaEditor.insertField(e,!0)},n.getValue=function(){return{formula:this.formulaEditor.getValue()}},n.validate=function(){""===this.formulaEditor.getValue()?this.formulaEditor.hideTip():this.fireEvent("EVENT_VALIDATE")},n.setValidation=function(e){e.validation?this.formulaEditor.hideTip():this.formulaEditor.showTip(BI.i18nText("BI-Basic_Formula_Invalid"))},n.setValue=function(e){this.formulaEditor.refresh(),this.formulaEditor.setValue(""),this.insertFormula(e),this.validate()},n.analyzeContent=function(e){return e.match(/\$[{][^}]*[}]|\w+|\$\{[^$()+\-*/)$,]*\w\}|\$\{[^$()+\-*/]*\w\}|\$\{[^$()+\-*/]*[\u4e00-\u9fa5]\}|\w|(.)|\n/g)},n.paramFormatter=function(e){return(0,f.getVarDisplayNameByValue)(e)},n.insertFormula=function(){var a=this,e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:"",t=1<arguments.length?arguments[1]:undefined,e=this.analyzeContent(e)||[],s=[],l=[],c=0,u=0,h="",d=(BI.isNotNull(t)&&(c=t.line,u=t.ch),this.formulaEditor.getParamWrap());e.forEach(function(e){var t,n,i,r,o;m.test(e)?(t=e.substring(2,e.length-1),n=a.paramFormatter(t),i=d+n.replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)})+d,r=p.Pos(c,u),h+=i,u+=i.length,o=p.Pos(c,u),s.push({from:r,to:o,value:t,invalid:/^<!.*!>$/.test(n),text:i})):(BI.isNotNull((0,f.isBelong2FormulaFunction)(e))&&(r=p.Pos(c,u),o=p.Pos(c,u+e.length),l.push({from:r,to:o,value:e})),"\n"===e&&(c++,u=0),h+=e,"\n"!==e&&(u+=e.length))}),this.formulaEditor.insertString(h),BI.each(s,function(e,t){a.formulaEditor.markField(t)}),BI.each(l,function(e,t){a.formulaEditor.markFunction(t)})},t}(BI.Widget),c(n,"xtype","bi.formula_operating_panel.inserter"),i=n))||i;t.FormulaInserter=n},function(e,t,n){"use strict";var i=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||i)}},function(e,t,n){"use strict";var i=n(20),r=n(11);e.exports=function(e){return!!r(e)&&("[object Function]"==(e=i(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)}},function(e,t,n){"use strict";e.exports=function(t){return function(e){return t(e)}}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}},function(e,t,n){"use strict";e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){"use strict";var i=n(59);e.exports=function(e){var t;return"string"==typeof e||i(e)?e:"0"==(t=e+"")&&1/e==-1/0?"-0":t}},function(e,t,n){"use strict";e.exports=function(e){return e}},function(e,t,n){"use strict";var c=n(60),u=n(89);e.exports=function(e,t,n,i){for(var r=!n,o=(n=n||{},-1),a=t.length;++o<a;){var s=t[o],l=i?i(n[s],e[s],s,n,e):undefined;l===undefined&&(l=e[s]),(r?u:c)(n,s,l)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toFastProperties=t.timer=t.PRINT_ERROR=t.PRINT_WARNING=void 0;var i=n(474),r=(Object.defineProperty(t,"PRINT_WARNING",{enumerable:!0,get:function(){return i.PRINT_WARNING}}),Object.defineProperty(t,"PRINT_ERROR",{enumerable:!0,get:function(){return i.PRINT_ERROR}}),n(475)),o=(Object.defineProperty(t,"timer",{enumerable:!0,get:function(){return r.timer}}),n(476));Object.defineProperty(t,"toFastProperties",{enumerable:!0,get:function(){return o.toFastProperties}})},function(e,t,n){"use strict";var i=n(478);e.exports=function(e){var t=(e=i(e))%1;return e==e?t?e-t:e:0}},function(e,t,n){"use strict";var i=n(20),r=n(0),o=n(12);e.exports=function(e){return"string"==typeof e||!r(e)&&o(e)&&"[object String]"==i(e)}},function(e,t,n){"use strict";e.exports=n(502)},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.defaultGrammarValidatorErrorProvider=t.defaultGrammarResolverErrorProvider=t.defaultParserErrorProvider=void 0,n(26)),a=i(n(40)),o=i(n(4)),s=i(n(23)),l=n(2),c=n(2);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,n=e.actual,e=(e.previous,e.ruleName,(0,r.hasTokenLabel)(t)?"--\x3e ".concat((0,r.tokenLabel)(t)," <--"):"token of type --\x3e ".concat(t.name," <--"));return"Expecting ".concat(e," but found --\x3e '").concat(n.image,"' <--")},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;e.ruleName;return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,n=e.actual,i=(e.previous,e.customUserDescription),e=(e.ruleName,"Expecting: "),n="\nbut found: '"+(0,a["default"])(n).image+"'";return i?e+i+n:(i=(0,s["default"])(t,function(e,t){return e.concat(t)},[]),t=(0,o["default"])(i,function(e){return"[".concat((0,o["default"])(e,function(e){return(0,r.tokenLabel)(e)}).join(", "),"]")}),i=(0,o["default"])(t,function(e,t){return"  ".concat(t+1,". ").concat(e)}),e+"one of these possible Token sequences:\n".concat(i.join("\n"))+n)},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,n=e.actual,i=e.customUserDescription,e=(e.ruleName,"Expecting: "),n="\nbut found: '"+(0,a["default"])(n).image+"'";return i?e+i+n:(i=(0,o["default"])(t,function(e){return"[".concat((0,o["default"])(e,function(e){return(0,r.tokenLabel)(e)}).join(","),"]")}),e+("expecting at least one iteration which starts with one of these possible Token sequences::\n  "+"<".concat(i.join(" ,"),">"))+n)}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var e=e.name,n=(0,a["default"])(t),i=n.idx,r=(0,c.getProductionDslName)(n),n=(n=n)instanceof l.Terminal?n.terminalType.name:n instanceof l.NonTerminal?n.nonTerminalName:"",o=0<i,r="->".concat(r).concat(o?i:"","<- ").concat(n?"with argument: ->".concat(n,"<-"):"","\n                  appears more than once (").concat(t.length," times) in the top level rule: ->").concat(e,"<-.                  \n                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ");return r=(r=r.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\n"+"The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <".concat(e.name,">.\n")+"To resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=(0,o["default"])(e.prefixPath,function(e){return(0,r.tokenLabel)(e)}).join(", "),n=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <".concat(e.ambiguityIndices.join(" ,"),"> due to common lookahead prefix\n")+"in <OR".concat(n,"> inside <").concat(e.topLevelRule.name,"> Rule,\n")+"<".concat(t,"> may appears as a prefix path in all these alternatives.\n")+"See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=(0,o["default"])(e.prefixPath,function(e){return(0,r.tokenLabel)(e)}).join(", "),n=0===e.alternation.idx?"":e.alternation.idx,n="Ambiguous Alternatives Detected: <".concat(e.ambiguityIndices.join(" ,"),"> in <OR").concat(n,">")+" inside <".concat(e.topLevelRule.name,"> Rule,\n")+"<".concat(t,"> may appears as a prefix path in all these alternatives.\n");return n+="See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError:function(e){var t=(0,c.getProductionDslName)(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <".concat(t,"> within Rule <").concat(e.topLevelRule.name,"> can never consume any tokens.\n")+"This could lead to an infinite loop."},buildTokenNameError:function(e){return"deprecated"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <".concat(e.emptyChoiceIdx+1,">")+" in <OR".concat(e.alternation.idx,"> inside <").concat(e.topLevelRule.name,"> Rule.\n")+"Only the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n"+"<OR".concat(e.alternation.idx,"> inside <").concat(e.topLevelRule.name,"> Rule.\n has ").concat(e.alternation.definition.length+1," alternatives.")},buildLeftRecursionError:function(e){var t=e.topLevelRule.name,e=(0,o["default"])(e.leftRecursionPath,function(e){return e.name}),e="".concat(t," --\x3e ").concat(e.concat([t]).join(" --\x3e "));return"Left Recursion found in grammar.\n"+"rule: <".concat(t,"> can be invoked from itself (directly or indirectly)\n")+"without consuming any Tokens. The grammar path that causes this is: \n ".concat(e,"\n")+" To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_factoring."},buildInvalidRuleNameError:function(e){return"deprecated"},buildDuplicateRuleNameError:function(e){var t=e.topLevelRule instanceof l.Rule?e.topLevelRule.name:e.topLevelRule;return"Duplicate definition, rule: ->".concat(t,"<- is already defined in the grammar: ->").concat(e.grammarName,"<-")}}},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o,a,s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},l=function(e){return e&&e.__esModule?e:{"default":e}},g=(Object.defineProperty(t,"__esModule",{value:!0}),t.areTokenCategoriesNotUsed=t.isStrictPrefixOfPath=t.containsPath=t.getLookaheadPathsForOptionalProd=t.getLookaheadPathsForOr=t.lookAheadSequenceFromAlternatives=t.buildSingleAlternativeLookaheadFunction=t.buildAlternativesLookAheadFunc=t.buildLookaheadFuncForOptionalProd=t.buildLookaheadFuncForOr=t.getLookaheadPaths=t.getProdType=t.PROD_TYPE=void 0,l(n(8))),c=l(n(16)),u=l(n(64)),y=l(n(4)),b=l(n(3)),f=l(n(7)),m=l(n(23)),v=n(68),l=n(91),h=n(27),d=n(2),n=n(2);function p(e){if(e instanceof d.Option||"Option"===e)return o.OPTION;if(e instanceof d.Repetition||"Repetition"===e)return o.REPETITION;if(e instanceof d.RepetitionMandatory||"RepetitionMandatory"===e)return o.REPETITION_MANDATORY;if(e instanceof d.RepetitionMandatoryWithSeparator||"RepetitionMandatoryWithSeparator"===e)return o.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof d.RepetitionWithSeparator||"RepetitionWithSeparator"===e)return o.REPETITION_WITH_SEPARATOR;if(e instanceof d.Alternation||"Alternation"===e)return o.ALTERNATION;throw Error("non exhaustive match")}(a=o=t.PROD_TYPE||(t.PROD_TYPE={}))[a.OPTION=0]="OPTION",a[a.REPETITION=1]="REPETITION",a[a.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",a[a.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",a[a.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",a[a.ALTERNATION=5]="ALTERNATION",t.getProdType=p,t.getLookaheadPaths=function(e){var t=e.occurrence,n=e.rule,i=e.prodType,e=e.maxLookahead;return(i=p(i))===o.ALTERNATION?R(t,n,e):N(t,n,i,e)},t.buildLookaheadFuncForOr=function(e,t,n,i,r,o){return e=R(e,t,n),o(e,i,L(e)?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,r)},t.buildLookaheadFuncForOptionalProd=function(e,t,n,i,r,o){return e=N(e,t,r,n),t=L(e)?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,o(e[0],t,i)},t.buildAlternativesLookAheadFunc=function(h,e,d,t){var n,p=h.length,i=(0,u["default"])(h,function(e){return(0,u["default"])(e,function(e){return 1===e.length})});return e?function(e){for(var t=(0,y["default"])(e,function(e){return e.GATE}),n=0;n<p;n++){var i=h[n],r=i.length,o=t[n];if(o===undefined||!1!==o.call(this))e:for(var a=0;a<r;a++){for(var s=i[a],l=s.length,c=0;c<l;c++){var u=this.LA(c+1);if(!1===d(u,s[c]))continue e}return n}}return undefined}:i&&!t?(e=(0,y["default"])(h,function(e){return(0,c["default"])(e)}),n=(0,m["default"])(e,function(t,e,n){return(0,b["default"])(e,function(e){(0,f["default"])(t,e.tokenTypeIdx)||(t[e.tokenTypeIdx]=n),(0,b["default"])(e.categoryMatches,function(e){(0,f["default"])(t,e)||(t[e]=n)})}),t},{}),function(){var e=this.LA(1);return n[e.tokenTypeIdx]}):function(){for(var e=0;e<p;e++){var t=h[e],n=t.length;e:for(var i=0;i<n;i++){for(var r=t[i],o=r.length,a=0;a<o;a++){var s=this.LA(a+1);if(!1===d(s,r[a]))continue e}return e}}return undefined}},t.buildSingleAlternativeLookaheadFunction=function(o,a,e){var t,n,i=(0,u["default"])(o,function(e){return 1===e.length}),s=o.length;return i&&!e?1===(i=(0,c["default"])(o)).length&&(0,g["default"])(i[0].categoryMatches)?(t=i[0].tokenTypeIdx,function(){return this.LA(1).tokenTypeIdx===t}):(n=(0,m["default"])(i,function(t,e,n){return t[e.tokenTypeIdx]=!0,(0,b["default"])(e.categoryMatches,function(e){t[e]=!0}),t},[]),function(){var e=this.LA(1);return!0===n[e.tokenTypeIdx]}):function(){e:for(var e=0;e<s;e++){for(var t=o[e],n=t.length,i=0;i<n;i++){var r=this.LA(i+1);if(!1===a(r,t[i]))continue e}return!0}return!1}};x=l.RestWalker,s(S,x),S.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},S.prototype.checkIsTarget=function(e,t,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=n.concat(i),!0)},S.prototype.walkOption=function(e,t,n){this.checkIsTarget(e,o.OPTION,t,n)||x.prototype.walkOption.call(this,e,t,n)},S.prototype.walkAtLeastOne=function(e,t,n){this.checkIsTarget(e,o.REPETITION_MANDATORY,t,n)||x.prototype.walkOption.call(this,e,t,n)},S.prototype.walkAtLeastOneSep=function(e,t,n){this.checkIsTarget(e,o.REPETITION_MANDATORY_WITH_SEPARATOR,t,n)||x.prototype.walkOption.call(this,e,t,n)},S.prototype.walkMany=function(e,t,n){this.checkIsTarget(e,o.REPETITION,t,n)||x.prototype.walkOption.call(this,e,t,n)},S.prototype.walkManySep=function(e,t,n){this.checkIsTarget(e,o.REPETITION_WITH_SEPARATOR,t,n)||x.prototype.walkOption.call(this,e,t,n)};var x,I=S;function S(e,t,n){var i=x.call(this)||this;return i.topProd=e,i.targetOccurrence=t,i.targetProdType=n,i}_=n.GAstVisitor,s(w,_),w.prototype.checkIsTarget=function(e,t){e.idx!==this.targetOccurrence||this.targetProdType!==t||this.targetRef!==undefined&&e!==this.targetRef||(this.result=e.definition)},w.prototype.visitOption=function(e){this.checkIsTarget(e,o.OPTION)},w.prototype.visitRepetition=function(e){this.checkIsTarget(e,o.REPETITION)},w.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,o.REPETITION_MANDATORY)},w.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,o.REPETITION_MANDATORY_WITH_SEPARATOR)},w.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,o.REPETITION_WITH_SEPARATOR)},w.prototype.visitAlternation=function(e){this.checkIsTarget(e,o.ALTERNATION)};var _,C=w;function w(e,t,n){var i=_.call(this)||this;return i.targetOccurrence=e,i.targetProdType=t,i.targetRef=n,i.result=[],i}function E(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=[];return t}function T(e){for(var t=[""],n=0;n<e.length;n++){for(var i=e[n],r=[],o=0;o<t.length;o++){var a=t[o];r.push(a+"_"+i.tokenTypeIdx);for(var s=0;s<i.categoryMatches.length;s++){var l="_"+i.categoryMatches[s];r.push(a+l)}}t=r}return t}function B(e,c){for(var e=(0,y["default"])(e,function(e){return(0,v.possiblePathsFrom)([e],1)}),u=E(e.length),h=(0,y["default"])(e,function(e){var t={};return(0,b["default"])(e,function(e){e=T(e.partialPath);(0,b["default"])(e,function(e){t[e]=!0})}),t}),d=e,p=1;p<=c;p++)for(var f=d,d=E(f.length),m=function m(t){for(var e=f[t],n=0;n<e.length;n++){var i=e[n].partialPath,r=e[n].suffixDef,o=T(i);if(function(e,t,n){for(var i=0;i<e.length;i++)if(i!==n)for(var r=e[i],o=0;o<t.length;o++)if(!0===r[t[o]])return!1;return!0}(h,o,t)||(0,g["default"])(r)||i.length===c){var a=u[t];if(!1===O(a,i)){a.push(i);for(var s=0;s<o.length;s++){var l=o[s];h[t][l]=!0}}}else{a=(0,v.possiblePathsFrom)(r,p+1,i);d[t]=d[t].concat(a),(0,b["default"])(a,function(e){e=T(e.partialPath);(0,b["default"])(e,function(e){h[t][e]=!0})})}}},t=0;t<f.length;t++)m(t);return u}function R(e,t,n,i){e=new C(e,o.ALTERNATION,i);return t.accept(e),B(e.result,n)}function N(e,t,n,i){var r=new C(e,n),r=(t.accept(r),r.result),t=new I(t,e,n).startWalking();return B([new d.Alternative({definition:r}),new d.Alternative({definition:t})],i)}function O(e,t){e:for(var n=0;n<e.length;n++){var i=e[n];if(i.length===t.length){for(var r=0;r<i.length;r++){var o=t[r],a=i[r];if(!1==(o===a||a.categoryMatchesMap[o.tokenTypeIdx]!==undefined))continue e}return!0}}return!1}function L(e){return(0,u["default"])(e,function(e){return(0,u["default"])(e,function(e){return(0,u["default"])(e,function(e){return(0,g["default"])(e.categoryMatches)})})})}t.lookAheadSequenceFromAlternatives=B,t.getLookaheadPathsForOr=R,t.getLookaheadPathsForOptionalProd=N,t.containsPath=O,t.isStrictPrefixOfPath=function(e,n){return e.length<n.length&&(0,u["default"])(e,function(e,t){t=n[t];return e===t||t.categoryMatchesMap[e.tokenTypeIdx]})},t.areTokenCategoriesNotUsed=L},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.EarlyExitException=t.NotAllInputParsedException=t.NoViableAltException=t.MismatchedTokenException=t.isRecognitionException=void 0,a(n(18))),l="MismatchedTokenException",c="NoViableAltException",u="EarlyExitException",h="NotAllInputParsedException",d=[l,c,u,h];Object.freeze(d),t.isRecognitionException=function(e){return(0,s["default"])(d,e.name)};p=Error,o(f,p);var p,n=f;function f(e,t){var n=this.constructor,e=p.call(this,e)||this;return e.token=t,e.resyncedTokens=[],Object.setPrototypeOf(e,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,e.constructor),e}o(g,m=n);var m,a=g;function g(e,t,n){e=m.call(this,e,t)||this;return e.previousToken=n,e.name=l,e}t.MismatchedTokenException=a;o(b,y=n);var y,a=b;function b(e,t,n){e=y.call(this,e,t)||this;return e.previousToken=n,e.name=c,e}t.NoViableAltException=a;o(x,v=n);var v,a=x;function x(e,t){e=v.call(this,e,t)||this;return e.name=h,e}t.NotAllInputParsedException=a;o(S,I=n);var I,a=S;function S(e,t,n){e=I.call(this,e,t)||this;return e.previousToken=n,e.name=u,e}t.EarlyExitException=a},function(e,t,n){"use strict";function i(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CONFIG=void 0;var a={type:"bi.pure_text",lineHeight:30,textAlign:"left",whiteSpace:"normal",expandIcon:"expander-down-font",collapseIcon:"expander-right-font",sortableIcon:"text-align-center-font"},t=(t.DEFAULT_CONFIG=a,BI.inherit(BI.Widget,{props:{baseCls:"bi-sticky-table-row",tagName:"tr",id:"",dimension:a,layer:0,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],items:[],draggable:!0,checkable:!0,checked:!1,half:!1,prevComponent:null},render:function(){var t=this;return{type:"bi.adaptive",cls:this.options.draggable?"enabled":"",ref:function(e){t.layout=e},items:this.getItems()}},getItems:function(){var t=this,n=this,i=this.options,e=r(r({},a),i.dimension);return this.text=BI.createWidget(e),[{type:"bi.adaptive",tagName:"td",cls:"".concat(i.freezeCols.includes(0)?"sticky-table-fix-first-col":""," first-col"),items:[{type:"bi.vertical_adapt",css:{minWidth:i.minColumnSize[0],maxWidth:i.maxColumnSize[0]},items:[i.prevComponent,i.draggable?{type:"bi.icon_label",extraCls:"bi-sticky-table-draggable-handler",cls:e.sortableIcon,width:30,height:30}:null,i.isParent?{_lgap:30*i.layer,type:"bi.icon_change_button",ref:function(e){t.arrow=e},handler:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,i.open?BI.Events.COLLAPSE:BI.Events.EXPAND)},cls:this._getExpandIcon(),width:30,height:30}:null,i.checkable?{_lgap:i.isParent?0:30*i.layer,type:"bi.multi_select_bar",ref:function(e){t.checkbox=e},selected:i.checked,halfSelected:i.half,width:30,iconWrapperWidth:30,height:30,text:"",listeners:o({},BI.MultiSelectBar.EVENT_CHANGE,function(e){n.fireEvent(BI.Controller.EVENT_CHANGE,BI.Events.CHANGE,e)})}:null,{_lgap:i.checkable||i.isParent?0:30*i.layer,width:"fill",el:this.text}]}]}].concat(BI.map(i.items,function(e,t){var n=i.freezeCols.includes(e+1)&&e<i.items.length-1;return{type:"bi.adaptive",extraCls:i.freezeCols.includes(e+1)&&e===i.items.length-1?"sticky-table-fix-last-col":n?"sticky-table-fix-first-col":"",cls:"sticky-table-fix-index-".concat(e+1,"-col"),css:{minWidth:i.minColumnSize[e+1],maxWidth:i.maxColumnSize[e+1]},tagName:"td",items:[r(r({},a),t)]}}))},_getExpandIcon:function(){var e=this.options,t=BI.extend({},a,e.dimension);return e.open?t.expandIcon:t.collapseIcon},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},shouldUpdate:function(n){var i=this.options;return BI.some(["open","layer","pId","id","dimension","items","columnSize","checked","half","cls"],function(e,t){return n[t]!==i[t]})},update:function(e){var t=this.options;e.cls!==t.cls&&(this.element.removeClass(t.cls).addClass(e.cls),t.cls=e.cls),e.dimension!==t.dimension&&(this.text.setText(e.dimension.text||e.dimension.value),t.dimension=e.dimension),e.open!==t.open&&(t.open=e.open,this.arrow)&&this.arrow.setIcon(this._getExpandIcon()),e.items!==t.items&&(t.items=e.items,this.layout.populate(this.getItems())),e.checked===t.checked&&e.half===t.half||(t.checked=e.checked,t.half=e.half,this.checkbox&&this.checkbox.setSelected(t.checked),this.checkbox&&this.checkbox.setHalfSelected(t.half))}}));BI.shortcut("bi.sticky_table_row",t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.token=t.allTokens=void 0;var n=n(49),i=(0,n.createToken)({name:"Unary",pattern:n.Lexer.NA}),r=(0,n.createToken)({name:"Addition",pattern:n.Lexer.NA}),o=(0,n.createToken)({name:"Multiplication",pattern:n.Lexer.NA}),a=(0,n.createToken)({name:"Equal",pattern:n.Lexer.NA}),s=(0,n.createToken)({name:"Compare",pattern:n.Lexer.NA}),r={WhiteSpace:(0,n.createToken)({name:"WhiteSpace",pattern:/\s+/,group:n.Lexer.SKIPPED}),String:(0,n.createToken)({name:"String",pattern:/("(\\\\|\\"|[^"])*"|'(\\\\|\\'|[^'])*')/}),Number:(0,n.createToken)({name:"Number",pattern:/[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?/i}),Date:(0,n.createToken)({name:"Date",pattern:/("bi-date-place-holder"|'bi-date-place-holder')/}),Boolean:(0,n.createToken)({name:"Boolean",pattern:/(true|false)/i}),Empty:(0,n.createToken)({name:"Empty",pattern:/(null|undefined)/i}),NaN:(0,n.createToken)({name:"NaN",pattern:/NaN/}),Comma:(0,n.createToken)({name:"Comma",pattern:/,/}),Func:(0,n.createToken)({name:"Func",pattern:/[A-Za-z0-9_.]+/}),LParen:(0,n.createToken)({name:"LParen",pattern:/\(/}),RParen:(0,n.createToken)({name:"RParen",pattern:/\)/}),LSquare:(0,n.createToken)({name:"LSquare",pattern:/\[/}),RSquare:(0,n.createToken)({name:"RSquare",pattern:/]/}),Plus:(0,n.createToken)({name:"Plus",pattern:/\+(?!\+)/,categories:[i,r]}),Minus:(0,n.createToken)({name:"Minus",pattern:/-(?!-)/,categories:[i,r]}),Unary:i,Addition:r,Multi:(0,n.createToken)({name:"Multi",pattern:/\*/,categories:[o]}),Div:(0,n.createToken)({name:"Div",pattern:/\//,categories:[o]}),Multiplication:o,LessOrEqual:(0,n.createToken)({name:"LessOrEqual",pattern:/<=/,categories:[s]}),GreaterOrEqual:(0,n.createToken)({name:"GreaterOrEqual",pattern:/>=/,categories:[s]}),Less:(0,n.createToken)({name:"Less",pattern:/</,categories:[s]}),Greater:(0,n.createToken)({name:"Greater",pattern:/>/,categories:[s]}),Compare:s,NotEqualStrict:(0,n.createToken)({name:"NotEqualStrict",pattern:/!==/,categories:[a]}),EqualLoose:(0,n.createToken)({name:"EqualLoose",pattern:/==/,categories:[a]}),NotEqualLoose:(0,n.createToken)({name:"NotEqualLoose",pattern:/!=/,categories:[a]}),Equal:a,EqualStrict:(0,n.createToken)({name:"EqualStrict",pattern:/=/,categories:[a]}),LogicNot:(0,n.createToken)({name:"LogicNot",pattern:/!/,categories:[i]}),LogicAnd:(0,n.createToken)({name:"LogicAnd",pattern:/&&/}),LogicOr:(0,n.createToken)({name:"LogicOr",pattern:/\|\|/}),BitAnd:(0,n.createToken)({name:"BitAnd",pattern:/&/})},o=[(t.token=r).WhiteSpace,r.Date,r.String,r.Number,r.NaN,r.Boolean,r.Empty,r.Func,r.LParen,r.RParen,r.LSquare,r.RSquare,r.Plus,r.Minus,r.Addition,r.Unary,r.Multi,r.Div,r.Multiplication,r.LessOrEqual,r.GreaterOrEqual,r.Less,r.Greater,r.Compare,r.NotEqualStrict,r.EqualLoose,r.NotEqualLoose,r.Equal,r.EqualStrict,r.LogicNot,r.LogicAnd,r.LogicOr,r.BitAnd,r.Comma];t.allTokens=o},function(e,t,n){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionDescriptionByFunctionName=function(t){var e=d.find(function(e){return e.name===t});return BI.isNotNull(e)?e.def:""},t.getFunctionTypeByFunctionName=function(t){var e=d.find(function(e){return e.name===t});if(BI.isNotNull(e))return e.type;return null},t.getSearchedFunctionNames=function(e){if(""===e)return[];var e=BI.Func.getSearchResult(p(),e,"val"),t=e.match,e=e.find;return t.sort(function(e,t){return e.value>t.value?1:-1}),e.sort(function(e,t){return e.value>t.value?1:-1}),[].concat(c(t),c(e))},t.getVarDescriptionByVarName=function(t){var e=h.find(function(e){return e.value===t});return BI.isNotNull(e)?e.def:""},t.getVarDisplayNameByValue=function(t){var e=h.find(function(e){return e.value===t});return e?e.text:"undefined"},t.isBelong2FormulaFunction=function(t){return p().find(function(e){return e.text.toLowerCase()===t.toLowerCase()})},t.isFormulaConfigCached=function(){return u},t.setFormulaConfigCache=function(e){u=!0,h=e.vars,BI.FormulaJSONs=e.JSONs,BI.FormulaCollections=e.JSONs.reduce(function(e,t){return e.push(t.name.toLowerCase(),t.name.toUpperCase()),e},[]),d=e.JSONs},t.transformFormulaJSONs2FunctionNames=p,t.transformFormulaJSONs2FunctionTypes=function(){return Object.keys(d.reduce(function(e,t){return t.type in e||(e[t.type]=[]),e},{})).map(function(e){return{text:e,title:e,value:e,cls:"bi-list-item-select",textAlign:"left",height:20,hgap:5}})},t.transformFormulaVarItems=function(){var r,o;return u?(r={},h.forEach(function(e){e.type in r?r[e.type].push(e):r[e.type]=[e]}),o=a.FORMULA_VAR_NODES.map(function(e){var t=BI.size(r[e.value]);return l(l({},e),{},{open:!0,height:25,text:BI.i18nText(e.i18nText)+(0<t?" - [".concat(t,"]"):"")})}),Object.keys(r).forEach(function(t){var n,i,e=a.FORMULA_VAR_NODES.find(function(e){return e.value===t});e&&(n=e.id,e=r[t],i=BI.size(e),o.push.apply(o,c(e.map(function(e,t){return{pId:n,id:BI.UUID(),text:e.text,value:e.value,lgap:16,layoutType:(t===i-1?BI.LastTreeLeafItem:BI.MidTreeLeafItem).xtype,type:s.FormulaVarItem.xtype,height:25}}))))}),o):[]};var i=n(305),a=n(48),s=n(306);function o(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function l(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var t,n;t=i,n=r[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function c(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var u=!1,h=[],d=[];function p(n){return Object.keys(d.reduce(function(e,t){return t.name in e||n&&t.type!==n||(e[t.name]=[]),e},{})).map(function(e){return{type:i.FormulaFunctionItem.xtype,text:e,title:e,value:e,height:20}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FORMULA_VAR_TYPES=t.FORMULA_VAR_NODES=t.DEFAULT_FUNCTION_TYPE=t.DEFAULT_FUNCTION_NAME=void 0;t.DEFAULT_FUNCTION_NAME="ABS";t.DEFAULT_FUNCTION_TYPE="MATH";var i={DATA_ITEMS:"DATA_ITEMS",VARS:"VARS",DATA_SET_VARS:"DATA_SET_VARS",REPORT_VARS:"REPORT_VARS",GLOBAL_VARS:"GLOBAL_VARS"},i=[{id:"1",pId:"-1",i18nText:"BI-Basic_Formula_Data_Items",value:(t.FORMULA_VAR_TYPES=i).DATA_ITEMS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"2",pId:"-1",i18nText:"BI-Basic_Formula_Vars",value:i.VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"3",pId:"-1",i18nText:"BI-Basic_Formula_Data_Set_Vars",value:i.DATA_SET_VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"4",pId:"-1",i18nText:"BI-Basic_Formula_Report_Vars",value:i.REPORT_VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"5",pId:"-1",i18nText:"BI-Basic_Formula_Global_Vars",value:i.GLOBAL_VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"}];t.FORMULA_VAR_NODES=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.createSyntaxDiagramsCode=t.clearCache=t.generateCstDts=t.GAstVisitor=t.serializeProduction=t.serializeGrammar=t.Terminal=t.Rule=t.RepetitionWithSeparator=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Repetition=t.Option=t.NonTerminal=t.Alternative=t.Alternation=t.defaultLexerErrorProvider=t.NoViableAltException=t.NotAllInputParsedException=t.MismatchedTokenException=t.isRecognitionException=t.EarlyExitException=t.defaultParserErrorProvider=t.LLkLookaheadStrategy=t.getLookaheadPaths=t.tokenName=t.tokenMatcher=t.tokenLabel=t.EOF=t.createTokenInstance=t.createToken=t.LexerDefinitionErrorType=t.Lexer=t.EMPTY_ALT=t.ParserDefinitionErrorType=t.EmbeddedActionsParser=t.CstParser=t.VERSION=void 0;var i=n(209),r=(Object.defineProperty(t,"VERSION",{enumerable:!0,get:function(){return i.VERSION}}),n(5)),o=(Object.defineProperty(t,"CstParser",{enumerable:!0,get:function(){return r.CstParser}}),Object.defineProperty(t,"EmbeddedActionsParser",{enumerable:!0,get:function(){return r.EmbeddedActionsParser}}),Object.defineProperty(t,"ParserDefinitionErrorType",{enumerable:!0,get:function(){return r.ParserDefinitionErrorType}}),Object.defineProperty(t,"EMPTY_ALT",{enumerable:!0,get:function(){return r.EMPTY_ALT}}),n(65)),a=(Object.defineProperty(t,"Lexer",{enumerable:!0,get:function(){return o.Lexer}}),Object.defineProperty(t,"LexerDefinitionErrorType",{enumerable:!0,get:function(){return o.LexerDefinitionErrorType}}),n(26)),s=(Object.defineProperty(t,"createToken",{enumerable:!0,get:function(){return a.createToken}}),Object.defineProperty(t,"createTokenInstance",{enumerable:!0,get:function(){return a.createTokenInstance}}),Object.defineProperty(t,"EOF",{enumerable:!0,get:function(){return a.EOF}}),Object.defineProperty(t,"tokenLabel",{enumerable:!0,get:function(){return a.tokenLabel}}),Object.defineProperty(t,"tokenMatcher",{enumerable:!0,get:function(){return a.tokenMatcher}}),Object.defineProperty(t,"tokenName",{enumerable:!0,get:function(){return a.tokenName}}),n(42)),l=(Object.defineProperty(t,"getLookaheadPaths",{enumerable:!0,get:function(){return s.getLookaheadPaths}}),n(247)),c=(Object.defineProperty(t,"LLkLookaheadStrategy",{enumerable:!0,get:function(){return l.LLkLookaheadStrategy}}),n(41)),u=(Object.defineProperty(t,"defaultParserErrorProvider",{enumerable:!0,get:function(){return c.defaultParserErrorProvider}}),n(43)),h=(Object.defineProperty(t,"EarlyExitException",{enumerable:!0,get:function(){return u.EarlyExitException}}),Object.defineProperty(t,"isRecognitionException",{enumerable:!0,get:function(){return u.isRecognitionException}}),Object.defineProperty(t,"MismatchedTokenException",{enumerable:!0,get:function(){return u.MismatchedTokenException}}),Object.defineProperty(t,"NotAllInputParsedException",{enumerable:!0,get:function(){return u.NotAllInputParsedException}}),Object.defineProperty(t,"NoViableAltException",{enumerable:!0,get:function(){return u.NoViableAltException}}),n(243)),d=(Object.defineProperty(t,"defaultLexerErrorProvider",{enumerable:!0,get:function(){return h.defaultLexerErrorProvider}}),n(2)),p=(Object.defineProperty(t,"Alternation",{enumerable:!0,get:function(){return d.Alternation}}),Object.defineProperty(t,"Alternative",{enumerable:!0,get:function(){return d.Alternative}}),Object.defineProperty(t,"NonTerminal",{enumerable:!0,get:function(){return d.NonTerminal}}),Object.defineProperty(t,"Option",{enumerable:!0,get:function(){return d.Option}}),Object.defineProperty(t,"Repetition",{enumerable:!0,get:function(){return d.Repetition}}),Object.defineProperty(t,"RepetitionMandatory",{enumerable:!0,get:function(){return d.RepetitionMandatory}}),Object.defineProperty(t,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return d.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"RepetitionWithSeparator",{enumerable:!0,get:function(){return d.RepetitionWithSeparator}}),Object.defineProperty(t,"Rule",{enumerable:!0,get:function(){return d.Rule}}),Object.defineProperty(t,"Terminal",{enumerable:!0,get:function(){return d.Terminal}}),n(2)),f=(Object.defineProperty(t,"serializeGrammar",{enumerable:!0,get:function(){return p.serializeGrammar}}),Object.defineProperty(t,"serializeProduction",{enumerable:!0,get:function(){return p.serializeProduction}}),Object.defineProperty(t,"GAstVisitor",{enumerable:!0,get:function(){return p.GAstVisitor}}),n(529));Object.defineProperty(t,"generateCstDts",{enumerable:!0,get:function(){return f.generateCstDts}}),t.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")};var m=n(538);Object.defineProperty(t,"createSyntaxDiagramsCode",{enumerable:!0,get:function(){return m.createSyntaxDiagramsCode}}),t.Parser=function(){throw new Error("The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.\t\nSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0")}},function(e,t,n){"use strict";var i=n(401),r=n(12),n=Object.prototype,o=n.hasOwnProperty,a=n.propertyIsEnumerable,n=i(function(){return arguments}())?i:function(e){return r(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=n},function(e,a,s){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=s(10),i=s(402),r="object"==t(a)&&a&&!a.nodeType&&a,o=r&&"object"==t(e)&&e&&!e.nodeType&&e,o=o&&o.exports===r?n.Buffer:undefined,r=o?o.isBuffer:undefined;e.exports=r||i}.call(this,s(46)(e))},function(e,a,s){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=s(211),i="object"==t(a)&&a&&!a.nodeType&&a,r=i&&"object"==t(e)&&e&&!e.nodeType&&e,o=r&&r.exports===i&&n.process,i=function(){try{var e=r&&r.require&&r.require("util").types;return e?e:o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=i}.call(this,s(46)(e))},function(e,t,n){"use strict";var i=n(406),r=n(407),o=n(408),a=n(409),n=n(410);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}s.prototype.clear=i,s.prototype["delete"]=r,s.prototype.get=o,s.prototype.has=a,s.prototype.set=n,e.exports=s},function(e,t,n){"use strict";var i=n(33);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},function(e,t,n){"use strict";n=n(19)(Object,"create");e.exports=n},function(e,t,n){"use strict";var i=n(424);e.exports=function(e,t){return e=e.__data__,i(t)?e["string"==typeof t?"string":"hash"]:e.map}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=i(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&r.test(e))&&-1<e&&e%1==0&&e<t}},function(e,t,n){"use strict";var i=n(0),r=n(88),o=n(437),a=n(224);e.exports=function(e,t){return i(e)?e:r(e,t)?[e]:o(a(e))}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=n(20),o=n(12);e.exports=function(e){return"symbol"==i(e)||o(e)&&"[object Symbol]"==r(e)}},function(e,t,n){"use strict";var r=n(89),o=n(33),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var i=e[t];a.call(e,t)&&o(i,n)&&(n!==undefined||t in e)||r(e,t,n)}},function(e,t,n){"use strict";var i=n(221),r=n(456),o=n(9);e.exports=function(e){return o(e)?i(e,!0):r(e)}},function(e,t,n){"use strict";var i=n(60),r=n(36),o=n(485),a=n(9),s=n(29),l=n(6),c=Object.prototype.hasOwnProperty,n=o(function(e,t){if(s(t)||a(t))r(t,l(t),e);else for(var n in t)c.call(t,n)&&i(e,n,t[n])});e.exports=n},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(33),a=n(9),s=n(57),l=n(11);e.exports=function(e,t,n){var i;return!!l(n)&&!!("number"==(i=r(t))?a(n)&&s(t,n.length):"string"==i&&t in n)&&o(n[t],e)}},function(e,t,n){"use strict";var r=n(495),o=n(496),a=n(13),s=n(0),l=n(63);e.exports=function(e,t,n){var i=s(e)?r:o;return n&&l(e,t,n)&&(t=undefined),i(e,a(t,3))}},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},te=(Object.defineProperty(t,"__esModule",{value:!0}),t.Lexer=t.LexerDefinitionErrorType=void 0,n(239)),s=i(n(100)),l=i(n(8)),c=i(n(0)),ne=i(n(107)),u=i(n(102)),h=i(n(4)),d=i(n(3)),p=i(n(6)),f=i(n(22)),m=i(n(35)),g=i(n(62)),y=i(n(23)),b=i(n(17)),v=n(37),x=n(27),i=n(243),I=n(106),S=((n=t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}))[n.MISSING_PATTERN=0]="MISSING_PATTERN",n[n.INVALID_PATTERN=1]="INVALID_PATTERN",n[n.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",n[n.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",n[n.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",n[n.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",n[n.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",n[n.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",n[n.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",n[n.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",n[n.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",n[n.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",n[n.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",n[n.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",n[n.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",n[n.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",n[n.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",{deferDefinitionErrorsHandling:!(n[n.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"),positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:i.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0});function r(r,o){void 0===o&&(o=S);var a=this;if(this.lexerDefinition=r,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=function(e,t){var n,i,r,o;return!0===a.traceInitPerf?(a.traceInitIndent++,n=new Array(a.traceInitIndent+1).join("\t"),a.traceInitIndent<a.traceInitMaxIdent&&console.log("".concat(n,"--\x3e <").concat(e,">")),i=(r=(0,v.timer)(t)).time,r=r.value,o=10<i?console.warn:console.log,a.traceInitIndent<a.traceInitMaxIdent&&o("".concat(n,"<-- <").concat(e,"> time: ").concat(i,"ms")),a.traceInitIndent--,r):t()},"boolean"==typeof o)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=(0,g["default"])({},S,o);var e=this.config.traceInitPerf;!0===e?(this.traceInitMaxIdent=Infinity,this.traceInitPerf=!0):"number"==typeof e&&(this.traceInitMaxIdent=e,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var n,e,t=!0,i=(a.TRACE_INIT("Lexer Config handling",function(){if(a.config.lineTerminatorsPattern===S.lineTerminatorsPattern)a.config.lineTerminatorsPattern=te.LineTerminatorOptimizedTester;else if(a.config.lineTerminatorCharacters===S.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(o.safeMode&&o.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');a.trackStartLines=/full|onlyStart/i.test(a.config.positionTracking),a.trackEndLines=/full/i.test(a.config.positionTracking),n=(0,c["default"])(r)?{modes:{defaultMode:(0,b["default"])(r)},defaultMode:te.DEFAULT_MODE}:(t=!1,b["default"])(r)}),!1===a.config.skipValidations&&(a.TRACE_INIT("performRuntimeChecks",function(){a.lexerDefinitionErrors=a.lexerDefinitionErrors.concat((0,te.performRuntimeChecks)(n,a.trackStartLines,a.config.lineTerminatorCharacters))}),a.TRACE_INIT("performWarningRuntimeChecks",function(){a.lexerDefinitionWarning=a.lexerDefinitionWarning.concat((0,te.performWarningRuntimeChecks)(n,a.trackStartLines,a.config.lineTerminatorCharacters))})),n.modes=n.modes||{},(0,d["default"])(n.modes,function(e,t){n.modes[t]=(0,u["default"])(e,function(e){return(0,f["default"])(e)})}),(0,p["default"])(n.modes));if((0,d["default"])(n.modes,function(t,n){a.TRACE_INIT("Mode: <".concat(n,"> processing"),function(){var e;a.modes.push(n),!1===a.config.skipValidations&&a.TRACE_INIT("validatePatterns",function(){a.lexerDefinitionErrors=a.lexerDefinitionErrors.concat((0,te.validatePatterns)(t,i))}),(0,l["default"])(a.lexerDefinitionErrors)&&((0,x.augmentTokenTypes)(t),a.TRACE_INIT("analyzeTokenTypes",function(){e=(0,te.analyzeTokenTypes)(t,{lineTerminatorCharacters:a.config.lineTerminatorCharacters,positionTracking:o.positionTracking,ensureOptimizations:o.ensureOptimizations,safeMode:o.safeMode,tracer:a.TRACE_INIT})}),a.patternIdxToConfig[n]=e.patternIdxToConfig,a.charCodeToPatternIdxToConfig[n]=e.charCodeToPatternIdxToConfig,a.emptyGroups=(0,g["default"])({},a.emptyGroups,e.emptyGroups),a.hasCustom=e.hasCustom||a.hasCustom,a.canModeBeOptimized[n]=e.canBeOptimized)})}),a.defaultMode=n.defaultMode,!(0,l["default"])(a.lexerDefinitionErrors)&&!a.config.deferDefinitionErrorsHandling)throw e=(0,h["default"])(a.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n"),new Error("Errors detected in definition of Lexer:\n"+e);(0,d["default"])(a.lexerDefinitionWarning,function(e){(0,v.PRINT_WARNING)(e.message)}),a.TRACE_INIT("Choosing sub-methods implementations",function(){if(te.SUPPORT_STICKY?(a.chopInput=m["default"],a.match=a.matchWithTest):(a.updateLastIndex=s["default"],a.match=a.matchWithExec),t&&(a.handleModes=s["default"]),!1===a.trackStartLines&&(a.computeNewColumn=m["default"]),!1===a.trackEndLines&&(a.updateTokenEndLineColumnLocation=s["default"]),/full/i.test(a.config.positionTracking))a.createTokenInstance=a.createFullToken;else if(/onlyStart/i.test(a.config.positionTracking))a.createTokenInstance=a.createStartOnlyToken;else{if(!/onlyOffset/i.test(a.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'.concat(a.config.positionTracking,'"'));a.createTokenInstance=a.createOffsetOnlyToken}a.hasCustom?(a.addToken=a.addTokenUsingPush,a.handlePayload=a.handlePayloadWithCustom):(a.addToken=a.addTokenUsingMemberAccess,a.handlePayload=a.handlePayloadNoCustom)}),a.TRACE_INIT("Failed Optimization Warnings",function(){var e=(0,y["default"])(a.canModeBeOptimized,function(e,t,n){return!1===t&&e.push(n),e},[]);if(o.ensureOptimizations&&!(0,l["default"])(e))throw Error("Lexer Modes: < ".concat(e.join(", ")," > cannot be optimized.\n")+'\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}),a.TRACE_INIT("clearRegExpParserCache",function(){(0,I.clearRegExpParserCache)()}),a.TRACE_INIT("toFastProperties",function(){(0,v.toFastProperties)(a)})})}Object.freeze(S),r.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),(0,l["default"])(this.lexerDefinitionErrors))return this.tokenizeInternal(e,t);throw e=(0,h["default"])(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n"),new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+e)},r.prototype.tokenizeInternal=function(e,z){var t,n,i,r,F,M,o,a,s=this,l=e,D=l.length,c=0,u=0,H=this.hasCustom?0:Math.floor(e.length/10),h=new Array(H),d=[],p=this.trackStartLines?1:undefined,f=this.trackStartLines?1:undefined,m=(0,te.cloneEmptyGroups)(this.emptyGroups),j=this.trackStartLines,g=this.config.lineTerminatorsPattern,y=0,b=[],v=[],x=[],V=[];function W(){return b}function G(e){e=(0,te.charCodeToOptimizedIndex)(e),e=v[e];return e===undefined?V:e}Object.freeze(V);var U=function U(e){var t;1===x.length&&e.tokenType.PUSH_MODE===undefined?(t=s.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e),d.push({offset:e.startOffset,line:e.startLine,column:e.startColumn,length:e.image.length,message:t})):(x.pop(),e=(0,ne["default"])(x),b=s.patternIdxToConfig[e],v=s.charCodeToPatternIdxToConfig[e],y=b.length,t=s.canModeBeOptimized[e]&&!1===s.config.safeMode,a=v&&t?G:W)};function $(e){x.push(e),v=this.charCodeToPatternIdxToConfig[e],b=this.patternIdxToConfig[e],y=b.length,y=b.length;e=this.canModeBeOptimized[e]&&!1===this.config.safeMode;a=v&&e?G:W}$.call(this,z);for(var Y=this.config.recoveryEnabled;c<D;){for(var I=null,q=l.charCodeAt(c),X=a(q),K=X.length,S=0;S<K;S++){var _,C=(_=X[S]).pattern,w=null;if(!1!==(A=_["short"])?q===A&&(I=C):!0===_.isCustom?null!==(o=C.exec(l,c,h,m))?(I=o[0],o.payload!==undefined&&(w=o.payload)):I=null:(this.updateLastIndex(C,c),I=this.match(C,e,c)),null!==I){if((i=_.longerAlt)!==undefined)for(var Z=i.length,E=0;E<Z;E++){var T=b[i[E]],B=T.pattern,Q=null;if(!0===T.isCustom?null!==(o=B.exec(l,c,h,m))?(n=o[0],o.payload!==undefined&&(Q=o.payload)):n=null:(this.updateLastIndex(B,c),n=this.match(B,e,c)),n&&n.length>I.length){I=n,w=Q,_=T;break}}break}}if(null!==I){if(L=I.length,(O=_.group)!==undefined&&(r=_.tokenTypeIdx,r=this.createTokenInstance(I,c,r,_.tokenType,p,f,L),this.handlePayload(r,w),!1===O?u=this.addToken(h,u,r):m[O].push(r)),e=this.chopInput(e,L),c+=L,f=this.computeNewColumn(f,L),!0===j&&!0===_.canLineTerminator){var J,R=0,N=void 0;for(g.lastIndex=0;!0===(J=g.test(I))&&(N=g.lastIndex-1,R++),!0===J;);0!==R&&(p+=R,this.updateTokenEndLineColumnLocation(r,O,N,R,p,f=L-N,L))}this.handleModes(_,U,$,r)}else{for(var O=c,L=p,ee=f,k=!1===Y;!1===k&&c<D;)for(e=this.chopInput(e,1),c++,t=0;t<y;t++){var A,P=b[t],C=P.pattern;if(!1!==(A=P["short"])?l.charCodeAt(c)===A&&(k=!0):k=!0===P.isCustom?null!==C.exec(l,c,h,m):(this.updateLastIndex(C,c),null!==C.exec(e)),!0===k)break}if(M=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(l,O,F=c-O,L,ee),d.push({offset:O,line:L,column:ee,length:F,message:M}),!1===Y)break}}return this.hasCustom||(h.length=u),{tokens:h,groups:m,errors:d}},r.prototype.handleModes=function(e,t,n,i){var r;!0===e.pop?(r=e.push,t(i),r!==undefined&&n.call(this,r)):e.push!==undefined&&n.call(this,e.push)},r.prototype.chopInput=function(e,t){return e.substring(t)},r.prototype.updateLastIndex=function(e,t){e.lastIndex=t},r.prototype.updateTokenEndLineColumnLocation=function(e,t,n,i,r,o,a){t!==undefined&&(n=(t=n===a-1)?-1:0,1===i&&!0==t||(e.endLine=r+n,e.endColumn=o-1-n))},r.prototype.computeNewColumn=function(e,t){return e+t},r.prototype.createOffsetOnlyToken=function(e,t,n,i){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:i}},r.prototype.createStartOnlyToken=function(e,t,n,i,r,o){return{image:e,startOffset:t,startLine:r,startColumn:o,tokenTypeIdx:n,tokenType:i}},r.prototype.createFullToken=function(e,t,n,i,r,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:r,endLine:r,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}},r.prototype.addTokenUsingPush=function(e,t,n){return e.push(n),t},r.prototype.addTokenUsingMemberAccess=function(e,t,n){return e[t]=n,++t},r.prototype.handlePayloadNoCustom=function(e,t){},r.prototype.handlePayloadWithCustom=function(e,t){null!==t&&(e.payload=t)},r.prototype.matchWithTest=function(e,t,n){return!0===e.test(t)?t.substring(n,e.lastIndex):null},r.prototype.matchWithExec=function(e,t){t=e.exec(t);return null!==t?t[0]:null},r.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",r.NA=/NOT_APPLICABLE/,t.Lexer=r},function(e,t,n){"use strict";e.exports=function(e){for(var t=-1,n=null==e?0:e.length,i=0,r=[];++t<n;){var o=e[t];o&&(r[i++]=o)}return r}},function(z,e,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||(n({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var i,r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=function(e){return e&&e.__esModule?e:{"default":e}},u=(Object.defineProperty(e,"__esModule",{value:!0}),e.checkPrefixAlternativesAmbiguities=e.validateSomeNonEmptyLookaheadPath=e.validateTooManyAlts=e.RepetitionCollector=e.validateAmbiguousAlternationAlternatives=e.validateEmptyOrAlternative=e.getFirstNoneTerminal=e.validateNoLeftRecursion=e.validateRuleIsOverridden=e.validateRuleDoesNotAlreadyExist=e.OccurrenceValidationCollector=e.identifyProductionForDuplicates=e.validateGrammar=e.validateLookahead=void 0,a(t(40))),l=a(t(8)),F=a(t(92)),c=a(t(16)),M=a(t(105)),D=a(t(102)),H=a(t(103)),h=a(t(4)),d=a(t(3)),j=a(t(244)),p=a(t(23)),V=a(t(233)),W=a(t(15)),f=a(t(18)),m=a(t(245)),G=a(t(17)),g=t(5),y=t(2),b=t(42),U=t(68),s=t(2),v=t(2),$=a(t(108)),Y=a(t(66)),q=t(27);function x(e){return"".concat((0,y.getProductionDslName)(e),"_#_").concat(e.idx,"_#_").concat(I(e))}function I(e){return e instanceof s.Terminal?e.terminalType.name:e instanceof s.NonTerminal?e.nonTerminalName:""}e.validateLookahead=function(e){return e=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName}),(0,h["default"])(e,function(e){return o({type:g.ParserDefinitionErrorType.CUSTOM_LOOKAHEAD_VALIDATION},e)})},e.validateGrammar=function(t,e,n,i){var r,o,a,s=(0,m["default"])(t,function(e){return i=e,r=n,e=new _,i.accept(e),e=e.allProductions,e=(0,j["default"])(e,x),e=(0,V["default"])(e,function(e){return 1<e.length}),(0,h["default"])((0,W["default"])(e),function(e){var t=(0,u["default"])(e),e=r.buildDuplicateFoundError(i,e),n=(0,y.getProductionDslName)(t),e={message:e,type:g.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:i.name,dslName:n,occurrence:t.idx},n=I(t);return n&&(e.parameter=n),e});var i,r}),e=(l=t,r=n,o=[],a=(0,h["default"])(e,function(e){return e.name}),(0,d["default"])(l,function(e){var t=e.name;(0,f["default"])(a,t)&&(e=r.buildNamespaceConflictError(e),o.push({message:e,type:g.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t}))}),o),l=(0,m["default"])(t,function(e){return k(e,n)}),c=(0,m["default"])(t,function(e){return w(e,t,i,n)});return s.concat(e,l,c)},e.identifyProductionForDuplicates=x;S=v.GAstVisitor,r(C,S),C.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},C.prototype.visitOption=function(e){this.allProductions.push(e)},C.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},C.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},C.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},C.prototype.visitRepetition=function(e){this.allProductions.push(e)},C.prototype.visitAlternation=function(e){this.allProductions.push(e)},C.prototype.visitTerminal=function(e){this.allProductions.push(e)};var S,_=C;function C(){var e=null!==S&&S.apply(this,arguments)||this;return e.allProductions=[],e}function w(n,e,t,i){var r=[];return 1<(0,p["default"])(e,function(e,t){return t.name===n.name?e+1:e},0)&&(e=i.buildDuplicateRuleNameError({topLevelRule:n,grammarName:t}),r.push({message:e,type:g.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:n.name})),r}function E(e){var t=[];if((0,l["default"])(e))return t;var n=(0,u["default"])(e);if(n instanceof s.NonTerminal)t.push(n.referencedRule);else if(n instanceof s.Alternative||n instanceof s.Option||n instanceof s.RepetitionMandatory||n instanceof s.RepetitionMandatoryWithSeparator||n instanceof s.RepetitionWithSeparator||n instanceof s.Repetition)t=t.concat(E(n.definition));else if(n instanceof s.Alternation)t=(0,c["default"])((0,h["default"])(n.definition,function(e){return E(e.definition)}));else if(!(n instanceof s.Terminal))throw Error("non exhaustive match");var n=(0,y.isOptionalProd)(n),i=1<e.length;return n&&i?(n=(0,F["default"])(e),t.concat(E(n))):t}e.OccurrenceValidationCollector=_,e.validateRuleDoesNotAlreadyExist=w,e.validateRuleIsOverridden=function(e,t,n){var i=[];return(0,f["default"])(t,e)||(t="Invalid rule override, rule: ->".concat(e,"<- cannot be overridden in the grammar: ->").concat(n,"<-")+"as it is not defined in any of the super grammars ",i.push({message:t,type:g.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},e.validateNoLeftRecursion=function P(n,e,i,r){void 0===r&&(r=[]);var t,o=[],e=E(e.definition);return(0,l["default"])(e)?[]:(t=n.name,(0,f["default"])(e,n)&&o.push({message:i.buildLeftRecursionError({topLevelRule:n,leftRecursionPath:r}),type:g.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:t}),t=(0,H["default"])(e,r.concat([n])),e=(0,m["default"])(t,function(e){var t=(0,G["default"])(r);return t.push(e),P(n,e,i,t)}),o.concat(e))},e.getFirstNoneTerminal=E;T=v.GAstVisitor,r(R,T),R.prototype.visitAlternation=function(e){this.alternations.push(e)};var T,B=R;function R(){var e=null!==T&&T.apply(this,arguments)||this;return e.alternations=[],e}e.validateEmptyOrAlternative=function(i,r){var e=new B,e=(i.accept(e),e.alternations);return(0,m["default"])(e,function(n){var e=(0,$["default"])(n.definition);return(0,m["default"])(e,function(e,t){e=(0,U.nextPossibleTokensAfter)([e],[],q.tokenStructuredMatcher,1);return(0,l["default"])(e)?[{message:r.buildEmptyAlternationError({topLevelRule:i,alternation:n,emptyChoiceIdx:t}),type:g.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:i.name,occurrence:n.idx,alternative:t+1}]:[]})})},e.validateAmbiguousAlternationAlternatives=function(l,c,u){var e=new B,e=(l.accept(e),e.alternations),e=(0,D["default"])(e,function(e){return!0===e.ignoreAmbiguities});return(0,m["default"])(e,function(e){var o,a,n,i,s,t=e.idx,r=e.maxLookahead||c,t=(0,b.getLookaheadPathsForOr)(t,l,r,e),r=(o=t,a=e,n=l,i=u,s=[],r=(0,p["default"])(o,function(e,t,r){return!0!==a.definition[r].ignoreAmbiguities&&(0,d["default"])(t,function(n){var i=[r];(0,d["default"])(o,function(e,t){r!==t&&(0,b.containsPath)(e,n)&&!0!==a.definition[t].ignoreAmbiguities&&i.push(t)}),1<i.length&&!(0,b.containsPath)(s,n)&&(s.push(n),e.push({alts:i,path:n}))}),e},[]),(0,h["default"])(r,function(e){var t=(0,h["default"])(e.alts,function(e){return e+1});return{message:i.buildAlternationAmbiguityError({topLevelRule:n,alternation:a,ambiguityIndices:t,prefixPath:e.path}),type:g.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:a.idx,alternatives:e.alts}})),t=A(t,e,l,u);return r.concat(t)})};N=v.GAstVisitor,r(L,N),L.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},L.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},L.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},L.prototype.visitRepetition=function(e){this.allProductions.push(e)};var N,O=L;function L(){var e=null!==N&&N.apply(this,arguments)||this;return e.allProductions=[],e}function k(t,n){var e=new B,e=(t.accept(e),e.alternations);return(0,m["default"])(e,function(e){return 255<e.definition.length?[{message:n.buildTooManyAlternativesError({topLevelRule:t,alternation:e}),type:g.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:t.name,occurrence:e.idx}]:[]})}function A(e,r,o,a){var n=(0,p["default"])(e,function(e,t,n){t=(0,h["default"])(t,function(e){return{idx:n,path:e}});return e.concat(t)},[]);return(0,Y["default"])((0,m["default"])(n,function(e){var i,t;return!0===r.definition[e.idx].ignoreAmbiguities?[]:(i=e.idx,t=e.path,e=(0,M["default"])(n,function(e){return!0!==r.definition[e.idx].ignoreAmbiguities&&e.idx<i&&(0,b.isStrictPrefixOfPath)(e.path,t)}),(0,h["default"])(e,function(e){var t=[e.idx+1,i+1],n=0===r.idx?"":r.idx;return{message:a.buildAlternationPrefixAmbiguityError({topLevelRule:o,alternation:r,ambiguityIndices:t,prefixPath:e.path}),type:g.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:o.name,occurrence:n,alternatives:t}}))}))}e.RepetitionCollector=O,e.validateTooManyAlts=k,e.validateSomeNonEmptyLookaheadPath=function(e,o,a){var s=[];return(0,d["default"])(e,function(r){var e=new O,e=(r.accept(e),e.allProductions);(0,d["default"])(e,function(e){var t=(0,b.getProdType)(e),n=e.maxLookahead||o,i=e.idx,i=(0,b.getLookaheadPathsForOptionalProd)(i,r,t,n)[0];(0,l["default"])((0,c["default"])(i))&&(t=a.buildEmptyRepetitionError({topLevelRule:r,repetition:e}),s.push({message:t,type:g.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:r.name}))})}),s},e.checkPrefixAlternativesAmbiguities=A},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},l=(Object.defineProperty(t,"__esModule",{value:!0}),t.nextPossibleTokensAfter=t.possiblePathsFrom=t.NextTerminalAfterAtLeastOneSepWalker=t.NextTerminalAfterAtLeastOneWalker=t.NextTerminalAfterManySepWalker=t.NextTerminalAfterManyWalker=t.AbstractNextTerminalAfterProductionWalker=t.NextAfterTokenWalker=t.AbstractNextPossibleTokensWalker=void 0,n(91)),c=s(n(40)),T=s(n(8)),B=s(n(108)),R=s(n(92)),N=s(n(107)),u=s(n(3)),O=s(n(17)),h=n(235),L=n(2),s=(o=l.RestWalker,a(d,o),d.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=(0,O["default"])(this.path.ruleStack).reverse(),this.occurrenceStack=(0,O["default"])(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},d.prototype.walk=function(e,t){void 0===t&&(t=[]),this.found||o.prototype.walk.call(this,e,t)},d.prototype.walkProdRef=function(e,t,n){e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence&&(n=t.concat(n),this.updateExpectedNext(),this.walk(e.referencedRule,n))},d.prototype.updateExpectedNext=function(){(0,T["default"])(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},d);function d(e,t){var n=o.call(this)||this;return n.topProd=e,n.path=t,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}t.AbstractNextPossibleTokensWalker=s;a(f,p=s),f.prototype.walkTerminal=function(e,t,n){this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found&&(e=t.concat(n),n=new L.Alternative({definition:e}),this.possibleTokTypes=(0,h.first)(n),this.found=!0)};var p,n=f;function f(e,t){e=p.call(this,e,t)||this;return e.path=t,e.nextTerminalName="",e.nextTerminalOccurrence=0,e.nextTerminalName=e.path.lastTok.name,e.nextTerminalOccurrence=e.path.lastTokOccurrence,e}t.NextAfterTokenWalker=n;m=l.RestWalker,a(g,m),g.prototype.startWalking=function(){return this.walk(this.topRule),this.result};var m,s=g;function g(e,t){var n=m.call(this)||this;return n.topRule=e,n.occurrence=t,n.result={token:undefined,occurrence:undefined,isEndOfRule:undefined},n}t.AbstractNextTerminalAfterProductionWalker=s;a(b,y=s),b.prototype.walkMany=function(e,t,n){var i;e.idx===this.occurrence?(i=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=i===undefined,i instanceof L.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)):y.prototype.walkMany.call(this,e,t,n)};var y,n=b;function b(){return null!==y&&y.apply(this,arguments)||this}t.NextTerminalAfterManyWalker=n;a(x,v=s),x.prototype.walkManySep=function(e,t,n){var i;e.idx===this.occurrence?(i=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=i===undefined,i instanceof L.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)):v.prototype.walkManySep.call(this,e,t,n)};var v,l=x;function x(){return null!==v&&v.apply(this,arguments)||this}t.NextTerminalAfterManySepWalker=l;a(S,I=s),S.prototype.walkAtLeastOne=function(e,t,n){var i;e.idx===this.occurrence?(i=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=i===undefined,i instanceof L.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)):I.prototype.walkAtLeastOne.call(this,e,t,n)};var I,n=S;function S(){return null!==I&&I.apply(this,arguments)||this}t.NextTerminalAfterAtLeastOneWalker=n;a(C,_=s),C.prototype.walkAtLeastOneSep=function(e,t,n){var i;e.idx===this.occurrence?(i=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=i===undefined,i instanceof L.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)):_.prototype.walkAtLeastOneSep.call(this,e,t,n)};var _,l=C;function C(){return null!==_&&_.apply(this,arguments)||this}t.NextTerminalAfterAtLeastOneSepWalker=l,t.possiblePathsFrom=function w(t,n,i){void 0===i&&(i=[]),i=(0,O["default"])(i);var r=[],o=0;function a(e){return e=w(e.concat((0,R["default"])(t,o+1)),n,i),r.concat(e)}for(;i.length<n&&o<t.length;){var e=t[o];if(e instanceof L.Alternative)return a(e.definition);if(e instanceof L.NonTerminal)return a(e.definition);if(e instanceof L.Option)r=a(e.definition);else{if(e instanceof L.RepetitionMandatory)return a(s=e.definition.concat([new L.Repetition({definition:e.definition})]));if(e instanceof L.RepetitionMandatoryWithSeparator)return a(s=[new L.Alternative({definition:e.definition}),new L.Repetition({definition:[new L.Terminal({terminalType:e.separator})].concat(e.definition)})]);if(e instanceof L.RepetitionWithSeparator)r=a(s=e.definition.concat([new L.Repetition({definition:[new L.Terminal({terminalType:e.separator})].concat(e.definition)})]));else if(e instanceof L.Repetition){var s=e.definition.concat([new L.Repetition({definition:e.definition})]);r=a(s)}else{if(e instanceof L.Alternation)return(0,u["default"])(e.definition,function(e){!1===(0,T["default"])(e.definition)&&(r=a(e.definition))}),r;if(!(e instanceof L.Terminal))throw Error("non exhaustive match");i.push(e.terminalType)}}o++}return r.push({partialPath:i,suffixDef:(0,R["default"])(t,o)}),r},t.nextPossibleTokensAfter=function(e,t,n,i){var r="EXIT_NONE_TERMINAL",o=[r],a="EXIT_ALTERNATIVE",s=!1,l=t.length,c=l-i-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!(0,T["default"])(h);){var d=h.pop();if(d===a)s&&(0,N["default"])(h).idx<=c&&h.pop();else{var p=d.def,f=d.idx,m=d.ruleStack,g=d.occurrenceStack;if(!(0,T["default"])(p)){var y=p[0];if(y===r){var b={idx:f,def:(0,R["default"])(p),ruleStack:(0,B["default"])(m),occurrenceStack:(0,B["default"])(g)};h.push(b)}else if(y instanceof L.Terminal)if(f<l-1){d=f+1;n(t[d],y.terminalType)&&(b={idx:d,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},h.push(b))}else{if(f!==l-1)throw Error("non exhaustive match");u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:g}),s=!0}else if(y instanceof L.NonTerminal){var d=(0,O["default"])(m),v=(d.push(y.nonTerminalName),(0,O["default"])(g)),b=(v.push(y.idx),{idx:f,def:y.definition.concat(o,(0,R["default"])(p)),ruleStack:d,occurrenceStack:v});h.push(b)}else if(y instanceof L.Option){var x={idx:f,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},I=(h.push(x),h.push(a),{idx:f,def:y.definition.concat((0,R["default"])(p)),ruleStack:m,occurrenceStack:g});h.push(I)}else if(y instanceof L.RepetitionMandatory){var S=new L.Repetition({definition:y.definition,idx:y.idx}),b={idx:f,def:y.definition.concat([S],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(b)}else if(y instanceof L.RepetitionMandatoryWithSeparator){var _=new L.Terminal({terminalType:y.separator}),S=new L.Repetition({definition:[_].concat(y.definition),idx:y.idx}),b={idx:f,def:y.definition.concat([S],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(b)}else if(y instanceof L.RepetitionWithSeparator){var x={idx:f,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},_=(h.push(x),h.push(a),new L.Terminal({terminalType:y.separator})),C=new L.Repetition({definition:[_].concat(y.definition),idx:y.idx}),I={idx:f,def:y.definition.concat([C],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(I)}else if(y instanceof L.Repetition){x={idx:f,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},C=(h.push(x),h.push(a),new L.Repetition({definition:y.definition,idx:y.idx})),I={idx:f,def:y.definition.concat([C],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(I)}else if(y instanceof L.Alternation)for(var w=y.definition.length-1;0<=w;w--){var E={idx:f,def:y.definition[w].definition.concat((0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(E),h.push(a)}else if(y instanceof L.Alternative)h.push({idx:f,def:y.definition.concat((0,R["default"])(p)),ruleStack:m,occurrenceStack:g});else{if(!(y instanceof L.Rule))throw Error("non exhaustive match");h.push(function(e,t,n,i){n=(0,O["default"])(n),n.push(e.name),i=(0,O["default"])(i);return i.push(1),{idx:t,def:e.definition,ruleStack:n,occurrenceStack:i}}(y,f,m,g))}}}}return u}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=function(){return this}();try{r=r||new Function("return this")()}catch(o){"object"===("undefined"==typeof window?"undefined":i(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=t.FormulaParser=void 0;var i=n(49),r=n(45);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var s=function(t){var e,n;function i(){var e=t.call(this,r.allTokens)||this;return a(o(e),"expr",e.RULE("expr",function(){e.SUBRULE(e.commaExpression)})),a(o(e),"commaExpression",e.RULE("commaExpression",function(){e.SUBRULE(e.binaryExpression),e.MANY(function(){e.CONSUME(r.token.Comma),e.SUBRULE2(e.binaryExpression)})})),a(o(e),"binaryExpression",e.RULE("binaryExpression",function(){e.SUBRULE(e.unaryExpression),e.MANY(function(){e.OR(e.c1||(e.c1=[{ALT:function(){e.CONSUME(r.token.LogicOr)}},{ALT:function(){e.CONSUME(r.token.LogicAnd)}},{ALT:function(){e.CONSUME(r.token.BitAnd)}},{ALT:function(){e.CONSUME(r.token.Equal)}},{ALT:function(){e.CONSUME(r.token.Compare)}},{ALT:function(){e.CONSUME(r.token.Addition)}},{ALT:function(){e.CONSUME(r.token.Multiplication)}}])),e.SUBRULE2(e.unaryExpression)})})),a(o(e),"unaryExpression",e.RULE("unaryExpression",function(){e.MANY(function(){e.CONSUME(r.token.Unary)}),e.SUBRULE(e.atomicExpression)})),a(o(e),"atomicExpression",e.RULE("atomicExpression",function(){e.OR(e.c2||(e.c2=[{ALT:function(){e.SUBRULE(e.array)}},{ALT:function(){e.SUBRULE(e.func)}},{ALT:function(){e.SUBRULE(e.group)}},{ALT:function(){e.SUBRULE(e.base)}}])),e.MANY(function(){e.CONSUME(r.token.LSquare),e.SUBRULE(e.expr),e.CONSUME(r.token.RSquare)})})),a(o(e),"array",e.RULE("array",function(){e.CONSUME(r.token.LSquare),e.MANY_SEP({SEP:r.token.Comma,DEF:function(){e.SUBRULE(e.binaryExpression)}}),e.CONSUME(r.token.RSquare)})),a(o(e),"func",e.RULE("func",function(){e.CONSUME(r.token.Func),e.CONSUME(r.token.LParen),e.OPTION(function(){e.MANY_SEP({SEP:r.token.Comma,DEF:function(){e.SUBRULE(e.binaryExpression)}})}),e.CONSUME(r.token.RParen)})),a(o(e),"group",e.RULE("group",function(){e.CONSUME(r.token.LParen),e.AT_LEAST_ONE_SEP({SEP:r.token.Comma,DEF:function(){e.SUBRULE(e.expr)}}),e.CONSUME(r.token.RParen)})),a(o(e),"base",e.RULE("base",function(){e.OR(e.c3||(e.c3=[{ALT:function(){e.CONSUME(r.token.String)}},{ALT:function(){e.CONSUME(r.token.Number)}},{ALT:function(){e.CONSUME(r.token.Date)}},{ALT:function(){e.CONSUME(r.token.Boolean)}},{ALT:function(){e.CONSUME(r.token.Empty)}},{ALT:function(){e.CONSUME(r.token.NaN)}}]))})),e.performSelfAnalysis(),e}return n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,l(e,n),i}(i.CstParser),c=(t.FormulaParser=s,function c(){return new s});t["default"]=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStringType=t.isNumberType=t.isDateType=t.isBooleanType=t.isArrayType=t.isAnyType=t["default"]=void 0;var s=n(49),l=n(45),a=o(n(3)),i=o(n(0)),r=o(n(6)),c=o(n(241)),u=o(n(86)),h=o(n(70));function o(e){return e&&e.__esModule?e:{"default":e}}function d(e,t){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function d(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}var p=function p(){for(var t=[],e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0,a["default"])(n,function(e){e&&(t=t.concat(e))}),t},f=function f(e){return[].concat(e).sort(function(e,t){return e.startOffset-t.startOffset})},m=function m(e,t,n){switch(e){case"+":return v(t)||v(n)||_(t)&&!b(t)||_(n)&&!b(n)?"string":"number";case"-":if((b(t)||S(t))&&(b(n)||S(n))||_(t)||_(n))return"number";throw new Error(JSON.stringify({type:"visit",token:e,errorType:"operation",errorText:BI.i18nText("BI-Conf_Formula_Valid")}));case"*":case"/":if(b(t)&&b(n)||_(t)||_(n))return"number";throw new Error(JSON.stringify({type:"visit",token:e,errorType:"operation",errorText:BI.i18nText("BI-Conf_Formula_Valid")}))}},g=function g(e,t,n){var i=e.slice(),t=t.slice(),e=e.map(function(e){return e.image}).indexOf(n.image);if(-1<e){var r=t.slice().splice(e,2),o=r[0],r=r[1],a="null";if((0,s.tokenMatcher)(n,l.token.Addition)||(0,s.tokenMatcher)(n,l.token.Multiplication))a=m(n.image,o,r);else if((0,s.tokenMatcher)(n,l.token.Compare)){if(null!==o&&null!==r&&C(o)!==C(r))throw new Error(JSON.stringify({type:"visit",token:n.image,errorType:"compare",errorText:BI.i18nText("BI-Basic_Formula_Invalid")}));a="boolean"}else if((0,s.tokenMatcher)(n,l.token.Equal))a="boolean";else if((0,s.tokenMatcher)(n,l.token.BitAnd))a="string";else if((0,s.tokenMatcher)(n,l.token.LogicAnd)||(0,s.tokenMatcher)(n,l.token.LogicOr)){if(!(b(o)&&b(r)||x(o)&&x(r)))throw new Error(JSON.stringify({type:"visit",token:n.image,errorType:"logic",errorText:BI.i18nText("BI-Basic_Formula_Invalid")}));a=o||r}i.splice(e,1),t.splice(e,2,a)}return{resultTokens:i,resultOperands:t}},y=function y(){var i,e=(0,h["default"])().getBaseCstVisitorConstructor(),t=function t(e){i=e},o=function o(t,e){var n;if(i)return n=(0,r["default"])(i),-1<(0,c["default"])(n,function(e){return e===t})?(0,u["default"])(i,t).apply(void 0,e):null;throw new Error("Interpreter is not set formula")};return{interpreter:new(function(t){var e;function n(){var e=t.call(this)||this;return e.validateVisitor(),e}e=t,(i=n).prototype=Object.create(e.prototype),i.prototype.constructor=i,d(i,e);var i=n.prototype;return i.expr=function(e){return this.visit(e.commaExpression)},i.commaExpression=function(e){e=e.binaryExpression.slice(-1)[0];return this.visit(e)},i.binaryExpression=function(e){var t=this,n=p(e.Multiplication,e.Addition,e.Compare,e.Equal,e.BitAnd,e.LogicAnd,e.LogicOr),i=f(n),r=[];return(0,a["default"])(e.unaryExpression,function(e){r.push(t.visit(e))}),(0,a["default"])(n,function(e){e=g(i,r,e);i=e.resultTokens,r=e.resultOperands}),r[0]},i.unaryExpression=function(e){var t=this.visit(e.atomicExpression);return e.Unary&&(e=e.Unary.slice().reverse(),(0,a["default"])(e,function(e){t=(0,s.tokenMatcher)(e,l.token.Minus)||(0,s.tokenMatcher)(e,l.token.Plus)?"number":"boolean"})),t},i.atomicExpression=function(e){var t,n=this;return e.base?t=this.visit(e.base):e.group?t=this.visit(e.group):e.array?t=this.visit(e.array):e.func&&(t=this.visit(e.func)),e.expr&&(0,a["default"])(e.expr,function(e){e=n.visit(e);t=t[e]}),t},i.array=function(e){var t=this,n=[];return(0,a["default"])(e.binaryExpression,function(e){n.push(t.visit(e))}),n},i.func=function r(e){var t=this,r=e.Func[0].image,n=[];return(0,a["default"])(e.binaryExpression,function(e){n.push(t.visit(e))}),o(r,n)},i.group=function(e){return this.visit(e.expr)},i.base=function(e){var t;return e.String?null!==(t=e.String[0].image)?"string:".concat(t):"string":e.Number?null!==(t=e.Number[0].image)?"number:".concat(t):"number":e.Date?null!==(t=e.Date[0].image)?"date:".concat(t):"date":e.Boolean?null!==(t=e.Boolean[0].image)?"boolean:".concat(t):"boolean":e.Empty?"null":e.NaN?"number":void 0},n}(e)),setFormula:t}},b=function b(e){return null===e||BI.startWith(e,"number")||BI.startWith(e,"boolean")},v=(t.isNumberType=b,function v(e){return null===e||BI.startWith(e,"string")}),x=(t.isStringType=v,function x(e){return null===e||BI.startWith(e,"boolean")}),I=(t.isBooleanType=x,function I(e){return(0,i["default"])(e)||null===e}),S=(t.isArrayType=I,function S(e){return null===e||BI.startWith(e,"date")}),_=(t.isDateType=S,function _(e){return"any"===e||null===e}),C=(t.isAnyType=_,function C(e){return v(e)?"string":b(e)?"number":S(e)?"date":x(e)?"boolean":I(e)?"array":_(e)?"any":undefined});t["default"]=y},function(e,t,n){"use strict";var o=n(44);function a(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function s(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){var t,n;t=i,n=r[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}n=BI.inherit(BI.Widget,{props:{baseCls:"bi-sticky-table-header",columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],header:[],headerRowSize:"auto"},render:function(){var t=this,e=this.options;return{type:"bi.sticky_table_layout",sortable:!(this.tds=[]),ref:function(e){t.layout=e},columnSize:e.columnSize,freezeCols:e.freezeCols,items:this._formatItems(e.header)}},_formatItems:function(e){var i=this,r=this.options;return e.map(function(n){return{type:"bi.adaptive",tagName:"tr",height:r.headerRowSize,items:n.map(function(e,t){return{type:"bi.default",tagName:"td",ref:function(e){i.tds[t]=e},extraCls:r.freezeCols.includes(t)?t===n.length-1?"sticky-table-fix-last-col":"sticky-table-fix-first-col":"",cls:"sticky-table-fix-index-".concat(t,"-col first-row ").concat(0===t?"first-col":""),css:{minWidth:r.minColumnSize[t],maxWidth:r.maxColumnSize[t]},items:[s(s({},o.DEFAULT_CONFIG),e)]}})}})},_populate:function(e){this.layout.populate(this._formatItems(e))},setColumnSize:function(e){this.layout.setColumnSize(e)},populate:function(e){this._populate(e)},getRealColumnSize:function(){return this.tds.map(function(e){return e.element.width()})}});BI.shortcut("bi.sticky_table_header",n)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyTableLayout=void 0;var i=n(302);function o(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function r(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var t,n;t=i,n=r[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}var l=BI.inherit(BI.Widget,{props:{baseCls:"bi-sticky-table-layout",sortable:!0,checkable:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],mirror:{}},render:function(){var t=this,e=this.options;return{type:"bi.default",items:[{type:"bi.default",tagName:"table",ref:function(e){t.table=e},width:BI.sum(e.columnSize),cls:"border-sizing",css:{border:0,borderSpacing:0,borderCollapse:"collapse",tableLayout:"fixed",minWidth:"100%"},items:[{type:"bi.default",ref:function(e){t.colgroup=e},tagName:"colgroup",items:this._formatCol(e.columnSize)},{type:"bi.default",tagName:"tbody",ref:function(e){t.layout=e},items:this._formatItems(e.items)}]}]}},mounted:function(){var e,o,a,s,n=this;this.options.sortable&&(e=new i.Draggable(this.table.element[0],{draggable:"tr.enabled",handle:".bi-sticky-table-draggable-handler",classes:{"draggable:over":["bi-sticky-table-draggable-drag-over"],mirror:["bi-sticky-table-draggable-mirror"]},mirror:this.options.mirror}),a=!1,s=BI.debounce(function(){a=!1},300),e.on("drag:start",function(e){e=e.data.source;e.style.transform="",e.style.transitionDuration="",n.fireEvent(l.EVENT_START_DRAG)}),e.on("drag:stop",function(e){var t=e.data.source.getAttribute("dataid");e.data.source.parentElement.childNodes.forEach(function(e){e.style.visibility="",e.style.transform="",e.style.transitionDuration=""}),e.data.sourceContainer.contains(e.data.originalSource)||(e.data.originalSource.remove(),e.data.source.remove()),o&&n.fireEvent(l.EVENT_END_DRAG,[t,o.getAttribute("dataid")]),o=null}),e.on("drag:over",function(e){var i=e.data.over,r=e.data.source;if(r.style.visibility="hidden",i!==r&&i!==e.data.originalSource&&(i!==o||!a)){if(a=!0,s(),i.style.transform)return i.style.transform="",e=n(),o===i?void(o=(o=e[0]===i?i.nextSibling:i.previousSibling)||i):void(o=i);o=i;var e=n(),t="translateY(-100%)";e[0]===i&&(t="translateY(100%)"),e.forEach(function(e){e!==r&&(e.style.transform=t,e.style.transitionDuration="300ms")})}function n(){var e=i.parentElement.childNodes,t=!1,n=[];return e.forEach(function(e){!0!==t||e!==r&&e!==i?(t=e!==r&&e!==i?t:!0)?n.push(e):e.style.transform="":(t=!1,n.push(e))}),n}}),e.on("mirror:created",function(e){n.options}))},_formatCol:function(e){return e.map(function(e){return{type:"bi.default",tagName:"col",width:e}})},_formatItems:function(e){var n=this.options;return e.map(function(e,t){return r(r({isNeedFreeze:n.isNeedFreeze,draggable:n.sortable,checkable:n.checkable,freezeCols:n.freezeCols,columnSize:n.columnSize,minColumnSize:n.minColumnSize,maxColumnSize:n.maxColumnSize,attributes:{dataid:e.id}},e),{},{cls:"".concat(e.cls||""," ").concat(t%2?"even":"odd")})})},_populate:function(e){this.layout.populate(this._formatItems(e))},setColumnSize:function(e){var t=this.options;t.columnSize=e,this.colgroup.populate(this._formatCol(t.columnSize)),this.table.setWidth(BI.sum(t.columnSize))},addItems:function(e){this.layout.addItems(this._formatItems(e))},populate:function(e){this._populate(e)}});(t.StickyTableLayout=l).EVENT_START_DRAG="EVENT_START_DRAG",l.EVENT_END_DRAG="EVENT_END_DRAG",BI.shortcut("bi.sticky_table_layout",l)},function(e,t,n){"use strict";var i=n(29),r=n(391),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t,n=[];for(t in Object(e))o.call(e,t)&&"constructor"!=t&&n.push(t);return n}},function(e,t,n){"use strict";n=n(19)(n(10),"Map");e.exports=n},function(e,t,n){"use strict";e.exports=function(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}},function(e,t,n){"use strict";var i=n(403),r=n(31),n=n(52),n=n&&n.isTypedArray,n=n?r(n):i;e.exports=n},function(e,t,n){"use strict";var i=n(53),r=n(411),o=n(412),a=n(413),s=n(414),n=n(415);function l(e){e=this.__data__=new i(e);this.size=e.size}l.prototype.clear=r,l.prototype["delete"]=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=n,e.exports=l},function(e,t,n){"use strict";var i=n(416),r=n(423),o=n(425),a=n(426),n=n(427);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}s.prototype.clear=i,s.prototype["delete"]=r,s.prototype.get=o,s.prototype.has=a,s.prototype.set=n,e.exports=s},function(e,t,n){"use strict";var i=n(79),r=n(429),n=n(430);function o(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new i;++t<n;)this.add(e[t])}o.prototype.add=o.prototype.push=r,o.prototype.has=n,e.exports=o},function(e,t,n){"use strict";e.exports=function(e,t){return e.has(t)}},function(e,t,n){"use strict";e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},function(e,t,n){"use strict";var i=n(85),n=n(220),r=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols;e.exports=o?function(t){return null==t?[]:(t=Object(t),i(o(t),function(e){return r.call(t,e)}))}:n},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}},function(e,t,n){"use strict";var i=n(87);e.exports=function(e,t,n){return(e=null==e?undefined:i(e,t))===undefined?n:e}},function(e,t,n){"use strict";var r=n(58),o=n(34);e.exports=function(e,t){for(var n=0,i=(t=r(t,e)).length;null!=e&&n<i;)e=e[o(t[n++])];return n&&n==i?e:undefined}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=n(0),o=n(59),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){var n;return!r(e)&&(!("number"!=(n=i(e))&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||s.test(e)||!a.test(e)||null!=t&&e in Object(t))}},function(e,t,n){"use strict";var i=n(228);e.exports=function(e,t,n){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){"use strict";var i=n(217);e.exports=function(e){var t=new e.constructor(e.byteLength);return new i(t).set(new i(e)),t}},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.RestWalker=void 0,i(n(92))),a=i(n(3)),s=n(2);function r(){}function l(e,t,n){return[new s.Option({definition:[new s.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}r.prototype.walk=function(n,i){var r=this;void 0===i&&(i=[]),(0,a["default"])(n.definition,function(e,t){t=(0,o["default"])(n.definition,t+1);if(e instanceof s.NonTerminal)r.walkProdRef(e,t,i);else if(e instanceof s.Terminal)r.walkTerminal(e,t,i);else if(e instanceof s.Alternative)r.walkFlat(e,t,i);else if(e instanceof s.Option)r.walkOption(e,t,i);else if(e instanceof s.RepetitionMandatory)r.walkAtLeastOne(e,t,i);else if(e instanceof s.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(e,t,i);else if(e instanceof s.RepetitionWithSeparator)r.walkManySep(e,t,i);else if(e instanceof s.Repetition)r.walkMany(e,t,i);else{if(!(e instanceof s.Alternation))throw Error("non exhaustive match");r.walkOr(e,t,i)}})},r.prototype.walkTerminal=function(e,t,n){},r.prototype.walkProdRef=function(e,t,n){},r.prototype.walkFlat=function(e,t,n){n=t.concat(n);this.walk(e,n)},r.prototype.walkOption=function(e,t,n){n=t.concat(n);this.walk(e,n)},r.prototype.walkAtLeastOne=function(e,t,n){t=[new s.Option({definition:e.definition})].concat(t,n);this.walk(e,t)},r.prototype.walkAtLeastOneSep=function(e,t,n){t=l(e,t,n);this.walk(e,t)},r.prototype.walkMany=function(e,t,n){t=[new s.Option({definition:e.definition})].concat(t,n);this.walk(e,t)},r.prototype.walkManySep=function(e,t,n){t=l(e,t,n);this.walk(e,t)},r.prototype.walkOr=function(e,t,n){var i=this,r=t.concat(n);(0,a["default"])(e.definition,function(e){e=new s.Alternative({definition:[e]});i.walk(e,r)})},t.RestWalker=r},function(e,t,n){"use strict";var r=n(93),o=n(38);e.exports=function(e,t,n){var i=null==e?0:e.length;return i?(t=n||t===undefined?1:o(t),r(e,t<0?0:t,i)):[]}},function(e,t,n){"use strict";e.exports=function(e,t,n){for(var i=-1,r=e.length,o=((n=r<n?r:n)<0&&(n+=r),r=n<(t=t<0?r<-t?0:r+t:t)?0:n-t>>>0,t>>>=0,Array(r));++i<r;)o[i]=e[i+t];return o}},function(z,e,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||(n({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var i,r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(e){return e&&e.__esModule?e:{"default":e}},a=(Object.defineProperty(e,"__esModule",{value:!0}),e.serializeProduction=e.serializeGrammar=e.Terminal=e.Alternation=e.RepetitionWithSeparator=e.Repetition=e.RepetitionMandatoryWithSeparator=e.RepetitionMandatory=e.Option=e.Alternative=e.Rule=e.NonTerminal=e.AbstractProduction=void 0,o(t(4))),F=o(t(3)),s=o(t(39)),M=o(t(232)),l=o(t(233)),c=o(t(62));function D(e){return t=e,(0,s["default"])(t.LABEL)&&""!==t.LABEL?e.LABEL:e.name;var t}Object.defineProperty(u.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),u.prototype.accept=function(t){t.visit(this),(0,F["default"])(this.definition,function(e){e.accept(t)})};t=u;function u(e){this._definition=e}e.AbstractProduction=t;r(p,h=t),Object.defineProperty(p.prototype,"definition",{get:function(){return this.referencedRule!==undefined?this.referencedRule.definition:[]},set:function(e){},enumerable:!1,configurable:!0}),p.prototype.accept=function(e){e.visit(this)};var h,d=p;function p(e){var t=h.call(this,[])||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.NonTerminal=d;r(g,f=t);var f,m=g;function g(e){var t=f.call(this,e.definition)||this;return(t.orgText="",c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Rule=m;r(v,y=t);var y,b=v;function v(e){var t=y.call(this,e.definition)||this;return(t.ignoreAmbiguities=!1,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Alternative=b;r(S,x=t);var x,I=S;function S(e){var t=x.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Option=I;r(w,_=t);var _,C=w;function w(e){var t=_.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.RepetitionMandatory=C;r(B,E=t);var E,T=B;function B(e){var t=E.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.RepetitionMandatoryWithSeparator=T;r(O,R=t);var R,N=O;function O(e){var t=R.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Repetition=N;r(j,L=t);var L,H=j;function j(e){var t=L.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.RepetitionWithSeparator=H;r(k,V=t),Object.defineProperty(k.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0});var V,W=k;function k(e){var t=V.call(this,e.definition)||this;return t.idx=1,t.ignoreAmbiguities=!1,(t.hasPredicates=!1,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Alternation=W;G.prototype.accept=function(e){e.visit(this)};var A=G;function G(e){this.idx=1,(0,c["default"])(this,(0,l["default"])(e,function(e){return e!==undefined}))}function P(e){function t(e){return(0,a["default"])(e,P)}var n,i;if(e instanceof d)return n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx},(0,s["default"])(e.label)&&(n.label=e.label),n;if(e instanceof b)return{type:"Alternative",definition:t(e.definition)};if(e instanceof I)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof C)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof T)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:P(new A({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof H)return{type:"RepetitionWithSeparator",idx:e.idx,separator:P(new A({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof N)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof W)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof A)return n={type:"Terminal",name:e.terminalType.name,label:D(e.terminalType),idx:e.idx},(0,s["default"])(e.label)&&(n.terminalLabel=e.label),i=e.terminalType.PATTERN,e.terminalType.PATTERN&&(n.pattern=(0,M["default"])(i)?i.source:i),n;if(e instanceof m)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}e.Terminal=A,e.serializeGrammar=function(e){return(0,a["default"])(e,P)},e.serializeProduction=P},function(e,t,n){"use strict";var i=n(35),r=n(486),o=n(488);e.exports=function(e,t){return o(r(e,t,i),e+"")}},function(e,t,n){"use strict";var r=n(216),o=n(13),a=n(494),s=n(0),l=n(63);e.exports=function(e,t,n){var i=s(e)?r:a;return n&&l(e,t,n)&&(t=undefined),i(e,o(t,3))}},function(e,t,n){"use strict";var i=n(234),r=n(497),o=n(498);e.exports=function(e,t,n){return t==t?o(e,t,n):i(e,r,n)}},function(e,t,n){"use strict";var l=n(83),c=n(499);e.exports=function u(e,t,n,i,r){var o=-1,a=e.length;for(n=n||c,r=r||[];++o<a;){var s=e[o];0<t&&n(s)?1<t?u(s,t-1,n,i,r):l(r,s):i||(r[r.length]=s)}return r}},function(e,t,n){"use strict";var i=n(500);e.exports=function(e){return e&&e.length?i(e):[]}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var i;(t="function"==typeof(i=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx;this.input=e.input;this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0;this.input=e;this.groupIdx=0;this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");var n={type:"Flags",loc:{begin:this.idx,end:e.length},global:false,ignoreCase:false,multiLine:false,unicode:false,sticky:false};while(this.isRegExpFlag())switch(this.popChar()){case"g":r(n,"global");break;case"i":r(n,"ignoreCase");break;case"m":r(n,"multiLine");break;case"u":r(n,"unicode");break;case"y":r(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:t,loc:this.loc(0)}},e.prototype.disjunction=function(){var e=[];var t=this.idx;e.push(this.alternative());while(this.peekChar()==="|"){this.consumeChar("|");e.push(this.alternative())}return{type:"Disjunction",value:e,loc:this.loc(t)}},e.prototype.alternative=function(){var e=[];var t=this.idx;while(this.isTerm())e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}},e.prototype.term=function(){if(this.isAssertion())return this.assertion();else return this.atom()},e.prototype.assertion=function(){var e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var t;switch(this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead";break}l(t);var n=this.disjunction();this.consumeChar(")");return{type:t,value:n,loc:this.loc(e)}}c()},e.prototype.quantifier=function(e){var t;var n=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:Infinity};break;case"+":t={atLeast:1,atMost:Infinity};break;case"?":t={atLeast:0,atMost:1};break;case"{":var i=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:i,atMost:i};break;case",":var r;if(this.isDigit()){r=this.integerIncludingZero();t={atLeast:i,atMost:r}}else t={atLeast:i,atMost:Infinity};this.consumeChar("}");break}if(e===true&&t===undefined)return undefined;l(t);break}if(e===true&&t===undefined)return undefined;l(t);if(this.peekChar(0)==="?"){this.consumeChar("?");t.greedy=false}else t.greedy=true;t.type="Quantifier";t.loc=this.loc(n);return t},e.prototype.atom=function(){var e;var t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===undefined&&this.isPatternCharacter())e=this.patternCharacter();l(e);e.loc=this.loc(t);if(this.isQuantifier())e.quantifier=this.quantifier();return e},e.prototype.dotAll=function(){this.consumeChar(".");return{type:"Set",complement:true,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){this.consumeChar("\\");switch(this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var e=this.positiveInteger();return{type:"GroupBackReference",value:e}},e.prototype.characterClassEscape=function(){var e;var t=false;switch(this.popChar()){case"d":e=u;break;case"D":e=u;t=true;break;case"s":e=d;break;case"S":e=d;t=true;break;case"w":e=h;break;case"W":e=h;t=true;break}l(e);return{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\x0B");break}l(e);return{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(/[a-zA-Z]/.test(e)===false)throw Error("Invalid ");var t=e.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:t}},e.prototype.nulCharacterAtom=function(){this.consumeChar("0");return{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){this.consumeChar("x");return this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){this.consumeChar("u");return this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var e=this.popChar();return{type:"Character",value:a(e)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var e=this.popChar();return{type:"Character",value:a(e)}}},e.prototype.characterClass=function(){var e=[];var t=false;this.consumeChar("[");if(this.peekChar(0)==="^"){this.consumeChar("^");t=true}while(this.isClassAtom()){var n=this.classAtom();var i=n.type==="Character";if(i&&this.isRangeDash()){this.consumeChar("-");var r=this.classAtom();var o=r.type==="Character";if(o){if(r.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:r.value})}else{s(n.value,e);e.push(a("-"));s(r.value,e)}}else s(n.value,e)}this.consumeChar("]");return{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){this.consumeChar("\\");switch(this.peekChar()){case"b":this.consumeChar("b");return{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=true;this.consumeChar("(");switch(this.peekChar(0)){case"?":this.consumeChar("?");this.consumeChar(":");e=false;break;default:this.groupIdx++;break}var t=this.disjunction();this.consumeChar(")");var n={type:"Group",capturing:e,value:t};if(e)n.idx=this.groupIdx;return n},e.prototype.positiveInteger=function(){var e=this.popChar();if(n.test(e)===false)throw Error("Expecting a positive integer");while(t.test(this.peekChar(0)))e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(t.test(e)===false)throw Error("Expecting an integer");while(t.test(this.peekChar(0)))e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return true;default:return false}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return t.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){if(e===undefined)e=0;switch(this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return false;default:return true}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return true;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return true;default:return false}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return true;case"\\":switch(this.peekChar(1)){case"b":case"B":return true;default:return false}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return false}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return this.quantifier(true)!==undefined}catch(t){return false}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return false;default:return true}},e.prototype.parseHexDigits=function(e){var t="";for(var n=0;n<e;n++){var i=this.popChar();if(o.test(i)===false)throw Error("Expecting a HexDecimal digits");t+=i}var r=parseInt(t,16);return{type:"Character",value:r}},e.prototype.peekChar=function(e){if(e===undefined)e=0;return this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);this.consumeChar();return e},e.prototype.consumeChar=function(e){if(e!==undefined&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},e.prototype.loc=function(e){return{begin:e,end:this.idx}};var o=/[0-9a-fA-F]/,t=/[0-9]/,n=/[1-9]/,i;function a(e){return e.charCodeAt(0)}function s(e,t){if(e.length!==undefined)e.forEach(function(e){t.push(e)});else t.push(e)}function r(e,t){if(e[t]===true)throw"duplicate flag "+t;e[t]=true}function l(e){if(e===undefined)throw Error("Internal Error - Should never get here!")}function c(){throw Error("Internal Error - Should never get here!")}for(var u=[],i=a("0");i<=a("9");i++)u.push(i);var h=[a("_")].concat(u);for(i=a("a");i<=a("z");i++)h.push(i);for(i=a("A");i<=a("Z");i++)h.push(i);var d=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\x0B"),a("\t"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\ufeff")];function p(){}return p.prototype.visitChildren=function(e){for(var t in e){var n=e[t];if(e.hasOwnProperty(t))if(n.type!==undefined)this.visit(n);else if(Array.isArray(n))n.forEach(function(e){this.visit(e)},this)}},p.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)},p.prototype.visitPattern=function(e){},p.prototype.visitFlags=function(e){},p.prototype.visitDisjunction=function(e){},p.prototype.visitAlternative=function(e){},p.prototype.visitStartAnchor=function(e){},p.prototype.visitEndAnchor=function(e){},p.prototype.visitWordBoundary=function(e){},p.prototype.visitNonWordBoundary=function(e){},p.prototype.visitLookahead=function(e){},p.prototype.visitNegativeLookahead=function(e){},p.prototype.visitCharacter=function(e){},p.prototype.visitSet=function(e){},p.prototype.visitGroup=function(e){},p.prototype.visitGroupBackReference=function(e){},p.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:p,VERSION:"0.5.0"}})?i.apply(t,[]):i)!==undefined&&(e.exports=t)},function(e,t,n){"use strict";var i=n(85),r=n(240),o=n(13),a=n(0),s=n(503);e.exports=function(e,t){return(a(e)?i:r)(e,s(o(t,3)))}},function(e,t,n){"use strict";var i=n(504),r=n(98),o=n(95),a=n(505),n=o(function(e,t){return a(e)?i(e,r(t,1,a,!0)):[]});e.exports=n},function(e,t,n){"use strict";n=n(507)(n(241));e.exports=n},function(e,t,n){"use strict";var i=n(85),r=n(240),o=n(13),a=n(0);e.exports=function(e,t){return(a(e)?i:r)(e,o(t,3))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegExpParserCache=t.getRegExpAst=void 0;var n=n(101),i={},r=new n.RegExpParser;t.getRegExpAst=function(e){var t,e=e.toString();return i.hasOwnProperty(e)?i[e]:(t=r.pattern(e),i[e]=t)},t.clearRegExpParserCache=function(){i={}}},function(e,t,n){"use strict";e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:undefined}},function(e,t,n){"use strict";var r=n(93),o=n(38);e.exports=function(e,t,n){var i=null==e?0:e.length;return i?(t=n||t===undefined?1:o(t),r(e,0,(t=i-t)<0?0:t)):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyForAutomaticLookahead=t.AT_LEAST_ONE_SEP_IDX=t.MANY_SEP_IDX=t.AT_LEAST_ONE_IDX=t.MANY_IDX=t.OPTION_IDX=t.OR_IDX=t.BITS_FOR_ALT_IDX=t.BITS_FOR_RULE_IDX=t.BITS_FOR_OCCURRENCE_IDX=t.BITS_FOR_METHOD_TYPE=void 0,t.BITS_FOR_METHOD_TYPE=4,t.BITS_FOR_OCCURRENCE_IDX=8,t.BITS_FOR_RULE_IDX=12,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_OCCURRENCE_IDX,t.OPTION_IDX=2<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_IDX=3<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_OCCURRENCE_IDX,t.getKeyForAutomaticLookahead=function(e,t,n){return n|t|e};t.BITS_FOR_ALT_IDX},function(e,t,n){"use strict";var i=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return i.test(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.headerItemsData=t.defaultHeaderItems=void 0;t.defaultHeaderItems=["add","delete","moveUp","moveDown","refresh"];t.headerItemsData=[{type:"add",cls:"text-add-tip-font",title:"BI-Basic_Parameter_Insert",event:"EVENT_INSERT"},{type:"delete",cls:"close-font bi-error",title:"BI-Basic_Parameter_Delete",event:"EVENT_DELETE"},{type:"moveUp",cls:"add-up-font",title:"BI-Basic_Parameter_Move_Up",event:"EVENT_MOVE_UP"},{type:"moveDown",cls:"minus-down-font",title:"BI-Basic_Parameter_Move_Down",event:"EVENT_MOVE_DOWN"},{type:"refresh",cls:"parameter-refresh-font",title:"BI-Basic_Parameter_Refresh",event:"EVENT_REFRESH"}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var i=n(45),r=n(49),o=c(n(70)),a=c(n(71)),s=c(n(113)),l=c(n(86));function c(e){return e&&e.__esModule?e:{"default":e}}n=function(){var e=t.prototype;function t(e){this.checker=e,this.lexer=new r.Lexer(i.allTokens,{ensureOptimizations:!0}),this.parser=(0,o["default"])();var e=(0,a["default"])(),t=e.interpreter,e=e.setFormula;this.interpreter=t,this.setFormula=e}return e.setFormula=function(){},e.parse=function(e){this.setFormula(new s["default"](this.checker));e=this.lexer.tokenize(e);if(0<e.errors.length)throw t=e.errors[0],new Error(JSON.stringify({type:"lexer",name:t.message,token:(0,l["default"])(t.message.match(/->(.)<-/),[1],""),errorText:BI.i18nText("BI-Expression_syntax_error")}));this.parser.input=e.tokens;var t=this.parser.expr();if(0<this.parser.errors.length)throw e=this.parser.errors[0],new Error(JSON.stringify({type:"parser",name:e.name,token:(0,l["default"])(e.message.match(/->\s(\w+)\s<-/),[1],(0,l["default"])(e,"previousToken.image")||(0,l["default"])(e,"token.image")),errorText:BI.i18nText("BI-Expression_syntax_error")}));return this.interpreter.visit(t)},t}();t["default"]=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=i(n(539)),a=i(n(3)),s=i(n(22)),l=n(71);function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var c=function c(e){r(this,"LOG",function(){return u({name:"LOG",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["number"],["number","number"]],errorText:BI.i18nText("BI-Front-Expression_param_number_number_default","LOG")}),"number"}),r(this,"log",this.LOG),r(this,"MAX",function(){return u({name:"MAX",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isArrayType)(e)},minCount:1,paramType:["number",["array"]],errorText:BI.i18nText("BI-Front-Expression_param_all_number","MAX")}),"number"}),r(this,"max",this.MAX),r(this,"MIN",function(){return u({name:"MIN",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isArrayType)(e)},minCount:1,paramType:["number",["array"]],errorText:BI.i18nText("BI-Front-Expression_param_all_number","MIN")}),"number"}),r(this,"min",this.MIN),r(this,"RAND",function(){return u({name:"RAND",params:arguments,paramCount:0,errorText:BI.i18nText("BI-Front-Expression_param_none","RAND")}),"number"}),r(this,"rand",this.RAND),r(this,"TRUNC",function(){return u({name:"TRUNC",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["number"],["number","number"]],errorText:BI.i18nText("BI-Front-Expression_param_number_number_default","TRUNC")}),"number"}),r(this,"trunc",this.TRUNC),r(this,"DATE",function(){return u({name:"DATE",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:3,paramType:[["number","string"],["number","string"],["number","string"]],errorText:BI.i18nText("BI-Front-Expression_param_multi_number_or_text","DATE")}),"date"}),r(this,"date",this.DATE),r(this,"DATEDELTA",function(){return u({name:"DATEDELTA",params:arguments,checkFunction:function(e,t){return 0===t?(0,l.isStringType)(e)||(0,l.isDateType)(e):(0,l.isNumberType)(e)},paramCount:2,paramType:[["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_date_or_text_number","DATEDELTA")}),"date"}),r(this,"datedelta",this.DATEDELTA),r(this,"DATEDIF",function(){return u({name:"DATEDIF",params:arguments,checkFunction:function(e,t){return 2===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:3,paramType:[["string","date"],["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_date_text_and_text","DATEDIF")}),"number"}),r(this,"datedif",this.DATEDIF),r(this,"DATESUBDATE",function(){return u({name:"DATESUBDATE",params:arguments,checkFunction:function(e,t){return 2===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:3,paramType:[["string","date"],["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_date_text_and_text","DATESUBDATE")}),"number"}),r(this,"datesubdate",this.DATESUBDATE),r(this,"DATETONUMBER",function(){return u({name:"DATETONUMBER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DATETONUMBER")}),"number"}),r(this,"datetonumber",this.DATETONUMBER),r(this,"DAY",function(){return u({name:"DAY",params:arguments,checkFunction:function(e,t){return 0===t?(0,l.isStringType)(e)||(0,l.isDateType)(e):(0,l.isStringType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","DAY")}),"number"}),r(this,"day",this.DAY),r(this,"DAYS360",function(){return u({name:"DAYS360",params:arguments,checkFunction:function(e,t){return 2===t?(0,l.isStringType)(e)||(0,l.isNumberType)(e)||(0,l.isBooleanType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:2,paramType:[["string","date"],["string","date"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_dateText_textNumber_default","DAYS360")}),"number"}),r(this,"days360",this.DAYS360),r(this,"DAYSOFMONTH",function(){return u({name:"DAYSOFMONTH",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DAYSOFMONTH")}),"number"}),r(this,"daysofmonth",this.DAYSOFMONTH),r(this,"DAYSOFQUARTER",function(){return u({name:"DAYSOFQUARTER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DAYSOFQUARTER")}),"number"}),r(this,"daysofquarter",this.DAYSOFQUARTER),r(this,"DAYVALUE",function(){return u({name:"DAYVALUE",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DAYVALUE")}),"number"}),r(this,"dayvalue",this.DAYVALUE),r(this,"HOUR",function(){return u({name:"HOUR",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","number"]],[["string","number"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","HOUR")}),"number"}),r(this,"hour",this.HOUR),r(this,"LUNAR",function(){return u({name:"LUNAR",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:3,paramType:[["string","number"],["string","number"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_multi_number_or_text","LUNAR")}),"string"}),r(this,"lunar",this.LUNAR),r(this,"MINUTE",function(){return u({name:"MINUTE",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","MINUTE")}),"number"}),r(this,"minute",this.MINUTE),r(this,"MONTH",function(){return u({name:"MONTH",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","MONTH")}),"number"}),r(this,"month",this.MONTH),r(this,"MONTHDELTA",function(){return u({name:"MONTHDELTA",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isNumberType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:2,paramType:[["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_date_or_text_number","MONTHDELTA")}),"date"}),r(this,"monthdelta",this.MONTHDELTA),r(this,"NOW",function(){return u({name:"NOW",params:arguments,paramCount:0,errorText:BI.i18nText("BI-Front-Expression_param_none","NOW")}),"date"}),r(this,"now",this.NOW),r(this,"QUARTER",function(){return u({name:"QUARTER",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","QUARTER")}),"number"}),r(this,"quarter",this.QUARTER),r(this,"SECOND",function(){return u({name:"SECOND",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","SECOND")}),"number"}),r(this,"second",this.SECOND),r(this,"TIME",function(){return u({name:"TIME",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:3,paramType:[["string","number"],["string","number"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_multi_number_or_text","TIME")}),"date"}),r(this,"time",this.TIME),r(this,"TODATE",function(){return u({name:"TODATE",params:arguments,checkFunction:function(e,t,n){return 1===n.length&&0===t||(0,l.isStringType)(e)},minCount:1,optionalCount:2,paramType:[["any"],["string","string"],["string","string","string"]],errorText:BI.i18nText("BI-Front-Expression_param_to_date","TODATE")}),"date"}),r(this,"todate",this.TODATE),r(this,"TODAY",function(){return u({name:"TODAY",params:arguments,paramCount:0,errorText:BI.i18nText("BI-Front-Expression_param_none","TODAY")}),"date"}),r(this,"today",this.TODAY),r(this,"WEEK",function(){return u({name:"WEEK",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","WEEK")}),"number"}),r(this,"week",this.WEEK),r(this,"WEEKDATE",function(){return u({name:"WEEKDATE",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:4,paramType:[["string","number"],["string","number"],["string","number"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_four_number_or_text","WEEKDATE")}),"date"}),r(this,"weekdate",this.WEEKDATE),r(this,"WEEKDAY",function(){return u({name:"WEEKDAY",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","WEEKDAY")}),"number"}),r(this,"weekday",this.WEEKDAY),r(this,"YEAR",function(){return u({name:"YEAR",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","YEAR")}),"number"}),r(this,"year",this.YEAR),r(this,"YEARDELTA",function(){return u({name:"YEARDELTA",params:arguments,checkFunction:function(e,t){return 0===t?(0,l.isStringType)(e)||(0,l.isDateType)(e):(0,l.isNumberType)(e)},paramCount:2,paramType:[["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_date_or_text_number","YEARDELTA")}),"date"}),r(this,"yeardelta",this.YEARDELTA),r(this,"CHAR",function(){return u({name:"CHAR",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},paramCount:1,paramType:["number"],errorText:BI.i18nText("BI-Front-Expression_param_number","CHAR")}),"string"}),r(this,"char",this.CHAR),r(this,"CODE",function(){return u({name:"CODE",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","CODE")}),"number"}),r(this,"code",this.CODE),r(this,"CONCATENATE",function(){return u({name:"CONCATENATE",params:arguments,checkFunction:function(){return!0},minCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_multi_any_type","CONCATENATE")}),"string"}),r(this,"concatenate",this.CONCATENATE),r(this,"ENDWITH",function(){return u({name:"ENDWITH",params:arguments,checkFunction:function(){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","ENDWITH")}),"number"}),r(this,"endwith",this.ENDWITH),r(this,"EXACT",function(){return u({name:"EXACT",params:arguments,checkFunction:function(){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","EXACT")}),"number"}),r(this,"exact",this.EXACT),r(this,"FIND",function(){return u({name:"FIND",params:arguments,checkFunction:function(e,t,n){return 2!==t||(0,l.isNumberType)(e)},minCount:2,optionalCount:1,paramType:[["any","any"],["any","any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_any_number_default","FIND")}),"number"}),r(this,"find",this.FIND),r(this,"FORMAT",function(){return u({name:"FORMAT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isStringType)(e)},paramCount:2,paramType:["any","string"],errorText:BI.i18nText("BI-Front-Expression_param_any_text","FORMAT")}),"string"}),r(this,"format",this.FORMAT),r(this,"INDEXOF",function(){return u({name:"INDEXOF",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},paramCount:2,paramType:["any","number"],errorText:BI.i18nText("BI-Front-Expression_param_any_number","INDEXOF")}),"string"}),r(this,"indexof",this.INDEXOF),r(this,"LEFT",function(){return u({name:"LEFT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["any"],["any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_any_number_default","LEFT")}),"string"}),r(this,"left",this.LEFT),r(this,"LEN",function(){return u({name:"LEN",params:arguments,checkFunction:function(e){return!0},paramCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_one_any_type","LEN")}),"number"}),r(this,"len",this.LEN),r(this,"LOWER",function(){return u({name:"LOWER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","LOWER")}),"string"}),r(this,"lower",this.LOWER),r(this,"MID",function(){return u({name:"MID",params:arguments,checkFunction:function(e,t){return 0===t||(0,l.isNumberType)(e)},paramCount:3,paramType:["any","number","number"],errorText:BI.i18nText("BI-Front-Expression_param_any_number_number","MID")}),"string"}),r(this,"mid",this.MID),r(this,"NUMTO",function(){return u({name:"NUMTO",params:arguments,checkFunction:function(e,t){return 0!==t&&(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["number"],["number","boolean"]],errorText:BI.i18nText("BI-Front-Expression_param_number_bool_default","NUMTO")}),"string"}),r(this,"numto",this.NUMTO),r(this,"PROPER",function(){return u({name:"PROPER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","PROPER")}),"string"}),r(this,"proper",this.PROPER),r(this,"REGEXP",function(){return u({name:"REGEXP",params:arguments,checkFunction:function(e,t){return(2===t?(0,l.isNumberType):(0,l.isStringType))(e)},minCount:2,optionalCount:1,paramType:[["string","string"],["string","string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_text_text_number_default","REGEXP")}),"string"}),r(this,"regexp",this.REGEXP),r(this,"REPEAT",function(){return u({name:"REPEAT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},paramCount:2,paramType:["any","number"],errorText:BI.i18nText("BI-Front-Expression_param_any_number","REPEAT")}),"string"}),r(this,"repeat",this.REPEAT),r(this,"REPLACE",function(){return u({name:"REPLACE",params:arguments,checkFunction:function(e,t,n){return 3===n.length||1!==t&&2!==t||(0,l.isNumberType)(e)},minCount:3,optionalCount:1,paramType:[["any","any","any"],["any","number","number","any"]],errorText:BI.i18nText("BI-Front-Expression_param_three_text_or_text_two_number_text","REPLACE")}),"string"}),r(this,"replace",this.REPLACE),r(this,"RIGHT",function(){return u({name:"RIGHT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["any"],["any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_any_number_default","RIGHT")}),"string"}),r(this,"right",this.RIGHT),r(this,"SPLIT",function(){return u({name:"SPLIT",params:arguments,checkFunction:function(){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","SPLIT")}),"array"}),r(this,"split",this.SPLIT),r(this,"STARTWITH",function(){return u({name:"STARTWITH",params:arguments,checkFunction:function(e,t){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","STARTWITH")}),"number"}),r(this,"startwith",this.STARTWITH),r(this,"SUBSTITUTE",function(){return u({name:"SUBSTITUTE",params:arguments,checkFunction:function(e,t){return 3!==t||(0,l.isNumberType)(e)},minCount:3,optionalCount:1,paramType:[["any","any","any"],["any","any","any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_three_any_number_default","SUBSTITUTE")}),"string"}),r(this,"substitute",this.SUBSTITUTE),r(this,"TODOUBLE",function(){return u({name:"TODOUBLE",params:arguments,checkFunction:function(){return!0},paramCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_one_any_type","TODOUBLE")}),"number"}),r(this,"todouble",this.TODOUBLE),r(this,"TOINTEGER",function(){return u({name:"TOINTEGER",params:arguments,checkFunction:function(){return!0},paramCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_one_any_type","TOINTEGER")}),"number"}),r(this,"tointeger",this.TOINTEGER),r(this,"TRIM",function(){return u({name:"TRIM",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","TRIM")}),"string"}),r(this,"trim",this.TRIM),r(this,"UPPER",function(){return u({name:"UPPER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","UPPER")}),"string"}),r(this,"upper",this.UPPER),r(this,"AND",function(){return u({name:"AND",params:arguments,checkFunction:function(e){return(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:0,paramType:["any"]}),"number"}),r(this,"and",this.AND),r(this,"OR",function(){return u({name:"OR",params:arguments,checkFunction:function(e){return(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:0,paramType:["any"]}),"number"}),r(this,"or",this.OR),r(this,"IF",function(){return u({name:"IF",params:arguments,checkFunction:function(e,t){return 0!==t||(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},paramCount:3,paramType:[["boolean","number"],"any","any"],errorText:BI.i18nText("BI-Front-Expression_logic_if_three_param","IF")}),"any"}),r(this,"if",this.IF),r(this,"SWITCH",function(){return u({name:"SWITCH",params:arguments,checkFunction:function(e,t){return 0!==t||(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:3,paramType:[["boolean","number"],"any","any"],errorText:BI.i18nText("BI-Front-Expression_logic_switch_le_three_param","SWITCH")}),"any"}),r(this,"switch",this.SWITCH),r(this,"ISNULL",function(){return u({name:"ISNULL",params:arguments,checkFunction:function(){return!0},minCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_multi_any_type","ISNULL")}),"number"}),r(this,"isnull",this.ISNULL),r(this,"NVL",function(){var e=!1,t=[].slice.call(arguments),n=[];return t.forEach(function(e){null===e||e===undefined||n.includes(e)||n.push(e)}),1<n.length&&(e=!0),u({name:"NVL",params:arguments,checkFunction:function(){return!e},minCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_nvl_param_same","ISNULL")}),"any"}),r(this,"nvl",this.NVL);var n=this,t=(["ABS","ACOS","ASIN","ATAN","ATAN2","CEILING","COS","DEGREES","EXP","FACT","FLOOR","INT","LN","LOG10","PI","RADIANS","SIGN","SIN","SORT","TAN"].forEach(function(e){n[e]=n[e.toLowerCase()]=function(){return u({name:e,params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},paramCount:1,paramType:["number"],errorText:BI.i18nText("BI-Front-Expression_param_number",e)}),"number"}}),["MOD","POWER","PROMOTION","RANBETWEEN","ROUND","SIGN","SIN","SORT","TAN"].forEach(function(e){n[e]=n[e.toLowerCase()]=function(){return u({name:e,params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},paramCount:2,paramType:["number","number"],errorText:BI.i18nText("BI-Front-Expression_param_two_number",e)}),"number"}}),BI.Providers.getProvider("bi.formula_editor.checker"));BI.each(t,function(e,t){n[e]=n[e.toLowerCase()]=t}),BI.each(e,function(e,t){n[e]=n[e.toLowerCase()]=t})},u=(t["default"]=c,function u(n){if(!(0,s["default"])(n.paramCount)&&(0,o["default"])(n.params)!==n.paramCount||!(0,s["default"])(n.minCount)&&(0,o["default"])(n.params)<n.minCount||!(0,s["default"])(n.minCount)&&!(0,s["default"])(n.optionalCount)&&(0,o["default"])(n.params)>n.minCount+n.optionalCount)throw new Error(JSON.stringify({type:"function",name:n.name,paramCount:n.paramCount,minCount:n.minCount,optionalCount:n.optionalCount,errorType:"paramCount",errorText:n.errorText}));var i=n.minCount+(n.optionalCount||0),r=!!n.isSupportDynamic;(0,a["default"])(n.params,function(e,t){if(i<t+1&&r)return!1;if(!n.checkFunction(e,t,n.params)&&!(0,l.isAnyType)(e))throw new Error(JSON.stringify({type:"function",name:n.name,paramIndex:t+1,paramType:n.paramType,errorType:"paramType",errorText:n.errorText}))})})},function(e,t,n){"use strict";!function(e){e="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:void 0;null==e.BI&&(e.BI={prepares:[]}),null==e.BI.prepares&&(e.BI.prepares=[])}.call(this,n(69))},function(e,t,n){"use strict";Date.SECOND=1e3,Date.MINUTE=60*Date.SECOND,Date.HOUR=60*Date.MINUTE,Date.DAY=24*Date.HOUR,Date.WEEK=7*Date.DAY,Object.defineProperty(Date.prototype,"getTimezone",{value:function(){return BI.getTimezone(this)}}),Object.defineProperty(Date.prototype,"getMonthDays",{value:function(e){return BI.getMonthDays(this,e)}}),Object.defineProperty(Date.prototype,"getLastDateOfMonth",{value:function(){return BI.getLastDateOfMonth(this)}}),Object.defineProperty(Date.prototype,"getDayOfYear",{value:function(){return BI.getDayOfYear(this)}}),Object.defineProperty(Date.prototype,"getWeekNumber",{value:function(){return BI.getWeekNumber(this)}}),Object.defineProperty(Date.prototype,"getQuarter",{value:function(){return BI.getQuarter(this)}}),Object.defineProperty(Date.prototype,"getOffsetDate",{value:function(e){return BI.getOffsetDate(this,e)}}),Object.defineProperty(Date.prototype,"getOffsetQuarter",{value:function(e){return BI.getOffsetQuarter(this,e)}}),Object.defineProperty(Date.prototype,"getQuarterStartMonth",{value:function(){return BI.getQuarter(this)}}),Object.defineProperty(Date.prototype,"getQuarterStartDate",{value:function(){return BI.getQuarterStartDate(this)}}),Object.defineProperty(Date.prototype,"getQuarterEndDate",{value:function(){return BI.getQuarterEndDate(this)}}),Object.defineProperty(Date.prototype,"getOffsetMonth",{value:function(e){return BI.getOffsetMonth(this,e)}}),Object.defineProperty(Date.prototype,"getWeekStartDate",{value:function(){return BI.getWeekStartDate(this)}}),Object.defineProperty(Date.prototype,"getWeekEndDate",{value:function(){return BI.getWeekEndDate(this)}}),Object.defineProperty(Date.prototype,"print",{value:function(e){return BI.print(this,e)}})},function(e,t,n){"use strict";Function.prototype.before=function(e){return BI.beforeFunc(this,e)},Function.prototype.after=function(e){return BI.afterFunc(this,e)}},function(e,t,n){"use strict";Number.prototype.add=function(e){return BI.add(this,e)},Number.prototype.sub=function(e){return BI.sub(this,e)},Number.prototype.mul=function(e){return BI.mul(this,e)},Number.prototype.div=function(e){return BI.div(this,e)}},function(e,t,n){"use strict";_.extend(String.prototype,{startWith:function(e){return BI.startWith(this,e)},endWith:function(e){return BI.endWith(this,e)},getQuery:function(e){return BI.getQuery(this,e)},appendQuery:function(e){return BI.appendQuery(this,e)},replaceAll:function(e,t){return BI.replaceAll(this,e,t)},perfectStart:function(e){return BI.perfectStart(this,e)},allIndexOf:function(e){return BI.allIndexOf(this,e)}})},function(e,t,n){"use strict";BI.extend(BI,{openWindow:function(e,t,n){var i=null;try{i=window.top.open.apply(window.top,arguments)}catch(r){i=window.open.apply(window,arguments)}return i}})},function(e,t,n){"use strict";var i;(i=function i(e){this.hexcase=e?1:0,this.b64pad="",this.chrsz=8}).prototype.hex_md5=function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))},i.prototype.hex_md5_salt=function(e){for(var t=this.hex_md5(e),n=[],i=[],r=0;r<t.length;r++)(r%2==0?n:i).push(t.charAt(r));return":"+n.join("")+i.join("")},i.prototype.b64_md5=function(e){return this.binl2b64(this.core_md5(this.str2binl(e),e.length*this.chrsz))},i.prototype.hex_hmac_md5=function(e,t){return this.binl2hex(this.core_hmac_md5(e,t))},i.prototype.b64_hmac_md5=function(e,t){return this.binl2b64(this.core_hmac_md5(e,t))},i.prototype.calcMD5=function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))},i.prototype.core_md5=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,i=-271733879,r=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=n,l=i,c=r,u=o,n=this.md5_ff(n,i,r,o,e[a+0],7,-680876936),o=this.md5_ff(o,n,i,r,e[a+1],12,-389564586),r=this.md5_ff(r,o,n,i,e[a+2],17,606105819),i=this.md5_ff(i,r,o,n,e[a+3],22,-1044525330);n=this.md5_ff(n,i,r,o,e[a+4],7,-176418897),o=this.md5_ff(o,n,i,r,e[a+5],12,1200080426),r=this.md5_ff(r,o,n,i,e[a+6],17,-1473231341),i=this.md5_ff(i,r,o,n,e[a+7],22,-45705983),n=this.md5_ff(n,i,r,o,e[a+8],7,1770035416),o=this.md5_ff(o,n,i,r,e[a+9],12,-1958414417),r=this.md5_ff(r,o,n,i,e[a+10],17,-42063),i=this.md5_ff(i,r,o,n,e[a+11],22,-1990404162),n=this.md5_ff(n,i,r,o,e[a+12],7,1804603682),o=this.md5_ff(o,n,i,r,e[a+13],12,-40341101),r=this.md5_ff(r,o,n,i,e[a+14],17,-1502002290),i=this.md5_ff(i,r,o,n,e[a+15],22,1236535329),n=this.md5_gg(n,i,r,o,e[a+1],5,-165796510),o=this.md5_gg(o,n,i,r,e[a+6],9,-1069501632),r=this.md5_gg(r,o,n,i,e[a+11],14,643717713),i=this.md5_gg(i,r,o,n,e[a+0],20,-373897302),n=this.md5_gg(n,i,r,o,e[a+5],5,-701558691),o=this.md5_gg(o,n,i,r,e[a+10],9,38016083),r=this.md5_gg(r,o,n,i,e[a+15],14,-660478335),i=this.md5_gg(i,r,o,n,e[a+4],20,-405537848),n=this.md5_gg(n,i,r,o,e[a+9],5,568446438),o=this.md5_gg(o,n,i,r,e[a+14],9,-1019803690),r=this.md5_gg(r,o,n,i,e[a+3],14,-187363961),i=this.md5_gg(i,r,o,n,e[a+8],20,1163531501),n=this.md5_gg(n,i,r,o,e[a+13],5,-1444681467),o=this.md5_gg(o,n,i,r,e[a+2],9,-51403784),r=this.md5_gg(r,o,n,i,e[a+7],14,1735328473),i=this.md5_gg(i,r,o,n,e[a+12],20,-1926607734),n=this.md5_hh(n,i,r,o,e[a+5],4,-378558),o=this.md5_hh(o,n,i,r,e[a+8],11,-2022574463),r=this.md5_hh(r,o,n,i,e[a+11],16,1839030562),i=this.md5_hh(i,r,o,n,e[a+14],23,-35309556),n=this.md5_hh(n,i,r,o,e[a+1],4,-1530992060),o=this.md5_hh(o,n,i,r,e[a+4],11,1272893353),r=this.md5_hh(r,o,n,i,e[a+7],16,-155497632),i=this.md5_hh(i,r,o,n,e[a+10],23,-1094730640),n=this.md5_hh(n,i,r,o,e[a+13],4,681279174),o=this.md5_hh(o,n,i,r,e[a+0],11,-358537222),r=this.md5_hh(r,o,n,i,e[a+3],16,-722521979),i=this.md5_hh(i,r,o,n,e[a+6],23,76029189),n=this.md5_hh(n,i,r,o,e[a+9],4,-640364487),o=this.md5_hh(o,n,i,r,e[a+12],11,-421815835),r=this.md5_hh(r,o,n,i,e[a+15],16,530742520),i=this.md5_hh(i,r,o,n,e[a+2],23,-995338651),n=this.md5_ii(n,i,r,o,e[a+0],6,-198630844),o=this.md5_ii(o,n,i,r,e[a+7],10,1126891415),r=this.md5_ii(r,o,n,i,e[a+14],15,-1416354905),i=this.md5_ii(i,r,o,n,e[a+5],21,-57434055),n=this.md5_ii(n,i,r,o,e[a+12],6,1700485571),o=this.md5_ii(o,n,i,r,e[a+3],10,-1894986606),r=this.md5_ii(r,o,n,i,e[a+10],15,-1051523),i=this.md5_ii(i,r,o,n,e[a+1],21,-2054922799),n=this.md5_ii(n,i,r,o,e[a+8],6,1873313359),o=this.md5_ii(o,n,i,r,e[a+15],10,-30611744),r=this.md5_ii(r,o,n,i,e[a+6],15,-1560198380),i=this.md5_ii(i,r,o,n,e[a+13],21,1309151649),n=this.md5_ii(n,i,r,o,e[a+4],6,-145523070),o=this.md5_ii(o,n,i,r,e[a+11],10,-1120210379),r=this.md5_ii(r,o,n,i,e[a+2],15,718787259),i=this.md5_ii(i,r,o,n,e[a+9],21,-343485551),n=this.safe_add(n,s),i=this.safe_add(i,l),r=this.safe_add(r,c),o=this.safe_add(o,u)}return Array(n,i,r,o)},i.prototype.md5_cmn=function(e,t,n,i,r,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(i,o)),r),n)},i.prototype.md5_ff=function(e,t,n,i,r,o,a){return this.md5_cmn(t&n|~t&i,e,t,r,o,a)},i.prototype.md5_gg=function(e,t,n,i,r,o,a){return this.md5_cmn(t&i|n&~i,e,t,r,o,a)},i.prototype.md5_hh=function(e,t,n,i,r,o,a){return this.md5_cmn(t^n^i,e,t,r,o,a)},i.prototype.md5_ii=function(e,t,n,i,r,o,a){return this.md5_cmn(n^(t|~i),e,t,r,o,a)},i.prototype.core_hmac_md5=function(e,t){for(var n=this.str2binl(e),i=(16<n.length&&(n=this.core_md5(n,e.length*this.chrsz)),Array(16)),r=Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];e=this.core_md5(i.concat(this.str2binl(t)),512+t.length*this.chrsz);return this.core_md5(r.concat(e),640)},i.prototype.safe_add=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},i.prototype.bit_rol=function(e,t){return e<<t|e>>>32-t},i.prototype.str2binl=function(e){for(var t=Array(),n=(1<<this.chrsz)-1,i=0;i<e.length*this.chrsz;i+=this.chrsz)t[i>>5]|=(e.charCodeAt(i/this.chrsz)&n)<<i%32;return t},i.prototype.binl2hex=function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n},i.prototype.binl2b64=function(e){for(var t="",n=0;n<4*e.length;n+=3)for(var i=(e[n>>2]>>n%4*8&255)<<16|(e[n+1>>2]>>(n+1)%4*8&255)<<8|e[n+2>>2]>>(n+2)%4*8&255,r=0;r<4;r++)8*n+6*r>32*e.length?t+=this.b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-r)&63);return t},BI.MD5=new i},function(e,t,n){"use strict";function i(e,t){return e<<t|e>>>32-t}function E(e){return(255&c[e>>>24&255])<<24|(255&c[e>>>16&255])<<16|(255&c[e>>>8&255])<<8|255&c[255&e]}function T(e){return e^i(e,2)^i(e,10)^i(e,18)^i(e,24)}function B(e){return e^i(e,13)^i(e,23)}function o(e,t,n){for(var i,r,o=[],a=0,s=new Array(N),l=t,c=s,t=n,u=new Array(4),h=new Array(4),d=0;d<4;d++)h[0]=255&l[0+4*d],h[1]=255&l[1+4*d],h[2]=255&l[2+4*d],h[3]=255&l[3+4*d],u[d]=h[0]<<24|h[1]<<16|h[2]<<8|h[3];for(u[0]^=2746333894,u[1]^=1453994832,u[2]^=1736282519,u[3]^=2993693404,i=0;i<32;i+=4)r=E(r=u[1]^u[2]^u[3]^L[i+0]),c[i+0]=u[0]^=B(r),r=E(r=u[2]^u[3]^u[0]^L[i+1]),c[i+1]=u[1]^=B(r),r=E(r=u[3]^u[0]^u[1]^L[i+2]),c[i+2]=u[2]^=B(r),r=E(r=u[0]^u[1]^u[2]^L[i+3]),c[i+3]=u[3]^=B(r);if(t===R)for(i=0;i<16;i++)r=c[i],c[i]=c[31-i],c[31-i]=r;new Array(16);for(var p,f=new Array(16),m=e.length;O<=m;){p=e.slice(a,a+16),C=_=S=I=y=g=x=v=b=void 0;for(var g,y,b=p,v=f,x=s,I=new Array(4),S=new Array(4),_=0;_<4;_++)S[0]=255&b[0+4*_],S[1]=255&b[1+4*_],S[2]=255&b[2+4*_],S[3]=255&b[3+4*_],I[_]=S[0]<<24|S[1]<<16|S[2]<<8|S[3];for(g=0;g<32;g+=4)y=E(I[1]^I[2]^I[3]^x[g+0]),I[0]=I[0]^T(y),y=E(I[2]^I[3]^I[0]^x[g+1]),I[1]=I[1]^T(y),y=E(I[3]^I[0]^I[1]^x[g+2]),I[2]=I[2]^T(y),y=E(I[0]^I[1]^I[2]^x[g+3]),I[3]=I[3]^T(y);for(var C=0;C<16;C+=4)v[C]=I[3-C/4]>>>24&255,v[C+1]=I[3-C/4]>>>16&255,v[C+2]=I[3-C/4]>>>8&255,v[C+3]=255&I[3-C/4];for(var w=0;w<O;w++)o[a+w]=f[w];m-=O,a+=O}return o}function a(e,t){if(t===R)return e.slice(0,e.lastIndexOf(128));var n=16-e.length%16;0<n&&e.push(128);for(var i=0;i<n-1;i++)e.push(0);return e}function r(e){for(var t="",n=e.length,i=0;i<n;i++)t+=String.fromCharCode(e[i]);for(var r,o,a,s=t,l="",c=0,u=(s=String(s)).length%3;c<s.length;){if(255<(r=s.charCodeAt(c++))||255<(o=s.charCodeAt(c++))||255<(a=s.charCodeAt(c++)))throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");l+=h.charAt((r=r<<16|o<<8|a)>>18&63)+h.charAt(r>>12&63)+h.charAt(r>>6&63)+h.charAt(63&r)}return u?l.slice(0,u-3)+"===".substring(u):l}function s(e){for(var t=function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));for(var t,n,i,r="",o=0;o<e.length;)t=h.indexOf(e.charAt(o++))<<18|h.indexOf(e.charAt(o++))<<12|(n=h.indexOf(e.charAt(o++)))<<6|(i=h.indexOf(e.charAt(o++))),r+=64===n?String.fromCharCode(t>>16&255):64===i?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return r}(e),n=[],i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}function l(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}var R,N,O,c,L,h,u;c=[214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,R=0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,O=16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,N=32,121,238,95,62,215,203,57,72],L=[462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257],h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=function u(){this.ecbEncrypt=function(e,t){if(32!==t.length||/[^0-9a-fA-F]/.test(t))throw new Error("key error");return r(o(a(function(e){for(var t=unescape(encodeURIComponent(e)),n=[],i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(e)),l(t),1))},this.ecbDecrypt=function(e,t){if(32!==t.length||/[^0-9a-fA-F]/.test(t))throw new Error("key error");for(var n=a(o(s(e),l(t),0),0),i=[],r=0;r<n.length;r++)i.push(String.fromCharCode(n[r]));return decodeURIComponent(escape(i.join("")))}},BI.SM4=new u},function(e,t,n){"use strict";function i(r,e,o){var a={approved:!0,errors:[],rules:{}};return BI.each(e,function(e,t){if(o&&!a.approved)return!1;var n,i;BI.has(s,e)?!1===t||(n=function(n,e){var i={},t=e.options,r=e.expects,o=BI.size(r);BI.isNotEmptyArray(r)&&BI.each(r,function(e,t){BI.has(n,t)?i[t]=n[t]:o<=1&&(BI.isKey(n)||BI.isRegExp(n))?i[t]=n:o<=1&&BI.isFunction(n)?i[t]=n():_global.console&&console.error("expects the "+r+" parameter")});BI.isNotEmptyArray(t)&&BI.each(t,function(e,t){BI.has(n,t)&&(i[t]=n[t])});return i}(t,s[e]),i=s[e].validate(r,n),t=(BI.has(t,"message")?t:s[e]).message,t=BI.isFunction(t)?t(r,n):t,a.rules[e]={approved:i,errors:i?"":t},i)||(a.errors.push(t),a.approved=!1):_global.console&&console.error(e+" is not support")}),a}var s,r;s={required:{message:"required",validate:function(e){return BI.isNotEmptyString(e)||BI.isNotEmptyArray(e)||BI.isNotEmptyObject(e)}},range:{validate:function(e,t){return BI.isNumeric(e)?e>=t.min&&e<=t.max:!!BI.isString(e)&&BI.size(e)>=t.min&&BI.size(e)<=t.max},message:"not in range",expects:["min","max"]},min:{message:"not min",validate:function(e,t){return BI.size(e)>=t.value},expects:["value"]},max:{message:function(e,t){return e+" max than "+t.value},validate:function(e,t){return BI.size(e)<=t.value},expects:["value"]},equal:{message:"not equal",validate:function(e,t){return BI.isEqual(e,t.value)},expects:["value"]},regex:{message:"not match",validate:function(e,t){if(BI.isRegExp(t.value))return t.value.test(e);_global.console&&console.error(t.value+" is not a valid regular expression")},expects:["value"]}},r=function r(){this.init=function(e){s=BI.extend(s,e)},this.validate=function(e,t,n){if(BI.isObject(t))return i(e,t,n)},this.addRule=function(e,t){BI.has(s,e)?_global.console&&console.error("rule:["+e+"] has been registed"):s[e]=t}},BI.validator=new r},function(e,t,n){"use strict";BI.SearchIconTextValueCombo=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-search-icon-text-value-combo",height:24,text:"",items:[],iconCls:"",tipType:"",warningTitle:"",attributes:{tabIndex:0}},render:function(){var t=this,e=this.options;return{type:"bi.absolute",items:[{el:{type:"bi.combo",container:e.container,adjustLength:2,toggle:!1,ref:function(){t.combo=this},el:{type:"bi.material.search_icon_text_value_trigger",simple:e.simple,cls:"search-text-value-trigger",ref:function(){t.trigger=this},items:e.items,height:e.height-(e.simple?1:2),text:e.text,value:e.value,tipType:e.tipType,iconCls:e.iconCls,warningTitle:e.warningTitle,title:e.title,listeners:[{eventName:BI.SearchTextValueTrigger.EVENT_CHANGE,action:function(){t.setValue(this.getValue()),t.combo.hideView(),t.fireEvent("EVENT_CHANGE")}}]},popup:{el:{type:"bi.icon_text_value_combo_popup",chooseType:BI.ButtonGroup.CHOOSE_TYPE_SINGLE,value:e.value,items:e.items,ref:function(){t.popup=this,t.trigger.getSearcher().setAdapter(t.popup)},listeners:[{eventName:BI.TextValueComboPopup.EVENT_CHANGE,action:function(){t.setValue(this.getValue()),t.combo.hideView(),t.fireEvent("EVENT_CHANGE")}}]},maxHeight:252},listeners:[{eventName:BI.Combo.EVENT_AFTER_HIDEVIEW,action:function(){t.trigger.stopEditing()}},{eventName:BI.Combo.EVENT_BEFORE_POPUPVIEW,action:function(){t.fireEvent("EVENT_BEFORE_POPUPVIEW")}}],hideChecker:function(e){return 0===t.triggerBtn.element.find(e.target).length}},left:0,right:0,bottom:0,top:0},{el:{type:"bi.trigger_icon_button",cls:"trigger-icon-button",ref:function(){t.triggerBtn=this},width:e.height,height:e.height,handler:function(){t.combo.isViewVisible()?t.combo.hideView():t.combo.showView()}},right:0,bottom:0,top:0}]}},mounted:function(){var e=this.options;BI.isKey(e.value)&&this._checkError(e.value)},_checkError:function(n){var e;BI.isNotNull(n)&&(n=BI.isArray(n)?n:[n],e=BI.find(this.options.items,function(e,t){return BI.contains(n,t.value)}),BI.isNull(e)?(this.element.removeClass("combo-error").addClass("combo-error"),this.trigger.attr("tipType","warning")):(this.element.removeClass("combo-error"),this.trigger.attr("tipType","success")))},populate:function(e){this.options.items=e,this.combo.populate(e)},setValue:function(e){this.combo.setValue(e),this._checkError(e)},getValue:function(){var e=this.popup.getValue();return BI.isNull(e)?[]:BI.isArray(e)?e:[e]}}),BI.shortcut("bi.material.search_icon_text_value_combo",BI.SearchIconTextValueCombo)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Trigger,{props:function(e){return{extraCls:"bi-material-search-icon-text-trigger "+(e.simple?"bi-border-bottom":"bi-border"),height:24}},render:function(){var t=this,i=this.options,e=this._digistIcon(i.value,i.items);return{type:"bi.htape",items:[{el:{type:"bi.icon_change_button",cls:"icon-combo-trigger-icon",iconCls:e,ref:function(e){t.icon=e},disableSelected:!0},vgap:3,width:BI.isKey(e)?i.iconWrapperWidth||i.height:0},{el:{type:"bi.searcher",ref:function(){t.searcher=this},isAutoSearch:!1,el:{type:"bi.state_editor",ref:function(){t.editor=this},defaultText:this._getText(),text:i.text,value:i.value,height:i.height,tipText:""},popup:{type:"bi.icon_text_value_combo_popup",cls:"bi-card",chooseType:BI.ButtonGroup.CHOOSE_TYPE_SINGLE},onSearch:function(e,t){var e=e.keyword,e=BI.Func.getSearchResult(i.items,e),n=e.match,e=e.find;t(BI.concat(e,n))},listeners:[{eventName:BI.Searcher.EVENT_CHANGE,action:function(){t.fireEvent("EVENT_CHANGE")}}]}},{el:{type:"bi.layout",width:24},width:24}],ref:function(e){t.wrapper=e}}},_setState:function(e){this.editor.setState(e)},_getText:function(){var e=this.options;return BI.isKey(e.value)&&e.text===this._digest(e.value,e.items)?"":e.text},_digest:function(n,e){var t=this.options,i=(n=BI.isArray(n)?n:[n],[]),e=BI.Tree.transformToArrayFormat(e);return BI.each(e,function(e,t){BI.deepContains(n,t.value)&&!BI.contains(i,t.text||t.value)&&i.push(t.text||t.value)}),0<i.length?i.join(","):t.text},_digistIcon:function(n,e){var i,t=this.options,e=(n=BI.isArray(n)?n:[n],BI.Tree.transformToArrayFormat(e));return BI.any(e,function(e,t){if(BI.deepContains(n,t.value))return i={text:t.text||t.value,iconCls:t.iconCls},!0}),(BI.isNotNull(i)?i:t).iconCls},stopEditing:function(){this.searcher.stopSearch()},getSearcher:function(){return this.searcher},populate:function(e){this.options.items=e},setValue:function(e){var t=this._digistIcon(e,this.options.items);this.setIcon(t),this._setState(this._digest(e,this.options.items))},setIcon:function(e){var t=this.options,n=(this.icon.setIcon(e),this.wrapper.attr("items")[0]);BI.isKey(e)?n.width!==(t.iconWrapperWidth||t.height)&&(n.width=t.iconWrapperWidth||t.height,this.wrapper.resize()):0!==n.width&&(n.width=0,this.wrapper.resize())},getValue:function(){return this.searcher.getValue()}}),BI.shortcut("bi.material.search_icon_text_value_trigger",i)},function(e,t,n){"use strict";BI.FullScreenController=BI.inherit(BI.Controller,{props:{},_init:function(){BI.FullScreenController.superclass._init.apply(this,arguments),this.exitHandlers=[]},requestFullScreen:function(e,t,n){BI.isNull(this.support)&&(this.support=this._checkSupportScreenHandler()),this.support?(BI.isWidget(e)&&(e=e.element[0]),this._launchFullScreen(e,n),t.call(this,!0)):(BI.Msg.toast(BI.i18nText("fullscreen api not support"),{level:"error"}),t(!1))},getFullScreenElement:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||null},isFullScreen:function(e){return!!((e=e||document).fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement)},exitFullScreen:function(){return this._existFullscreenHandler(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),BI.each(this.exitHandlers,function(e,t){BI.isFunction(t)&&t()}),this},_launchFullScreen:function(e,t){var n=this;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen(),BI.$(e).addClass("bi-fullscreen-element"),this.fullscreenElement=e,BI.$(document).bind("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){n.isFullScreen()||(BI.isFunction(t)&&t(),n.exitHandlers=[],n._existFullscreenHandler(),BI.$(document).unbind("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange"))})},_checkSupportScreenHandler:function(){document.body&&(e=document.body.requestFullscreen||document.body.webkitRequestFullscreen||document.body.mozRequestFullScreen||document.body.msRequestFullscreen);var e,t=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled;return!(!e||!t)},_existFullscreenHandler:function(){var e=this.getFullScreenElement()||this.fullscreenElement;e&&BI.$(e).removeClass("bi-fullscreen-element"),this.fullscreenElement=null}}),BI.FullScreen=new BI.FullScreenController},function(e,t,n){"use strict";BI.AbstractFilterItem=BI.inherit(BI.Widget,{props:{baseCls:"bi-filter-item bi-border-right bi-border-bottom"},isSelectedCondition:function(){return this.emptyItem&&this.emptyItem.isVisible()},setSelectedCondition:function(e){e&&!this.emptyItem&&(this.emptyItem=BI.createWidget({type:"bi.absolute",height:40,cls:"filter-item-empty-item bi-border-top",items:[{el:{type:"bi.center_adapt",cls:"empty-filter-item-leaf"}}],hgap:10,vgap:5}),BI.createWidget({type:"bi.vertical",element:this,items:[this.emptyItem],scrolly:!1})),this.emptyItem&&this.emptyItem.setVisible(e)}}),BI.extend(BI.AbstractFilterItem,{FILTER_OPERATION_FORMULA:1,FILTER_OPERATION_CONDITION:2,FILTER_OPERATION_CONDITION_AND:3,FILTER_OPERATION_CONDITION_OR:4,FILTER_OPERATION_FORMULA_AND:5,FILTER_OPERATION_FORMULA_OR:6,FILTER_OPERATION_SHAKE:7})},function(e,t,n){"use strict";BI.AndOrFilterExpander=BI.inherit(BI.Widget,{props:{baseCls:"bi-filter-expander",el:{},popup:{}},render:function(){var t=this,e=this.options;return{type:"bi.filter_expander",switchable:e.switchable,el:e.el,popup:e.popup,id:e.id,value:e.value,listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,arguments)}}],ref:function(e){t.expander=e}}},populate:function(){this.expander.populate.apply(this.expander,arguments)},getValue:function(){var e=this.expander.getValue();return{filterType:e.type,filterValue:e.value,id:e.id}}}),BI.shortcut("bi.and.or.filter.expander",BI.AndOrFilterExpander)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.AbstractFilterItem,{_constant:{EXPANDER_WIDTH:30},props:{baseCls:"bi-filter-expander-item bi-filter-expander bi-border-left bi-border-bottom",el:{},popup:{},switchable:!0},render:function(){var t=this,e=this.options,n=e.el.value;return{type:"bi.horizontal_adapt",cls:"filter-item-empty-item",horizontalAlign:BI.HorizontalAlign.Stretch,columnSize:[this._constant.EXPANDER_WIDTH,"fill"],verticalAlign:BI.VerticalAlign.Middle,items:[{type:"bi.absolute",cls:"filter-item-expander-wrapper",items:[{el:{type:"bi.text_button",$testId:"bi-materials-filter-and-or-expander",cls:"condition-and-or",text:this._getText(n),value:n,id:e.id,width:this._constant.EXPANDER_WIDTH,height:"100%",ref:function(e){t.expander=e},listeners:[{eventName:BI.TextButton.EVENT_CHANGE,action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,BI.Events.CLICK,"",t)}}]},left:0,top:0,right:0,bottom:0},{el:{type:"bi.icon_button",invisible:!e.switchable,stopPropagation:!0,cls:"change-and-or-font",title:BI.i18nText("BI-Basic_Switch"),handler:function(){t.switchText(),t.fireEvent(BI.Controller.EVENT_CHANGE,BI.Events.CLICK,!0,t)}},top:10,width:16,height:16,left:7}],width:this._constant.EXPANDER_WIDTH,height:"100%"},BI.extend(e.popup,{ref:function(e){t.conditionsView=e},listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,arguments)}}]})]}},_getText:function(e){return e===BI.Filter.FILTER_TYPE.AND?BI.i18nText("BI-Basic_And"):BI.i18nText("BI-Basic_Or")},switchText:function(){var e=this.expander.getValue()===BI.Filter.FILTER_TYPE.AND?BI.Filter.FILTER_TYPE.OR:BI.Filter.FILTER_TYPE.AND;this.expander.setValue(e),this.expander.setText(this._getText(e))},getValue:function(){return{type:this.expander.getValue(),value:this.conditionsView.getValue(),id:this.options.id}},populate:function(){this.conditionsView.populate.apply(this.conditionsView,arguments)}}),BI.shortcut("bi.filter_expander",i)},function(e,t,n){"use strict";BI.Filter=BI.inherit(BI.Widget,{constants:{FIELD_TYPE_NUMBER:1,FIELD_TYPE_STRING:0,FIELD_TYPE_DATE:2},props:{baseCls:"bi-filter",expander:{},items:[],el:{},itemCreator:BI.empty},_store:function(){return BI.Models.getModel("bi.model.material.filter")},watch:{shakeTree:function(){this.shakeTree()}},render:function(){var i=this,e=this.options;return BI.extend({type:"bi.filter_operation",addWarningTitle:e.addWarningTitle,expander:e.expander,listeners:[{eventName:"EVENT_OPERATION",action:function(e){switch(e){case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION:i.store.addCondition(),i._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_CONDITION);break;case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND:i.store.addAndCondition(),i._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_CONDITION);break;case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR:i.store.addOrCondition(),i._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_CONDITION,1);break;case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA:i.store.addFormula(),i._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_FORMULA);break;case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND:i.store.addAndFormula(),i._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_FORMULA);break;case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR:i.store.addOrFormula(),i._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_FORMULA,1);break;case BI.AbstractFilterItem.FILTER_OPERATION_SHAKE:i.store.shakeTree()}}},{eventName:"BI.FilterOperation.EVENT_DESTROY_ITEM",action:function(e){i._removeCondition(e)}},{eventName:"EVENT_CLICK_EXPANDER",action:function(e,t,n){i._switchConditionLink(n),i._checkBeautifyLevelNecessary(),i.fireEvent("EVENT_CHANGE")}}],ref:function(e){i.filter=e}},e.el)},mounted:function(){this.tree=new BI.Tree,this.tree.initTree(this.options.items),this._populate(this.tree.toJSONWithNode())},_checkBeautifyLevelNecessary:function(){this.filter.setBeautifyButtonVisible(this._checkLevelStructure(this.tree.getRoot()))},_checkLevelStructure:function(n,e){var i=this,t=n.getChildren();if(BI.isNotNull(e)){var e=e.get("data"),r=n.get("data");if(BI.isNotNull(e)&&e.value===r.value)return!0}return BI.any(t,function(e,t){return i._checkLevelStructure(t,n)})},_switchConditionLink:function(e){var e=this.tree.search(e.attr("id"));BI.isNotNull(e)&&((e=e.get("data")).value=e.value===BI.Filter.FILTER_TYPE.AND?BI.Filter.FILTER_TYPE.OR:BI.Filter.FILTER_TYPE.AND)},_createEmptyNode:function(e){var t=new BI.Node(BI.UUID());return t.set("data",{value:e}),t},_insertAndOrCondition:function(e,t,n){var i,r,o,a,s=["AND","OR"],e=(n=n||0,this.tree.search(e));BI.isNotNull(e)&&(a=e.get("data"),r=(i=e.getParent()).getChildIndex(e.id),o=i.get("data")||{},t=this._createEmptyNode(t),a.value===BI.Filter.FILTER_TYPE[s[n]]?this.tree.addNode(e,t):(a.value!==BI.Filter.FILTER_TYPE[s[1-n]]||o.value!==BI.Filter.FILTER_TYPE[s[n]])&&(a.value===BI.Filter.FILTER_TYPE[s[1-n]]&&o.value!==BI.Filter.FILTER_TYPE[s[n]]||o.value===BI.Filter.FILTER_TYPE[s[1-n]]||o.value!==BI.Filter.FILTER_TYPE.AND&&o.value!==BI.Filter.FILTER_TYPE.OR)?((a=new BI.Node(BI.UUID())).set("data",{value:BI.Filter.FILTER_TYPE[s[n]],children:[e.get("data"),t.get("data")]}),i.removeChildByIndex(r),i.addChild(a,r),a.addChild(e),a.addChild(t)):i.addChild(t,r+1))},_removeCondition:function(e){var t,n=this.tree.search(e);BI.isNotNull(n)&&((n=n.getParent()).removeChild(e),n.getChildrenLength()<=1&&(e=n.getParent(),BI.isNotNull(e))&&(t=e.getChildIndex(n.id),e.removeChildByIndex(t),1===n.getChildrenLength())&&e.addChild(n.getFirstChild(),t),this._populate(this.tree.toJSONWithNode()),this.fireEvent("EVENT_CHANGE"))},_addAndOrCondition:function(e,t){var n,i,r=["AND","OR"],o=(t=t||0,this.filter.getCurrentSelectItem());BI.isNotNull(o)?(o=o.attr("id"),this._insertAndOrCondition(o,e,t)):(o=this._createEmptyNode(e),n=(e=this.tree.getRoot()).getLastChild(),BI.isNotNull(n)?n.get("data").value===BI.Filter.FILTER_TYPE[r[t]]?this.tree.addNode(n,o):((i=new BI.Node(BI.UUID())).set("data",{value:BI.Filter.FILTER_TYPE[r[t]],children:[n.get("data"),o.get("data")]}),e.removeChild(n.id),this.tree.addNode(i),this.tree.addNode(i,n),this.tree.addNode(i,o)):this.tree.addNode(o)),this._populate(this.tree.toJSONWithNode()),this.fireEvent("EVENT_CHANGE")},_shakeTree:function(e,n){for(var t,i,r,o=this,a=0,s=e.getChildren(),l=0;l<s.length;l++){var c=o._shakeTree(s[l],e);0<c&&(l+=c-1)}return BI.isNotNull(n)&&(t=n.get("data"),i=e.get("data"),BI.isNotNull(t))&&t.value===i.value&&(r=n.getChildIndex(e.id),n.removeChild(e.id),BI.each(e.getChildren(),function(e,t){a++,o.tree.addNode(n,t,r+e)})),a},shakeTree:function(){var e=this.tree.getRoot();this._shakeTree(e),this._populate(this.tree.toJSONWithNode()),this.fireEvent("EVENT_CHANGE")},_populate:function(e){this.filter.defaultState();var n=this.options;n.items=e,BI.Tree.traversal(e,function(e,t){n.itemCreator(t)}),this.filter.populate.apply(this.filter,[e]),this._checkBeautifyLevelNecessary()},populate:function(e){this.tree.initTree(e),this._populate(this.tree.toJSONWithNode())},getValue:function(){return this.filter.getValue()}}),BI.shortcut("bi.filter",BI.Filter),BI.Filter.FILTER_TYPE={},BI.Filter.FILTER_TYPE.FORMULA=33,BI.Filter.FILTER_TYPE.AND=34,BI.Filter.FILTER_TYPE.OR=35,BI.Filter.FILTER_TYPE.EMPTY_FORMULA=36,BI.Filter.FILTER_TYPE.EMPTY_CONDITION=37},function(e,t,n){"use strict";var i;i=BI.inherit(BI.ButtonTree,{props:{baseCls:"bi-button-map"},_createBtns:function(e){var t=this.options,t=BI.createWidgets(BI.createItems(e,{type:"bi.text_button",once:0===t.chooseType})),e=BI.map(e,function(e,t){if((t=BI.stripEL(t)).id||t.value)return t.id||t.value;throw new Error("item must have 'id' or 'value' as its property")});return BI.zipObject(e,t)},setValue:function(n){n=BI.isArray(n)?n:[n],BI.each(this.buttons,function(e,t){BI.isFunction(t.setSelected)?BI.contains(n,e)?t.setSelected&&t.setSelected(!0):t.setSelected&&t.setSelected(!1):t.setValue(n)})},setNotSelectedValue:function(n){n=BI.isArray(n)?n:[n],BI.each(this.buttons,function(e,t){BI.isFunction(t.setSelected)?BI.contains(n,e)?t.setSelected&&t.setSelected(!1):t.setSelected&&t.setSelected(!0):t.setNotSelectedValue(n)})},populate:function(e){var i=this,r=[].slice.call(arguments),o=new BI.LinkHashMap,a=function a(e){return e.id||e.value},s=(this.buttons||(this.buttons={}),[]),l=(BI.each(e,function(e,t){var n;t=BI.stripEL(t),i.buttons[a(t)]?(n=i.buttons[a(t)],r[0]=t.items,r[2]=t,n.populate&&n.populate.apply(n,r)):s.push(t)}),r[0]=s,this._btnsCreator.apply(this,r)),c=[],e=(BI.each(e,function(e,t){t=BI.stripEL(t);var n=i.buttons[a(t)]||l[a(t)];o.add(a(t),n),c.push(n)}),this.buttons=o.map,BI.DOM.hang(this.buttons),this.element.empty(),this._packageItems(e,this._packageBtns(c)));BI.createWidget(BI.extend({element:this},this._packageLayout(e)))},getIndexByValue:function(){throw new Error("Can not use getIndexByValue")}}),BI.shortcut("bi.filter_list",i)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{state:function(){return{setSelectedCondition:!1,shakeTree:!1}},childContext:["setSelectedCondition"],computed:{},actions:{addCondition:function(){},addAndCondition:function(){},addOrCondition:function(){},addFormula:function(){},addAndFormula:function(){},addOrFormula:function(){},shakeTree:function(){this.model.shakeTree=!this.model.shakeTree}}}),BI.model("bi.model.material.filter",i)},function(e,t,n){"use strict";BI.FilterOperation=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.FilterOperation.superclass._defaultConfig.apply(this,arguments),{constants:{FORMULA_COMBO:[{text:BI.i18nText("BI-Conf_Formula_And"),$testId:"bi-materials-formula-add",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND},{text:BI.i18nText("BI-Conf_Formula_Or"),$testId:"bi-materials-formula-or",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR}],CONDITION_COMBO:[{text:BI.i18nText("BI-Conf_Condition_And"),$testId:"bi-materials-condition-add",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND},{text:BI.i18nText("BI-Conf_Condition_Or"),$testId:"bi-materials-condition-or",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR}]}})},props:{baseCls:"bi-filter-operation",expander:{},items:[],logic:{dynamic:!1},selections:[BI.AbstractFilterItem.FILTER_OPERATION_CONDITION,BI.AbstractFilterItem.FILTER_OPERATION_FORMULA],itemsCreator:BI.emptyFn},_store:function(){return BI.Models.getModel("bi.model.material.filter_operation")},render:function(){var i=this,e=this.options;return this.currentSelected=null,BI.extend({items:[{el:{type:"bi.left_right_vertical_adapt",items:{left:i._buildOperationButton(),right:[{type:"bi.icon_button",cls:"combine-level-font",title:BI.i18nText("BI-Basic_Beautify_Level"),ref:function(e){i.beautifyButton=e},listeners:[{eventName:BI.IconButton.EVENT_CHANGE,action:function(){i.fireEvent("EVENT_OPERATION",BI.AbstractFilterItem.FILTER_OPERATION_SHAKE)}}]}]},height:24,lrgap:20,rrgap:10},height:24},{el:BI.extend({tgap:10,items:[{el:{type:"bi.left",items:[{type:"bi.filter_pane",expander:e.expander,items:e.items,itemsCreator:e.itemsCreator,listeners:[{eventName:"EVENT_CHANGE",action:function(e,t,n){e===BI.Events.CLICK&&!0!==t&&(BI.isNotNull(i.currentSelected)&&i.currentSelected===n?(i.store.setSelectedCondition(!n.isSelectedCondition()),n.setSelectedCondition(!n.isSelectedCondition())):(BI.isNotNull(i.currentSelected)&&(i.store.setSelectedCondition(!1),i.currentSelected.setSelectedCondition(!1)),i.currentSelected=n,i.store.setSelectedCondition(!0),n.setSelectedCondition(!0))),e===BI.Events.CLICK&&!0===t&&i.fireEvent("EVENT_CLICK_EXPANDER",arguments),e===BI.Events.DESTROY&&(i.currentSelected===n&&(i.currentSelected=null),i.fireEvent("BI.FilterOperation.EVENT_DESTROY_ITEM",t,n))}}],ref:function(e){i.filter=e}}]},top:0,right:2,bottom:0,left:0,rgap:2}]},e.logic.dynamic?{type:"bi.vertical",scrolly:!1}:{type:"bi.absolute",scrollable:!0})}]},e.logic.dynamic?{type:"bi.vertical",scrolly:!1}:{type:"bi.vtape"})},_buildOperationButton:function(){var t=this,n=[],i=this.options;return BI.each(this.options.selections,function(e,t){t===BI.AbstractFilterItem.FILTER_OPERATION_FORMULA?n.push({type:"bi.filter_operation_switch",warningTitle:i.addWarningTitle,addType:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND,listeners:[{eventName:"EVENT_CHANGE",action:function(e){r(e)}}]}):(BI.AbstractFilterItem.FILTER_OPERATION_CONDITION,n.push({type:"bi.filter_operation_switch",warningTitle:i.addWarningTitle,addType:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND,listeners:[{eventName:"EVENT_CHANGE",action:function(e){r(e)}}]}))}),n;function r(e){t.fireEvent("EVENT_OPERATION",e),t.defaultState()}},defaultState:function(){BI.isNotNull(this.currentSelected)&&(this.store.setSelectedCondition(!1),this.currentSelected.setSelectedCondition(!1))},getCurrentSelectItem:function(){if(BI.isNotNull(this.currentSelected)&&this.currentSelected.isSelectedCondition())return this.currentSelected},setBeautifyButtonVisible:function(e){this.beautifyButton.setVisible(!!e)},populate:function(){this.filter.populate.apply(this.filter,arguments)},getValue:function(){return this.filter.getValue()}}),BI.shortcut("bi.filter_operation",BI.FilterOperation)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{context:["setSelectedCondition"],computed:{},actions:{setSelectedCondition:function(e){this.model.setSelectedCondition=e}}}),BI.model("bi.model.material.filter_operation",i)},function(e,t,n){"use strict";BI.FilterOperationSwitch=BI.inherit(BI.Single,{props:{baseCls:"bi-filter-operation-switch",width:112,height:24,addType:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND},render:function(){var t=this;return{type:"bi.htape",items:[{el:{type:"bi.text_button",cls:"filter-add-item left-item-radius",$testId:"bi-filter-operation-switch-add-button",text:this._getShowText(this._getDefaultValue()),ref:function(e){t.addButton=e},value:this._getDefaultValue(),listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent("EVENT_CHANGE",this.getValue())}}]},rgap:1},{el:{type:"bi.down_list_combo",el:{cls:"filter-add-item",title:BI.i18nText("BI-Basic_Switch")},iconCls:"filter-down-font icon-size-12",$testId:"bi-filter-operation-switch-combo",cls:"filter-add-item right-item-radius",items:this._getItemsByType(),value:[{value:this._getDefaultValue()}],listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue()[0].value;t.addButton.setValue(e),t.addButton.setText(t._getShowText(e)),t.fireEvent("EVENT_CHANGE",e)}}]},width:16}]}},_getShowText:function(e){switch(e){case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR:return BI.i18nText("BI-Basic_Add_Or_Condition");case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND:return BI.i18nText("BI-Basic_Add_And_Formula");case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR:return BI.i18nText("BI-Basic_Add_Or_Formula");default:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND;return BI.i18nText("BI-Basic_Add_And_Condition")}},_getDefaultValue:function(){return this.options.addType===BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND?BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND},_getItemsByType:function(){return this.options.addType===BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND?[[{text:BI.i18nText("BI-Basic_And_Condition"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND,$testId:"bi-filter-operation-switch-combo-item-condition-and"},{text:BI.i18nText("BI-Basic_Or_Condition"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR,$testId:"bi-filter-operation-switch-combo-item-condition-or"}]]:[[{text:BI.i18nText("BI-Basic_And_Formula"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND,$testId:"bi-filter-operation-switch-combo-item-formula-and"},{text:BI.i18nText("BI-Basic_Or_Formula"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR,$testId:"bi-filter-operation-switch-combo-item-formula-or"}]]}}),BI.shortcut("bi.filter_operation_switch",BI.FilterOperationSwitch)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-filter-pane",expander:{},items:[],itemsCreator:BI.emptyFn},render:function(){var t=this,e=this.options;return{type:"bi.custom_tree",cls:BI.isNotEmptyArray(e.items)?"bi-border-right bi-border-top":"",expander:BI.extend({type:"bi.filter_expander",el:{},popup:{type:"bi.custom_tree"}},e.expander),el:{type:"bi.filter_list",cls:"filter-list-pane",chooseType:BI.ButtonGroup.CHOOSE_TYPE_DEFAULT,layouts:[{type:"bi.vertical",scrolly:!1}]},items:e.items,listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(){t.fireEvent("EVENT_CHANGE",arguments)}}],ref:function(e){t.tree=e}}},populate:function(e){BI.isNotEmptyArray(e)?this.element.addClass("bi-border-right bi-border-top"):this.element.removeClass("bi-border-right bi-border-top"),this.tree.populate.apply(this.tree,arguments)},getValue:function(){return this.tree.getValue()}}),BI.shortcut("bi.filter_pane",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-form",items:[],rules:{},stop:!1,layouts:[{type:"bi.vertical"}]},_init:function(){i.superclass._init.apply(this,arguments),this.populate(this.options.items)},_createItems:function(e){var n=this.options.rules;return BI.createWidgets(BI.map(e,function(e,t){return BI.extend({type:"bi.form.item"},t,{rules:BI.extend({},n,t.rules)})}))},_itemsCreator:function(e){var n=this,e=this._createItems(e);return BI.each(e,function(e,t){t.on(BI.Events.DESTROY,function(){BI.remove(n.formItems,t)})}),e},_packageItemLayout:function(e){for(var n=this.options,i=n.layouts.length-1;0<i;i--)e=BI.map(e,function(e,t){return BI.extend({},n.layouts[i],{items:[BI.extend({},n.layouts[i].el,{el:t})]})});return e},_packageSimpleItems:function(n){var e=this.options;return BI.map(e.items,function(e,t){return BI.stripEL(t)===t?n[e]:BI.extend({},t,{el:n[e]})})},_packageItems:function(e,t){return BI.createItems(BI.makeArrayByArray(e,{}),BI.clone(t))},_packageLayout:function(e){for(var t=this.options,t=BI.deepClone(t.layouts[0]),n=BI.formatEL(t).el;n&&n.items&&!BI.isEmpty(n.items);)n=BI.formatEL(n.items[0]).el;return n.items=e,t},_isSimpleLayout:function(){var e=this.options;return 1===e.layouts.length&&!BI.isArray(e.items[0])},submit:function(e){var n,i=this.options.stop,r=!0;return BI.each(this.formItems,function(e,t){if(!r&&i)return!0;t.isEnabled()&&BI.isFunction(t.getValidations)&&((n=t.getValidations())&&!n.approved?(t.showError&&t.showError(n.errors[0]),r=!1):t.hideError&&t.hideError())}),r&&BI.isFunction(e)&&e(this.getValue()),r},validate:function(){var n=!0,i=this.options.stop;return BI.each(this.formItems,function(e,t){if(!n&&i)return!0;t.isEnabled()&&BI.isFunction(t.validate)&&!t.validate()&&(n=!1)}),n},getValidations:function(){var n=[];return BI.each(this.formItems,function(e,t){t.isEnabled()&&BI.isFunction(t.getValidations)&&n.push(t.getValidations())}),n},setValue:function(e,t){t=this.getNodeByName(t);t&&t.setValue(e)},getValue:function(){var n=[];return BI.each(this.formItems,function(e,t){t.isEnabled()&&n.push(t.getValue())}),n},getFormValue:function(){var n={};return BI.each(this.formItems,function(e,t){t.options.name&&(n[t.options.name]=t.getValue())}),n},populate:function(e){e=e||[],this.empty(),this.options.items=e,this.formItems=this._itemsCreator.apply(this,arguments),e=this._isSimpleLayout()?this._packageSimpleItems(this.formItems):this._packageItems(e,this._packageItemLayout(this.formItems)),this.layouts=BI.createWidget(BI.extend({element:this},this._packageLayout(e)))},setEnabledItems:function(n){n=BI.isArray(n)?n:[n],BI.each(this.formItems,function(e,t){BI.contains(n,t.options.name)?t.setEnable(!0):t.setEnable(!1)})},getAllItems:function(){return this.formItems},getIndexByName:function(n){var i=-1;return BI.some(this.formItems,function(e,t){if(t.isEnabled()&&t.options.name===n)return i=e,!0}),i},getNodeByName:function(n){var i;return BI.some(this.formItems,function(e,t){if(t.isEnabled()&&t.options.name===n)return i=t,!0}),i},empty:function(){i.superclass.empty.apply(this,arguments),this.options.items=[]},destroy:function(){i.superclass.destroy.apply(this,arguments),this.options.items=[]}}),BI.shortcut("bi.form",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-form-error-item",errorText:"",stop:!0,rules:{}},render:function(){var e=this.options;return this._formItem=BI.createWidget(e.el),e.label?{type:"bi.vertical_adapt",items:[{el:BI.isKey(e.label)?{type:"bi.label",textAlign:"left",textHeight:24,text:e.label,title:e.label,rgap:10}:e.label},{el:this._formItem}]}:{type:"bi.vertical_adapt",items:[{el:this._formItem}]}},getValue:function(){return this._formItem.getValue()},validate:function(){var e=this.options,e=BI.validator.validate(this.getValue(),e.rules,e.stop);return BI.isNull(e)||e.approved},getValidations:function(){var e=this.options;return BI.validator.validate(this.getValue(),e.rules,e.stop)},showError:function(e){e&&BI.Bubbles.show(this.getName(),e,this._formItem)},hideError:function(){BI.Bubbles.hide(this.getName())}}),BI.shortcut("bi.form.error.item",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-form-item",stop:!0,rules:{}},render:function(){var e=this.options;if(e.label)return this.item=BI.createWidget({rules:e.rules,stop:e.stop},e.el),{type:"bi.vertical_adapt",items:[{el:BI.isKey(e.label)?{type:"bi.label",textAlign:"left",textHeight:24,text:e.label,title:e.label,rgap:10}:e.label},{el:this.item}]};this.item=BI.createWidget({rules:e.rules,stop:e.stop,element:this},e.el)},getValue:function(){return this.item.getValue()},validate:function(){return BI.isFunction(this.item.validate)?this.item.validate():this._validate()},getValidations:function(){var e=this.options;return BI.isFunction(this.item.getValidations)?this.item.getValidations():BI.validator.validate(this.getValue(),e.rules,e.stop)},showError:function(e){BI.isFunction(this.item.showError)&&this.item.showError(e)},hideError:function(){BI.isFunction(this.item.hideError)&&this.item.hideError()},_validate:function(){var e=this.options,e=BI.validator.validate(this.getValue(),e.rules,e.stop);return BI.isNull(e)||e.approved}}),BI.shortcut("bi.form.item",i)},function(e,t,n){"use strict";BI.Func=BI.Func||{},BI.extend(BI.Func,{paintWaterMark:function(e,t){for(var t=BI.extend({text:"watermark",fontSize:16,fontFamily:"Microsoft YaHei, PingFangSC-Light, SimHei, SimSun, FangSong, KaiTi, Arial, Tahoma, Verdana, Times New Roman",color:"#999999",opacity:.15,angle:20,fontWeight:"bold",horizontalGap:200,verticalGap:100},t),n=t.angle*Math.PI/180,i=BI.Func.createEmptyCanvas(),r=e.height,o=e.width,a=(t.text+"").split("\n"),s=o*Math.cos(n)+r*Math.sin(n),o=o*Math.sin(n)+r/Math.cos(n),l=(i.width=s,i.height=o,i.getContext("2d")),c=(l.rotate(-n),l.font=t.fontWeight+" "+t.fontSize+"px "+t.fontFamily,l.fillStyle=t.color,l.globalAlpha=t.opacity,l.textAlign="center",0),u=0;u<a.length;u++)c=Math.max(c,l.measureText(a[u]).width);for(var h=c+t.horizontalGap,d=BI.DOM.getTextSizeHeight(t.text,t.fontSize),p=d*a.length+t.verticalGap,f=BI.parseInt(s/h),m=BI.parseInt(o/p),g=e.height*Math.tan(n),y=0;y<m+1;y++)for(var b=0;b<f+3;b++)for(var v=b*h-g+(y%2==0?-h/2:0),x=0;x<a.length;x++)l.fillText(a[x],v,y*p+d*x);r=e.getContext("2d");r.fillStyle=r.createPattern(i,"no-repeat"),r.fillRect(0,0,i.width,i.height)},createEmptyCanvas:function(){var e=document.createElement("canvas");return e=document.createElement("canvas").getContext?e:window.G_vmlCanvasManager.initElement(e)}})},function(e,t,n){"use strict";BI.WarningLabel=BI.inherit(BI.Single,{props:{baseCls:"bi-warning-label",textAlign:"center",whiteSpace:"nowrap",forceCenter:!1,textWidth:null,textHeight:null,hgap:0,vgap:0,lgap:0,rgap:0,tgap:0,bgap:0,text:""},render:function(){var e=this,t=this.options;return{type:"bi.label",ref:function(){e.label=this},textAlign:t.textAlign,whiteSpace:t.whiteSpace,forceCenter:t.forceCenter,textWidth:t.textWidth,textHeight:t.textHeight,hgap:t.hgap,vgap:t.vgap,lgap:t.lgap,rgap:t.rgap,tgap:t.tgap,bgap:t.bgap}},mounted:function(){var e=this.options;BI.isKey(e.text)&&this.setText(e.text)},_digest:function(e){return(e=BI.htmlEncode(e||"")).replaceAll("\\$\\{(.*?)\\}",function(e,t){return"<span class='warning-label'>"+t+"</span>"})},setText:function(e){this.options.text=e,this.label.text.text.element.html(this._digest(e))},getText:function(){return this.options.text},setValue:function(e){this.label.setValue(e)}}),BI.shortcut("bi.warning_label",BI.WarningLabel)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.BasicButton,{props:{baseCls:"bi-line-segment-button bi-list-item-effect",once:!0,readonly:!0,hgap:10,height:25,lineHeight:3},render:function(){var t=this,e=this.options;this.text=BI.createWidget({type:"bi.label",element:this,text:e.text,height:e.height,value:e.value,hgap:e.hgap}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.layout",cls:"line-segment-button-line",height:e.lineHeight,ref:function(e){t.line=e}},left:0,right:0,bottom:0}]})},setSelected:function(e){i.superclass.setSelected.apply(this,arguments),e?this.line.element.addClass("bi-high-light-background"):this.line.element.removeClass("bi-high-light-background")},setText:function(e){i.superclass.setText.apply(this,arguments),this.text.setText(e)}}),BI.shortcut("bi.line_segment_button",i)},function(e,t,n){"use strict";BI.VirtaulTreeListItem=BI.inherit(BI.Widget,{props:{layer:0,id:"",pId:"",height:24},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{el:{type:"bi.layout"},width:15*e.layer},{type:"bi.text_item",logic:{dynamic:!0},id:e.id,pId:e.pId,height:e.height,hgap:e.hgap,text:e.text,value:e.value,py:e.py,keyword:e.keyword,listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__")}}],ref:function(e){t.item=e}}]}},doHighLight:function(){this.item.doHighLight.apply(this.item,arguments)},unHighLight:function(){this.item.unHighLight.apply(this.item,arguments)},getId:function(){return this.options.id},getPId:function(){return this.options.pId},doClick:function(){BI.VirtaulTreeListItem.superclass.doClick.apply(this,arguments),this.item.setSelected(this.isSelected())},setSelected:function(e){BI.VirtaulTreeListItem.superclass.setSelected.apply(this,arguments),this.item.setSelected(e)}}),BI.shortcut("bi.virtual_tree_list_item",BI.VirtaulTreeListItem)},function(e,t,n){"use strict";BI.GridList=BI.inherit(BI.Widget,{props:{baseCls:"bi-grid-list",items:[],itemHeight:30,showLoader:!1,itemsCreator:BI.emptyFn,onLoaded:BI.emptyFn,hasNext:BI.emptyFn,count:!1,overscanRowCount:0,overflowX:!0,overflowY:!0},mounted:function(){var n=this;this._resizeHandler=BI.debounce(function(){var e=n._getListWidth(),t=n._getListHeight();n.list.getWidth()===e&&n.list.getHeight()===t||n._populate()},30),this.removeListener=BI.ResizeDetector.addResizeListener(this.wrapper,function(){n._resizeHandler()}),BI.isNotEmptyArray(this.options.items)&&this._populate()},render:function(){var t=this,e=this.options;return this.times=1,this.count=0,this.loaderStatus="loaded",{type:"bi.absolute",items:[{el:{type:"bi.grid_view",overflowX:e.overflowX,overflowY:e.overflowY,estimatedRowSize:e.itemHeight,estimatedColumnSize:this._getListWidth(),overscanRowCount:e.overscanRowCount,itemFormatter:e.itemFormatter,rowHeightGetter:function(){return e.itemHeight},columnWidthGetter:function(){return t.listWidth-BI.DOM.getScrollWidth()},ref:function(e){t.list=e},listeners:[{eventName:BI.GridView.EVENT_SCROLL,action:function(e){t.fireEvent("EVENT_SCROLL",e.scrollTop)}}]},top:0,right:0,bottom:0,left:0}],ref:function(e){t.wrapper=e}}},_getListWidth:function(){return this.element.width()},_getListHeight:function(){return this.element.height()},_populate:function(){var e=this.options,t=this,n=(this.listWidth=this._getListWidth(),this.list.setEstimatedColumnSize(this.listWidth-BI.DOM.getScrollWidth()),this.list.setWidth(this.listWidth),this.list.setHeight(this._getListHeight()),BI.map(this.options.items,function(e,t){return[t]}));e.showLoader&&(this._hasNext()||"end"===this.loaderStatus)&&n.push([{type:"bi.loading_bar",ref:function(){"end"===t.loaderStatus?this.setEnd():this.setLoaded()},listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(e){e===BI.Events.CLICK&&(this.setLoading(),t._nextLoad())}}]}]),this.list.populate(n)},_nextLoad:function(){var e=this;this.options.itemsCreator.apply(this,[{times:++this.times},function(){e._addItems.apply(e,arguments)}])},_addItems:function(e){var t=this.options;this.count+=e.length,t.items=BI.concat(t.items,e),this._hasNext()?this.setLoaded():this.setEnd(),this._populate()},_hasNext:function(){var e=this.options;return BI.isNumber(e.count)?this.count<e.count:!!e.hasNext.apply(this,[{times:this.times,count:this.count}])},populate:function(e){var t=this.options,n=this;0===arguments.length&&BI.isFunction(t.itemsCreator)?t.itemsCreator.apply(this,[{times:1},function(){if(0===arguments.length)throw new Error("参数不能为空");n.populate.apply(n,arguments),t.onLoaded()}]):(e&&e!==t.items&&(t.items=e),this.times=1,this.count=e.length,this.loaderStatus="loaded",this._populate())},setScrollTop:function(e){this.list.setScrollTop(e)},setLoaded:function(){this.loaderStatus="loaded"},setEnd:function(){this.loaderStatus="end"},setLoading:function(){this.loaderStatus="loading"},destroyed:function(){this.removeListener&&this.removeListener()}}),BI.GridList.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.grid_list",BI.GridList)},function(e,t,n){"use strict";function o(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function a(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var t,n;t=i,n=r[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}BI.VirtualTreeList=BI.inherit(BI.Widget,{props:{baseCls:"bi-virtual-tree-list",itemsCreator:BI.emptyFn,items:[],el:{type:"bi.virtual_group_list",rowHeight:32}},render:function(){var t=this,e=this.options;return BI.extend({items:this._getNodes(),ref:function(e){t.treeList=e},overscanHeight:200,blockSize:20},e.el)},_initTree:function(e){BI.isNull(this.tree)&&(this.tree=new BI.Tree);e=BI.Tree.transformToTreeFormat(e);this.tree.initTree(e)},_fillTree:function(e,t){var i=this,n=this.tree.getRoot(),r=this.tree.search(n,e)||n;BI.each(t,function(e,t){var n=new BI.Node(t);n.set("data",a({checked:r.data.checked},t)),i.tree.addNode(r,n)}),this._populate()},_cutTree:function(e){var t=this.tree.getRoot(),t=this.tree.search(t,e);BI.isNotNull(t)&&(t.open=!1),this._populate()},_getNodes:function(){var t=[];return this.tree||this._initTree(this.options.items),this.tree.recursion(function(e){if(t.push(BI.extend({id:e.id,pId:e.pId,key:e.key||e.id},e.get("data"),{open:e.open})),!0!==e.open)return!0}),this._wrapperEvent(t)},_triggerNode:function(e){var t=this,n=this.tree.search(this.tree.getRoot(),e)||this.tree.getRoot();!0===n.open?this._cutTree(e):BI.isNull(n.open)&&0===n.getChildrenLength()&&n.isParent?this.options.itemsCreator({node:n},function(e){n.open=!0,t._fillTree(n.id,e)}):(n.open=!0,this._populate())},_triggerNodeChecked:function(e,t){e=this.tree.search(this.tree.getRoot(),e);if(e){e.data.checked=t,e.data.half=!1;for(var n=e.getChildren().slice();n.length;){var i=n.shift();t===i.data.checked&&!i.data.half||(i.data.checked=t,i.data.half=!1,n=n.concat(i.getChildren()))}if(t)for(var r=e.getParent();r!==this.tree.getRoot();)BI.some(r.getChildren(),function(e,t){if(!t.data.checked||t.data.half)return!0})?(r.data.checked=!1,r.data.half=!0):(r.data.checked=!0,r.data.half=!1),r=r.getParent();else for(var o=e.getParent();o!==this.tree.getRoot();)BI.some(o.getChildren(),function(e,t){if(t.data.checked||t.data.half)return!0})?(o.data.checked=!1,o.data.half=!0):(o.data.checked=!1,o.data.half=!1),o=o.getParent()}this._populate()},_populate:function(){this.treeList.populate(this._getNodes())},_wrapperEvent:function(e){var i=this;return BI.map(e,function(e,n){return n.listeners=n.listeners||[],BI.find(n.listeners,function(e,t){return"__EVENT_CHANGE__"===t.eventName})||n.listeners.push({eventName:"__EVENT_CHANGE__",action:function(e,t){e!==BI.Events.COLLAPSE&&e!==BI.Events.EXPAND||(i._triggerNode(n.id),i.fireEvent(BI.VirtualTreeList.EVENT_NODE_CHANGE,i.tree.search(i.tree.getRoot(),n.id)||i.tree.getRoot())),e===BI.Events.CHANGE&&i._triggerNodeChecked(n.id,t)}}),n})},move:function(e,t){if(null!=e&&null!=t&&e!==t){var n=this.tree.search(this.tree.getRoot(),e),i=this.tree.search(this.tree.getRoot(),t);if(n.getParent()!==i.getParent())return!1;i=n.getParent(),e=i.getChildIndex(e),t=i.getChildIndex(t);e<t?(i.addChild(n,t+1),i.removeChildByIndex(e)):(i.addChild(n,t),i.removeChildByIndex(e+1)),this._populate()}},getTree:function(){return this.tree},setOpened:function(e,t){var n=this;t?(function i(e){e=n.tree.search(n.tree.getRoot(),e);e&&!1===e.open&&(e.open=!0,i(e.pId))}(e),this._populate()):this._cutTree(e)},scrollToViewPosition:function(t){var n,e,i;BI.isKey(this.options.el.rowHeight)&&(n=0,this.tree.recursion(function(e){if(e.id===t)return!1;!1!==BI.get(e,["parent","open"])&&n++}),e=this.element.scrollTop(),(i=(n+1)*this.options.el.rowHeight)<e||i>e+this.element.height())&&(i=BI.max([0,(n+1)*this.options.el.rowHeight-this.element.height()]),this.element.scrollTop(i))},getValue:function(){var t=[];return this.tree.recursion(function(e){e=e.get("data");e.checked&&t.push(BI.isNull(e.value)?e.id:e.value)}),t},populate:function(e){this.options.items=e,this._initTree(this.options.items),this._populate()}}),BI.VirtualTreeList.EVENT_CHANGE="EVENT_CHANGE",BI.VirtualTreeList.EVENT_NODE_CHANGE="EVENT_NODE_CHANGE",BI.shortcut("bi.virtual_tree_list",BI.VirtualTreeList)},function(e,t,n){"use strict";BI.VirtualTreeListNode=BI.inherit(BI.NodeButton,{props:{baseCls:"bi-virtual-tree-list-node",id:"",height:24,layer:0,expandIcon:"expander-down-font",narrowIcon:"expander-right-font"},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{el:{type:"bi.layout"},width:15*e.layer},{el:{type:"bi.arrow_group_node_checkbox",cls:e.open?e.expandIcon:e.narrowIcon,ref:function(e){t.arrow=e}},width:16},{type:"bi.label",textAlign:"left",whiteSpace:"nowrap",textHeight:e.height,height:e.height,text:e.text,value:e.value,py:e.py,keyword:e.keyword,ref:function(e){t.text=e}}]}},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},doClick:function(){this.isSelected()?this.triggerExpand():this.triggerCollapse()},setOpened:function(e){BI.VirtualTreeListNode.superclass.setOpened.apply(this,arguments),this.arrow.setSelected(e)},shouldUpdate:function(n){var i=this.options;return BI.some(["open","layer","pId","value","keyword"],function(e,t){return n[t]!==i[t]})},update:function(e){var t=this.options;e.value!==t.value&&(t.value=e.value,this.text.setText(e.value)),e.open!==t.open&&(t.open=e.open,this.arrow.setSelected(e.open)),e.keyword?e.keyword!==t.keyword&&(t.keyword=e.keyword,this.text.doRedMark(e.keyword)):(t.keyword="",this.text.unRedMark(e.value))}}),BI.shortcut("bi.virtual_tree_list_node",BI.VirtualTreeListNode)},function(e,t,n){"use strict";BI.LoadingPane=BI.Pane},function(e,t,n){"use strict";BI.ResizeContainerHtape=BI.inherit(BI.Widget,{props:{baseCls:"bi-resize-container-htape",minSize:260,maxSize:390,initLeftSize:null,left:{type:"bi.default"},right:{type:"bi.default"}},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{type:"bi.resizable_container",minSize:e.minSize,maxSize:e.maxSize,content:e.left,resize:BI.bind(this._resizeContainer,this),width:e.initLeftSize||e.minSize},{el:e.right}],ref:function(e){t.contianer=e}}},_resizeContainer:function(e){this.contianer.attr("items")[0].width=e,this.contianer.resize(),this.fireEvent("EVENT_RESIZE",e)}}),BI.ResizeContainerHtape.EVENT_RESIZE="EVENT_RESIZE",BI.shortcut("bi.resize_container.htape",BI.ResizeContainerHtape)},function(e,t,n){"use strict";BI.ResizableContainer=BI.inherit(BI.Widget,{props:{baseCls:"bi-resizable-container",content:{},direction:"e",minSize:15,maxSize:Number.MAX_VALUE,resizable:!0,start:BI.emptyFn,resize:BI.emptyFn,stop:BI.emptyFn,startDragging:BI.emptyFn,broadCastResize:!0},render:function(){var n=this,i=this.options,r=!1,o=0,a=0;function s(e){return BI.clamp(e,i.minSize,i.maxSize||Number.MAX_VALUE)}this.defaultSize=i.height||null,this.handler=BI.createWidget(BI.extend(this._createHandle(),{invisible:!i.resizable})),this.handler.element.on("click",function(e){e.stopPropagation()}),this._stared=!1;var l=new BI.MouseMoveTracker(function(e,t){l.isDragging()&&(n._stared||(n._stared=!0,i.startDragging()),BI.$(document.body).css("cursor",n._isHorizontalResize()?"ew-resize":"ns-resize"),r=!0,"w"===BI.get(i.direction,0)&&(e=-e),a+=e,"n"===BI.get(i.direction,0)&&(t=-t),a+=t,o=s((n.defaultSize||n._getDefaultSize())+a),n.handler.element.addClass("dragging"),i.resize(o),i.broadCastResize)&&BI.$(window).trigger("resize")},function(){!0===r&&(o=s(o),i.stop(o),n.defaultSize=o,a=o=0,r=!1,n._stared=!1,BI.$(document.body).css("cursor","auto")),n.handler.element.removeClass("dragging"),n.handler.element.removeClass("suitable"),l.releaseMouseMoves()},document);return this.handler.element.on("mousedown",function(e){l.captureMouseMoves(e)}),{type:"bi.absolute",items:[{el:i.content,left:0,right:0,top:0,bottom:0},BI.extend({el:this.handler},this._getHandlePosition())]}},_isHorizontalResize:function(){return"w"===BI.get(this.options.direction,0)||"e"===BI.get(this.options.direction,0)},_createHandle:function(){return this._isHorizontalResize()?{type:"bi.icon_label",cls:"horizontal-drag-font resize-handle-ew",width:5}:{type:"bi.icon_label",cls:"vertical-drag-font resize-handle-ns",height:5}},_getHandlePosition:function(){switch(this.options.direction){case"e":return{right:-2,top:0,bottom:0};case"ew":return{right:8,top:0,bottom:0};case"w":return{left:-2,top:0,bottom:0};case"we":return{left:8,top:0,bottom:0};case"s":return{left:0,right:0,bottom:-3};case"sn":return{left:0,right:0,bottom:2};case"n":return{top:-3,left:0,right:0};case"ns":return{top:2,left:0,right:0}}},_getDefaultSize:function(){var e=this.options;return this._isHorizontalResize()?e.width||e.minSize:e.height||e.minSize},setMinSize:function(e){this.options.minSize=e},setMaxSize:function(e){this.options.maxSize=e},setResizable:function(e){this.options.resizable=e,this.handler.setVisible(e),BI.$(window).trigger("resize")},reset:function(){this.defaultSize=null}}),BI.shortcut("bi.resizable_container",BI.ResizableContainer)},function(e,t,n){"use strict";BI.ResizeContainerVtape=BI.inherit(BI.Widget,{props:{baseCls:"bi-resize-container-vtape",minSize:100,maxSize:200,initTopSize:null,top:{type:"bi.default"},bottom:{type:"bi.default"}},render:function(){var t=this,e=this.options;return{type:"bi.vtape",items:[{type:"bi.resizable_container",direction:"s",minSize:e.minSize,maxSize:e.maxSize,content:e.top,resize:BI.bind(this._resizeContainer,this),height:e.initTopSize||e.minSize},{el:e.bottom}],ref:function(e){t.contianer=e}}},_resizeContainer:function(e){this.contianer.attr("items")[0].height=e,this.contianer.resize(),this.fireEvent("EVENT_RESIZE",e)}}),BI.ResizeContainerVtape.EVENT_RESIZE="EVENT_RESIZE",BI.shortcut("bi.resize_container.vtape",BI.ResizeContainerVtape)},function(e,t,n){"use strict";BI.ScrollbarContainer=BI.inherit(BI.Widget,{props:{baseCls:"bi-scrollbar-container",el:{}},render:function(){var n=this;return[this.options.el,{type:"bi.absolute",items:[{el:{type:"bi.grid_table_scrollbar",ref:function(e){n.scrollbar=e},listeners:[{eventName:BI.GridTableScrollbar.EVENT_SCROLL,action:function(e){try{n.element.scrollTop(e)}catch(t){}}}]},top:0,bottom:0,right:0}]}]},_handleResize:function(){var e=this.element.scrollTop(),t=this.element[0].scrollHeight,n=this.element.height();this.scrollbar.setContentSize(t),this.scrollbar.setSize(n),this.scrollbar.setPosition(e),this.scrollbar.populate()},mounted:function(){var t=this;this.element.scroll(function(){t.scrollbar.setVisible(!0);var e=t.element.scrollTop();t.scrollbar.setPosition(e),t.scrollbar.populate()}),this.resizeObserver=BI.ResizeDetector.addResizeListener(this,this._handleResize.bind(this)),window.MutationObserver&&(this.mutationObserver=new window.MutationObserver(this._handleResize.bind(this)),this.mutationObserver.observe(this.element[0],{attributes:!0,childList:!0,subtree:!0})),this.popper=BI.Popper.createPopper(this.element[0],this.scrollbar.element[0],{placement:"right-start",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,0]}}]}),this._handleResize()},destroyed:function(){this.resizeObserver(),this.mutationObserver&&this.mutationObserver.disconnect(),this.popper.destroy()}}),BI.shortcut("bi.scrollbar_container",BI.ScrollbarContainer),BI.config("bi.scrollbar_container",function(e){return BI.isIE()?BI.extend({},e,{type:"bi.el"}):e})},function(e,t,n){"use strict";var i;(i=BI.inherit(BI.BasicButton,{props:{extraCls:"bi-select-color-item bi-border",value:[],colors:[],once:!0,height:50,width:130},mounted:function(){var n=this.options;BI.each(this.layouts,function(e,t){t.element.css("background-color",n.value[e])})},render:function(){var t=this,e=this.options;return this.layouts=[],{type:"bi.absolute",items:[{el:{type:"bi.button_group",items:BI.map(e.colors,function(){return{type:"bi.layout",ref:function(e){t.layouts.push(e)}}}),layouts:[{type:"bi.center",hgap:.5,vgap:2}]},left:1,right:2,top:0,bottom:0}]}}})).EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_item",i)},function(e,t,n){"use strict";var o;(o=BI.inherit(BI.Widget,{props:{baseCls:"bi-select-color-popup",height:160,items:[]},render:function(){var n=this,i=this.options,r=[];return BI.each(i.colors,function(e,t){r.push({type:"bi.select_color_item_wrapper",selected:BI.isEqual(i.value,t.colors),header:t.value,colors:t.colors.slice(0,5),value:t.colors})}),{type:"bi.absolute",items:[{el:{type:"bi.button_group",items:r,layouts:[{type:"bi.vertical",hgap:5}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e,t){n.popup.setValue(e),t.setSelected&&t.setSelected(!0),n.fireEvent(o.EVENT_CHANGE,e)}}],ref:function(e){n.popup=e}},top:5,right:0,bottom:5,left:0}]}},getValue:function(){return this.popup.getValue()}})).EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_popup",o)},function(e,t,n){"use strict";BI.SelectColorCombo=BI.inherit(BI.Widget,{props:{baseCls:"bi-select-color-combo",width:130,items:[],colors:[],value:[]},_store:function(){return BI.Models.getModel("bi.model.select.color.combo",{value:this.options.value})},watch:{selectedColor:function(e){e=BI.isArray(e)?e:[e],this.combo.setValue(e)}},render:function(){var n=this,t=this.options;return{type:"bi.combo",value:this.model.selectedColor,adjustLength:5,el:{type:"bi.select_color_trigger",title:function(){var e=BI.find(t.colors,function(e,t){if(BI.isEqual(t.colors,n.model.selectedColor))return!0});return e&&e.text},value:this.model.selectedColor},popup:{el:{type:"bi.select_color_popup",value:this.model.selectedColor,colors:t.colors,listeners:[{eventName:"EVENT_CHANGE",action:function(e){n.store.setSelectedColor(e),n.combo.hideView(),n.fireEvent(BI.SelectColorCombo.EVENT_CHANGE)}}],ref:function(e){n.popup=e}},stopPropagation:!1,minWidth:152},ref:function(e){n.combo=e},listeners:[{eventName:BI.Combo.EVENT_AFTER_INIT,action:function(){n.popup.setValue(n.model.selectedColor)}}]}}}),BI.SelectColorCombo.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_combo",BI.SelectColorCombo)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{state:function(){return{selectedColor:this.options.value}},actions:{setSelectedColor:function(e){this.model.selectedColor=e}}}),BI.model("bi.model.select.color.combo",i)},function(e,t,n){"use strict";var i;(i=BI.inherit(BI.Trigger,{props:{extraCls:" bi-select-color-trigger bi-border",height:28,value:[]},mounted:function(){var n=this.options;BI.each(this.layouts,function(e,t){t.element.css("background-color",n.value[e])})},render:function(){var t=this,e=this.options;return this.layouts=[],{type:"bi.absolute",items:[{el:{type:"bi.button_group",items:BI.map(e.value.slice(0,5),function(){return{type:"bi.layout",ref:function(e){t.layouts.push(e)}}}),layouts:[{type:"bi.center",hgap:.5,vgap:2}],ref:function(e){t.colorContainer=e}},left:1,right:2,top:0,bottom:0},{el:{type:"bi.icon_button",disableSelected:!0,cls:"icon-combo-down-icon trigger-triangle-font",width:15,height:10,ref:function(e){t.down=e}},right:4,bottom:5}]}},populate:function(e){this.options.items=e},setValue:function(n){this.value=n,BI.each(this.layouts,function(e,t){t.element.css("background-color",n[e])})},getValue:function(){return this.value}})).EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_trigger",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.BasicButton,{props:{extraCls:"bi-select-color-item-wrapper",header:"",value:[],colors:[],height:50,width:130},render:function(){var t=this,e=this.options;return{type:"bi.vtape",hgap:2,items:[{type:"bi.label",textAlign:"left",text:e.header,lgap:3},{el:{type:"bi.select_color_item",value:e.value,colors:e.colors,ref:function(e){t.item=e},listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,this.getValue())}}]},height:28}]}},setSelected:function(e){this.item.setSelected(e)},isSelected:function(){return this.item.isSelected()}}),BI.shortcut("bi.select_color_item_wrapper",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-steps-item",text:"",stepWidth:88,stepHeight:50,showLine:!0},render:function(){var t=this,e=this.options;return this.constant=BI.Constants.getConstant("bi.constants.steps.status"),this.status=this.constant.NEXT,{type:"bi.htape",height:e.stepHeight,items:[{el:{type:"bi.vertical_adapt",items:[{type:"bi.layout",cls:"step-line",height:2,width:"100%",invisible:!e.showLine}]},rgap:8},{el:{type:"bi.right_vertical_adapt",items:[{type:"bi.icon_change_button",iconCls:"step-next",iconWidth:14,iconHeight:14,ref:function(e){t.icon=e},rgap:8},{type:"bi.label",cls:"step-text",textAlign:"left",whiteSpace:"nowrap",rgap:5,text:e.text}]},width:e.stepWidth}]}},setStatus:function(e){if(e!==this.status)switch(this.status=e){case this.constant.CURR:this.icon.setIcon("step-now"),this.element.addClass("active");break;case this.constant.PREV:this.icon.setIcon("step-prev"),this.element.addClass("active");break;default:this.constant.NEXT;this.icon.setIcon("step-next"),this.element.removeClass("active")}}}),BI.shortcut("bi.steps.item",i)},function(e,t,n){"use strict";BI.constant("bi.constants.steps.status",{PREV:0,CURR:1,NEXT:2})},function(e,t,n){"use strict";BI.Steps=BI.inherit(BI.Widget,{props:{baseCls:"bi-steps",stepItems:[],stepHeight:50,stepWidth:88},render:function(){var n=this,e=this.options,t=(this.steps=[],this.currStep=0,this.constant=BI.Constants.getConstant("bi.constants.steps.status"),this.steps.push(BI.createWidget(this._createStep(e.stepItems[0],!1))),BI.createWidget({type:"bi.grid",rows:1,width:"100%",columns:e.stepItems.length-1,items:BI.map(e.stepItems.slice(1),function(e,t){return{row:0,column:e,el:BI.extend(n._createStep(t,!0),{ref:function(e){n.steps.push(e)}})}})}));return{type:"bi.htape",items:[{el:this.steps[0],width:e.stepWidth},{el:t}],height:e.stepHeight}},_createStep:function(e,t){var n=this.options;return BI.extend(e,{type:"bi.steps.item",stepHeight:n.stepHeight,stepWidth:n.stepWidth,showLine:t})},mounted:function(){this.steps[0]&&this.steps[0].setStatus(this.constant.CURR)},setValue:function(t){var n=this;this.currStep=t,BI.each(this.options.stepItems,function(e){e<t?n.steps[e].setStatus(n.constant.PREV):e===t?n.steps[e].setStatus(n.constant.CURR):n.steps[e].setStatus(n.constant.NEXT)})},getValue:function(){return this.currStep}}),BI.shortcut("bi.steps",BI.Steps)},function(e,t,n){"use strict";BI.constant("bi.constant.char.widths",{32:.274,33:.284,34:.393,35:.592,36:.54,37:.819,38:.801,39:.23,40:.303,41:.303,42:.418,43:.684,44:.218,45:.4,46:.218,47:.391,48:.54,49:.54,50:.54,51:.54,52:.54,53:.54,54:.54,55:.54,56:.54,57:.54,58:.218,59:.218,60:.684,61:.684,62:.684,63:.449,64:.955,65:.646,66:.574,67:.62,68:.703,69:.507,70:.488,71:.687,72:.71,73:.267,74:.358,75:.58,76:.471,77:.899,78:.749,79:.754,80:.561,81:.754,82:.599,83:.532,84:.524,85:.688,86:.622,87:.934,88:.591,89:.553,90:.571,91:.303,92:.379,93:.303,94:.684,95:.416,96:.269,97:.509,98:.588,99:.463,100:.59,101:.524,102:.313,103:.59,104:.567,105:.243,106:.243,107:.498,108:.243,109:.862,110:.567,111:.587,112:.588,113:.59,114:.348,115:.425,116:.34,117:.567,118:.479,119:.723,120:.459,121:.484,122:.453,123:.303,124:.24,125:.303,126:.684})},function(e,t,n){"use strict";var i;(i=BI.inherit(BI.Widget,{props:function(){return{baseCls:"bi-dynamic-collection-view",overscanHeight:100,blockSize:10,scrollTop:0,scrollLeft:0,columnSize:[],isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,stopScrollEvent:!1,items:[],el:{},trRenderer:null}},created:function(){var e=this;this.renderedIndex=-1,this.cache={},this.trCache={},this._debounceRelease=BI.debounce(function(){e._scrollLock=!1},1e3/60)},render:function(){var e=this,t=this.options;return BI.extend(t.el,{type:"bi.vertical",scrolly:!1,scrollable:!0,items:[{type:"bi.default",tagName:t.trRenderer?"div":"table",css:{marginLeft:t.isNeedFreeze?-1*BI.sum(t.columnSize.slice(0,t.freezeCols.length)):0},ref:function(){e.table=this},items:(t.trRenderer?[]:[{type:"bi.default",tagName:"colgroup",ref:function(){e.colGroup=this}}]).concat([{type:"bi.layout",ref:function(){e.topBlank=this}},{type:"bi.default",tagName:t.trRenderer?"div":"tbody",ref:function(){e.container=this}},{type:"bi.layout",ref:function(){e.bottomBlank=this}}])}]})},mounted:function(){var t=this,n=this.options;0<n.items.length&&this._populate(),this.element.scroll(function(e){!0!==t._scrollLock&&(n.scrollLeft=t.element.scrollLeft(),n.scrollTop=t.element.scrollTop(),n.stopScrollEvent||t._calculateBlocksToRender(),t.fireEvent(i.EVENT_SCROLL,{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}))}),BI.ResizeDetector.addResizeListener(this,function(){try{t._calculateBlocksToRender()}catch(e){}})},_renderMoreIf:function(){for(var e,t=this,n=this.options,i=this.element.height(),r=n.scrollTop+i+n.overscanHeight,o=this.cache[this.renderedIndex]&&this.cache[this.renderedIndex].index+this.cache[this.renderedIndex].size||0,a=this.renderedIndex+1,s=function s(){return t.container.element.height()+t.topBlank.element.height()+t.bottomBlank.element.height()};(e=s())<r&&o<n.items.length;){for(var l=[],c=o;c<o+n.blockSize&&c<n.items.length;c++)l.push(c);for(var u=o+n.blockSize;0<l.length;){for(var h=l[0],d=0;d<n.columnSize.length;d++)for(var p=t.itemsMap[h][d].__mergeRows,f=h+(0|(p?p.length:1)),c=h;c<f;c++)l.indexOf(c)<0&&(l.push(c),u=f);l.shift()}var m=n.items.slice(o,u),m=(this._addItems(m,o),s()-e);this.cache[a]={index:o,height:m,size:u-o},this.tree.set(a,m),this.renderedIndex=a,a++,o+=u-o}},_addItem:function(e,i){var r=this,t=this.options;return t.trRenderer?BI.createWidget(t.trRenderer(e,i,this.itemsMap[i]),{root:!0}):BI.createWidget({type:"bi.adaptive",root:!0,tagName:"tr",height:t.rowSizeGetter?t.rowSizeGetter(i):null,items:BI.map(e,function(e,t){var n;if(BI.isNotEmptyObject(r.itemsMap[i][e]))return n=r.itemsMap[i][e].__mergeRows.length,e=r.itemsMap[i][e].__mergeCols.length,{type:"bi.default",tagName:"td",attributes:{rowspan:1<n?n:undefined,colspan:1<e?e:undefined},cls:"bi-collection-table-cell",items:[BI.extend({type:"bi.label"},t)]}})})},_serialize:function(e,i,o,a){o=o||[],a=a||[];for(var s=this.options,l={},c={},u={},h={},t=[],n=0;n<i.length;n++)t[n]=0===n?i[n]:t[n-1]+i[n];var d=function d(e,t){c[t].__mergeRows.push(e)},p=function p(e,t){u[e]._width+=i[t],u[e].__mergeCols.push(t)},f=function f(e,t){var n=i[t];h[e][t]._row=e,h[e][t]._col=t,h[e][t]._width=n,c[t]=h[e][t],c[t].__mergeRows=[e],u[e]=h[e][t],u[e].__mergeCols=[t]};return BI.each(e,function(e,t){for(var n,i,r=0;r<t.length;r++)l[e]||(l[e]={}),h[e]||(h[e]={}),l[e][r]=t[r],h[e][r]={},!0===o||-1<o.indexOf(r)||!0===a||-1<a.indexOf(e)?0===e&&0===r?f(0,0):0===r&&0<e?!0===(n=s.mergeRule(l[e][r],l[e-1][r]))?(d(e,r),u[e]=c[r]):f(e,r):0===e&&0<r?!0===(i=s.mergeRule(l[e][r],l[e][r-1]))?(p(e,r),c[r]=u[e]):f(e,r):(n=s.mergeRule(l[e][r],l[e-1][r]),(i=s.mergeRule(l[e][r],l[e][r-1]))&&n||(i&&p(e,r),n&&d(e,r),i)||n||f(e,r)):f(e,r)}),h},_addItems:function(e,n){var i=this,r=BI.Widget._renderEngine.createFragment();BI.each(e,function(e,t){t=i._addItem(t,n+e);i.trCache[n+e]=t,r.appendChild(t.element[0])}),this.container.element.append(r)},_calculateBlocksToRender:function(){if(this.tree&&0!==this.options.items.length){for(var e=this.options,t=(this._renderMoreIf(),this.element.height()),n=e.scrollTop-e.overscanHeight,t=e.scrollTop+t+e.overscanHeight,i=this.tree.greatestLowerBound(n),r=this.tree.leastUpperBound(t),o=[],a=0;a<i;a++)if(this.cache[a]){var s=this.cache[a].index;if(!this.cache[a].destroyed){for(var l=s;l<s+this.cache[a].size&&l<e.items.length;l++)o.push(this.trCache[l]),delete this.trCache[l];this.cache[a].destroyed=!0}}for(a=r+1;a<=this.renderedIndex;a++)if(this.cache[a]){s=this.cache[a].index;if(!this.cache[a].destroyed){for(l=s;l<s+this.cache[a].size&&l<e.items.length;l++)o.push(this.trCache[l]),delete this.trCache[l];this.cache[a].destroyed=!0}}for(var n=BI.Widget._renderEngine.createFragment(),c=BI.Widget._renderEngine.createFragment(),u=n,a=i<0?0:i;a<=r&&a<=this.renderedIndex;a++){s=this.cache[a].index;if(this.cache[a].destroyed||(u=c),!0===this.cache[a].destroyed){for(l=s;l<s+this.cache[a].size&&l<e.items.length;l++){var h=this._addItem(e.items[l],l);this.trCache[l]=h,u.appendChild(h.element[0])}this.cache[a].destroyed=!1}}this.container.element.prepend(n),this.container.element.append(c),this.topBlank.setHeight(this.tree.sumTo(Math.max(-1,i-1))),this.bottomBlank.setHeight(this.tree.sumTo(this.renderedIndex)-this.tree.sumTo(Math.min(r,this.renderedIndex))),BI.each(o,function(e,t){t&&t._destroy()});for(a=i<0?0:i;a<=r&&a<=this.renderedIndex;a++){for(var d,p=0,l=s=this.cache[a].index;l<s+this.cache[a].size&&l<e.items.length;l++)e.rowSizeGetter?(d=e.rowSizeGetter(l),this.trCache[l].element.height(d),p+=d):p+=this.trCache[l].element.height();this.cache[a].height!==p&&(this.cache[a].height=p,this.tree.set(a,p))}}},_populate:function(e){var n=this,t=this.options;e&&this.options.items!==e&&(this.options.items=e,this.itemsMap=this._serialize(t.items,t.columnSize,t.mergeCols)),this.tree||(this.tree=BI.PrefixIntervalTree.empty(Math.ceil(t.items.length/t.blockSize))),this.table.setWidth(BI.sum(t.columnSize)),this.table.element.css({marginLeft:t.isNeedFreeze?-1*BI.sum(t.columnSize.slice(0,t.freezeCols.length)):0}),this.colGroup&&BI.each(t.columnSize,function(e,t){0===n.colGroup.element.children().eq(e).length?n.colGroup.addItem({type:"bi.layout",tagName:"col",width:t}):n.colGroup.element.children().eq(e).css("width",t)}),this._calculateBlocksToRender()},_clearChildren:function(){this.colGroup.empty(),this.container.empty()},setColumnSize:function(e){this.options.columnSize=e},setRegionColumnSize:function(e){this.options.regionColumnSize=e},getMaxScrollTop:function(){return this.container.element.height()+this.topBlank.element.height()+this.bottomBlank.element.height()-this.element.height()},getScrollTop:function(){return this.options.scrollTop},getScrollLeft:function(){return this.options.scrollLeft},setScrollLeft:function(e){this.options.scrollLeft!==e&&(this._scrollLock=!0,this.options.scrollLeft=e,this._debounceRelease(),this.element.scrollLeft(this.options.scrollLeft))},setScrollTop:function(e){this.options.scrollTop!==e&&(this._scrollLock=!0,this.options.scrollTop=e,this._debounceRelease(),this._calculateBlocksToRender(),this.element.scrollTop(this.options.scrollTop),this.fireEvent("EVENT_SYNC",e))},restore:function(){this.renderedIndex=-1,this._clearChildren(),this.cache={},this.tree=null,this.trCache={},this.options.scrollTop=0,this.topBlank.setHeight(0),this.bottomBlank.setHeight(0)},populate:function(e){this.options;e&&this.options.items!==e&&this.restore(),this._populate(e)},destroyed:function(){this.restore()}})).EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.dynamic_collection_view",i)},function(e,t,n){"use strict";BI.NativeTableScrollbar=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.NativeTableScrollbar.superclass._defaultConfig.apply(this,arguments),{attributes:{tabIndex:0},contentSize:0,defaultPosition:0,position:0,size:0})},render:function(){var t=this,e=(this.options,this.element.width(36),BI.throttle(function(){t.fireEvent(BI.NativeTableScrollbar.EVENT_SCROLL,t.element.scrollTop())},150,{leading:!1}));return this.element.scroll(function(){e()}),{type:"bi.default",scrolly:!0,items:[{type:"bi.layout",width:1,ref:function(e){t.inner=e}}]}},mounted:function(){this._populate()},_populate:function(){var e=this.options;if(e.size<1||e.contentSize<=e.size)this.setVisible(!1);else{this.setVisible(!0);try{this.element.scrollTop(e.position)}catch(t){}this.inner.element.height(e.contentSize)}},setContentSize:function(e){this.options.contentSize=e},setPosition:function(e){this.options.position=e},setSize:function(e){this.setHeight(e),this.options.size=e},populate:function(){this._populate()}}),BI.NativeTableScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.native_table_scrollbar",BI.NativeTableScrollbar),BI.NativeTableHorizontalScrollbar=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.NativeTableHorizontalScrollbar.superclass._defaultConfig.apply(this,arguments),{attributes:{tabIndex:0},contentSize:0,position:0,size:0})},render:function(){var t=this,e=(this.options,this.element.height(36),BI.throttle(function(){t.fireEvent(BI.NativeTableScrollbar.EVENT_SCROLL,t.element.scrollLeft())},150,{leading:!1}));return this.element.scroll(function(){e()}),{type:"bi.default",scrollx:!0,items:[{type:"bi.layout",height:1,ref:function(e){t.inner=e}}]}},setContentSize:function(e){this.options.contentSize=e},setPosition:function(e){this.options.position=e},setSize:function(e){this.setWidth(e),this.options.size=e},_populate:function(){var e=this.options;if(e.size<1||e.contentSize<=e.size)this.setVisible(!1);else{this.setVisible(!0);try{this.element.scrollLeft(e.position)}catch(t){}this.inner.element.width(e.contentSize)}},populate:function(){this._populate()}}),BI.NativeTableHorizontalScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.native_table_horizontal_scrollbar",BI.NativeTableHorizontalScrollbar)},function(e,t,n){"use strict";var i,s;i=20,s=300,BI.SortableTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-sortable-table",el:{type:"bi.grid_table"},sortable:!0},render:function(){var t=this,n=this.options;return this.header={},this.cell={},this.quickSelectHelper=new BI.SortableTable.QuickSelectHelper,this.styleHelper=new BI.SortableTable.StyleHelper(this.header,this.cell,BI.bind(this._getCell,this),this.quickSelectHelper),[BI.extend({type:"bi.grid_table",width:n.width,height:n.height,headerRowSize:n.headerRowSize,rowSize:n.rowSize,columnSize:n.columnSize,header:this._formatHeader(n.header),items:this._formatCell(n.items),listeners:[{eventName:BI.Table.EVENT_TABLE_SCROLL,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}},{eventName:BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}},{eventName:BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)}}]},n.el,{ref:function(e){t.table=e,n.el.ref&&n.el.ref.call(this,e)},mounted:function(){t.autoScrollHelper=new BI.SortableTable.AutoScrollHelper(t.table,BI.bind(t._onAutoScroll,t))}})]},_getColumnsLeftPosition:function(){var t=[],n=this.table.getColumnSize();return BI.each(n,function(e){t.push(0===e?0:t[e-1]+n[e-1])}),t},_exchangeItemsAndHeaderPosition:function(n,i){var e,t,r,o,a=this.options;return(1!==n.length||n[0]!==i)&&(e=BI.unzip(a.header),t=BI.unzip(a.items),r=this.getColumnSize(),o=BI.map(n,function(e,t){return t<i?t:t+n.length}),a.header=BI.unzip(this._dealExchangeConfig(e,n,i,o)),a.items=BI.unzip(this._dealExchangeConfig(t,n,i,o)),a.columnSize=this._dealExchangeConfig(r,n,i,o),!0)},_dealExchangeConfig:function(e,t,n,i){var r=BI.filter(e,function(e){return BI.contains(t,e)});return r.unshift(n,0),[].splice.apply(e,r),BI.removeAt(e,i),e},_getCell:function(e){if(this.options.customCell)return e.element;for(var t=e.element.parent();t&&!t.hasClass("bi-grid-table-cell");)t=t.parent();return t},_formatHeader:function(){var o=this,e=this.options;return BI.map(e.header,function(r,e){return BI.map(e,function(i,e){return BI.extend({},e,{ref:function(t){o.header[i]=o.header[i]||{},o.header[i][r]=t,e.ref&&e.ref.call(this,t);var n=!1;t.element.on("mousedown",function(e){o.disableSelectText(!0),BI.contains(o.quickSelectHelper.getSelectedColumns(),i)?n=!0:(o._clickSelectColumn(i,e),o.fireEvent("EVENT_TABLE_SELECT_COLUMN",i)),o._prepareDrag(e,t,i)}),t.element.on("click",function(e){n&&(n=!1,o._clickSelectColumn(i,e),o.fireEvent("EVENT_TABLE_SELECT_COLUMN",i))})},mounted:function(){o.startDrag||(BI.contains(o.quickSelectHelper.getSelectedColumns(),i)&&(o.styleHelper.selectCell(!0,o.header[i][r],{column:i,row:r,header:!0}),o._initDrag(i,o.header[i][r],!0)),BI.contains(o.quickSelectHelper.getSelectedColumns(),i+1)&&o._getCell(o.header[i][r]).addClass("column-select-helper")),o.columnIndex===i&&o.styleHelper.setInVisibility(o.header[i][r])},destroyed:function(){o.header[i]&&delete o.header[i][r],0===BI.size(o.header[i])&&delete o.header[i]}})})})},_clickSelectColumn:function(e,t){var r=this;this.quickSelectHelper.selectColumns(e,t),BI.each(this.header,function(i,e){BI.each(e,function(e,t){var n=BI.contains(r.quickSelectHelper.getSelectedColumns(),BI.parseInt(i))?r.styleHelper.selectColumn(!0,i):r.styleHelper.selectColumn(!1,i);r._initDrag(i,t,n)})})},_formatCell:function(){var r=this,o=this.options;return BI.map(o.items,function(i,e){return BI.map(e,function(t,n){return BI.extend({},n,{ref:function(e){r.cell[t]=r.cell[t]||{},r.cell[t][i]=e,n.ref&&n.ref.call(this,e)},mounted:function(){r.startDrag||(BI.contains(r.quickSelectHelper.getSelectedColumns(),t)&&r.styleHelper.selectCell(!0,r.cell[t][i],{column:t,row:i,lastRowCell:i===o.items.length-1}),BI.contains(r.quickSelectHelper.getSelectedColumns(),t+1)&&r._getCell(r.cell[t][i]).addClass("column-select-helper")),r.columnIndex===t&&r.styleHelper.setInVisibility(r.cell[t][i])},destroyed:function(){r.cell[t]&&delete r.cell[t][i],0===BI.size(r.cell[t])&&delete r.cell[t]}},{lastRowCell:i===o.items.length-1})})})},_drop:function(e){var t,n,i,r=this.options,o=this.columnIndex>this.newColumnIndex?this.newColumnIndex:this.newColumnIndex+1;!0===this._exchangeItemsAndHeaderPosition(e,o)&&(this.setColumnSize(r.columnSize),t=this.getSelectedColumns(),this.populate(r.items,r.header),n=BI.findIndex(t,function(e,t){return o<=t}),i=o-(t[0]<o?n<0?t.length:n:0),this.selectColumns(BI.map(t,function(e){return BI.clamp(i+e,0,r.columnSize.length)})),this.fireEvent("EVENT_TABLE_SORT",e,o))},_shouldStartDrag:function(e,t){return Math.abs(e-t)>i},disableSelectText:function(n){BI.each(this.header,function(e,t){BI.each(t,function(e,t){t.element[n?"addClass":"removeClass"]("bi-user-select-disable")})})},_prepareDrag:function(e,t,n){this.tracker.captureMouseMoves(BI.extend({},e,{preventDefault:BI.emptyFn})),this.start=!1,this.startDrag=!1,this.startX=this.oStartX=e.pageX,this.startY=e.pageY,this.boundingClientRect=t.element[0].getBoundingClientRect(),this.columnIndex=this.newColumnIndex=n,this.positions=this._getColumnsLeftPosition(),this.offsetX=this.positions[n],this.height=t.element[0].offsetHeight,this.width=t.element[0].offsetWidth,this.widths=this.table.getColumnSize(),this.tableWidth=this.table.getWidth(),this.tableHeight=this.table.getHeight();e=this.element[0].getBoundingClientRect();this.minTranslateX=e.left-this.boundingClientRect.left-this.width/2,this.maxTranslateX=e.left+e.width-this.boundingClientRect.left-this.width/2,this.initialScrollX=this.table.getActualRightHorizontalScroll()},_initDrag:function(e,t,n){var i;this.options.sortable&&(i=this,BI.isNull(this.tracker)&&(this.tracker=new BI.MouseMoveTracker(function(e,t){i.startX+=e,i.startY+=t,i.tracker.isDragging()&&(i.startDrag||i._shouldStartDrag(i.startX,i.oStartX))&&(i.startDrag=!0,i._updateHelperPosition(),i._animateColumns(),i._autoScroll())},function(){i.dragHelper&&i.dragHelper.setVisible(!1),i.tracker.releaseMouseMoves(),i.startDrag&&i._drop(BI.sortBy(i.quickSelectHelper.getSelectedColumns())),i._stopDrag()},window)),n?t.element.off("mouseup").on("mouseup",function(e){Math.abs(i.startX-e.pageX)<5&&Math.abs(i.startY-e.pageY)<5&&i._stopDrag()}):t.element.off("mouseup"))},_updateHelperPosition:function(){BI.isNull(this.dragHelper)?(this.dragHelper=BI.createWidget({type:"bi.layout",cls:"sortable_table_drag_helper cursor-drag-hand",zIndex:BI.zIndex_layer}),BI.createWidget({type:"bi.absolute",element:"body",items:[{el:this.dragHelper,left:this.boundingClientRect.left,top:this.boundingClientRect.top}]}),this.translateX=this.startX-this.oStartX,this.styleHelper.setColumnInVisibility(this.columnIndex),this.styleHelper.setColumnDisabled(this._getOtherSelectedColumns(this.columnIndex))):(this.translateX=this.startX-this.oStartX,this.styleHelper.setTranslateX(this.dragHelper.element,this.translateX),this.dragHelper.setWidth(this.widths[this.columnIndex]),this.dragHelper.setHeight(this.tableHeight),this.dragHelper.setVisible(!0))},_animateColumns:function(){var o=this,a=this.offsetX+this.translateX+this.table.getActualRightHorizontalScroll()-this.initialScrollX;this.newColumnIndex=null,BI.some(this.header,function(i,e){if(i===o.columnIndex)return!1;var r={x:0,y:0};BI.some(e,function(e,t){var n=t.element[0].offsetWidth,t=t.element[0].offsetHeight,t=(o.height>t||o.height,o.width>n?n/2:o.width/2);o.styleHelper.setTransitionDuration(i,s),i>o.columnIndex&&a+t>=o.positions[i]?(r.x=-o.width,o.newColumnIndex=parseInt(i)):i<o.columnIndex&&a<=o.positions[i]+t&&(r.x=o.width,null===o.newColumnIndex)&&(o.newColumnIndex=parseInt(i)),o.styleHelper.setColumnTranslateX(i,r.x)})}),null===this.newColumnIndex&&(this.newColumnIndex=this.columnIndex)},_autoScroll:function(){this.autoScrollHelper.update({translateX:this.translateX,minTranslateX:this.minTranslateX,maxTranslateX:this.maxTranslateX,width:this.width})},_onAutoScroll:function(e){this.translateX+=e,this._animateColumns()},_getOtherSelectedColumns:function(e){var t=BI.clone(this.quickSelectHelper.getSelectedColumns()),e=t.indexOf(e);return t.splice(e,1),t},_stopDrag:function(){var t=this;this.startDrag=!1,this.styleHelper.setColumnInVisibility(this.columnIndex,!1),this.styleHelper.setColumnDisabled(this._getOtherSelectedColumns(this.columnIndex),!1),this.autoScrollHelper.clear(),this.columnIndex=-1,this.tracker&&this.tracker.releaseMouseMoves(),BI.each(this.header,function(e){t.styleHelper.setColumnTranslateX(e),t.styleHelper.setTransitionDuration(e,null)}),this.dragHelper&&this.dragHelper.destroy(),this.dragHelper=null,this.disableSelectText(!1)},selectColumns:function(e){var n=this;e=BI.isArray(e)?e:[e],this.quickSelectHelper.clearColumns(),BI.each(this.header,function(e){n.styleHelper.selectColumn(!1,e)}),BI.each(e,function(e,t){n._clickSelectColumn(t,{ctrlKey:!0})})},getSelectedColumns:function(){return this.quickSelectHelper.getSelectedColumns()},setWidth:function(e){BI.SortableTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.SortableTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setColumnSize:function(e){this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},setSortable:function(e){this.options.sortable=e},attr:function(){return BI.SortableTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t){var n=this.options;this.header={},this.cell={},this.styleHelper.update(this.header,this.cell),this.quickSelectHelper.clearColumns(),this._stopDrag(),n.header=t||n.header,n.items=e||n.items,this.table.populate(this._formatCell(n.items),this._formatHeader(n.header))}}),BI.shortcut("bi.sortable_table",BI.SortableTable)},function(e,t,n){"use strict";function i(){this.selectedColumns=[],this.lastSelectedColumn=null}var a,s,l;a=0,s=1,l=2,i.prototype.selectColumns=function(n,e){var i=this;switch(this.getMouseHotKey(e)){case a:this.selectedColumns=[n],this.lastSelectedColumn=n;break;case s:BI.some(this.selectedColumns,function(e,t){if(t===n)return i.selectedColumns.splice(e,1),!0})||this.selectedColumns.push(n);break;case l:var t=i.lastSelectedColumn,r=n,o=BI.min([t,r]),t=BI.max([t,r])+1;this.selectedColumns=BI.uniq(BI.concat(this.selectedColumns,BI.range(o,t)))}},i.prototype.getMouseHotKey=function(e){return e.ctrlKey||e.metaKey?s:e.shiftKey?l:a},i.prototype.getSelectedColumns=function(){return this.selectedColumns},i.prototype.MOUSE_EVENT_KEY={CLICK:0,CONTROL_CLICK:1,SHIFT_CLICK:2},i.prototype.clearColumns=function(){this.selectedColumns=[],this.lastSelectedColumn=null},BI.SortableTable.QuickSelectHelper=i},function(e,t,n){"use strict";function i(e,t){this.container=e,this.onScrollCallback=t}i.prototype.update=function(e){var t=this,n=0,i=!1,r=e.translateX,o=e.minTranslateX,a=e.maxTranslateX,e=e.width;r<=o+e/2?(n=-10*Math.abs((r-e/2-o)/e),i=!0):a-e/2<=r&&(n=10*Math.abs((a-e/2-r)/e),i=!0),this.clear(),i&&(this.interval=setInterval(function(){var e=t.container.getActualRightHorizontalScroll();t.container.setRightHorizontalScroll(e+n),t.onScrollCallback(n),t.container.getActualRightHorizontalScroll()===e&&t.clear()},5))},i.prototype.clear=function(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)},BI.SortableTable.AutoScrollHelper=i},function(e,t,n){"use strict";function i(e,t,n,i){this.cellWrapperGetter=n,this.headers=e,this.cells=t,this.quickSelectHelper=i}i.prototype.setTranslateX=function(e,t){e[0].style.transform=BI.isNull(t)?"":"translateX(".concat(t,"px)")},i.prototype.setInVisibility=function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],e=this.cellWrapperGetter(e);e[0].style.opacity=t?0:"",e[0].style.visibility=t?"hidden":""},i.prototype.setDraggingStyle=function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],n=2<arguments.length?arguments[2]:undefined;this.cellWrapperGetter(e)[t?"addClass":"removeClass"](n||"dragging-state")},i.prototype.setColumnDisabled=function(e){var i=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],r=this;BI.each(e,function(e,n){BI.each(r.cells[n],function(e,t){r.setDraggingStyle(t,i),0<n&&r.cells[n-1]&&r.setDraggingStyle(r.cells[n-1][e],i,"dragging-pre-column-state")}),BI.each(r.headers[n],function(e,t){r.setDraggingStyle(t,i,"dragging-state dragging-header"),0<n&&r.headers[n-1]&&r.setDraggingStyle(r.headers[n-1][e],i,"dragging-pre-column-state")}),r.selectColumn(!i&&BI.contains(r.quickSelectHelper.getSelectedColumns(),n),n)})},i.prototype.setColumnInVisibility=function(e){var n=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],i=this;BI.each(this.cells[e],function(e,t){i.setInVisibility(t,n)}),BI.each(this.headers[e],function(e,t){i.setInVisibility(t,n)}),this.selectColumn(!n&&BI.contains(this.quickSelectHelper.getSelectedColumns(),e),e)},i.prototype.setTransitionDuration=function(e,n){var i=this;BI.each(this.cells[e],function(e,t){i.cellWrapperGetter(t)[0].style.transitionDuration=BI.isNull(n)?"":"".concat(n,"ms")}),BI.each(this.headers[e],function(e,t){i.cellWrapperGetter(t)[0].style.transitionDuration=BI.isNull(n)?"":"".concat(n,"ms")})},i.prototype.setColumnTranslateX=function(e,n){var i=this;BI.each(this.cells[e],function(e,t){i.setTranslateX(i.cellWrapperGetter(t),n)}),BI.each(this.headers[e],function(e,t){i.setTranslateX(i.cellWrapperGetter(t),n)})},i.prototype.selectColumn=function(n,i){var r=this;return BI.each(this.headers[i],function(e,t){r.selectCell(n,t,{column:i,row:e,header:!0,cursor:"cursor-hand"})}),BI.each(this.cells[i],function(e,t){r.selectCell(n,t,{column:i,row:e,header:!1,lastRowCell:t.attr("lastRowCell")})}),n},i.prototype.selectCell=function(e,t,n){var i=n.column,r=n.row,o=n.header||!1,a=n.cursor||"",n=n.lastRowCell||!1;this.cellWrapperGetter(t)[e?"addClass":"removeClass"](a+" column-select"+(n?" last-row-cell":"")+(o?BI.isEmpty(this.cells)?" empty-cell header":" header":"")),0<i&&(t=o?this.headers:this.cells)[i-1]&&this.cellWrapperGetter(t[i-1][r])[e?"addClass":"removeClass"]("column-select-helper")},i.prototype.update=function(e,t){this.headers=e,this.cells=t},BI.SortableTable.StyleHelper=i},function(e,t,n){"use strict";BI.TableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.TableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table-cell",textAlign:"left",text:""})},_init:function(){BI.TableCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,whiteSpace:e.whiteSpace||"nowrap",textAlign:this.options.textAlign,height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.table_cell",BI.TableCell)},function(e,t,n){"use strict";BI.CollectionTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.CollectionTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-collection-table-cell bi-border-right bi-border-bottom",width:0,height:0,_left:0,_top:0,firstRowTopLine:!0,firstColumnLeftLine:!0,cell:{}})},_init:function(){BI.CollectionTableCell.superclass._init.apply(this,arguments);var e=this.options;this.cell=BI.createWidget(BI.extend({type:"bi.label"},e.cell,{cls:(e.cell.cls||"")+" collection-table-cell-wrapper",width:e.width-(e.firstColumnLeftLine&&0===e._left?1:0)-1,height:e.height-(e.firstRowTopLine&&0===e._top?1:0)-1})),BI.createWidget({type:"bi.absolute",cls:(e.firstRowTopLine?"bi-collection-table-cell-top-line":"")+(e.firstColumnLeftLine?" bi-collection-table-cell-left-line":""),element:this,items:[{el:this.cell,left:0,right:0,top:0,bottom:0}]})},setWidth:function(e){BI.CollectionTableCell.superclass.setWidth.apply(this,arguments);var t=this.options;this.cell.setWidth(t.width-(t.firstColumnLeftLine&&0===t._left?1:0)-1)},setHeight:function(e){BI.CollectionTableCell.superclass.setHeight.apply(this,arguments);var t=this.options;this.cell.setHeight(t.height-(t.firstRowTopLine&&0===t._top?1:0)-1)}}),BI.shortcut("bi.collection_table_cell",BI.CollectionTableCell)},function(e,t,n){"use strict";BI.CollectionTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.CollectionTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-collection-table",headerRowSize:25,rowSize:25,columnSize:[],isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,header:[],items:[],regionColumnSize:[],customCell:!1})},render:function(){var t=this,e=this.options;this._width=0,this._height=0,this.topLeftCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.topLeftItems[e]}}),this.topLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topRightCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.topRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomLeftCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.bottomLeftItems[e]}}),this.bottomLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollTop(e.scrollTop),t.topLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.bottomRightItems[e]}}),this.bottomRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollTop(e.scrollTop),t.topRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topLeftCollection]}),this.topRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topRightCollection]}),this.bottomLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomLeftCollection]}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomRightCollection]}),this.shadow=BI.createWidget({type:"bi.layout",cls:"collection-table-shadow"}),this.contextLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topLeft,top:0,left:0},{el:this.topRight,top:0},{el:this.bottomLeft,left:0},{el:this.bottomRight},{el:this.shadow,top:0,bottom:0}]}),this.topScrollbar=BI.createWidget({type:"bi.grid_table_scrollbar",width:BI.GridTableScrollbar.SIZE}),this.topScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollTop(e),t.bottomRightCollection.setScrollTop(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.leftScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.leftScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.topLeftCollection.setScrollLeft(e),t.bottomLeftCollection.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.rightScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.rightScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.topRightCollection.setScrollLeft(e),t.bottomRightCollection.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.scrollBarLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topScrollbar,right:0,top:0},{el:this.leftScrollbar,left:0},{el:this.rightScrollbar}]}),BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]}),this._width=e.width-BI.GridTableScrollbar.SIZE,this._height=e.height-BI.GridTableScrollbar.SIZE,(0<e.header.length||0<e.items.length)&&(this._digest(),this._populate())},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?0:e.header.length*e.headerRowSize},_getActualItems:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?e.header.concat(e.items):e.items},_getContentHeight:function(){var e=this.options;return this._getFreezeHeaderHeight()<=0?e.header.length*e.headerRowSize+e.items.length*e.rowSize:this._getActualItems().length*this.options.rowSize},_populateScrollbar:function(){var n=this.options,e=this.getRegionSize(),i=0,r=0,t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?i+=t:r+=t,e,0}),this.topScrollbar.setContentSize(this._getContentHeight()),this._getFreezeHeaderHeight()),o=this._height-t,o=(this.topScrollbar.setSize(o),this.bottomRightCollection.getScrollTop()),o=(this.topScrollbar.setPosition(o),this.topScrollbar.populate(),this.leftScrollbar.setContentSize(i),this.leftScrollbar.setSize(e),this.bottomLeftCollection.getScrollLeft()),a=(this.leftScrollbar.setPosition(o),this.leftScrollbar.populate(),this.rightScrollbar.setContentSize(r),this.rightScrollbar.setSize(this._width-e),this.bottomRightCollection.getScrollLeft()),s=(this.rightScrollbar.setPosition(a),this.rightScrollbar.populate(),this.scrollBarLayout.attr("items")),s=(s[0].top=this._getFreezeHeaderHeight(),s[1].top=this._height,s[2].top=this._height,s[2].left=e,this.scrollBarLayout.attr("items",s),this.scrollBarLayout.resize(),!1);0<i&&0<r&&(s=e<i&&o<i-e||0<a)&&(o=this.getFirstColumnRowSize(),e=BI.sum(o),this.shadow.setHeight(Math.min(this._height,t+e))),this.shadow.setVisible(s)},_populateTable:function(){var t,a=this.options,e=this.getRegionSize(),n=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,e,0}),e),i=this._getFreezeHeaderHeight(),r=this._width-e,o=this._getFreezeHeaderHeight(),s=e,l=this._height-i,c=this._width-e,u=this._height-o,h=BI.isFireFox()?0:BI.DOM.getScrollWidth(),d=n+h,p=i+h,f=r+h,m=o+h,g=s+h,y=l+h,b=c+h,h=u+h,v=function v(e){e.element.css({overflow:"scroll",overflowX:"scroll",overflowY:"scroll"})},n=(this.topLeft.setWidth(n),this.topLeft.setHeight(i),this.topRight.setWidth(r),this.topRight.setHeight(o),this.bottomLeft.setWidth(s),this.bottomLeft.setHeight(l),this.bottomRight.setWidth(c),this.bottomRight.setHeight(u),this.topLeftCollection.setWidth(d),this.topLeftCollection.setHeight(p),this.topRightCollection.setWidth(f),this.topRightCollection.setHeight(m),this.bottomLeftCollection.setWidth(g),this.bottomLeftCollection.setHeight(y),this.bottomRightCollection.setWidth(b),this.bottomRightCollection.setHeight(h),v(this.topLeftCollection),v(this.topRightCollection),v(this.bottomLeftCollection),v(this.bottomRightCollection),this.contextLayout.attr("items")),i=(n[1].left=e,n[2].top=this._getFreezeHeaderHeight(),n[3].left=e,n[3].top=this._getFreezeHeaderHeight(),n[4].left=e,this.contextLayout.attr("items",n),this.contextLayout.resize(),[]),r=[],o=[],s=[];(t=function t(e,n,i,r,o){BI.each(e,function(e,t){a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=r,n[t.row][t.col].firstColumnLeftLine=o,i.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:r,firstColumnLeftLine:o},i.push(t))})})(this.topLeftItems,a.header,i,!0,!0),t(this.topRightItems,a.header,r,!0,this.topLeftItems.length<=0),t(this.bottomLeftItems,this._getActualItems(),o,this.topRightItems.length<=0,!0),t(this.bottomRightItems,this._getActualItems(),s,this.topRightItems.length<=0,this.topLeftItems.length<=0),this.topLeftCollection._populate(i),this.topRightCollection._populate(r),this.bottomLeftCollection._populate(o),this.bottomRightCollection._populate(s)},_syncScroll:function(){this.setLeftHorizontalScroll(this.getLeftHorizontalScroll()),this.setRightHorizontalScroll(this.getRightHorizontalScroll()),this.setVerticalScroll(this.getVerticalScroll())},_digest:function(){var t=this.options,e=this._getFreezeColLength();this._getFreezeHeaderHeight()<=0?(this.topLeftItems=[],this.topRightItems=[],this.bottomLeftItems=BI.CollectionTable.serialize(this._getActualItems(),0,e,function(e){return e<=t.header.length-1?t.headerRowSize:t.rowSize},t.columnSize,t.mergeCols,BI.range(t.header.length),t.mergeRule,function(e){return e<=t.header.length?e*t.headerRowSize:t.header.length*t.headerRowSize+(e-t.header.length)*t.rowSize}),this.bottomRightItems=BI.CollectionTable.serialize(this._getActualItems(),e,t.columnSize.length,function(e){return e<=t.header.length-1?t.headerRowSize:t.rowSize},t.columnSize,t.mergeCols,BI.range(t.header.length),t.mergeRule,function(e){return e<=t.header.length?e*t.headerRowSize:t.header.length*t.headerRowSize+(e-t.header.length)*t.rowSize})):(this.topLeftItems=BI.CollectionTable.serialize(t.header,0,e,t.headerRowSize,t.columnSize,t.mergeCols,[],t.mergeRule),this.topRightItems=BI.CollectionTable.serialize(t.header,e,t.columnSize.length,t.headerRowSize,t.columnSize,!0,[],t.mergeRule),this.bottomLeftItems=BI.CollectionTable.serialize(t.items,0,e,t.rowSize,t.columnSize,t.mergeCols,[],t.mergeRule),this.bottomRightItems=BI.CollectionTable.serialize(t.items,e,t.columnSize.length,t.rowSize,t.columnSize,t.mergeCols,[],t.mergeRule))},_populate:function(){this._width<=0||this._height<=0||(!0===this._isNeedDigest&&this._digest(),this._isNeedDigest=!1,this._populateTable(),this._populateScrollbar(),this._syncScroll())},attr:function(e,t){var n=BI.CollectionTable.superclass.attr.apply(this,arguments);if(BI.isNotNull(t))switch(e){case"scrollLeft":this.topRightCollection.attr(e,t),this.bottomRightCollection.attr(e,t);break;case"scrollTop":this.bottomLeftCollection.attr(e,t),this.bottomRightCollection.attr(e,t)}return n},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){this.bottomLeftCollection.setScrollTop(e),this.bottomRightCollection.setScrollTop(e)},setLeftHorizontalScroll:function(e){this.topLeftCollection.setScrollLeft(e),this.bottomLeftCollection.setScrollLeft(e)},setRightHorizontalScroll:function(e){this.topRightCollection.setScrollLeft(e),this.bottomRightCollection.setScrollLeft(e)},getVerticalScroll:function(){return this.bottomRightCollection.getScrollTop()},getLeftHorizontalScroll:function(){return this.bottomLeftCollection.getScrollLeft()},getRightHorizontalScroll:function(){return this.bottomRightCollection.getScrollLeft()},setWidth:function(e){BI.CollectionTable.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){BI.CollectionTable.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},getFirstColumnHeaderRowSize:function(){var e=this._getFreezeColLength(),t=this.topLeftItems,n=(e<=0&&(t=this.topRightItems),this._getFreezeHeaderHeight()<=0&&(t=this.bottomLeftItems,t=((t=e<=0?this.bottomRightItems:t)||[]).slice(0,this.options.header.length)),[]);return BI.each(t,function(e,t){0===t.col&&n.push(t.height)}),n},getFirstColumnRowSize:function(){var e=this._getFreezeColLength(),t=this.bottomLeftItems,n=(e<=0&&(t=this.bottomRightItems),this._getFreezeHeaderHeight()<=0&&(t=(t||[]).slice(this.options.header.length)),[]);return BI.each(t,function(e,t){0===t.col&&n.push(t.height)}),n},getLastColumnRowSize:function(){var e=this.bottomRightItems,n=(this._getFreezeHeaderHeight()<=0&&(e=(e||[]).slice(this.options.header.length)),BI.max(BI.map(e,"x"))),i=[];return BI.each(e,function(e,t){t.x===n&&i.push(t.height)}),i},populate:function(e,t){e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate()},_restore:function(){this.topLeftCollection.restore(),this.topRightCollection.restore(),this.bottomLeftCollection.restore(),this.bottomRightCollection.restore()},restore:function(){this._restore()}}),BI.extend(BI.CollectionTable,{map:function I(e,o,a,r,s,l,c,u,h){l=l||[],c=c||[];for(var d=BI.isFunction(r)?r:function(){return r},p=[],f={},m={},g={},I={},y=[],t=o;t<a;t++)y[t]=t===o?s[t]:y[t-1]+s[t];var b=function b(e,t){m[t]._height+=d(e),m[t].__mergeRows.push(e)},v=function v(e,t){g[e]._width+=s[t],g[e].__mergeCols.push(t)},x=function x(e,t){var n=s[t],i=d(e);I[e][t]._row=e,I[e][t]._col=t,I[e][t]._width=n,I[e][t]._height=i,m[t]=I[e][t],m[t].__mergeRows=[e],g[e]=I[e][t],g[e].__mergeCols=[t],p.push({x:y[t]-s[t],y:h?h(e):+e*r,item:I[e][t]})};return BI.each(e,function(e,t){for(var n,i,r=o;r<a;r++)f[e]||(f[e]={}),I[e]||(I[e]={}),f[e][r]=t[r],I[e][r]={},!0===l||-1<l.indexOf(r)||!0===c||-1<c.indexOf(e)?0===e&&r===o?x(0,o):r===o&&0<e?!0===(n=u(f[e][r],f[e-1][r]))?(b(e,r),g[e]=m[r]):x(e,r):0===e&&o<r?!0===(i=u(f[e][r],f[e][r-1]))?(v(e,r),m[r]=g[e]):x(e,r):(n=u(f[e][r],f[e-1][r]),(i=u(f[e][r],f[e][r-1]))&&n||(i&&v(e,r),n&&b(e,r),i)||n||x(e,r)):x(e,r)}),{map:I,cells:p}},serialize:function(e,t,n,i,r,o,a,s,l){e=BI.CollectionTable.map(e,t,n,i,r,o,a,s,l);return BI.map(e.cells,function(e,t){return{x:t.x,y:t.y,row:t.item._row,col:t.item._col,width:t.item._width,height:t.item._height}})}}),BI.shortcut("bi.collection_table",BI.CollectionTable)},function(e,t,n){"use strict";BI.QuickCollectionTable=BI.inherit(BI.CollectionTable,{_defaultConfig:function(){return BI.extend(BI.QuickCollectionTable.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-quick-collection-table"})},render:function(){BI.QuickCollectionTable.superclass.render.apply(this,arguments);this.options;this.topLeftCollection.setOverflowX(!1),this.topLeftCollection.setOverflowY(!1),this.topRightCollection.setOverflowX(!1),this.topRightCollection.setOverflowY(!1),this.bottomLeftCollection.setOverflowX(!1),this.bottomLeftCollection.setOverflowY(!1),this.bottomRightCollection.setOverflowX(!1),this.bottomRightCollection.setOverflowY(!1)},mounted:function(){var t=this;this._topLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._topRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this._bottomLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._bottomRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this.topLeftCollection.element.mousewheel(function(e){t._topLeftWheelHandler.onWheel(e.originalEvent)}),this.topRightCollection.element.mousewheel(function(e){t._topRightWheelHandler.onWheel(e.originalEvent)}),this.bottomLeftCollection.element.mousewheel(function(e){t._bottomLeftWheelHandler.onWheel(e.originalEvent)}),this.bottomRightCollection.element.mousewheel(function(e){t._bottomRightWheelHandler.onWheel(e.originalEvent)})},_shouldHandleLeftX:function(e){return 0<e?this.bottomLeftCollection.getScrollLeft()<this.bottomLeftCollection.getMaxScrollLeft():0<this.bottomLeftCollection.getScrollLeft()},_shouldHandleRightX:function(e){return 0<e?this.bottomRightCollection.getScrollLeft()<this.bottomRightCollection.getMaxScrollLeft():0<this.bottomRightCollection.getScrollLeft()},_shouldHandleY:function(e){return 0<e?this.bottomRightCollection.getScrollTop()<this.bottomRightCollection.getMaxScrollTop():0<this.bottomRightCollection.getScrollTop()},_onWheelLeft:function(e,t){var n=this.bottomLeftCollection.getScrollTop(),i=this.bottomLeftCollection.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,i+=e,this.bottomLeftCollection.setScrollTop(n+=t),this.bottomRightCollection.setScrollTop(n),this.topLeftCollection.setScrollLeft(i),this.bottomLeftCollection.setScrollLeft(i),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_onWheelRight:function(e,t){var n=this.bottomRightCollection.getScrollTop(),i=this.bottomRightCollection.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,i+=e,this.bottomLeftCollection.setScrollTop(n+=t),this.bottomRightCollection.setScrollTop(n),this.topRightCollection.setScrollLeft(i),this.bottomRightCollection.setScrollLeft(i),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_populateTable:function(){var t,a=this.options,e=this.getRegionSize(),n=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,e,0}),e),i=this._getFreezeHeaderHeight(),r=this._width-e,o=this._getFreezeHeaderHeight(),s=e,l=this._height-i,c=this._width-e,u=this._height-o,n=(this.topLeft.setWidth(n),this.topLeft.setHeight(i),this.topRight.setWidth(r),this.topRight.setHeight(o),this.bottomLeft.setWidth(s),this.bottomLeft.setHeight(l),this.bottomRight.setWidth(c),this.bottomRight.setHeight(u),this.topLeftCollection.setWidth(n),this.topLeftCollection.setHeight(i),this.topRightCollection.setWidth(r),this.topRightCollection.setHeight(o),this.bottomLeftCollection.setWidth(s),this.bottomLeftCollection.setHeight(l),this.bottomRightCollection.setWidth(c),this.bottomRightCollection.setHeight(u),this.contextLayout.attr("items")),i=(n[1].left=e,n[2].top=this._getFreezeHeaderHeight(),n[3].left=e,n[3].top=this._getFreezeHeaderHeight(),n[4].left=e,this.contextLayout.attr("items",n),this.contextLayout.resize(),[]),r=[],o=[],s=[];(t=function t(e,n,i,r,o){BI.each(e,function(e,t){!r&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=r,n[t.row][t.col].firstColumnLeftLine=o,i.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:r,firstColumnLeftLine:o},i.push(t))})})(this.topLeftItems,a.header,i,!0,!0),t(this.topRightItems,a.header,r,!0,this.topLeftItems.length<=0),t(this.bottomLeftItems,this._getActualItems(),o,this.topRightItems.length<=0,!0),t(this.bottomRightItems,this._getActualItems(),s,this.topRightItems.length<=0,this.topLeftItems.length<=0),this.topLeftCollection._populate(i),this.topRightCollection._populate(r),this.bottomLeftCollection._populate(o),this.bottomRightCollection._populate(s)}}),BI.shortcut("bi.quick_collection_table",BI.QuickCollectionTable)},function(e,t,n){"use strict";var h,m;h=function h(e,t,n,i){for(var r=0,o=1,a=0,s=BI.Constants.getConstant("bi.constant.char.widths"),l=0,c=e.length;l<c;l++){var u=e.charCodeAt(l);if(13===u||10===u)r=0,o++;else if(n<(r+=a=32<=u&&u<=126?s[u]*t:t)&&(r=a,o++),o===i)break}return o},m=function m(e,t,n,i,r,o,a){var s=Math.ceil((a-r)/i),e=h(e||"",t,n,s);return Math.min(Math.max(e*i+r,o),a)},BI.AutoHeightCollectionTable=BI.inherit(BI.CollectionTable,{_defaultConfig:function(){return BI.extend(BI.AutoHeightCollectionTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-collection-table bi-collection-auto-height-table",isAutoHeight:!0,isHeaderAutoHeight:!0,fontSize:12,fontLineHeight:14,columnGaps:[],rowGap:1,headerFontSize:12,headerFontLineHeight:14,headerColumnGaps:[],headerRowGap:1,rowSize:0,headerRowSize:0,maxRowSize:400})},_getFreezeHeaderHeight:function(){var e=this.options;return e.isHeaderAutoHeight?!this.headerIntervalTree||(e=this.headerIntervalTree.sumUntil(e.header.length))>=this._height?0:e:BI.AutoHeightCollectionTable.superclass._getFreezeHeaderHeight.call(this)},_getActualItems:function(){var e=this.options;if(!e.isHeaderAutoHeight)return BI.AutoHeightCollectionTable.superclass._getActualItems.call(this);if(this.headerIntervalTree&&this.headerIntervalTree.sumUntil(e.header.length)>=this._height)return e.header.concat(e.items);return e.items},_getContentHeight:function(){var e,t=this.options;return t.isAutoHeight||t.isHeaderAutoHeight?t.isHeaderAutoHeight?t.isAutoHeight?this.headerIntervalTree?(e=this.headerIntervalTree.sumUntil(t.header.length))>=this._height?e+this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:0:(e=this.headerIntervalTree?this.headerIntervalTree.sumUntil(t.header.length):0)>=this._height?e+t.items.length*t.rowSize:t.items.length*t.rowSize:(e=this._getFreezeHeaderHeight())<=0?t.header.length*t.headerRowSize+(this.intervalTree?this.intervalTree.sumUntil(t.items.length):0):this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:BI.AutoHeightCollectionTable.superclass._getContentHeight.call(this)},_getOneRowHeight:function(e){for(var t=this.options,n=this.options.items[e],i=0,r=this.heightCache,o=this._getFreezeColLength(),a=0,s=n.length;a<s;a++){var l=n[a];if(r[e]&&r[e][a])var c=r[e][a];else{var u=this.mergeRules.map[e]&&this.mergeRules.map[e][a],h=u&&u.__mergeRows||[],d=u&&u.__mergeCols||[],p=t.columnSize[a]-(t.columnGaps[a]||0)-((BI.isFunction(l.columnGap)?l.columnGap():l.columnGap)||0)-(0===a||a===o?2:1)-30*(l.layer||0);if(1<d.length){for(var f=1;f<d.length;f++)p+=t.columnSize[a+f];a+=d.length-1}c=m(l.text,t.fontSize,p,t.fontLineHeight,t.rowGap,t.rowSize,t.maxRowSize);if(c/=h.length||1,0<h.length)for(f=e;f<e+h.length;f++)r[f]||(r[f]={}),r[f][a]=c}if(c>=t.maxRowSize)return t.maxRowSize;i=Math.max(i,c)}return i},_getOneHeaderRowHeight:function(e){for(var t=this.options,n=this.options.header[e],i=0,r=this.headerHeightCache,o=this._getFreezeColLength(),a=0,s=n.length;a<s;a++){var l=n[a];if(r[e]&&r[e][a])var c=r[e][a];else{var u=this.headerMergeRules.map[e]&&this.headerMergeRules.map[e][a],h=u&&u.__mergeRows||[],d=u&&u.__mergeCols||[],p=t.columnSize[a]-(t.columnGaps[a]||0)-((l.cell?BI.isFunction(l.cell.columnGap)?l.cell.columnGap():l.cell.columnGap:l.columnGap)||0)-(0===a||a===o?2:1);if(1<d.length){for(var f=1;f<d.length;f++)p+=t.columnSize[a+f];a+=d.length-1}c=m((l.cell||l).text,t.headerFontSize,p,t.headerFontLineHeight,t.headerRowGap,t.headerRowSize,t.maxRowSize);if(c/=h.length||1,0<h.length)for(f=e;f<e+h.length;f++)r[f]||(r[f]={}),r[f][a]=c}if(c>=t.maxRowSize)return t.maxRowSize;i=Math.max(i,c)}return i},_getActualRowHeights:function(){var n=this,e=this.options,t=this.options.items;return this.intervalTree=BI.PrefixIntervalTree.empty(e.items.length),this.heightCache={},this.mergeRules=BI.CollectionTable.map(e.items,0,this._getFreezeColLength(),e.rowSize,e.columnSize,e.mergeCols,[],e.mergeRule),BI.each(t,function(e,t){n.intervalTree.set(e,n._getOneRowHeight(e))}),this.intervalTree},_getActualHeaderRowHeights:function(){var n=this,e=this.options,t=this.options.header;return this.headerIntervalTree=BI.PrefixIntervalTree.empty(e.header.length),this.headerHeightCache={},this.headerMergeRules=BI.CollectionTable.map(e.header,this._getFreezeColLength(),e.columnSize.length,e.headerRowSize,e.columnSize,!0,[],e.mergeRule),BI.each(t,function(e,t){n.headerIntervalTree.set(e,n._getOneHeaderRowHeight(e))}),this.headerIntervalTree},_digest:function(){var t,n=this,i=this.options;if(!i.isAutoHeight&&!i.isHeaderAutoHeight)return BI.AutoHeightCollectionTable.superclass._digest.call(this);t=i.isHeaderAutoHeight?(this._getActualHeaderRowHeights(),this.headerIntervalTree.sumUntil(i.header.length)):i.header.length*i.headerRowSize,i.isAutoHeight&&this._getActualRowHeights();var r,o,a,s,l,c,e=this._getFreezeColLength();t>=this._height?(r={},o={},this.topLeftItems=[],this.topRightItems=[],this.bottomLeftItems=BI.CollectionTable.serialize(this._getActualItems(),0,e,function(e){return r[e]||(e<=i.header.length-1?i.isHeaderAutoHeight?r[e]=n.headerIntervalTree.get(e):r[e]=i.headerRowSize:i.isAutoHeight?r[e]=n.intervalTree.get(e-i.header.length):r[e]=i.rowSize)},i.columnSize,i.mergeCols,BI.range(i.header.length),i.mergeRule,function(e){return e<=0?0:o[e]||(e<=i.header.length?i.isHeaderAutoHeight?o[e]=n.headerIntervalTree.sumUntil(e):o[e]=e*i.headerRowSize:i.isAutoHeight?o[e]=t+n.intervalTree.sumUntil(e-i.header.length):o[e]=t+(e-i.header.length)*i.rowSize)}),this.bottomRightItems=BI.CollectionTable.serialize(this._getActualItems(),e,i.columnSize.length,function(e){return r[e]||(e<=i.header.length-1?i.isHeaderAutoHeight?r[e]=n.headerIntervalTree.get(e):r[e]=i.headerRowSize:i.isAutoHeight?r[e]=n.intervalTree.get(e-i.header.length):r[e]=i.rowSize)},i.columnSize,i.mergeCols,BI.range(i.header.length),i.mergeRule,function(e){return e<=0?0:o[e]||(e<=i.header.length?i.isHeaderAutoHeight?o[e]=n.headerIntervalTree.sumUntil(e):o[e]=e*i.headerRowSize:i.isAutoHeight?o[e]=t+n.intervalTree.sumUntil(e-i.header.length):o[e]=t+(e-i.header.length)*i.rowSize)})):(a={},s={},l={},c={},this.topLeftItems=BI.CollectionTable.serialize(i.header,0,e,function(e){return a[e]||(i.isHeaderAutoHeight?a[e]=n.headerIntervalTree.get(e):a[e]=i.headerRowSize)},i.columnSize,i.mergeCols,[],i.mergeRule,function(e){return 0===e?0:s[e]||(i.isHeaderAutoHeight?s[e]=n.headerIntervalTree.sumUntil(e):e*i.headerRowSize)}),this.topRightItems=BI.CollectionTable.serialize(i.header,e,i.columnSize.length,function(e){return a[e]||(i.isHeaderAutoHeight?a[e]=n.headerIntervalTree.get(e):a[e]=i.headerRowSize)},i.columnSize,!0,[],i.mergeRule,function(e){return 0===e?0:s[e]||(i.isHeaderAutoHeight?s[e]=n.headerIntervalTree.sumUntil(e):e*i.headerRowSize)}),this.bottomLeftItems=BI.CollectionTable.serialize(i.items,0,e,function(e){return l[e]||(i.isAutoHeight?l[e]=n.intervalTree.get(e):l[e]=i.rowSize)},i.columnSize,i.mergeCols,[],i.mergeRule,function(e){return 0===e?0:c[e]||(i.isAutoHeight?c[e]=n.intervalTree.sumUntil(e):e*i.rowSize)}),this.bottomRightItems=BI.CollectionTable.serialize(i.items,e,i.columnSize.length,function(e){return l[e]||(i.isAutoHeight?l[e]=n.intervalTree.get(e):l[e]=i.rowSize)},i.columnSize,i.mergeCols,[],i.mergeRule,function(e){return 0===e?0:c[e]||(i.isAutoHeight?c[e]=n.intervalTree.sumUntil(e):e*i.rowSize)}))}}),BI.shortcut("bi.collection_auto_height_table",BI.AutoHeightCollectionTable)},function(e,t,n){"use strict";var i;i=BI.DynamicCollectionTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(i.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-dynamic-collection-table",headerRowSize:25,columnSize:[],isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,header:[],items:[],regionColumnSize:[],trRenderer:null,headerEl:{},bodyEl:{},bordered:!0})},attr:function(e,t){var n=i.superclass.attr.apply(this,arguments);return BI.isNull(t)?(this.topRightCollection.attr.apply(this.topRightCollection,arguments),this.bottomRightCollection.attr.apply(this.bottomRightCollection,arguments)):n},render:function(){var t=this,n=this.options;this._width=0,this._height=0,this.topLeftCollection=BI.createWidget({type:"bi.dynamic_collection_view",stopScrollEvent:!0,renderMore:!0,columnSize:n.columnSize.slice(0,n.freezeCols.length),isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,rowSizeGetter:function(e){return n.headerRowSize}}),this.topLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topRightCollection=BI.createWidget({type:"bi.dynamic_collection_view",columnSize:n.columnSize,isNeedFreeze:n.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,regionColumnSize:n.regionColumnSize,rowSizeGetter:function(e){return n.headerRowSize}}),this.topRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightCollection=BI.createWidget({type:"bi.dynamic_collection_view",columnSize:n.columnSize,isNeedFreeze:n.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,regionColumnSize:n.regionColumnSize,trRenderer:n.trRenderer,el:n.bodyEl}),this.bottomRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollTop(e.scrollTop),t.topRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightCollection.on("EVENT_SYNC",function(){t.bottomLeftCollection._calculateBlocksToRender()}),this.bottomLeftCollection=BI.createWidget({type:"bi.dynamic_collection_view",stopScrollEvent:!0,renderMore:!0,columnSize:n.columnSize.slice(0,n.freezeCols.length),isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,rowSizeGetter:function(e){return t.bottomRightCollection.trCache[e].element.height()},trRenderer:n.trRenderer}),this.bottomLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollTop(e.scrollTop),t.topLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topLeftCollection]}),this.topRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topRightCollection]}),this.bottomLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomLeftCollection]}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1,items:[this.bottomRightCollection]}),this.contextLayout=BI.createWidget({type:"bi.absolute",cls:n.bordered?"bordered bi-split":"",element:this,items:[{el:this.topLeft,top:0,left:0},{el:this.topRight,top:0},{el:this.bottomLeft,left:0},{el:this.bottomRight}]}),this.leftScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.leftScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.topLeftCollection.setScrollLeft(e),t.bottomLeftCollection.setScrollLeft(e),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.scrollBarLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.leftScrollbar,left:0,bottom:0}]}),this._width=n.width-BI.GridTableScrollbar.SIZE,this._height=n.height-BI.GridTableScrollbar.SIZE,BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]})},mounted:function(){var e=this.options;(0<e.header.length||0<e.items.length)&&(this._digest(),this._populate())},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?0:e.header.length*e.headerRowSize},_getActualItems:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?e.header.concat(e.items):e.items},_populateScrollbar:function(){var n=this.options,e=this.getRegionSize(),i=0,e=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?i+=t:0,e,0}),this.leftScrollbar.setContentSize(i),this.leftScrollbar.setSize(e),this.leftScrollbar.setPosition(this.bottomLeftCollection.getScrollLeft()),this.leftScrollbar.populate(),this.scrollBarLayout.attr("items"));e[0].top=this._height,this.scrollBarLayout.attr("items",e),this.scrollBarLayout.resize()},_populateTable:function(){var n=this.options,e=this.getRegionSize(),t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?0:0,e,0}),e),i=this._getFreezeHeaderHeight(),r=this._width-e,o=this._getFreezeHeaderHeight(),a=e,s=this._height-i,l=this._width-e,c=this._height-o,u=BI.DOM.getScrollWidth(),h=t+u,d=i+u,p=r+u,f=o+u,m=a+u,g=s+u,y=l+u,u=c+u,b=function b(e){e.element.css({overflow:"scroll",overflowX:"scroll",overflowY:"scroll"})},t=(this.topLeft.setWidth(t),this.topLeft.setHeight(i),this.topRight.setWidth(r),this.topRight.setHeight(o),this.bottomLeft.setWidth(a),this.bottomLeft.setHeight(s),this.bottomRight.setWidth(l),this.bottomRight.setHeight(c),this.topLeftCollection.setWidth(h),this.topLeftCollection.setHeight(d),this.topRightCollection.setWidth(p),this.topRightCollection.setHeight(f),this.bottomLeftCollection.setWidth(m),this.bottomLeftCollection.setHeight(g),this.bottomRightCollection.setWidth(y),this.bottomRightCollection.setHeight(u),b(this.topLeftCollection),b(this.topRightCollection),b(this.bottomLeftCollection),b(this.bottomRightCollection),this.contextLayout.attr("items"));t[1].left=e,t[2].top=this._getFreezeHeaderHeight(),t[3].left=e,t[3].top=this._getFreezeHeaderHeight(),this.contextLayout.attr("items",t),this.contextLayout.resize();this.topRightCollection.setColumnSize(n.columnSize),this.topRightCollection._populate(n.header),this.bottomRightCollection.setColumnSize(n.columnSize),this.bottomRightCollection._populate(n.items),n.isNeedFreeze&&0<n.freezeCols.length&&(this.topLeftCollection.setColumnSize(n.columnSize.slice(0,n.freezeCols.length)),this.topLeftCollection._populate(BI.map(n.header,function(e,t){return t.slice(0,n.freezeCols.length)})),this.bottomLeftCollection.setColumnSize(n.columnSize.slice(0,n.freezeCols.length)),this.bottomLeftCollection._populate(BI.map(n.items,function(e,t){return t.slice(0,n.freezeCols.length)})))},_digest:function(){this.options},_populate:function(){this._width<=0||this._height<=0||(!0===this._isNeedDigest&&this._digest(),this._isNeedDigest=!1,this._populateTable(),this._populateScrollbar())},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){return this.bottomRightCollection.getScrollTop()},getLeftHorizontalScroll:function(){return this.bottomLeftCollection.getScrollLeft()},getRightHorizontalScroll:function(){return this.bottomRightCollection.getScrollLeft()},setWidth:function(e){i.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){i.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e,this.topRightCollection.setColumnSize(e),this.bottomRightCollection.setColumnSize(e)},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e,this.topRightCollection.setRegionColumnSize(e),this.bottomRightCollection.setRegionColumnSize(e)},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},populate:function(e,t){e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate()},_restore:function(){this.topLeftCollection.restore(),this.topRightCollection.restore(),this.bottomLeftCollection.restore(),this.bottomRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.dynamic_collection_table",i)},function(e,t,n){"use strict";BI.GridTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.GridTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-grid-table-cell  bi-border-right bi-border-bottom",width:0,height:0,firstRowTopLine:!0,firstColumnLeftLine:!0,_rowIndex:0,_columnIndex:0,_left:0,_top:0,cell:{}})},_init:function(){BI.GridTableCell.superclass._init.apply(this,arguments);var e=this.options;this.cell=BI.createWidget(BI.extend({type:"bi.label"},e.cell,{cls:(e.cell.cls||"")+" grid-table-cell-wrapper",width:e.width-(e.firstColumnLeftLine&&0===e._columnIndex?1:0)-1,height:e.height-(e.firstRowTopLine&&0===e._rowIndex?1:0)-1})),BI.createWidget({type:"bi.absolute",cls:(e.firstRowTopLine?"bi-grid-table-cell-top-line":"")+(e.firstColumnLeftLine?" bi-grid-table-cell-left-line":""),element:this,items:[{el:this.cell,left:0,right:0,top:0,bottom:0}]})},setWidth:function(e){BI.GridTableCell.superclass.setWidth.apply(this,arguments);var t=this.options;this.cell.setWidth(t.width-(t.firstColumnLeftLine&&0===t._columnIndex?1:0)-1)},setHeight:function(e){BI.GridTableCell.superclass.setHeight.apply(this,arguments);var t=this.options;this.cell.setHeight(t.height-(t.firstRowTopLine&&0===t._rowIndex?1:0)-1)}}),BI.shortcut("bi.grid_table_cell",BI.GridTableCell)},function(e,t,n){"use strict";BI.GridTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.GridTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-grid-table",headerRowSize:25,rowSize:25,columnSize:[],isNeedFreeze:!1,freezeCols:[],header:[],items:[],regionColumnSize:[],customCell:!1})},render:function(){var t=this,n=this.options,i=(this._width=0,this._height=0,function i(e){return n.columnSize[e]}),r=function r(e){return n.columnSize[e+t._getFreezeColLength()]};this.topLeftGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._headerRowHeightGetter.bind(this),columnWidthGetter:i}),this.topLeftGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomLeftGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topRightGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._headerRowHeightGetter.bind(this),columnWidthGetter:r}),this.topRightGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomRightGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomLeftGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:i}),this.bottomLeftGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomRightGrid.setScrollTop(e.scrollTop),t.topLeftGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:r}),this.bottomRightGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomLeftGrid.setScrollTop(e.scrollTop),t.topRightGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topLeftGrid]}),this.topRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topRightGrid]}),this.bottomLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomLeftGrid]}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomRightGrid]}),this.shadow=BI.createWidget({type:"bi.layout",cls:"grid-table-shadow"}),this.contextLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topLeft,top:0,left:0},{el:this.topRight,top:0},{el:this.bottomLeft,left:0},{el:this.bottomRight},{el:this.shadow,top:0,bottom:0}]}),this.topScrollbar=BI.createWidget({type:"bi.grid_table_scrollbar",width:BI.GridTableScrollbar.SIZE}),this.topScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.bottomLeftGrid.setScrollTop(e),t.bottomRightGrid.setScrollTop(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.leftScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.leftScrollbar.on(BI.GridTableHorizontalScrollbar.EVENT_SCROLL,function(e){t.topLeftGrid.setScrollLeft(e),t.bottomLeftGrid.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.rightScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.rightScrollbar.on(BI.GridTableHorizontalScrollbar.EVENT_SCROLL,function(e){t.topRightGrid.setScrollLeft(e),t.bottomRightGrid.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.scrollBarLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topScrollbar,right:0,top:0},{el:this.leftScrollbar,left:0},{el:this.rightScrollbar}]}),BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]}),this._width=n.width-BI.GridTableScrollbar.SIZE,this._height=n.height-BI.GridTableScrollbar.SIZE,this.header=this._getHeader(),this.items=this._getItems(),(0<n.header.length||0<n.items.length)&&this._populate()},_rowHeightGetter:function(){return this.options.rowSize},_headerRowHeightGetter:function(){return this.options.headerRowSize},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?0:e.header.length*e.headerRowSize},_getActualItems:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?e.header.concat(e.items):e.items},_getContentHeight:function(){return this._getActualItems().length*this.options.rowSize},_getHeader:function(){var i=this.options,r=this._getFreezeColLength(),o=[],a=[];return BI.each(i.header,function(n,e){o[n]=[],a[n]=[],BI.each(e,function(e,t){t=i.customCell?t:{type:"bi.grid_table_cell",cell:t};t.firstRowTopLine=!0,e===r&&0<r&&(t.firstColumnLeftLine=!1),(e<r?o:a)[n].push(t)})}),[o,a]},_populateScrollbar:function(){var n=this.options,e=this.getRegionSize(),i=0,r=0,t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?i+=t:r+=t,e,0}),this.topScrollbar.setContentSize(this._getContentHeight()),this._getFreezeHeaderHeight()),o=this._height-t,o=(this.topScrollbar.setSize(o),this.topScrollbar.setPosition(Math.min(this.bottomLeftGrid.getScrollTop(),this.bottomRightGrid.getScrollTop())),this.topScrollbar.populate(),this.leftScrollbar.setContentSize(i),this.leftScrollbar.setSize(e),Math.max(this.bottomLeftGrid.getScrollLeft(),this.topLeftGrid.getScrollLeft())),a=(this.leftScrollbar.setPosition(o),this.leftScrollbar.populate(),this.rightScrollbar.setContentSize(r),this.rightScrollbar.setSize(this._width-e),Math.max(this.bottomRightGrid.getScrollLeft(),this.topRightGrid.getScrollLeft())),s=(this.rightScrollbar.setPosition(a),this.rightScrollbar.populate(),this.scrollBarLayout.attr("items")),s=(s[0].top=this._getFreezeHeaderHeight(),s[1].top=this._height,s[2].top=this._height,s[2].left=e,this.scrollBarLayout.attr("items",s),this.scrollBarLayout.resize(),!1);0<i&&0<r&&(s=e<i&&o<i-e||0<a)&&(o=this.getFirstColumnRowSize(),e=BI.sum(o),this.shadow.setHeight(Math.min(this._height,t+e))),this.shadow.setVisible(s)},_getItems:function(){var i=this.options,r=this._getFreezeColLength(),o=[],a=[],s=!(i.header&&0<i.header.length);return BI.each(this._getActualItems(),function(n,e){o[n]=[],a[n]=[],BI.each(e,function(e,t){t=i.customCell?(t&&(t.firstRowTopLine=s),t):{type:"bi.grid_table_cell",cell:t,firstRowTopLine:s};e===r&&0<r&&(t.firstColumnLeftLine=!1),(e<r?o:a)[n].push(t)})}),[o,a]},_digest:function(){var n=this.options,e=this._getFreezeColLength(),i=0,r=0;BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?i+=t:r+=t,e,0}),this.topLeftGrid.setEstimatedColumnSize(0<e?i/e:0),this.topLeftGrid.setEstimatedRowSize(n.headerRowSize),this.topRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?r/(n.columnSize.length-e):0),this.topRightGrid.setEstimatedRowSize(n.headerRowSize),this.bottomLeftGrid.setEstimatedColumnSize(0<e?i/e:0),this.bottomLeftGrid.setEstimatedRowSize(n.rowSize),this.bottomRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?r/(n.columnSize.length-e):0),this.bottomRightGrid.setEstimatedRowSize(n.rowSize),this.topLeftGrid.setColumnCount(e),this.topRightGrid.setColumnCount(n.columnSize.length-e),this.bottomLeftGrid.setColumnCount(e),this.bottomRightGrid.setColumnCount(n.columnSize.length-e)},_populateTable:function(){this.options;var e=this.getRegionSize(),t=e,n=this._getFreezeHeaderHeight(),i=this._width-e,r=this._getFreezeHeaderHeight(),o=e,a=this._height-n,s=this._width-e,l=this._height-r,c=BI.isFireFox()?0:BI.DOM.getScrollWidth(),u=t+c,h=n+c,d=i+c,p=r+c,f=o+c,m=a+c,g=s+c,c=l+c,y=function y(e){e.element.css({overflow:"scroll",overflowX:"scroll",overflowY:"scroll"})},t=(this.topLeft.setWidth(t),this.topLeft.setHeight(n),this.topRight.setWidth(i),this.topRight.setHeight(r),this.bottomLeft.setWidth(o),this.bottomLeft.setHeight(a),this.bottomRight.setWidth(s),this.bottomRight.setHeight(l),this.topLeftGrid.setWidth(u),this.topLeftGrid.setHeight(h),this.topRightGrid.setWidth(d),this.topRightGrid.setHeight(p),this.bottomLeftGrid.setWidth(f),this.bottomLeftGrid.setHeight(m),this.bottomRightGrid.setWidth(g),this.bottomRightGrid.setHeight(c),y(this.topLeftGrid),y(this.topRightGrid),y(this.bottomLeftGrid),y(this.bottomRightGrid),this.contextLayout.attr("items")),n=(t[1].left=e,t[2].top=this._getFreezeHeaderHeight(),t[3].left=e,t[3].top=this._getFreezeHeaderHeight(),t[4].left=e,this.contextLayout.attr("items",t),this.contextLayout.resize(),this._getHeader()),i=this._getItems(n);this.topLeftGrid._populate(n[0]),this.topRightGrid._populate(n[1]),this.bottomLeftGrid._populate(i[0]),this.bottomRightGrid._populate(i[1])},_syncScroll:function(){this.setLeftHorizontalScroll(this.getLeftHorizontalScroll()),this.setRightHorizontalScroll(this.getRightHorizontalScroll()),this.setVerticalScroll(this.getVerticalScroll())},_populate:function(){this._width<=0||this._height<=0||(this._digest(),this._populateTable(),this._populateScrollbar(),this._syncScroll())},attr:function(e,t){var n=BI.GridTable.superclass.attr.apply(this,arguments);if(BI.isNotNull(t))switch(e){case"scrollLeft":this.topRightGrid.attr(e,t),this.bottomRightGrid.attr(e,t);break;case"scrollTop":this.bottomLeftGrid.attr(e,t),this.bottomRightGrid.attr(e,t)}return n},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){this.bottomLeftGrid.setScrollTop(e),this.bottomRightGrid.setScrollTop(e),this._populateScrollbar()},setLeftHorizontalScroll:function(e){this.topLeftGrid.setScrollLeft(e),this.bottomLeftGrid.setScrollLeft(e),this._populateScrollbar()},setRightHorizontalScroll:function(e){this.topRightGrid.setScrollLeft(e),this.bottomRightGrid.setScrollLeft(e),this._populateScrollbar()},getVerticalScroll:function(){return this.bottomRightGrid.getScrollTop()},getLeftHorizontalScroll:function(){return this.bottomLeftGrid.getScrollLeft()},getRightHorizontalScroll:function(){return this.bottomRightGrid.getScrollLeft()},getActualRightHorizontalScroll:function(){return this.bottomRightGrid.element.scrollLeft()},setWidth:function(e){BI.GridTable.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){BI.GridTable.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this.options.columnSize=e,this._isNeedDigest=!0},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this._isNeedDigest=!0},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},getFirstColumnHeaderRowSize:function(){var e=this.options,t=this.options.header;return BI.map(t,function(){return e.headerRowSize})},getFirstColumnRowSize:function(){var e=this.options,t=this.options.items;return BI.map(t,function(){return e.rowSize})},populate:function(e,t){var n=this.options.header!==t,i=this.options.items!==e;t&&n&&(this.options.header=t),e&&i&&(this.options.items=e),e&&i&&(this.items=this._getItems(),this._restore()),t&&n&&(this.header=this._getHeader(),this._restore()),this._populate()},_restore:function(){this.topLeftGrid.restore(),this.topRightGrid.restore(),this.bottomLeftGrid.restore(),this.bottomRightGrid.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.grid_table",BI.GridTable)},function(e,t,n){"use strict";BI.QuickGridTable=BI.inherit(BI.GridTable,{_defaultConfig:function(){return BI.extend(BI.QuickGridTable.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-quick-grid-table"})},render:function(){BI.QuickGridTable.superclass.render.apply(this,arguments);this.options;this.topLeftGrid.setOverflowX(!1),this.topLeftGrid.setOverflowY(!1),this.topRightGrid.setOverflowX(!1),this.topRightGrid.setOverflowY(!1),this.bottomLeftGrid.setOverflowX(!1),this.bottomLeftGrid.setOverflowY(!1),this.bottomRightGrid.setOverflowX(!1),this.bottomRightGrid.setOverflowY(!1)},mounted:function(){var t=this;this._topLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._topRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this._bottomLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._bottomRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this.topLeftGrid.element.mousewheel(function(e){t._topLeftWheelHandler.onWheel(e.originalEvent)}),this.topRightGrid.element.mousewheel(function(e){t._topRightWheelHandler.onWheel(e.originalEvent)}),this.bottomLeftGrid.element.mousewheel(function(e){t._bottomLeftWheelHandler.onWheel(e.originalEvent)}),this.bottomRightGrid.element.mousewheel(function(e){t._bottomRightWheelHandler.onWheel(e.originalEvent)})},_shouldHandleLeftX:function(e){return 0<e?this.bottomLeftGrid.getScrollLeft()<this.bottomLeftGrid.getMaxScrollLeft():0<this.bottomLeftGrid.getScrollLeft()},_shouldHandleRightX:function(e){return 0<e?this.bottomRightGrid.getScrollLeft()<this.bottomRightGrid.getMaxScrollLeft():0<this.bottomRightGrid.getScrollLeft()},_shouldHandleY:function(e){return 0<e?this.bottomRightGrid.getScrollTop()<this.bottomRightGrid.getMaxScrollTop():0<this.bottomRightGrid.getScrollTop()},_onWheelLeft:function(e,t){var n=this.bottomLeftGrid.getScrollTop(),i=this.bottomLeftGrid.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,i+=e,this.bottomLeftGrid.setScrollTop(n+=t),this.bottomRightGrid.setScrollTop(n),this.topLeftGrid.setScrollLeft(i),this.bottomLeftGrid.setScrollLeft(i),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_onWheelRight:function(e,t){var n=this.bottomRightGrid.getScrollTop(),i=this.bottomRightGrid.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,i+=e,this.bottomLeftGrid.setScrollTop(n+=t),this.bottomRightGrid.setScrollTop(n),this.topRightGrid.setScrollLeft(i),this.bottomRightGrid.setScrollLeft(i),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_populateTable:function(){var i=this.options,e=this.getRegionSize(),n=0,r=0,o=this._getFreezeColLength(),t=(BI.each(i.columnSize,function(e,t){!0===i.isNeedFreeze&&i.freezeCols.includes(e)?n+=t:r+=t,e,0}),e),a=this._getFreezeHeaderHeight(),s=this._width-e,l=this._getFreezeHeaderHeight(),c=e,u=this._height-a,h=this._width-e,d=this._height-l,t=(this.topLeft.setWidth(t),this.topLeft.setHeight(a),this.topRight.setWidth(s),this.topRight.setHeight(l),this.bottomLeft.setWidth(c),this.bottomLeft.setHeight(u),this.bottomRight.setWidth(h),this.bottomRight.setHeight(d),this.topLeftGrid.setWidth(t),this.topLeftGrid.setHeight(a),this.topRightGrid.setWidth(s),this.topRightGrid.setHeight(l),this.bottomLeftGrid.setWidth(c),this.bottomLeftGrid.setHeight(u),this.bottomRightGrid.setWidth(h),this.bottomRightGrid.setHeight(d),this.topLeftGrid.setEstimatedColumnSize(0<o?n/o:0),this.topLeftGrid.setEstimatedRowSize(i.headerRowSize),this.topRightGrid.setEstimatedColumnSize(0<i.columnSize.length-o?r/(i.columnSize.length-o):0),this.topRightGrid.setEstimatedRowSize(i.headerRowSize),this.bottomLeftGrid.setEstimatedColumnSize(0<o?n/o:0),this.bottomLeftGrid.setEstimatedRowSize(i.rowSize),this.bottomRightGrid.setEstimatedColumnSize(0<i.columnSize.length-o?r/(i.columnSize.length-o):0),this.bottomRightGrid.setEstimatedRowSize(i.rowSize),this.topLeftGrid.setColumnCount(o),this.topRightGrid.setColumnCount(i.columnSize.length-o),this.bottomLeftGrid.setColumnCount(o),this.bottomRightGrid.setColumnCount(i.columnSize.length-o),this.contextLayout.attr("items")),p=(t[1].left=e,t[2].top=this._getFreezeHeaderHeight(),t[3].left=e,t[3].top=this._getFreezeHeaderHeight(),t[4].left=e,this.contextLayout.attr("items",t),this.contextLayout.resize(),[]),f=[],m=[],g=[],y=(BI.each(i.header,function(n,e){p[n]=[],f[n]=[],BI.each(e,function(e,t){t=i.customCell?t:{type:"bi.grid_table_cell",cell:t};t.firstRowTopLine=!0,e===o&&0<o&&(t.firstColumnLeftLine=!1),(e<o?p:f)[n].push(t)})}),!(i.header&&0<i.header.length));BI.each(this._getActualItems(),function(n,e){m[n]=[],g[n]=[],BI.each(e,function(e,t){t=i.customCell?(t&&(t.firstRowTopLine=y),t):{type:"bi.grid_table_cell",cell:t,firstRowTopLine:y};(e<o?m:g)[n].push(t)})}),this.topLeftGrid._populate(p),this.topRightGrid._populate(f),this.bottomLeftGrid._populate(m),this.bottomRightGrid._populate(g)}}),BI.shortcut("bi.quick_grid_table",BI.QuickGridTable)},function(e,t,n){"use strict";BI.GridTableScrollbar=BI.inherit(BI.Widget,{_const:{FACE_MARGIN:4,FACE_MARGIN_2:8,FACE_SIZE_MIN:30,KEYBOARD_SCROLL_AMOUNT:40},_defaultConfig:function(){return BI.extend(BI.GridTableScrollbar.superclass._defaultConfig.apply(this,arguments),{baseCls:"scrollbar-layout-main public-scrollbar-main",attributes:{tabIndex:0},contentSize:0,defaultPosition:0,isOpaque:!1,orientation:"vertical",position:0,size:0})},render:function(){this.options;this.focused=!1,this.isDragging=!1,this.face=BI.createWidget({type:"bi.layout",cls:"scrollbar-layout-face public-scrollbar-face "+(this._isHorizontal()?"scrollbar-layout-face-horizontal":"scrollbar-layout-face-vertical")}),this.contextLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.face,left:0,top:0}]})},mounted:function(){var t=this,e="horizontal"===this.options.orientation?this._onWheelX:this._onWheelY;this._wheelHandler=new BI.WheelHandler(BI.bind(e,this),BI.bind(this._shouldHandleX,this),BI.bind(this._shouldHandleY,this)),this._mouseMoveTracker=new BI.MouseMoveTracker(BI.bind(this._onMouseMove,this),BI.bind(this._onMouseMoveEnd,this),_global.document),this.element.on("mousedown",BI.bind(this._onMouseDown,this)),this.element.on("mousewheel",function(e){t._wheelHandler.onWheel(e.originalEvent)}),this.element.on("keydown",BI.bind(this._onKeyDown,this)),this.element.on("focus",function(){t.focused=!0,t._populate()}),this.element.on("blur",function(){t.focused=!1,t._populate()}),this._isHorizontal()?this.element.addClass("scrollbar-layout-main-horizontal"):this.element.addClass("scrollbar-layout-main-vertical"),this._populate()},_isHorizontal:function(){return"horizontal"===this.options.orientation},_getScale:function(){var e=this.options,t=e.size/e.contentSize;return t=e.size*t<this._const.FACE_SIZE_MIN?(e.size-this._const.FACE_SIZE_MIN)/(e.contentSize-e.size):t},_getFaceSize:function(){var e=this.options,t=e.size/e.contentSize,e=e.size*t;return e=e<this._const.FACE_SIZE_MIN?this._const.FACE_SIZE_MIN:e},_shouldHandleX:function(e){return"horizontal"===this.options.orientation&&this._shouldHandleChange(e)},_shouldHandleY:function(e){return"horizontal"!==this.options.orientation&&this._shouldHandleChange(e)},_shouldHandleChange:function(e){return this.options.position+e!==this.options.position},_onWheelY:function(e,t){this._onWheel(t)},_onWheelX:function(e,t){this._onWheel(e)},_onWheel:function(e){var t=this.options.contentSize-this.options.size;this.options.position+=e,this.options.position<0?this.options.position=0:this.options.position>t&&(this.options.position=t),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)},_onMouseDown:function(e){var t;e.target!==this.face.element[0]?(t=this._isHorizontal()?e.offsetX:e.offsetY,t/=this._getScale(),this.options.position=BI.clamp(t-.5*this._getFaceSize()/this._getScale(),0,this.options.contentSize-this.options.size),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)):this._mouseMoveTracker.captureMouseMoves(e);try{this.element[0].focus()}catch(e){}},_onMouseMove:function(e,t){e=this._isHorizontal()?e:t;e/=this._getScale(),this.options.position=BI.clamp(this.options.position+e,0,this.options.contentSize-this.options.size),this.isDragging=this._mouseMoveTracker.isDragging(),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)},_onMouseMoveEnd:function(e){this._mouseMoveTracker.releaseMouseMoves(),!0===this.isDragging&&(this.isDragging=!1,this._populate())},_onKeyDown:function(e){var t=9,n=32,i=33,r=34,o=36,a=37,s=38,l=39,c=40,u=e.keyCode;if(u!==t){var h=40,d=0;if(this._isHorizontal())switch(u){case o:d=-1,h=this.options.contentSize;break;case a:d=-1;break;case l:d=1;break;default:return}if(!this._isHorizontal())switch(u){case n:d=e.shiftKey?-1:1;break;case o:d=-1,h=this.options.contentSize;break;case s:d=-1;break;case c:d=1;break;case i:d=-1,h=this.options.size;break;case r:d=1,h=this.options.size;break;default:return}this.options.position=BI.clamp(this.options.position+h*d,0,this.options.contentSize-this.options.size),e.preventDefault(),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)}},_populate:function(){var e,t,n,i,r,o=this.options;o.size<1||o.contentSize<=o.size?this.setVisible(!1):(this.setVisible(!0),e=o.size,t=this._isHorizontal(),r=this.focused||this.isDragging,n=this._getFaceSize(),i=o.isOpaque,this.element[!0===i?"addClass":"removeClass"]("public-scrollbar-main-opaque"),this.element[!0===r?"addClass":"removeClass"]("public-scrollbar-main-active"),this.face.element[!0===r?"addClass":"removeClass"]("public-scrollbar-face-active"),i=o.position*this._getScale()+this._const.FACE_MARGIN,r=this.contextLayout.attr("items"),t?(this.setWidth(e),this.face.setWidth(n-this._const.FACE_MARGIN_2),r[0].left=i,r[0].top=0):(this.setHeight(e),this.face.setHeight(n-this._const.FACE_MARGIN_2),r[0].left=0,r[0].top=i),this.contextLayout.attr("items",r),this.contextLayout.resize())},setContentSize:function(e){this.options.contentSize=e},setPosition:function(e){this.options.position=e},setSize:function(e){this.options.size=e},populate:function(){this._populate()}}),BI.GridTableScrollbar.SIZE=10,BI.GridTableScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.grid_table_scrollbar",BI.GridTableScrollbar),BI.GridTableHorizontalScrollbar=BI.inherit(BI.Widget,{_const:{FACE_MARGIN:4,FACE_MARGIN_2:8,FACE_SIZE_MIN:30,KEYBOARD_SCROLL_AMOUNT:40},_defaultConfig:function(){return BI.extend(BI.GridTableHorizontalScrollbar.superclass._defaultConfig.apply(this,arguments),{attributes:{tabIndex:0},contentSize:0,position:0,size:0})},_init:function(){BI.GridTableHorizontalScrollbar.superclass._init.apply(this,arguments);var e=this,t=this.options;this.scrollbar=BI.createWidget({type:"bi.grid_table_scrollbar",orientation:"horizontal",isOpaque:!0,position:t.position,contentSize:t.contentSize,size:t.size}),this.scrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(){e.fireEvent(BI.GridTableHorizontalScrollbar.EVENT_SCROLL,arguments)}),BI.createWidget({type:"bi.absolute",cls:"horizontal-scrollbar",element:this,width:t.size,height:BI.GridTableScrollbar.SIZE,items:[{el:{type:"bi.absolute",scrollable:!1,height:BI.GridTableScrollbar.SIZE,items:[{el:this.scrollbar,left:0,top:0}]},top:0,left:0,right:0}]})},setContentSize:function(e){this.options.contentSize=e,this.scrollbar.setContentSize(e)},setPosition:function(e){this.options.position=e,this.scrollbar.setPosition(e)},setSize:function(e){this.setWidth(e),this.options.size=e,this.scrollbar.setSize(e)},populate:function(){this.scrollbar.populate();var e=this.options;e.size<1||e.contentSize<=e.size?this.setVisible(!1):this.setVisible(!0)}}),BI.GridTableHorizontalScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.grid_table_horizontal_scrollbar",BI.GridTableHorizontalScrollbar)},function(e,t,n){"use strict";var h,c;h=function h(e,t,n,i){for(var r=0,o=1,a=0,s=BI.Constants.getConstant("bi.constant.char.widths"),l=0,c=e.length;l<c;l++){var u=e.charCodeAt(l);if(13===u||10===u)r=0,o++;else if(n<(r+=a=32<=u&&u<=126?s[u]*t:t)&&(r=a,o++),o===i)break}return o},c=function c(e,t,n,i,r,o,a){var s=Math.ceil((a-r)/i),e=h(e||"",t,n,s);return Math.min(Math.max(e*i+r,o),a)},BI.AutoHeightGridTable=BI.inherit(BI.GridTable,{_defaultConfig:function(){return BI.extend(BI.AutoHeightGridTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-grid-table bi-grid-auto-height-table",isAutoHeight:!0,isHeaderAutoHeight:!0,fontSize:12,fontLineHeight:14,columnGaps:[],rowGap:1,headerFontSize:12,headerFontLineHeight:14,headerColumnGaps:[],headerRowGap:1,rowSize:0,headerRowSize:0,maxRowSize:400})},_getFreezeHeaderHeight:function(){var e=this.options;return e.isHeaderAutoHeight?!this.headerIntervalTree||(e=this.headerIntervalTree.sumUntil(e.header.length))>=this._height?0:e:BI.AutoHeightGridTable.superclass._getFreezeHeaderHeight.call(this)},_getActualItems:function(){var e=this.options;return e.isHeaderAutoHeight?this.headerIntervalTree&&this.headerIntervalTree.sumUntil(e.header.length)>=this._height?e.header.concat(e.items):e.items:BI.AutoHeightGridTable.superclass._getActualItems.call(this)},_getContentHeight:function(){var e,t=this.options;return t.isAutoHeight||t.isHeaderAutoHeight?t.isHeaderAutoHeight?t.isAutoHeight?this.headerIntervalTree?(e=this.headerIntervalTree.sumUntil(t.header.length))>=this._height?e+this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:0:(e=this.headerIntervalTree?this.headerIntervalTree.sumUntil(t.header.length):0)>=this._height?e+t.items.length*t.rowSize:t.items.length*t.rowSize:(e=this._getFreezeHeaderHeight())<=0?t.header.length*t.headerRowSize+(this.intervalTree?this.intervalTree.sumUntil(t.items.length):0):this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:BI.AutoHeightGridTable.superclass._getContentHeight.call(this)},_getHeaderContentHeight:function(){var e=this.options;return e.isHeaderAutoHeight?this.headerIntervalTree?this.headerIntervalTree.sumUntil(e.header.length):0:e.header.length*e.headerRowSize},_getOneRowHeight:function(e){for(var t=this.options,n=this.options.items[e],i=0,r=this._getFreezeColLength(),o=0,a=n.length;o<a;o++){var s=n[o],l=t.columnSize[o]-(t.columnGaps[o]||0)-((BI.isFunction(s.columnGap)?s.columnGap():s.columnGap)||0)-(0===o||o===r?2:1);if((i=Math.max(i,c(s.text,t.fontSize,l,t.fontLineHeight,t.rowGap,t.rowSize,t.maxRowSize)))>=t.maxRowSize)return t.maxRowSize}return i},_getOneHeaderRowHeight:function(e){for(var t=this.options,n=this.options.header[e],i=0,r=this._getFreezeColLength(),o=0,a=n.length;o<a;o++){var s=n[o],l=t.columnSize[o]-(t.columnGaps[o]||0)-((s.cell?BI.isFunction(s.cell.columnGap)?s.cell.columnGap():s.cell.columnGap:s.columnGap)||0)-(0===o||o===r?2:1);if((i=Math.max(i,c((s.cell||s).text,t.headerFontSize,l,t.headerFontLineHeight,t.headerRowGap,t.headerRowSize,t.maxRowSize)))>=t.maxRowSize)return t.maxRowSize}return i},_getActualRowHeights:function(){var n=this,e=this.options,t=this.options.items;return this.intervalTree=BI.PrefixIntervalTree.empty(e.items.length),BI.each(t,function(e,t){n.intervalTree.set(e,n._getOneRowHeight(e))}),this.intervalTree},_getActualHeaderRowHeights:function(){var n=this,e=this.options,t=this.options.header;return this.headerIntervalTree=BI.PrefixIntervalTree.empty(e.header.length),BI.each(t,function(e,t){n.headerIntervalTree.set(e,n._getOneHeaderRowHeight(e))}),this.headerIntervalTree},_headerRowHeightGetter:function(e){return this.options.isHeaderAutoHeight?this.headerIntervalTree?this.headerIntervalTree.get(e):this.options.headerRowSize:BI.AutoHeightGridTable.superclass._headerRowHeightGetter.call(this,e)},_rowHeightGetter:function(e){return this.options.isAutoHeight?this.intervalTree?this.intervalTree.get(e):this.options.rowSize:BI.AutoHeightGridTable.superclass._rowHeightGetter.call(this,e)},_digest:function(){var n=this.options;if(!n.isAutoHeight&&!n.isHeaderAutoHeight)return BI.AutoHeightGridTable.superclass._digest.call(this);n.isHeaderAutoHeight&&this._getActualHeaderRowHeights(),n.isAutoHeight&&this._getActualRowHeights();var e=this._getFreezeColLength(),i=0,r=0,t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?i+=t:r+=t,e,0}),0<n.items.length?this._getContentHeight()/n.items.length:0),o=this._getHeaderContentHeight()/n.header.length;this.topLeftGrid.setEstimatedColumnSize(0<e?i/e:0),this.topLeftGrid.setEstimatedRowSize(o),this.topRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?r/(n.columnSize.length-e):0),this.topRightGrid.setEstimatedRowSize(o),this.bottomLeftGrid.setEstimatedColumnSize(0<e?i/e:0),this.bottomLeftGrid.setEstimatedRowSize(t),this.bottomRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?r/(n.columnSize.length-e):0),this.bottomRightGrid.setEstimatedRowSize(t),this.topLeftGrid.setColumnCount(e),this.topRightGrid.setColumnCount(n.columnSize.length-e),this.bottomLeftGrid.setColumnCount(e),this.bottomRightGrid.setColumnCount(n.columnSize.length-e)},getFirstColumnHeaderRowSize:function(){var t=this,e=this.options;return e.isHeaderAutoHeight?(e=e.header,BI.map(e,function(e){return t.headerIntervalTree&&t.headerIntervalTree.get(e)})):BI.AutoHeightGridTable.superclass.getFirstColumnHeaderRowSize.call(this)},getFirstColumnRowSize:function(){var t=this,e=this.options;return e.isAutoHeight?(e=e.items,BI.map(e,function(e){return t.intervalTree&&t.intervalTree.get(e)})):BI.AutoHeightGridTable.superclass.getFirstColumnRowSize.call(this)}}),BI.shortcut("bi.grid_auto_height_table",BI.AutoHeightGridTable)},function(e,t,n){"use strict";BI.TableHeaderCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.TableHeaderCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table-header-cell",text:""})},_init:function(){BI.TableHeaderCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,textAlign:e.textAlign||"center",height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.table_header_cell",BI.TableHeaderCell)},function(e,t,n){"use strict";BI.Table=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.Table.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table",logic:{dynamic:!1},isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:function(e,t){return BI.isEqual(e,t)},columnSize:[],headerRowSize:25,footerRowSize:25,rowSize:25,bordered:!0,stripe:!1,hover:!1,regionColumnSize:!1,header:[],footer:!1,items:[],el:{type:"bi.vertical_fill"}})},_calculateWidth:function(e){return e&&"0"!==e?1.01<(e=(e=BI.parseFloat(e))<0?0:e)?e:100*e+"%":""},_calculateHeight:function(e){return e||""},_isColumnSizeValid:function(e,n){return!BI.some(e,function(e,t){return!(n&&!n.includes(e))&&(!t||!BI.isNumeric(t)||void 0)})},_isRightFreeze:function(){return BI.isNotEmptyArray(this.options.freezeCols)&&0!==BI.first(this.options.freezeCols)},_createTopLeft:function(){var n,i,r=this.options,e=this._isRightFreeze(),t=(this.topLeftColGroupTds={},this.topLeftBodyTds={},this.topLeftBodyItems={},this._table()),o=this._createColGroup(this.columnLeft,this.topLeftColGroupTds),a=this.topLeftBody=this._body();return a.element.append(this._createHeaderCells(this.topLeftItems,this.columnLeft,this.mergeLeft,this.topLeftBodyTds,this.topLeftBodyItems)),this.topLeftContainer=BI.createWidget({type:"bi.default",element:t,width:this._calculateWidth(n),items:[o,a]}),e&&(i=!(n=0),BI.each(r.columnSize,function(e,t){BI.isNumeric(t)||(i=!1),r.freezeCols.includes(e)||(n+=t)}),i)&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n)),this.topLeftContainer},_createTopRight:function(){var n,i,r=this.options,e=this._isRightFreeze(),t=(this.topRightColGroupTds={},this.topRightBodyTds={},this.topRightBodyItems={},this._table()),o=this._createColGroup(this.columnRight,this.topRightColGroupTds),a=this.topRightBody=this._body();return a.element.append(this._createHeaderCells(this.topRightItems,this.columnRight,this.mergeRight,this.topRightBodyTds,this.topRightBodyItems,this.columnLeft.length)),this.topRightContainer=BI.createWidget({type:"bi.default",width:this._calculateWidth(n),element:t,items:[o,a]}),e||(i=!(n=0),BI.each(r.columnSize,function(e,t){BI.isNumeric(t)||(i=!1),r.freezeCols.includes(e)||(n+=t)}),i&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n))),this.topRightContainer},_createBottomLeft:function(){var n,i,r=this.options,e=this._isRightFreeze(),t=(this.bottomLeftColGroupTds={},this.bottomLeftBodyTds={},this.bottomLeftBodyItems={},this._table()),o=this._createColGroup(this.columnLeft,this.bottomLeftColGroupTds),a=this._createBottomLeftBody();return this.bottomLeftContainer=BI.createWidget({type:"bi.default",width:this._calculateWidth(n),element:t,items:[o,a]}),e&&(i=!(n=0),BI.each(r.columnSize,function(e,t){BI.isNumeric(t)||(i=!1),r.freezeCols.includes(e)||(n+=t)}),i)&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n)),this.bottomLeftContainer},_createBottomLeftBody:function(){var e=this.bottomLeftBody=this._body();return e.element.append(this._createCells(this.bottomLeftItems,this.columnLeft,this.mergeLeft,this.bottomLeftBodyTds,this.bottomLeftBodyItems)),e},_createBottomRight:function(){var n,i,r=this.options,e=this._isRightFreeze(),t=(this.bottomRightColGroupTds={},this.bottomRightBodyTds={},this.bottomRightBodyItems={},this._table()),o=this._createColGroup(this.columnRight,this.bottomRightColGroupTds),a=this._createBottomRightBody();return this.bottomRightContainer=BI.createWidget({type:"bi.default",element:t,items:[o,a]}),e||(i=!(n=0),BI.each(r.columnSize,function(e,t){BI.isNumeric(t)||(i=!1),r.freezeCols.includes(e)||(n+=t)}),i&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n))),this.bottomRightContainer},_createBottomRightBody:function(){var e=this.bottomRightBody=this._body();return e.element.append(this._createCells(this.bottomRightItems,this.columnRight,this.mergeRight,this.bottomRightBodyTds,this.bottomRightBodyItems,this.columnLeft.length)),e},_createFreezeTable:function(){var n=this,i=this.options,r=this._isRightFreeze(),e=this._split(i.header),e=(this.topLeftItems=e.left,this.topRightItems=e.right,e=this._split(i.items),this.bottomLeftItems=e.left,this.bottomRightItems=e.right,this.columnLeft=[],this.columnRight=[],BI.each(i.columnSize,function(e,t){(i.freezeCols.includes(e)?n[r?"columnRight":"columnLeft"]:n[r?"columnLeft":"columnRight"]).push(t)}),this.mergeLeft=[],this.mergeRight=[],BI.each(i.mergeCols,function(e,t){(i.freezeCols.includes(t)?n[r?"mergeRight":"mergeLeft"]:n[r?"mergeLeft":"mergeRight"]).push(t)}),this._createTopLeft()),t=this._createTopRight(),o=this._createBottomLeft(),a=this._createBottomRight(),e=(this.scrollTopLeft=BI.createWidget({type:"bi.adaptive",cls:"scroll-top-left",width:"100%",height:"100%",scrollable:!1,items:[e]}),this.scrollTopRight=BI.createWidget({type:"bi.adaptive",cls:"scroll-top-right",width:"100%",height:"100%",scrollable:!1,items:[t]}),this.scrollBottomLeft=BI.createWidget({type:"bi.adaptive",cls:"scroll-bottom-left",width:"100%",height:"100%",scrollable:r||null,scrollx:!r,items:[o]}),this.scrollBottomRight=BI.createWidget({type:"bi.adaptive",cls:"scroll-bottom-right",width:"100%",height:"100%",scrollable:!r||null,scrollx:r,items:[a]}),this.topLeft=BI.createWidget({type:"bi.adaptive",cls:"top-left",scrollable:!1,items:[this.scrollTopLeft]}),this.topRight=BI.createWidget({type:"bi.adaptive",cls:"top-right",scrollable:!1,items:[this.scrollTopRight]}),this.bottomLeft=BI.createWidget({type:"bi.adaptive",cls:"bottom-left",scrollable:!1,items:[this.scrollBottomLeft]}),this.bottomRight=BI.createWidget({type:"bi.adaptive",cls:"bottom-right",scrollable:!1,items:[this.scrollBottomRight]}),i.header.length,i.headerRowSize||i.rowSize,BI.sum(i.freezeCols,function(e,t){return i.columnSize[t]})),t=(this._resize=function(){n.scrollBottomLeft.element.is(":visible")&&(n.scrollBottomLeft.element.css({"overflow-x":"auto"}),n.scrollBottomRight.element.css({"overflow-x":"auto"}),(r?n.scrollBottomLeft:n.scrollBottomRight).element.css({"overflow-y":"auto"}),(n.scrollBottomLeft.element.hasHorizonScroll()||n.scrollBottomRight.element.hasHorizonScroll())&&(n.scrollBottomLeft.element.css("overflow-x","scroll"),n.scrollBottomRight.element.css("overflow-x","scroll")),n.scrollBottomLeft.element.hasVerticalScroll()?n.scrollTopLeft.element.css("overflow-y","scroll"):n.scrollTopLeft.element.css("overflow-y","hidden"),n.scrollTopLeft.element[0].scrollLeft=n.scrollBottomLeft.element[0].scrollLeft,n.scrollBottomLeft.element[0].scrollTop=n.scrollBottomRight.element[0].scrollTop),n.scrollBottomRight.element.hasVerticalScroll()?n.scrollTopRight.element.css("overflow-y","scroll"):n.scrollTopRight.element.css("overflow-y","hidden"),n.scrollTopRight.element[0].scrollLeft=n.scrollBottomRight.element[0].scrollLeft},i.regionColumnSize&&i.regionColumnSize.concat(["fill"]));0===i.freezeCols.length?(t=["fill","fill"],r?(this.topRight=null,this.bottomRight=null):(this.topLeft=null,this.bottomLeft=null)):i.freezeCols.length>=i.columnSize.length&&(t=["fill","fill"],r?(this.topLeft=null,this.bottomLeft=null):(this.topRight=null,this.bottomRight=null)),BI.createWidget(i.el,{element:this,cls:"".concat(i.bordered?"bordered":""," ").concat(i.stripe?"stripe":""," ").concat(i.hover?"hover":""),rowSize:["","fill"],items:[{type:"bi.horizontal_fill",columnSize:t||(r?["fill",e]:[e,"fill"]),items:[this.topLeft,this.topRight]},{type:"bi.horizontal_fill",columnSize:t||(r?["fill",e]:[e,"fill"]),items:[this.bottomLeft,this.bottomRight]}]}),this._initFreezeScroll(),BI.ResizeDetector.addResizeListener(this,function(){n._resize(),n.fireEvent(BI.Table.EVENT_TABLE_RESIZE)})},mounted:function(){this._resize&&this._resize(),BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]}),this.fireEvent(BI.Table.EVENT_TABLE_AFTER_INIT)},_initFreezeScroll:function(){var r=this;this.options;function e(t,n,i){t.scroll(function(e){null!=i&&i.scrollTop(t.scrollTop()),n.scrollLeft(t.scrollLeft()),r.fireEvent(BI.Table.EVENT_TABLE_SCROLL)})}e(this.scrollBottomRight.element,this.scrollTopRight.element,this.scrollBottomLeft.element),e(this.scrollBottomLeft.element,this.scrollTopLeft.element)},resize:function(){this._resize&&this._resize()},_createCells:function(e,i,u,h,d,p,t,n){var f=this,m=this.options,g={},y={},b={},v={},x={},I=(i=i||m.columnSize,u=u||m.mergeCols,h=h||{},d=d||{},p=p||0,t=t||m.rowSize,document.createDocumentFragment());return BI.each(e,function(r,o){var a=BI.$("<tr>").addClass(0==(1&r)?"odd":"even").height(t);function s(e,t){var n=1+(0|(g[t].attr("rowspan")||1));g[t].attr("rowspan",n),BI.pushDistinct(g[t].__mergeRows,e),h[e][t]=g[t],d[e][t]=v[t]}function l(e,t){i[t];var n=1+(0|(y[e].attr("colspan")||1));y[e].attr("colspan",n),BI.pushDistinct(y[e].__mergeCols,t),h[e][t]=y[e],d[e][t]=b[e]}function c(e,t){var n=BI.$("<td>").css({position:"relative"}).addClass(0==(1&t)?"odd-col":"even-col").addClass(0===e?"first-row":"").addClass(0===t?"first-col":"").addClass(t===o.length-1?"last-col":""),i=BI.createWidget(x[e][t],{type:"bi.table_cell",_row:e,_col:t+p});f.addWidget(i.getName(),i),i._mount(),n.append(i.element),a.append(n),g[t]=n,g[t].__mergeRows=[e],v[t]=i,y[e]=n,y[e].__mergeCols=[t],b[e]=i,h[e][t]=n,d[e][t]=i}BI.each(o,function(e,t){var n,i;x[r]||(x[r]={}),h[r]||(h[r]={}),d[r]||(d[r]={}),x[r][e]=t,m.isNeedMerge&&u.includes(e)?0===r&&0===e?c(0,0):0===e&&0<r?!0===(n=m.mergeRule(x[r][e],x[r-1][e]))?(s(r,e),y[r]=g[e],b[r]=v[e]):c(r,e):0===r&&0<e?!0===(i=m.mergeRule(x[r][e],x[r][e-1]))?(l(r,e),g[e]=y[r],v[e]=b[r]):c(r,e):(n=m.mergeRule(x[r][e],x[r-1][e]),(i=m.mergeRule(x[r][e],x[r][e-1]))&&n||(i&&l(r,e),n&&s(r,e),i)||n||c(r,e)):c(r,e)}),I.appendChild(a[0])}),I},_createColGroupCells:function(e,n){var i=this,t=this.options,r=(e=e||t.columnSize,n=n||{},document.createDocumentFragment());return BI.each(e,function(e,t){t=i._calculateWidth(t),t=BI.$("<col>").css("width",t);n[e]=t,r.appendChild(t[0])}),r},_createHeaderCells:function(e,t,n,i,r,o){var a=this.options;return o=o||0,this._createCells(e,t,BI.range(a.columnSize.length),i,r,o,a.headerRowSize||a.rowSize,!0)},_createFooterCells:function(e,t,n,i){this.options;return this._createCells(e,t,[],n,i,0)},_createColGroup:function(e,t,n){this.options;return this.colgroup=this._colgroup(),this.colgroup.element.append(this._createColGroupCells(e,t,n)),this.colgroup},_createHeader:function(){var e=this.options;if(!1!==e.header)return this.header=this._header(),this.header.element.append(this._createHeaderCells(e.header,null,null,this.headerTds,this.headerItems)),this.header},_createFooter:function(e,t,n){var i=this.options;if(!1!==i.footer)return this.footer=this._footer(),this.footer.element.append(this._createFooterCells(i.footer,null,this.footerTds,this.footerItems)),this.footer},_createBody:function(){var e=this.options;return this.body=this._body(),this.body.element.append(this._createCells(e.items,null,null,this.bodyTds,this.bodyItems)),this.body},_createNormalTable:function(){var e=this.options,t=this._table(),n=(this.colgroupTds={},this.headerTds={},this.footerTds={},this.bodyTds={},this.headerItems={},this.footerItems={},this.bodyItems={},this._createColGroup(null,this.colgroupTds)),i=this._createHeader(),r=this._createFooter(),o=this._createBody();this.tableContainer=BI.createWidget({type:"bi.default",element:t,width:this._calculateWidth(void 0),items:[n,i,r,o]}),this._isColumnSizeValid(e.columnSize)&&(t=BI.sum(e.columnSize)||undefined,t=this._calculateWidth(t)),this.scrollBottomRight=BI.createWidget({type:"bi.adaptive",width:"100%",height:"100%",cls:"scroll-bottom-right",scrollable:!0,items:[this.tableContainer]}),BI.createWidget({type:"bi.adaptive",cls:"".concat(e.bordered?"bordered":""," ").concat(e.stripe?"stripe":"",' "bottom-right"'),element:this,scrollable:!1,items:[this.scrollBottomRight]}),this._initNormalScroll()},_initNormalScroll:function(){var t=this;this.scrollBottomRight.element.scroll(function(e){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL)})},_split:function(e){var i=this.options,r=[],o=[],a=this._isRightFreeze();return BI.each(e,function(n,e){r.push([]),o.push([]),BI.each(e,function(e,t){(i.freezeCols.includes(e)?a?o:r:a?r:o)[n].push(t)})}),{left:r,right:o}},_table:function(){return BI.createWidget({type:"bi.layout",tagName:"table",cls:"table-view-table",attribute:{cellspacing:0,cellpadding:0}})},_header:function(){return BI.createWidget({type:"bi.layout",cls:"table-view-header",tagName:"thead"})},_footer:function(){return BI.createWidget({type:"bi.layout",cls:"table-view-footer",tagName:"tfoot"})},_body:function(){return BI.createWidget({type:"bi.layout",tagName:"tbody",cls:"table-view-body"})},_colgroup:function(){return BI.createWidget({type:"bi.layout",tagName:"colgroup"})},render:function(){(0<this.options.items.length||0<this.options.header.length)&&this.populate(this.options.items)},setColumnSize:function(e){var n,r,o,a,s,l,c,i,u,h,d,p=this,f=this.options,m=this._isRightFreeze();f.columnSize=e||[],f.isNeedFreeze?(n=[],r=[],BI.each(f.columnSize,function(e,t){(f.freezeCols.includes(e)?m?r:n:m?n:r).push(t)}),a=1,s=2,l=3,(c=function c(e){var t,i;switch(e){case o:t=p.topLeftColGroupTds,p.topLeftBodyTds,p.topLeftBodyItems,i=n;break;case a:t=p.topRightColGroupTds,p.topRightBodyTds,p.topRightBodyItems,i=r;break;case s:t=p.bottomLeftColGroupTds,p.bottomLeftBodyTds,p.bottomLeftBodyItems,i=n;break;case l:t=p.bottomRightColGroupTds,p.bottomRightBodyTds,p.bottomRightBodyItems,i=r}BI.each(t,function(e,t){var n=0|t.attr("width");""!==i[e]&&n!==i[e]&&(n=p._calculateWidth(i[e]),t.attr("width",n).css("width",n))})})(o=0),c(a),c(s),c(l),d=h=!(u=i=0),this.columnLeft=[],this.columnRight=[],BI.each(f.columnSize,function(e,t){(f.freezeCols.includes(e)?(BI.isNumeric(t)||(m?d=!1:h=!1),i+=t,p[m?"columnRight":"columnLeft"]):(BI.isNumeric(t)||(m?h=!1:d=!1),u+=t,p[m?"columnLeft":"columnRight"])).push(t)}),h&&(i=this._calculateWidth(i),BI.isNumeric(i))&&(i=BI.parseFloat(i)),d&&(u=this._calculateWidth(u),BI.isNumeric(u))&&(u=BI.parseFloat(u)),h||d&&m?(this.topLeftContainer.element.width(m?u:i),this.bottomLeftContainer.element.width(m?u:i)):(this.topLeftContainer.element.width(""),this.bottomLeftContainer.element.width("")),d||h&&m?(this.topRightContainer.element.width(m?i:u),this.bottomRightContainer.element.width(m?i:u)):(this.topRightContainer.element.width(""),this.bottomRightContainer.element.width("")),this.scrollTopLeft.element[0].scrollLeft=this.scrollBottomLeft.element[0].scrollLeft,this.scrollTopRight.element[0].scrollLeft=this.scrollBottomRight.element[0].scrollLeft):(BI.each(this.colgroupTds,function(e,t){var n=0|t.attr("width");""!==f.columnSize[e]&&n!==f.columnSize[e]&&(n=p._calculateWidth(f.columnSize[e]),t.attr("width",n).css("width",n))}),this._isColumnSizeValid(f.columnSize)?1.05<(e=this._calculateWidth(BI.sum(f.columnSize)))&&this.tableContainer.element.width(e):this.tableContainer.element.width(""))},getColumnSize:function(){return this.options.columnSize},getCalculateColumnSize:function(){var e=this.options,n=[];if(!0===e.isNeedFreeze){if(0<BI.size(this.bottomLeftBodyTds)||0<BI.size(this.bottomRightBodyTds))return BI.any(this.bottomLeftBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.bottomLeftBodyTds[0],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),BI.any(this.bottomRightBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.bottomRightBodyTds[0],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),n;BI.any(this.topLeftBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.topLeftBodyTds[BI.size(this.topLeftBodyTds)-1],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),BI.any(this.topRightBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.topRightBodyTds[BI.size(this.topRightBodyTds)-1],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)})}else BI.each(this.headerTds[BI.size(this.headerTds)-1],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)});return n},setHeaderColumnSize:function(n){var i,r,o,a,s,l,c,e,u=this,h=this.options,d=this._isRightFreeze();h.isNeedFreeze?(i=[],r=[],BI.each(n,function(e,t){(h.freezeCols.includes(e)?d?r:i:d?i:r).push(t)}),a=1,(s=function s(e){var t,n;switch(e){case o:t=u.topLeftColGroupTds,u.topLeftBodyTds,u.topLeftBodyItems,n=i;break;case a:t=u.topRightColGroupTds,u.topRightBodyTds,u.topRightBodyItems,n=r}BI.each(t,function(e,t){(0|t.attr("width"))!==n[e]&&(e=u._calculateWidth(n[e]),t.attr("width",e).css("width",e))})})(o=0),s(a),c=l=0,BI.each(n,function(e,t){h.freezeCols.includes(e)?l+=t:c+=t}),l=this._calculateWidth(l),c=this._calculateWidth(c),BI.isNumeric(l)&&(l=BI.parseFloat(l)),BI.isNumeric(c)&&(c=BI.parseFloat(c)),this.topLeftContainer.element.width(d?c:l),this.topRightContainer.element.width(d?l:c),this.scrollTopLeft.element[0].scrollLeft=this.scrollBottomLeft.element[0].scrollLeft,this.scrollTopRight.element[0].scrollLeft=this.scrollBottomRight.element[0].scrollLeft):(BI.each(this.colgroupTds,function(e,t){(0|t.attr("width"))!==n[e]&&(e=u._calculateWidth(n[e]),t.attr("width",e).css("width",e))}),e=this._calculateWidth(BI.sum(n)),this.tableContainer.element.width(e))},setRegionColumnSize:function(e){var t=this.options;t.regionColumnSize=e,0!==t.freezeCols.length&&0<t.freezeCols.length&&t.freezeCols.length<t.columnSize.length?t.isNeedFreeze&&(this.topLeft.element.css("width",e),this.bottomLeft.element.css("width",e)):t.isNeedFreeze},getRegionColumnSize:function(){return this.options.regionColumnSize},getCalculateRegionColumnSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element.width(),this.scrollBottomRight.element.width()]:[this.scrollBottomRight.element.width()]},getCalculateRegionRowSize:function(){return this.options.isNeedFreeze?[this.scrollTopRight.element.height(),this.scrollBottomRight.element.height()]:[this.scrollBottomRight.element.height()]},getClientRegionColumnSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element[0].clientWidth,this.scrollBottomRight.element[0].clientWidth]:[this.scrollBottomRight.element[0].clientWidth]},getClientRegionRowSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element[0].clientHeight,this.scrollBottomRight.element[0].clientHeight]:[this.scrollBottomRight.element[0].clientHeight]},getScrollRegionColumnSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element[0].scrollWidth,this.scrollBottomRight.element[0].scrollWidth]:[this.scrollBottomRight.element[0].scrollWidth]},getScrollRegionRowSize:function(){var e=this.options;return e.isNeedFreeze?e.freezeCols.length<e.columnSize.length?[this.scrollTopRight.element[0].scrollHeight,this.scrollBottomRight.element[0].scrollHeight]:[this.scrollTopLeft.element[0].scrollHeight,this.scrollBottomLeft.element[0].scrollHeight]:[this.scrollBottomRight.element[0].scrollHeight]},hasVerticalScroll:function(){return this.options.isNeedFreeze?this.scrollBottomRight.element.hasVerticalScroll()||this.scrollBottomLeft.element.hasVerticalScroll():this.scrollBottomRight.element.hasVerticalScroll()},setVerticalScroll:function(e){this.options.isNeedFreeze?(this.scrollBottomRight.element[0].scrollTop!==e&&(this.scrollBottomRight.element[0].scrollTop=e),this.scrollBottomLeft.element[0].scrollTop!==e&&(this.scrollBottomLeft.element[0].scrollTop=e)):this.scrollBottomRight.element[0].scrollTop!==e&&(this.scrollBottomRight.element[0].scrollTop=e)},setLeftHorizontalScroll:function(e){this.options.isNeedFreeze?(this.scrollBottomLeft.element[0].scrollLeft!==e&&(this.scrollBottomLeft.element[0].scrollLeft=e),this.scrollTopLeft.element[0].scrollLeft!==e&&(this.scrollTopLeft.element[0].scrollLeft=e)):this.scrollBottomRight.element[0].scrollLeft!==e&&(this.scrollBottomRight.element[0].scrollLeft=e)},setRightHorizontalScroll:function(e){this.options.isNeedFreeze?(this.scrollBottomRight.element[0].scrollLeft!==e&&(this.scrollBottomRight.element[0].scrollLeft=e),this.scrollTopRight.element[0].scrollLeft!==e&&(this.scrollTopRight.element[0].scrollLeft=e)):this.scrollBottomRight.element[0].scrollLeft!==e&&(this.scrollBottomRight.element[0].scrollLeft=e)},getVerticalScroll:function(){return this.options.isNeedFreeze?this.scrollBottomRight.element[0].scrollTop||this.scrollBottomLeft.element[0].scrollTop:this.scrollBottomRight.element[0].scrollTop},getLeftHorizontalScroll:function(){return(this.options.isNeedFreeze?this.scrollBottomLeft:this.scrollBottomRight).element[0].scrollLeft},getRightHorizontalScroll:function(){return this.options.isNeedFreeze,this.scrollBottomRight.element[0].scrollLeft},getColumns:function(){return this.options.isNeedFreeze?{topLeft:this.topLeftBodyItems,topRight:this.topRightBodyItems,bottomLeft:this.bottomLeftBodyItems,bottomRight:this.bottomRightBodyItems}:{header:this.headerItems,body:this.bodyItems,footer:this.footerItems}},populate:function(e,t){e&&(this.options.items=e||[],t&&(this.options.header=t),this.empty(),this.options.isNeedFreeze?this._createFreezeTable():this._createNormalTable())}}),BI.Table.EVENT_TABLE_AFTER_INIT="EVENT_TABLE_AFTER_INIT",BI.Table.EVENT_TABLE_RESIZE="EVENT_TABLE_RESIZE",BI.Table.EVENT_TABLE_SCROLL="EVENT_TABLE_SCROLL",BI.Table.EVENT_TABLE_BEFORE_COLUMN_RESIZE="EVENT_TABLE_BEFORE_COLUMN_RESIZE",BI.Table.EVENT_TABLE_COLUMN_RESIZE="EVENT_TABLE_COLUMN_RESIZE",BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE="EVENT_TABLE_AFTER_COLUMN_RESIZE",BI.Table.EVENT_TABLE_BEFORE_REGION_RESIZE="EVENT_TABLE_BEFORE_REGION_RESIZE",BI.Table.EVENT_TABLE_REGION_RESIZE="EVENT_TABLE_REGION_RESIZE",BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE="EVENT_TABLE_AFTER_REGION_RESIZE",BI.shortcut("bi.table_view",BI.Table)},function(e,t,n){"use strict";BI.ResizableTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.ResizableTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-resizable-table-cell",cell:{},minSize:30,maxSize:Number.MAX_VALUE,start:BI.emptyFn,resize:BI.emptyFn,stop:BI.emptyFn,_rowIndex:null,_columnIndex:null,_left:0,_top:0,firstRowTopLine:!0,firstColumnLeftLine:!0})},render:function(){var e=this.options;return this.cell=BI.createWidget(BI.extend({type:"bi.label"},e.cell,{width:e.width,height:e.height,_rowIndex:e._rowIndex,_columnIndex:e._columnIndex,_left:e._left,_top:e._top,firstRowTopLine:e.firstRowTopLine,firstColumnLeftLine:e.firstColumnLeftLine})),this.handler=BI.createWidget({type:"bi.absolute",cls:"resizable-table-cell-resizer-container",width:6,items:[{el:{type:"bi.layout",cls:"resizable-table-cell-resizer-knob",width:4},right:0,top:0,bottom:0}]}),[{type:"bi.vertical_adapt",columnSize:["fill"],items:[this.cell]},{type:"bi.absolute",items:[{el:this.handler,right:0,top:0,bottom:0}]}]},mounted:function(){var n=this,i=this.options,r=!1,o=0,a=0,s=i.width;function l(e){return BI.clamp(e,i.minSize,i.maxSize||Number.MAX_VALUE)}var c=new BI.MouseMoveTracker(function(e,t){c.isDragging()&&(r=!0,o=l(s+(a+=e)),n.handler.element.addClass("dragging"),i.resize(o,n))},function(){!0===r&&(o=l(o),i.stop(o),a=o=0,s=i.width||n.element.width(),r=!1),n.handler.element.removeClass("dragging"),n.handler.element.removeClass("suitable"),c.releaseMouseMoves()},_global.document);this.handler.element.on("mousedown",function(e){l(s=i.width||n.element.width()),c.captureMouseMoves(e)})},setWidth:function(e){BI.ResizableTableCell.superclass.setWidth.apply(this,arguments);var t=this.options;this.cell.setWidth(t.width)},setHeight:function(e){BI.ResizableTableCell.superclass.setHeight.apply(this,arguments);var t=this.options;this.cell.setHeight(t.height)}}),BI.shortcut("bi.resizable_table_cell",BI.ResizableTableCell)},function(e,t,n){"use strict";BI.ResizableTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-resizable-table",el:{type:"bi.grid_table"},isNeedFreeze:!1,isNeedResize:!0,headerRowSize:25,rowSize:25,isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],header:[],items:[],regionColumnSize:[]},render:function(){var t=this,n=this.options;return[BI.extend({type:"bi.grid_table",width:n.width,height:n.height,headerRowSize:n.headerRowSize,rowSize:n.rowSize,columnSize:n.columnSize,isNeedFreeze:n.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:BI.bind(this._mergeRule,this),header:this._formatHeader(n.header),items:n.items,regionColumnSize:n.regionColumnSize,listeners:[{eventName:BI.Table.EVENT_TABLE_SCROLL,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}}]},n.el,{ref:function(e){t.table=e,n.el.ref&&n.el.ref.call(this,e)}}),{type:"bi.absolute",items:[{el:this._createResizerHandler(),left:0,top:0,bottom:0},{el:{type:"bi.layout",cls:"resizable-table-resizer",invisible:!0,width:2,ref:function(e){t.resizer=e}},left:0,top:0}]}]},mounted:function(){var n=this,i=this.options,r=0,o=0,a=0,s=!1,l=(this._populate(),new BI.MouseMoveTracker(function(e,t){l.isDragging()&&(s=!0,o+=e,r=BI.clamp(a+o,30,i.width-40),n.regionResizerHandler.element.addClass("dragging"),n._setRegionResizerHandlerPosition(r-3,0))},function(){!0===s&&(i.regionColumnSize[0]=BI.clamp(r,30,(i.width||n.element.width())-40),n.table.setRegionColumnSize(i.regionColumnSize),n._populate(),n.regionResizerHandler.element.removeClass("dragging"),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE),s=!1),l.releaseMouseMoves()},_global.document));this.regionResizerHandler.element.on("mousedown",function(e){a=r=n._getRegionSize(),o=0,n._setResizerPosition(0,0),l.captureMouseMoves(e)})},_mergeRule:function(e,t){var n=this.options;return"bi.resizable_table_cell"===e.type&&(e=e.cell),"bi.resizable_table_cell"===t.type&&(t=t.cell),n.mergeRule(e,t)},_createResizerHandler:function(){var t=this;return{type:"bi.absolute",cls:"resizable-table-region-resizer",invisible:!0,width:6,items:[{el:{type:"bi.layout",width:2,cls:"resizable-table-region-resizer-knob"},left:2,top:0,bottom:0}],ref:function(e){t.regionResizerHandler=e}}},_setResizerPosition:function(e,t){this.resizer.element.css({left:e+"px",top:t+"px"})},_setRegionResizerHandlerPosition:function(e,t){this.regionResizerHandler.element.css({left:e+"px",top:t+"px"})},_getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},_getHeaderHeight:function(){var e=this.options,t=this.table.getFirstColumnHeaderRowSize&&this.table.getFirstColumnHeaderRowSize();return t?BI.sum(t):e.headerRowSize*e.header.length},_getItemsHeight:function(){var e=this.options;return this.table.getFirstColumnRowSize?BI.sum(this.table.getFirstColumnRowSize()):e.items.length*e.rowSize},_getRegionRowSize:function(){var e=this.options,t=this._getHeaderHeight(),n=this._getItemsHeight();return[t,Math.min((e.height||this.element.height())-t,n)]},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeColumnSize:function(){for(var e=this.options.columnSize,t=0,n=0,i=this._getFreezeColLength();n<i;n++)t+=e[n];return t},_getResizerLeft:function(e,t){var n=this.element.offset().left;return t.element.offset().left-n},_formatHeader:function(t){var c=this,u=this.options,r=[],o=function o(e,t,n){c.resizer.setVisible(!0);var i=c._getRegionRowSize(),i=i[0]+i[1];c.resizer.setHeight(i),c._setResizerPosition(c._getResizerLeft(e,n)+t,0)},h=function h(i,e){c.resizer.setVisible(!1);var r=u.columnSize.slice(),o=(r[i]=e,c._getFreezeColLength()),a=c._getRegionSize(),e=(u.width||c.element.width())-BI.GridTableScrollbar.SIZE-a,s=0,l=0;i<o?0<(l=a-BI.sum(r.slice(0,o)))&&(i===o-1?(s=BI.sum(r.slice(i+1)),BI.each(r,function(e,t){i<e&&(r[e]=Math.floor(t+l*t/s))}),a-=l):(s=BI.sum(r.slice(i+1,o)),BI.each(r,function(e,t){i<e&&e<o&&(r[e]=Math.floor(t+l*t/s))}))):0<(l=e-BI.sum(r.slice(o)))&&(i===BI.size(r)-1?(s=BI.sum(r.slice(0,BI.size(r)-1)),BI.each(r,function(e,t){var n=Math.floor(l*t/s);e<i&&(r[e]=t+n,e<o)&&(a+=n)})):(s=BI.sum(r.slice(i+1)),BI.each(r,function(e,t){i<e&&(r[e]=Math.floor(t+l*t/s))}))),u.columnSize=r,c.setColumnSize(r),c.setRegionColumnSize([a]),c._populate(),c.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,i)};return BI.each(t,function(i,e){i===t.length-1?(r[i]=[],BI.each(e,function(e,t){if(r[i][e]={type:"bi.resizable_table_cell",cell:t,suitableSize:u.minColumnSize[e],maxSize:u.maxColumnSize[e],resize:BI.bind(o,null,e),stop:BI.bind(h,null,e)},u.isNeedMerge)for(var n=i;0<n&&c._mergeRule(r[n][e],r[n-1][e]);)r[n-1][e]={type:"bi.resizable_table_cell",cell:r[n-1][e],suitableSize:u.minColumnSize[e],maxSize:u.maxColumnSize[e],resize:BI.bind(o,null,e),stop:BI.bind(h,null,e)},n--})):r.push(e)}),r},_populate:function(){this.options;var e=this._getRegionSize();0<e?(this.regionResizerHandler.setVisible(!0),this._setRegionResizerHandlerPosition(e-3,this._getHeaderHeight())):this.regionResizerHandler.setVisible(!1)},setWidth:function(e){BI.ResizableTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.ResizableTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},getActualRightHorizontalScroll:function(){return this.table.getActualRightHorizontalScroll()},attr:function(){return BI.ResizableTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t){e&&(this.options.items=e),t&&(this.options.header=t,this.options.isNeedResize)&&(t=this._formatHeader(t)),this.table.populate(e,t),this._populate()}}),BI.shortcut("bi.resizable_table",BI.ResizableTable)},function(e,t,n){"use strict";BI.ColumnSizeAdaptiveTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.ColumnSizeAdaptiveTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-column-size-adaptive-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],header:[],items:[],crossHeader:[],crossItems:[]})},_init:function(){BI.ColumnSizeAdaptiveTable.superclass._init.apply(this,arguments);var t=this,n=this.options,e=this._digest();this.table=BI.createWidget(n.el,{type:"bi.resizable_table",element:this,width:n.width,height:n.height,isNeedResize:n.isNeedResize,isNeedFreeze:n.isNeedFreeze,freezeCols:e.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,columnSize:e.columnSize,headerRowSize:n.headerRowSize,rowSize:n.rowSize,regionColumnSize:e.regionColumnSize,header:n.header,items:n.items,crossHeader:n.crossHeader,crossItems:n.crossItems}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){n.regionColumnSize=this.getRegionColumnSize(),t._populate(),t.table.populate(),t.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(e){n.columnSize[e]=this.getColumnSize()[e],t._populate(),t.table.populate(),t.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_getFreezeColLength:function(){var e=this.options;return!0!==e.isNeedFreeze||e.freezeCols.length===e.columnSize.length?0:BI.clamp(e.freezeCols.length,0,e.columnSize.length)},_digest:function(){var n=this.options,e=n.regionColumnSize.slice(),t=n.freezeCols.slice(),i=n.regionColumnSize[0],r=this._getFreezeColLength(),o=[],a=BI.sum(n.columnSize,function(e,t){return t||0}),s=(BI.each(n.columnSize,function(e,t){t||o.push(e)}),(n.width-BI.GridTableScrollbar.SIZE-a)/o.length),a=n.columnSize.map(function(e,t){return e||(n.minColumnSize[t]?BI.clamp(s,n.minColumnSize,n.width-BI.GridTableScrollbar.SIZE):s)}),l=((!i||i>n.width-BI.GridTableScrollbar.SIZE||i<BI.GridTableScrollbar.SIZE)&&(u=BI.sum(a,function(e,t){return e<r?t:0}),i=BI.clamp(u,0,.8*n.width)),0===r&&(i=0),t.length>=a.length&&(t=[]),0),c=0,u=(BI.each(a,function(e,t){e<r&&(l+=t),c+=t}),0<r&&l<i&&(a[r-1]+=i-l),0<r&&i<l&&(a[r-1]=i-(l-a[r-1]),a[r-1]<(n.minColumnSize[r-1]||s))&&(a[r-1]=n.minColumnSize[r-1]||s),c);return n.isNeedFreeze&&0<r&&(u=c-l+i),0<a.length&&u<n.width-BI.GridTableScrollbar.SIZE&&(a[a.length-1]=n.width-BI.GridTableScrollbar.SIZE-i-(c-l-a[a.length-1])),e[0]=i,{freezeCols:t,columnSize:a,regionColumnSize:e}},_populate:function(){this.options;var e=this._digest();this.table.setColumnSize(e.columnSize),this.table.setRegionColumnSize(e.regionColumnSize),this.table.attr("freezeCols",e.freezeCols)},setWidth:function(e){BI.ColumnSizeAdaptiveTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.ColumnSizeAdaptiveTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.table.getColumnSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){var n=BI.ColumnSizeAdaptiveTable.superclass.attr.apply(this,arguments);return"freezeCols"===e?n:this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e){this.options;this._populate(),this.table.populate.apply(this.table,arguments)},destroy:function(){this.table.destroy(),BI.ColumnSizeAdaptiveTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.column_size_adaptive_table",BI.ColumnSizeAdaptiveTable)},function(e,t,n){"use strict";BI.AdaptiveTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.AdaptiveTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-adaptive-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],header:[],items:[],crossHeader:[],crossItems:[]})},_init:function(){BI.AdaptiveTable.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:t.mergeCols,mergeRule:t.mergeRule,columnSize:n.columnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:n.regionColumnSize,header:t.header,items:t.items,crossHeader:t.crossHeader,crossItems:t.crossItems}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),e._populate(),e.table.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.columnSize=this.getColumnSize(),t.regionColumnSize=this.getRegionColumnSize(),e._populate(),e.table.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_getFreezeColLength:function(){var e=this.options;return!0!==e.isNeedFreeze||e.freezeCols.length===e.columnSize.length?0:BI.clamp(e.freezeCols.length,0,e.columnSize.length)},_digest:function(){var e=this.options,t=e.columnSize.slice(),n=e.regionColumnSize.slice(),i=e.freezeCols.slice(),r=e.regionColumnSize[0],o=this._getFreezeColLength(),a=((!r||r>e.width-BI.GridTableScrollbar.SIZE||r<BI.GridTableScrollbar.SIZE)&&(l=BI.sum(t,function(e,t){return e<o?t:0}),r=BI.clamp(l,.2*e.width,.8*e.width)),0===o&&(r=0),i.length>=t.length&&(i=[]),BI.isNumber(t[0])||(t=e.minColumnSize.slice()),0),s=0,l=(BI.each(t,function(e,t){e<o&&(a+=t),s+=t}),0<o&&a<r&&(t[o-1]+=r-a),s);return e.isNeedFreeze&&0<o&&(l=s-a+r),0<t.length&&l<e.width-BI.GridTableScrollbar.SIZE&&(t[t.length-1]=e.width-BI.GridTableScrollbar.SIZE-r-(s-a-t[t.length-1])),n[0]=r,{freezeCols:i,columnSize:t,regionColumnSize:n}},_populate:function(){var e=this.options,t=this._digest();e.regionColumnSize=t.regionColumnSize,e.columnSize=t.columnSize,this.table.setColumnSize(t.columnSize),this.table.setRegionColumnSize(t.regionColumnSize),this.table.attr("freezeCols",t.freezeCols)},setWidth:function(e){BI.AdaptiveTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.AdaptiveTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){var n=BI.AdaptiveTable.superclass.attr.apply(this,arguments);return"freezeCols"===e?n:this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e){this.options;this._populate(),this.table.populate.apply(this.table,arguments)},destroy:function(){this.table.destroy(),BI.AdaptiveTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.adaptive_table",BI.AdaptiveTable)},function(e,t,n){"use strict";BI.DynamicSummaryLayerTreeTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.DynamicSummaryLayerTreeTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-dynamic-summary-layer-tree-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,footerRowSize:25,rowSize:25,regionColumnSize:[],rowHeaderCreator:null,headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],footer:!1,items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right"})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_createHeader:function(e){var t=this.options,n=t.header||[],i=t.crossHeader||[],e=BI.isEmpty(n)?BI.TableTree.formatCrossItems4Special(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}):BI.TableTree.formatCrossItems(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}),r=[],e=(BI.each(e,function(e,t){e=[i[e]];r.push(e.concat(t||[]))}),BI.isFunction(t.rowHeaderCreator)?t.rowHeaderCreator():t.rowHeaderCreator);return n&&0<n.length&&(n=this._formatColumns(n),this._getHDeep()<=0?n.unshift(e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter}):n[0]=e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter},r.push(n)),r},_formatItems:function(e,t,n){var i=this.options,r=[];return BI.each(e,function(e,t){var n;BI.each(t.children,function(e,t){!function i(e,n){e.type||(e.type="bi.layer_tree_table_cell"),e.layer=n;var t=[e];0<(t=t.concat(e.values||[])).length&&r.push(t),BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){i(t,n+1)})}(t,0)}),BI.isArray(t.values)&&(n=[{type:"bi.table_style_cell",text:i.summaryText,title:i.summaryText,styleGetter:function(){return i.summaryCellStyleGetter(!0,BI.get(t,["children",0,"dId"]))},_store:i.tableStyleCellStoreGetter}].concat(t.values),"bottom"===i.rowPosition?r.push(n):r.unshift(n))}),BI.DynamicSummaryTreeTable.formatSummaryItems(r,t,i.crossItems,1)},_formatColumns:function(e,t){return BI.isNotEmptyArray(e)?(t=t||this._getHDeep(),e.slice(Math.max(0,t-1))):e},_formatFreezeCols:function(){return 0<this.options.freezeCols.length?[0]:[]},_formatColumnSize:function(e,n){var i;return e.length<=0?[]:(i=[0],n=n||this._getHDeep(),BI.each(e,function(e,t){e<n?i[0]+=t:i.push(t)}),i)},_recomputeColumnSize:function(){var e=this.options,t=(e.regionColumnSize=this.table.getRegionColumnSize(),this.table.getColumnSize().slice());if(1<e.freezeCols.length)for(var n=0;n<e.freezeCols.length-1;n++)t.splice(1,0,0);e.columnSize=t},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=this._createHeader(n),n=this._formatItems(e.items,n,t),i=e.columnSize.slice(),r=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(i,n.deletedCols),BI.removeAt(r,n.deletedCols),BI.removeAt(e,n.deletedCols),this.header=n.header,this.items=n.items,{header:n.header,items:n.items,columnSize:this._formatColumnSize(i,t),minColumnSize:this._formatColumns(r,t),maxColumnSize:this._formatColumns(e,t),freezeCols:this._formatFreezeCols()}},_init:function(){BI.DynamicSummaryLayerTreeTable.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:[],mergeRule:t.mergeRule,columnSize:n.columnSize,minColumnSize:n.minColumnSize,maxColumnSize:n.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,header:n.header,items:n.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){e._recomputeColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){e._recomputeColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},setWidth:function(e){BI.DynamicSummaryLayerTreeTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.DynamicSummaryLayerTreeTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.options.columnSize},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){var n=this.table.getFirstColumnRowSize(),i=[];return BI.each(this.items,function(e,t){0<t[0].layer?i[i.length-1]+=n[e]:i.push(n[e])}),i},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){switch(BI.DynamicSummaryLayerTreeTable.superclass.attr.apply(this,arguments),e){case"columnSize":case"minColumnSize":case"maxColumnSize":case"freezeCols":case"mergeCols":return}return this.table.attr.apply(this.table,[e,t])},restore:function(){this.table.restore()},populate:function(e,t,n,i){var r=this.options,e=(e&&(r.items=e),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.table.setColumnSize(e.columnSize),this.table.attr("minColumnSize",e.minColumnSize),this.table.attr("maxColumnSize",e.maxColumnSize),this.table.attr("freezeCols",e.freezeCols),this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.DynamicSummaryLayerTreeTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.dynamic_summary_layer_tree_table",BI.DynamicSummaryLayerTreeTable)},function(e,t,n){"use strict";BI.DynamicSummaryTreeTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.DynamicSummaryTreeTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-dynamic-summary-tree-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,footerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,summaryCellCreator:undefined,header:[],footer:!1,items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_init:function(){BI.DynamicSummaryTreeTable.superclass._init.apply(this,arguments);var n=this,i=this.options,e=this._digest();this.table=BI.createWidget(i.el,{type:"bi.resizable_table",element:this,width:i.width,height:i.height,isNeedResize:i.isNeedResize,isNeedFreeze:i.isNeedFreeze,freezeCols:i.freezeCols,isNeedMerge:i.isNeedMerge,mergeCols:i.mergeCols,mergeRule:i.mergeRule,columnSize:i.columnSize,minColumnSize:i.minColumnSize,maxColumnSize:i.maxColumnSize,headerRowSize:i.headerRowSize,rowSize:i.rowSize,regionColumnSize:i.regionColumnSize,header:e.header,items:e.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){n.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){i.regionColumnSize=this.getRegionColumnSize();var e=this.getColumnSize(),t=i.columnSize.length-e.length;i.columnSize=e.slice(),i.columnSize=i.columnSize.concat(BI.makeArray(t,0)),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){i.regionColumnSize=this.getRegionColumnSize();var e=this.getColumnSize(),t=i.columnSize.length-e.length;i.columnSize=e.slice(),i.columnSize=i.columnSize.concat(BI.makeArray(t,0)),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),i=BI.DynamicSummaryTreeTable.formatHorizontalItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,summaryCellCreator:e.summaryCellCreator,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter}),i=BI.DynamicSummaryTreeTable.formatSummaryItems(i,n,e.crossItems,t),n=e.columnSize.slice(),t=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(n,i.deletedCols),BI.removeAt(t,i.deletedCols),BI.removeAt(e,i.deletedCols),{header:i.header,items:i.items,columnSize:n,minColumnSize:t,maxColumnSize:e}},setWidth:function(e){BI.DynamicSummaryTreeTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.DynamicSummaryTreeTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.options.columnSize},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){var n,i,e=this.options,r=this.table.getFirstColumnRowSize();return e.isNeedMergeRow?r:(e=BI.TableTree.formatItems(e.items,this._getHDeep(),!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,summaryCellCreator:e.summaryCellCreator}),n=[],i=null,BI.each(e,function(e,t){t[0]===i?n[n.length-1]+=r[e]:(i=t[0],n.push(r[e]))}),n)},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e){switch(BI.DynamicSummaryTreeTable.superclass.attr.apply(this,arguments),e){case"minColumnSize":case"maxColumnSize":return}return this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t,n,i){var r=this.options,e=(e&&(r.items=e),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.table.setColumnSize(e.columnSize),this.table.attr("minColumnSize",e.minColumnSize),this.table.attr("maxColumnSize",e.maxColumnSize),this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.DynamicSummaryTreeTable.superclass.destroy.apply(this,arguments)}}),BI.extend(BI.DynamicSummaryTreeTable,{formatHorizontalItems:function(e,u,h,d,p){var f=[],m=(p=p||{}).sumPosition,g=p.summaryText,i=p.isNeedMergeRow,y=p.summaryCellCreator||function(e){return e};function b(e,t){return i||(e=BI.clone(e),t&&(e.clone=!0)),e}function v(e,n){return i?e.slice():BI.map(e,function(e,t){return b(t,n)})}return BI.each(e,function(e,t){!function c(i,r){if(BI.isArray(r.children)){var o=0;if(BI.each(r.children,function(e,t){var n;-1!=i?(n=v(i,r.summaryClone?0<r.children.length:0!==e)).push(b(r,r.summaryClone?0<r.children.length:0!==e)):n=[],o+=c(n,t)}),-1!=i?(s=v(i,!r.summaryClone)).push(b(r,!r.summaryClone)):s=[],BI.isNotEmptyArray(r.values)){for(var e=y({text:g,title:g,type:"bi.table_style_cell",styleGetter:function(){return d(-1===i,BI.get(r,["children",0,"dId"]))},_store:p.tableStyleCellStoreGetter},r,-1===i),t=s.length;t<u;t++)s.push(e);if(0<(s=h?s:s.concat(BI.map(r.values,function(e,t){var n=d(-1===i);return y(BI.extend({},t,{styles:n}),r,-1===i)}))).length)if(h)for(var n=0,a=r.values.length;n<a;n++)m?f.push(s):f.splice(f.length-o,0,s);else m?f.push(s):f.splice(f.length-o,0,s);return o+1}return o}if(-1!=i)for(var s,t=(s=i.slice()).length;t<u;t++)s.push(r);else s=[];if(!h&&BI.isArray(r.values)&&(s=s.concat(r.values)),h&&BI.isArray(r.values))for(var t=0,l=r.values.length;t<l-1;t++)0<s.length&&f.push(s);return 0<s.length&&f.push(s),r.values?1:0}(-1,t)}),BI.each(f,function(e,t){for(var n=BI.last(t),i=t.length;i<u;i++)t.push(n)}),f},formatSummaryItems:function(e,t,n,i){var r,o,a=[],s=0;return BI.each(n,function(e,t){!function n(e){if(BI.isArray(e.children)){if(BI.each(e.children,function(e,t){n(t)}),BI.isNotEmptyArray(e.values)){if(1===e.children.length)for(var t=0;t<e.values.length;t++)a.push(s+t+i);s+=e.values.length}}else e.values&&1<e.values.length?s+=e.values.length:s++}(t)}),0<a.length&&(r=[],o=[],BI.each(t,function(e,t){t=t.slice();BI.removeAt(t,a),r.push(t)}),BI.each(e,function(e,t){t=t.slice();BI.removeAt(t,a),o.push(t)}),t=r,e=o),{items:e,header:t,deletedCols:a}}}),BI.shortcut("bi.dynamic_summary_tree_table",BI.DynamicSummaryTreeTable)},function(e,t,n){"use strict";BI.LayerTreeTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.LayerTreeTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-layer-tree-table-cell",layer:0,text:""})},_init:function(){BI.LayerTreeTableCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this.element,textAlign:"left",whiteSpace:"nowrap",height:e.height,text:e.text,value:e.value,lgap:5+30*e.layer,rgap:5})}}),BI.shortcut("bi.layer_tree_table_cell",BI.LayerTreeTableCell)},function(e,t,n){"use strict";BI.LayerTreeTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.LayerTreeTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-layer-tree-table",el:{type:"bi.resizable_table"},isNeedResize:!1,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],rowHeaderCreator:null,headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_createHeader:function(e){var t=this.options,n=t.header||[],i=t.crossHeader||[],e=BI.TableTree.formatCrossItems(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===t.colPosition,summaryText:t.summaryText}),r=[];return BI.each(e,function(e,t){e=[i[e]];r.push(e.concat(t||[]))}),n&&0<n.length&&(e=this._formatColumns(n),this._getHDeep()<=0?e.unshift(t.rowHeaderCreator||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter}):e[0]=t.rowHeaderCreator||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter},r.push(e)),r},_formatItems:function(e){var n=this.options,r=[];return BI.each(e,function(e,t){BI.each(t.children,function(e,t){!function i(e,n){e.type||(e.type="bi.layer_tree_table_cell"),e.layer=n;var t=[e];0<(t=t.concat(e.values||[])).length&&r.push(t),BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){i(t,n+1)})}(t,0)}),BI.isArray(t.values)&&(t=[{type:"bi.table_style_cell",text:BI.i18nText("BI-Summary_Values"),styleGetter:function(){return n.summaryCellStyleGetter(!0)},_store:n.tableStyleCellStoreGetter}].concat(t.values),r.push(t))}),r},_formatColumns:function(e,t){return BI.isNotEmptyArray(e)?(t=t||this._getHDeep(),e.slice(Math.max(0,t-1))):e},_formatFreezeCols:function(){return 0<this.options.freezeCols.length?[0]:[]},_formatColumnSize:function(e,n){var i;return e.length<=0?[]:(i=[0],n=n||this._getHDeep(),BI.each(e,function(e,t){e<n?i[0]+=t:i.push(t)}),i)},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep();return this.header=this._createHeader(n),this.items=this._formatItems(e.items),{header:this.header,items:this.items,columnSize:this._formatColumnSize(e.columnSize,t),minColumnSize:this._formatColumns(e.minColumnSize,t),maxColumnSize:this._formatColumns(e.maxColumnSize,t),freezeCols:this._formatFreezeCols()}},_init:function(){BI.LayerTreeTable.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:[],mergeRule:t.mergeRule,columnSize:n.columnSize,minColumnSize:n.minColumnSize,maxColumnSize:n.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,header:n.header,items:n.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},setWidth:function(e){BI.LayerTreeTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.LayerTreeTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){var e=this.table.getColumnSize(),t=this._getHDeep(),n=[];return(n=0<t?BI.makeArray(t,e[0]/t):n).concat(e.slice(1))},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){var n=this.table.getFirstColumnRowSize(),i=[];return BI.each(this.items,function(e,t){0<t[0].layer?i[i.length-1]+=n[e]:i.push(n[e])}),i},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){switch(BI.LayerTreeTable.superclass.attr.apply(this,arguments),e){case"columnSize":case"minColumnSize":case"maxColumnSize":case"freezeCols":case"mergeCols":return}return this.table.attr.apply(this.table,[e,t])},restore:function(){this.table.restore()},populate:function(e,t,n,i){var r=this.options,e=(r.items=e||[],t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.table.setColumnSize(e.columnSize),this.table.attr("freezeCols",e.freezeCols),this.table.attr("minColumnSize",e.minColumnSize),this.table.attr("maxColumnSize",e.maxColumnSize),this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.LayerTreeTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.layer_tree_table",BI.LayerTreeTable)},function(e,t,n){"use strict";BI.TableStyleCell=BI.inherit(BI.Single,{props:{baseCls:"bi-table-style-cell",styleGetter:BI.emptyFn},mounted:function(){var e=BI.extend({},this.options.styleGetter());e.fontSize&&this.text.element.css({fontSize:"calc(var(--css-scale) * ".concat(null!=(e=e.fontSize)?e:12,"px)")})},render:function(){var e=this.options,t=this,n=BI.extend({},e.styleGetter(),{height:e.height-1});return{type:"bi.adaptive",items:[{el:{type:"bi.label",textAlign:n.textAlign||"left",css:n,hgap:5,text:e.text,title:e.text,belowMouse:!0,ref:function(e){t.text=e}}}]}},_digestStyle:function(){var e=this.options.styleGetter();e&&this.text.element.css(e)},setText:function(e){this.text.setText(e)},setHeight:function(e){BI.TableStyleCell.superclass.setHeight.call(this,e),this.text.setHeight(e-1)},populate:function(){this._digestStyle()}}),BI.shortcut("bi.table_style_cell",BI.TableStyleCell)},function(e,t,n){"use strict";BI.TableTree=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.TableTree.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table-tree",el:{type:"bi.resizable_table"},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_init:function(){BI.TableTree.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:t.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:t.mergeCols,mergeRule:t.mergeRule,columnSize:t.columnSize,minColumnSize:t.minColumnSize,maxColumnSize:t.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,header:n.header,items:n.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep();return{header:BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),items:BI.TableTree.formatItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow})}},setWidth:function(e){BI.TableTree.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.TableTree.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(){return BI.TableTree.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t,n,i){var r=this.options,e=(e&&(r.items=e||[]),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.TableTree.superclass.destroy.apply(this,arguments)}}),BI.extend(BI.TableTree,{formatHeader:function(e,t,n,i,r,o,a){for(var s=BI.isEmpty(e)?BI.TableTree.formatCrossItems4Special(n,r,o,a):BI.TableTree.formatCrossItems(n,r,o,a),l=[],c=0;c<r;c++){for(var u=[],h=0;h<i;h++)u.push(t[c]);l.push(u.concat(s[c]||[]))}return e&&0<e.length&&l.push(e),l},formatItems:function(e,u,h,d,p){var f=[],m=(p=p||{}).sumPosition,g=p.summaryText||BI.i18nText("BI-Summary_Values"),y=p.summaryCellCreator||function(e){return e};return BI.each(e,function(e,t){!function c(i,r){if(BI.isArray(r.children)){var o=0;if(BI.each(r.children,function(e,t){var n;-1!=i?(n=i.slice()).push(r):n=[],o+=c(n,t)}),-1!=i?(s=i.slice()).push(r):s=[],BI.isNotEmptyArray(r.values)){for(var e=y({text:g,title:g,type:"bi.table_style_cell",styleGetter:function(){return d(-1===i)},_store:p.tableStyleCellStoreGetter},r,-1===i),t=s.length;t<u;t++)s.push(e);if(0<(s=h?s:s.concat(r.values)).length)if(h)for(var n=0,a=r.values.length;n<a;n++)m?f.push(s):f.splice(f.length-o,0,s);else m?f.push(s):f.splice(f.length-o,0,s);return o+1}return o}if(-1!=i)for(var s,t=(s=i.slice()).length;t<u;t++)s.push(r);else s=[];if(!h&&BI.isArray(r.values)&&(s=s.concat(r.values)),h&&BI.isArray(r.values))for(var t=0,l=r.values.length;t<l-1;t++)0<s.length&&f.push(s);return 0<s.length&&f.push(s),r.values?1:0}(-1,t)}),BI.each(f,function(e,t){for(var n=BI.last(t),i=t.length;i<u;i++)t.push(n)}),f},formatItems4Special:function(e,c,u,h,d){var p=[],f=(d=d||{}).sumPosition,m=d.summaryText||BI.i18nText("BI-Summary_Values");return BI.each(e,function(e,t){!function l(i,r){if(BI.isArray(r.children)){var o=0;if(BI.each(r.children,function(e,t){var n;-1!=i?(n=i.slice()).push(r):n=[],o+=l(n,t)}),-1!=i?(s=i.slice()).push(r):s=[],BI.isNotEmptyArray(r.values)){for(var e={text:m,title:m,type:"bi.table_style_cell",styleGetter:function(){return h(-1===i)},_store:d.tableStyleCellStoreGetter},t=s.length;t<c;t++)s.push(e);if(0<s.length)if(u)for(var n=0,a=r.values.length;n<a;n++)f?p.push(s):p.splice(p.length-o,0,s);else f?p.push(s):p.splice(p.length-o,0,s);return o+r.values.length}return o}if(-1!=i)for(var s,t=(s=i.slice()).length;t<c;t++)s.push(r);else s=[];return 0<s.length&&p.push(s),r.values?r.values.length:0}(-1,t)}),BI.each(p,function(e,t){for(var n=BI.last(t),i=t.length;i<c;i++)t.push(n)}),p},formatCrossItems:function(e,t,n,i){e=BI.TableTree.formatItems(e,t,!0,n,i);return BI.unzip(e)},formatCrossItems4Special:function(e,t,n,i){e=BI.TableTree.formatItems4Special(e,t,!1,n,i);return BI.unzip(e)},maxDeep:function(e){var n=1;return BI.isObject(e)&&BI.each(e,function(e,t){n=Math.max(n,function r(n,e){var i=n;return BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){i=Math.max(i,r(n+1,t))}),i}(1,t))}),n}}),BI.shortcut("bi.tree_table",BI.TableTree)},function(e,t,n){"use strict";BI.StyleTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-components-preview-table",$testId:"bi-components-preview-table",userSelectable:!0,isNeedFreeze:!0,showSequence:!1,seqWidth:60,sequenceCellStyleGetter:BI.emptyFn,headerCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,showPartData:!1,columnSortable:!1,columnSelectable:!1,tipPosition:"bottom",zebraVeins:!0,freezeCols:[],columnSize:[],columnGaps:[],headerRowSize:30,rowSize:30,header:[],items:[],watermark:{},needFormat:!0,fontSize:12,minSize:60,regionColumnSize:[],isHeaderAutoHeight:!1,isAutoHeight:!1},mounted:function(){var n=this;this._resizeHandler=BI.debounce(function(){var e=n._getTableWidth(),t=n._getTableHeight();n.table.getWidth()===e&&n.table.getHeight()===t||(n.table.setWidth(e),n.table.setHeight(t),n.table.populate())},30),this.removeListener=BI.ResizeDetector.addResizeListener(this.wrapper,function(){n._resizeHandler()}),this._populate()},render:function(){var t=this,e=this.options,n=e.watermark;return{type:"bi.absolute",items:[{el:{type:"bi.vtape",cls:e.userSelectable?"user-selectable":"",items:this._createTable()},top:0,right:0,bottom:0,left:0},{el:{type:"bi.watermark",invisible:!n.valid,watermark:n},left:0,top:0,right:0,bottom:0}],ref:function(e){t.wrapper=e}}},_createTable:function(){var e=this.options,t=this,n={el:{type:"bi.label",cls:"bi-tips",text:BI.i18nText("BI-Conf_Current_Preview_Part_Data"),textAlign:"right"},height:e.showPartData?30:0},i={type:"bi.page_table",rowSize:e.rowSize,headerRowSize:e.headerRowSize,isNeedFreeze:e.isNeedFreeze,freezeCols:e.freezeCols,showSequence:e.showSequence,seqWidth:e.seqWidth,sequenceCellStyleGetter:e.sequenceCellStyleGetter,headerCellStyleGetter:e.headerCellStyleGetter,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter,ref:function(e){t.table=e},el:{type:"bi.sequence_table",el:{type:"bi.adaptive_table",el:e.columnSelectable||e.columnSortable?{type:"bi.sortable_table",sortable:e.columnSortable,ref:function(e){t.sortableTable=e},el:{type:"bi.resizable_table",el:this._getGridConfig()},listeners:[{eventName:"EVENT_TABLE_SELECT_COLUMN",action:function(e){t.fireEvent("EVENT_TABLE_SELECT_COLUMN",e)}},{eventName:"EVENT_TABLE_SORT",action:function(){t.fireEvent("EVENT_TABLE_SORT",arguments)}}]}:{type:"bi.resizable_table",el:this._getGridConfig()},listeners:[{eventName:"EVENT_TABLE_AFTER_COLUMN_RESIZE",action:function(){t.fireEvent("EVENT_TABLE_AFTER_COLUMN_RESIZE")}}]}}};return"top"!==e.tipPosition?[i,n]:[n,i]},_getGridConfig:function(){var e=this.options;return{type:"bi.grid_auto_height_table",columnGaps:e.columnGaps,isAutoHeight:e.isAutoHeight,isHeaderAutoHeight:e.isHeaderAutoHeight,fontSize:e.fontSize,fontLineHeight:1.4*e.fontSize,headerFontSize:e.fontSize,headerFontLineHeight:1.4*e.fontSize}},_getTableWidth:function(){return this.options.width||this.element.width()},_getTableHeight:function(){var e=this.element.height();return this.options.showPartData?e-30:e},_populate:function(){this.populate(this.options.items,this.options.header)},_calculateColumnSize:function(){var t,i,e,n,r,o,a;return this.options.columnSize&&0<this.options.columnSize.length?this.options.columnSize:(t=this.options.fontSize,i=this.options.minSize,l(this.options.header,e=[]),l(this.options.items,e),n=BI.map(e,function(e,t){var n=2*Math.ceil(BI.average(BI.filter(t,function(e,t){return 0<=t}))),t=Math.ceil(BI.max(t));return n<i||t<i?i:n<t?n:t}),BI.each(this.options.header,function(e,t){BI.each(t,function(e,t){n[e]+=BI.isNumber(t.iconWidth)?t.iconWidth:0,n[e]+=BI.isNumber(t.lgap)?t.lgap:0,n[e]+=BI.isNumber(t.rgap)?t.rgap:0,n[e]+=BI.isNumber(t.hgap)?2*t.hgap:0})}),r=this._getTableWidth()-10,o=n.reduce(function(e,t){return e+t},0),r<=o?n:(a=r-o,BI.map(n,function(e,t){return e===n.length-1?t+a:(a-=Math.ceil((r-o)/n.length),t+Math.ceil((r-o)/n.length))})));function s(e){return BI.isNumber(e.width)?e.width:BI.isNotEmptyString(e.text)?BI.Func.getGBWidth(e.text)*t*1.2:0}function l(e,i){BI.each(e,function(e,t){BI.each(t,function(e,t){var n=0;BI.isNotEmptyArray(t.items)?BI.each(t.items,function(e,t){n+=s(t)}):n+=s(t),i[e]=i[e]||[],i[e].push(n)})})}},_formatItems:function(){var i=this,e=BI.deepClone(this.options.items),r=this.options.zebraVeins;return BI.each(e,function(n,e){BI.each(e,function(e,t){BI.isNotNull(i.options.header[0])&&BI.isNotNull(i.options.header[0][e])&&"number-field-font"===i.options.header[0][e].iconCls&&i.options.needFormat&&(t.text=BI.Format.numberFormat(t.text)),t.text=BI.replaceAll(t.text||"","\n","\\n"),t.cls=(t.cls||"")+" body-row "+(r?n%2!=0?"even-row":"odd-row":"")})}),e},_formatHeader:function(){var e=BI.deepClone(this.options.header);return BI.each(e,function(e,t){BI.each(t,function(e,t){t.cls=(t.cls||"")+" header-row "})}),e},populate:function(e,t,n){this.options.items=e,this.options.header=t;e=this._calculateColumnSize();this.table.attr("columnSize",e),n=n||{},!BI.isNull(n.freezeScroll)&&!1!==n.freezeScroll||(this.table.attr("scrollTop",0),this.table.attr("scrollLeft",BI.sum(e.slice(0,n.scrollLeftIndex||0)))),this.table.restore(),this.table.setWidth(this._getTableWidth()),this.table.setHeight(this._getTableHeight()),this.table.attr("regionColumnSize",this.options.regionColumnSize),this.table.attr("minColumnSize",e),this.table.attr("isNeedFreeze",!0),this.table.attr("freezeCols",this.options.freezeCols),this.table.attr("showSequence",this.options.showSequence),this.table.populate(this._formatItems(),this._formatHeader())},setHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},selectColumns:function(e){this.sortableTable&&this.sortableTable.selectColumns(e)},setSortable:function(e){this.sortableTable&&this.sortableTable.setSortable(e)},getSelectedColumns:function(){return this.sortableTable&&this.sortableTable.getSelectedColumns()},destroyed:function(){this.removeListener&&this.removeListener()},getColumnSize:function(){return this.table.getColumnSize()}}),BI.shortcut("bi.components.style_table",BI.StyleTable)},function(e,t,n){"use strict";var l,c;l=function l(e,t,n){return t<e?e:n<t?n:t},c={index:0,offset:0,position:0,contentHeight:0},BI.TableScrollHelper=function(e,t,n,i){this._rowOffsets=BI.PrefixIntervalTree.uniform(e,t),this._storedHeights=new Array(e);for(var r=0;r<e;++r)this._storedHeights[r]=t;this._rowCount=e,this._position=0,this._contentHeight=e*t,this._defaultRowHeight=t,this._rowHeightGetter=i||function(){return t},this._viewportHeight=n,this._updateHeightsInViewport(0,0)},BI.TableScrollHelper.prototype={constructor:BI.TableScrollHelper,setRowHeightGetter:function(e){this._rowHeightGetter=e},setViewportHeight:function(e){this._viewportHeight=e},getContentHeight:function(){return this._contentHeight},_updateHeightsInViewport:function(e,t){for(var n=t,i=e;n<=this._viewportHeight&&i<this._rowCount;)this._updateRowHeight(i),n+=this._storedHeights[i],i++},_updateHeightsAboveViewport:function(e){for(var t=e-1;0<=t&&e-5<=t;){var n=this._updateRowHeight(t);this._position+=n,t--}},_updateRowHeight:function(e){var t,n;return!(e<0||e>=this._rowCount)&&(t=this._rowHeightGetter(e))!==this._storedHeights[e]?(n=t-this._storedHeights[e],this._rowOffsets.set(e,t),this._storedHeights[e]=t,this._contentHeight+=n,n):0},getRowPosition:function(e){return this._updateRowHeight(e),this._rowOffsets.sumUntil(e)},scrollBy:function(e){if(0===this._rowCount)return c;var t=this._rowOffsets.greatestLowerBound(this._position),t=l(t,0,Math.max(this._rowCount-1,0)),n=this._rowOffsets.sumUntil(t),i=t,r=this._position,t=this._updateRowHeight(i),o=(0!==n&&(r+=t),this._storedHeights[i]-(r-n));if(0<=e)for(;0<e&&i<this._rowCount;)e<o?(r+=e,e=0):(e-=o,r+=o,i++),i<this._rowCount&&(this._updateRowHeight(i),o=this._storedHeights[i]);else if(e<0){e=-e;for(var a,s=this._storedHeights[i]-o;0<e&&0<=i;)e<s?(r-=e,e=0):(r-=s,e-=s,i--),0<=i&&(a=this._updateRowHeight(i),s=this._storedHeights[i],r+=a)}t=this._contentHeight-this._viewportHeight,r=l(r,0,t),this._position=r,n=this._rowOffsets.greatestLowerBound(r),n=l(n,0,Math.max(this._rowCount-1,0)),t=this._rowOffsets.sumUntil(n)-r;return this._updateHeightsInViewport(n,t),this._updateHeightsAboveViewport(n),{index:n,offset:t,position:this._position,contentHeight:this._contentHeight}},_getRowAtEndPosition:function(e){this._updateRowHeight(e);for(var t=e,n=this._storedHeights[t];n<this._viewportHeight&&0<=t;)0<=--t&&(this._updateRowHeight(t),n+=this._storedHeights[t]);e=this._rowOffsets.sumTo(e)-this._viewportHeight;return e=e<0?0:e},scrollTo:function(e){var t;return 0===this._rowCount?c:e<=0?(this._position=0,this._updateHeightsInViewport(0,0),{index:0,offset:0,position:this._position,contentHeight:this._contentHeight}):(e>=this._contentHeight-this._viewportHeight&&(t=this._rowCount-1,e=this._getRowAtEndPosition(t)),this._position=e,t=this._rowOffsets.greatestLowerBound(e),t=l(t,0,Math.max(this._rowCount-1,0)),e=this._rowOffsets.sumUntil(t)-e,this._updateHeightsInViewport(t,e),this._updateHeightsAboveViewport(t),{index:t,offset:e,position:this._position,contentHeight:this._contentHeight})},scrollToRow:function(e,t){e=l(e,0,Math.max(this._rowCount-1,0)),t=l(t,-this._storedHeights[e],0);e=this._rowOffsets.sumUntil(e);return this.scrollTo(e-t)},scrollRowIntoView:function(e){e=l(e,0,Math.max(this._rowCount-1,0));var t=this._rowOffsets.sumUntil(e),n=t+this._storedHeights[e];return t<this._position?this.scrollTo(t):this._position+this._viewportHeight<n?(t=this._getRowAtEndPosition(e),this.scrollTo(t)):this.scrollTo(this._position)}}},function(e,t,n){"use strict";BI.SequenceTableTreeNumber=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.SequenceTableTreeNumber.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sequence-table-tree-number",isNeedFreeze:!1,startSequence:1,scrollTop:0,headerRowSize:25,rowSize:25,rowSizeGetter:BI.emptyFn,headerRowSizeGetter:BI.emptyFn,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],width:60})},_init:function(){BI.SequenceTableTreeNumber.superclass._init.apply(this,arguments);var e=this.options;this.vCurr=1,this.hCurr=1,this.tasks=[],this.gridView=BI.createWidget({type:"bi.grid_view",overflowX:!1,overflowY:!1,scrollTop:e.scrollTop,columnCount:1,estimatedColumnSize:e.width,width:e.width,rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:function(){return e.width}}),this.headerContainer=BI.createWidget({type:"bi.absolute",cls:"sequence-table-header-cell bi-border-top bi-border-left bi-border-bottom bi-border-right",width:e.width,scrollable:!1}),this.layout=BI.createWidget({type:"bi.vtape",element:this,items:[{el:this.headerContainer,height:2},{el:this.gridView,height:"fill"}]}),this.start=this.options.startSequence,this.cache={},this._nextState(),this.populate()},_rowHeightGetter:function(e){var t,n=this.options,i=this._getHeaderHeight();return i>=n.height?0===e?i:this.rowHeights&&(t=this.rowHeights[e-1],BI.isNotNull(t))?t:this.options.rowSize:this.rowHeights&&(t=this.rowHeights[e],BI.isNotNull(t))?t:this.options.rowSize},_getNextSequence:function(e){var n=this,i=this.start,r=this.start;return BI.each(e,function(e,t){BI.isNotEmptyArray(t.children)&&BI.each(t.children,function(e,t){0===e&&(e=n._getCacheKey(t),n.cache[e])&&(i=r=n.cache[e]),e=t,e=n._getCacheKey(e),n.cache[e]||(n.cache[e]=r),r++})}),this.start=r,i},_getStart:function(e){var n=this,i=this.start;return BI.some(e,function(e,t){if(BI.isNotEmptyArray(t.children))return BI.some(t.children,function(e,t){if(0===e){e=n._getCacheKey(t);if(n.cache[e])return i=n.cache[e],!0}})}),i},_formatNumber:function(e){var r=this.options,n=[],o=this._getStart(e);var a=0,s=0,i=(BI.each(e,function(e,t){BI.isArray(t.children)&&(BI.isNotEmptyArray(t.values)&&r.rowPosition===BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(n.push({text:r.sequenceSummaryText,start:a++,top:s,cnt:1,isSummary:!0,height:r.rowSize}),s+=r.rowSize),BI.each(t.children,function(e,t){t=function i(e){var n=0;return BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){n+=i(t)}),++n}(t);n.push({text:o++,start:a,top:s,cnt:t,index:e,height:t*r.rowSize}),a+=t,s+=t*r.rowSize}),BI.isNotEmptyArray(t.values))&&r.rowPosition!==BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(n.push({text:r.sequenceSummaryText,start:a++,top:s,cnt:1,isSummary:!0,height:r.rowSize}),s+=r.rowSize)}),this.rowHeights=r.rowSizeGetter());return n=BI.map(n,function(e,t){return[BI.extend({type:"bi.table_style_cell",cls:"sequence-table-number-cell bi-border-left bi-border-bottom bi-border-right",width:r.width,styleGetter:!0===t.isSummary?function(){return r.summaryCellStyleGetter(!0)}:(n=t.index,function(){return r.sequenceCellStyleGetter(n)}),_store:r.tableStyleCellStoreGetter},t,{height:i[e]||t.height})];var n})},_layout:function(){var e,t=this.options,n=(this.headerContainer.empty(),this._getHeaderHeight()),i=this.layout.attr("items");n>=t.height?i[0].height=0:(BI.createWidget({type:"bi.absolute",element:this.headerContainer,items:[{el:BI.extend({type:"bi.table_style_cell",height:n-2,cls:"sequence-table-title-cell",styleGetter:t.headerCellStyleGetter,text:BI.i18nText("BI-Number_Index"),_store:t.tableStyleCellStoreGetter},t.sequenceHeaderCreator()),left:0,top:0,right:0,bottom:0}]}),i[0].height=n),this.layout.attr("items",i),this.layout.resize(),this.numbers=this._formatNumber(t.items),n>=t.height?(this.numbers.unshift([BI.extend({type:"bi.table_style_cell",height:n-2,cls:"sequence-table-title-cell",styleGetter:t.headerCellStyleGetter,text:BI.i18nText("BI-Number_Index"),_store:t.tableStyleCellStoreGetter},t.sequenceHeaderCreator())]),e=BI.isArray(this.numbers)?(BI.sum(this.rowHeights)+n)/(this.numbers.length+1):0,this.gridView.setEstimatedRowSize(e),this.gridView.setHeight(t.height)):(e=BI.isArray(this.numbers)&&0<this.numbers.length?BI.sum(this.rowHeights)/this.numbers.length:0,this.gridView.setEstimatedRowSize(e),this.gridView.setHeight(t.height-n)),this.gridView.restore()},_getHeaderHeight:function(){var e=this.options.headerRowSizeGetter();return BI.sum(e)},_nextState:function(){var e=this.options;this._getNextSequence(e.items)},_prevState:function(){var n,e=this.options;BI.some(e.items,function(e,t){if(BI.isNotEmptyArray(t.children))return BI.some(t.children,function(e,t){return n=t,!0})}),n&&BI.isNotEmptyObject(this.cache)?this.start=this.cache[this._getCacheKey(n)]:this.start=1,this._nextState()},_calculateChildrenToRender:function(){var e=this.options;this.gridView._populate(this.numbers),this.gridView.setScrollTop(e.scrollTop)},_getCacheKey:function(e){this.nullKey||(this.nullKey=BI.UUID());e=BI.isNull(e.text)?e.value:e.text;return BI.isNull(e)?this.nullKey:e},_restore:function(){this.gridView.restore()},_populate:function(){var n=this;BI.each(this.tasks,function(e,t){t.apply(n)}),this.tasks=[],this._layout(),this._calculateChildrenToRender()},setVerticalScroll:function(e){var t=this.options;t.scrollTop!==e&&(t.scrollTop=e,this.gridView.setScrollTop(t.scrollTop))},getVerticalScroll:function(){return this.options.scrollTop},setVPage:function(e){e<=1?(this.cache={},this.start=this.options.startSequence,this._restore(),this.tasks.push(this._nextState)):e===this.vCurr+1?this.tasks.push(this._nextState):e===this.vCurr-1&&this.tasks.push(this._prevState),this.vCurr=e},setHPage:function(e){e!==this.hCurr&&this.tasks.push(this._prevState),this.hCurr=e},setWidth:function(e){BI.SequenceTableTreeNumber.superclass.setWidth.apply(this,arguments),this.gridView.setWidth(e),this.headerContainer.setWidth(e)},restore:function(){this._restore()},populate:function(e,t,n,i){var r=this.options;e&&e!==this.options.items&&(r.items=e,this._restore(),this.tasks.push(this._prevState)),t&&t!==this.options.header&&(r.header=t),n&&n!==this.options.crossItems&&(r.crossItems=n),i&&i!==this.options.crossHeader&&(r.crossHeader=i),this._populate()}}),BI.shortcut("bi.sequence_table_tree_number",BI.SequenceTableTreeNumber)},function(e,t,n){"use strict";BI.SequenceTableDynamicNumber=BI.inherit(BI.SequenceTableTreeNumber,{_defaultConfig:function(){return BI.extend(BI.SequenceTableDynamicNumber.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-sequence-table-dynamic-number"})},_init:function(){BI.SequenceTableDynamicNumber.superclass._init.apply(this,arguments)},_formatNumber:function(e){var r=this.options,o=[],a=this._getStart(e);var s=0,l=0,i=(BI.each(e,function(e,t){BI.isArray(t.children)&&(BI.isNotEmptyArray(t.values)&&r.rowPosition===BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(o.push({text:r.sequenceSummaryText,title:r.sequenceSummaryText,start:s++,top:l,cnt:1,isSummary:!0,height:r.rowSize}),l+=r.rowSize),BI.each(t.children,function(e,t){var t=function i(e){var n=0;return BI.isNotEmptyArray(e.children)&&(BI.each(e.children,function(e,t){n+=i(t)}),!BI.isNotEmptyArray(e.values))||n++,n}(t),n=a++;o.push({text:n,title:n,start:s,top:l,cnt:t,index:e,height:t*r.rowSize}),s+=t,l+=t*r.rowSize}),BI.isNotEmptyArray(t.values))&&r.rowPosition!==BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(o.push({text:r.sequenceSummaryText,title:r.sequenceSummaryText,start:s++,top:l,cnt:1,isSummary:!0,height:r.rowSize}),l+=r.rowSize)}),this.rowHeights=r.rowSizeGetter());return o=BI.map(o,function(e,t){return[BI.extend({type:"bi.table_style_cell",cls:"sequence-table-number-cell bi-border-left bi-border-bottom bi-border-right",width:r.width,styleGetter:!0===t.isSummary?function(){return r.summaryCellStyleGetter(!0)}:(n=t.index,function(){return r.sequenceCellStyleGetter(n)}),_store:r.tableStyleCellStoreGetter},t,{height:i[e]||t.height})];var n})}}),BI.shortcut("bi.sequence_table_dynamic_number",BI.SequenceTableDynamicNumber)},function(e,t,n){"use strict";BI.PageTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PageTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-page-table-cell",text:"",title:""})},_init:function(){BI.PageTableCell.superclass._init.apply(this,arguments),BI.createWidget({type:"bi.label",element:this,textAlign:"left",whiteSpace:"nowrap",height:this.options.height,text:this.options.text,title:this.options.title,value:this.options.value,lgap:5,rgap:5}),BI.isNotNull(this.options.styles)&&BI.isObject(this.options.styles)&&this.element.css(this.options.styles)}}),BI.shortcut("bi.page_table_cell",BI.PageTableCell)},function(e,t,n){"use strict";BI.PageTable=BI.inherit(BI.Widget,{_const:{scrollWidth:18,minScrollWidth:100},_defaultConfig:function(){return BI.extend(BI.PageTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-page-table",el:{type:"bi.sequence_table"},pager:{horizontal:{pages:!1,curr:1,hasPrev:BI.emptyFn,hasNext:BI.emptyFn,firstPage:1,lastPage:BI.emptyFn},vertical:{pages:!1,curr:1,hasPrev:BI.emptyFn,hasNext:BI.emptyFn,firstPage:1,lastPage:BI.emptyFn}},itemsCreator:BI.emptyFn,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,showSequence:!1,seqWidth:60,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[]})},_init:function(){BI.PageTable.superclass._init.apply(this,arguments);var n=this,i=this.options;this.hCurr=1,this.vCurr=1,this.table=BI.createWidget(i.el,{type:"bi.sequence_table",width:i.width,height:i.height&&i.height-30,isNeedResize:!0,isNeedFreeze:i.isNeedFreeze,freezeCols:i.freezeCols,isNeedMerge:i.isNeedMerge,mergeCols:i.mergeCols,mergeRule:i.mergeRule,columnSize:i.columnSize,minColumnSize:i.minColumnSize,maxColumnSize:i.maxColumnSize,headerRowSize:i.headerRowSize,rowSize:i.rowSize,showSequence:i.showSequence,seqWidth:i.seqWidth,regionColumnSize:i.regionColumnSize,headerCellStyleGetter:i.headerCellStyleGetter,summaryCellStyleGetter:i.summaryCellStyleGetter,sequenceCellStyleGetter:i.sequenceCellStyleGetter,tableStyleCellStoreGetter:i.tableStyleCellStoreGetter,header:i.header,items:i.items,crossHeader:i.crossHeader,crossItems:i.crossItems}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){n.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){i.regionColumnSize=this.getRegionColumnSize(),i.columnSize=this.getColumnSize(),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){i.regionColumnSize=this.getRegionColumnSize(),i.columnSize=this.getColumnSize(),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)}),this.pager=BI.createWidget(i.pager,{type:"bi.direction_pager",height:24}),this.pager.on(BI.Pager.EVENT_CHANGE,function(){var e=this.getVPage&&this.getVPage(),t=(BI.isNull(e)&&(e=this.getCurrentPage()),this.getHPage&&this.getHPage());i.itemsCreator({vpage:e,hpage:t},function(){n.table.setVPage?n.table.setVPage(e):n.table.setValue(e),n.table.setHPage&&n.table.setHPage(t),n.populate.apply(n,arguments)})}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.table,left:0,top:0},{el:this.pager,left:0,right:10,bottom:3}]})},setHPage:function(e){this.hCurr=e,this.pager.setHPage&&this.pager.setHPage(e),this.table.setHPage&&this.table.setHPage(e)},setVPage:function(e){this.vCurr=e,this.pager.setVPage&&this.pager.setVPage(e),this.table.setVPage&&this.table.setVPage(e)},getHPage:function(){var e=this.pager.getHPage&&this.pager.getHPage();return BI.isNotNull(e)||(e=this.pager.getCurrentPage&&this.pager.getCurrentPage(),BI.isNotNull(e))?e:this.hpage},getVPage:function(){var e=this.pager.getVPage&&this.pager.getVPage();return BI.isNotNull(e)||(e=this.pager.getCurrentPage&&this.pager.getCurrentPage(),BI.isNotNull(e))?e:this.vpage},setWidth:function(e){BI.PageTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.PageTable.superclass.setHeight.apply(this,arguments);var t=this.options,n=!1;(this.pager.isShowPager&&this.pager.isShowPager()||this.pager.hasHNext&&this.pager.hasHNext()||this.pager.hasHPrev&&this.pager.hasHPrev()||this.pager.hasVNext&&this.pager.hasVNext()||this.pager.hasVPrev&&this.pager.hasVPrev()||this.pager.hasNext&&this.pager.hasNext()||this.pager.hasPrev&&this.pager.hasPrev())&&(n=!0),this.table.setHeight(e-(n?t.pager&&t.pager.height||30:0))},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},setRegionColumnSize:function(e){this.options.columnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getVerticalScroll:function(){return this.table.getVerticalScroll()},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},restore:function(){this.table.restore()},attr:function(){BI.PageTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},populate:function(){this.pager.populate(),this.table.populate.apply(this.table,arguments)},destroy:function(){this.table.destroy(),this.pager&&this.pager.destroy(),BI.PageTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.page_table",BI.PageTable)},function(e,t,n){"use strict";BI.PreviewTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PreviewTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-preview-table-cell",text:""})},_init:function(){BI.PreviewTableCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,textAlign:e.textAlign||"left",whiteSpace:e.whiteSpace||"normal",height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.preview_table_cell",BI.PreviewTableCell)},function(e,t,n){"use strict";BI.PreviewTableHeaderCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PreviewTableHeaderCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-preview-table-header-cell",text:""})},_init:function(){BI.PreviewTableHeaderCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,textAlign:e.textAlign||"left",whiteSpace:e.whiteSpace||"nowrap",height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.preview_table_header_cell",BI.PreviewTableHeaderCell)},function(e,t,n){"use strict";BI.PreviewTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PreviewTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-preview-table",isNeedFreeze:!1,freezeCols:[],rowSize:null,columnSize:[],headerRowSize:30,header:[],items:[]})},_init:function(){BI.PreviewTable.superclass._init.apply(this,arguments);var e=this,t=this.options;this.table=BI.createWidget({type:"bi.table_view",element:this,isNeedResize:!1,isNeedFreeze:t.isNeedFreeze,freezeCols:t.freezeCols,rowSize:t.rowSize,columnSize:t.columnSize,headerRowSize:t.headerRowSize,header:BI.map(t.header,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_header_cell"},t)})}),items:BI.map(t.items,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_cell"},t)})})}),this.table.on(BI.Table.EVENT_TABLE_AFTER_INIT,function(){e.fireEvent(BI.Table.EVENT_TABLE_AFTER_INIT,arguments)}),this.table.on(BI.Table.EVENT_TABLE_RESIZE,function(){e._adjustColumns()}),this._adjustColumns()},_hasAdaptCol:function(e){return BI.any(e,function(e,t){return""===t})},_isPercentage:function(e){return e[0]<=1},_adjustColumns:function(){var n,i,r,e,o,a,s,l,c=this.options;!0===c.isNeedFreeze?this._isPercentage(c.columnSize)&&(this._hasAdaptCol(c.columnSize)&&(n=[],i=0,BI.each(c.columnSize,function(e,t){""===t?n.push(e):i+=t}),r=(i=1-i)/n.length,BI.each(n,function(e,t){c.columnSize[t]=r})),e=0!==BI.first(c.freezeCols),o=[],a=[],BI.each(c.columnSize,function(e,t){(c.freezeCols.includes(e)?o:a).push(t)}),s=BI.sum(o),l=BI.sum(a),BI.each(o,function(e,t){o[e]=t/s}),BI.each(a,function(e,t){a[e]=t/l}),this.table.setRegionColumnSize(e?["fill",s]:[s,"fill"]),this.table.setColumnSize(e?a.concat(o):o.concat(a))):(this._hasAdaptCol(c.columnSize)||this._isPercentage(c.columnSize))&&this.table.setRegionColumnSize(["100%"])},setColumnSize:function(e){return this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getCalculateColumnSize:function(){return this.table.getCalculateColumnSize()},setHeaderColumnSize:function(e){return this.table.setHeaderColumnSize(e)},setRegionColumnSize:function(e){return this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getCalculateRegionColumnSize:function(){return this.table.getCalculateRegionColumnSize()},getCalculateRegionRowSize:function(){return this.table.getCalculateRegionRowSize()},getClientRegionColumnSize:function(){return this.table.getClientRegionColumnSize()},getScrollRegionColumnSize:function(){return this.table.getScrollRegionColumnSize()},getScrollRegionRowSize:function(){return this.table.getScrollRegionRowSize()},hasVerticalScroll:function(){return this.table.hasVerticalScroll()},setVerticalScroll:function(e){return this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){return this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){return this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},getColumns:function(){return this.table.getColumns()},populate:function(e,t){e=e&&BI.map(e,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_cell"},t)})}),t=t&&BI.map(t,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_header_cell"},t)})}),this.table.populate(e,t),this._adjustColumns()}}),BI.PreviewTable.EVENT_CHANGE="PreviewTable.EVENT_CHANGE",BI.shortcut("bi.preview_table",BI.PreviewTable)},function(e,t,n){"use strict";BI.SequenceTableListNumber=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.SequenceTableListNumber.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sequence-table-list-number",isNeedFreeze:!1,scrollTop:0,startSequence:1,headerRowSize:25,rowSize:25,rowSizeGetter:BI.emptyFn,headerRowSizeGetter:BI.emptyFn,sequenceHeaderCreator:BI.emptyFn,header:[],items:[],crossHeader:[],crossItems:[],pageSize:20,width:60})},_init:function(){BI.SequenceTableListNumber.superclass._init.apply(this,arguments);var e=this.options;this.start=e.startSequence,this.gridView=BI.createWidget({type:"bi.grid_view",overflowX:!1,overflowY:!1,scrollTop:e.scrollTop,columnCount:1,estimatedColumnSize:e.width,width:e.width,rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:function(){return e.width}}),this.headerContainer=BI.createWidget({type:"bi.absolute",cls:"sequence-table-header-cell bi-border-top bi-border-left bi-border-bottom bi-border-right",width:e.width,scrollable:!1}),this.layout=BI.createWidget({type:"bi.vtape",element:this,items:[{el:this.headerContainer,height:2},{el:this.gridView,height:"fill"}]}),this.populate()},_rowHeightGetter:function(e){return this.rowHeights&&(e=this.rowHeights[e],BI.isNotNull(e))?e:this.options.rowSize},_layout:function(){var e=this.options,t=(this.headerContainer.empty(),e.headerRowSizeGetter()),t=BI.sum(t),n=(BI.createWidget({type:"bi.absolute",element:this.headerContainer,items:[{el:BI.extend({type:"bi.table_style_cell",height:t-2,cls:"sequence-table-title-cell",styleGetter:e.headerCellStyleGetter,text:BI.i18nText("BI-Number_Index"),_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),left:0,top:0,right:0,bottom:0}]}),this.layout.attr("items")),n=(!1===e.isNeedFreeze?n[0].height=0:!0===e.isNeedFreeze&&(n[0].height=t),this.layout.attr("items",n),this.layout.resize(),this.numbers=this._formatNumber(e.items),0<e.items.length?BI.sum(this.rowHeights)/e.items.length:0);this.gridView.setEstimatedRowSize(n),this.gridView.setHeight(e.height-t)},_formatNumber:function(e){var i=this,r=this.options,o=this.rowHeights=r.rowSizeGetter();return BI.map(e,function(n,e){return BI.map(e,function(e,t){return{type:"bi.table_style_cell",cls:"sequence-table-number-cell bi-border-left bi-border-bottom bi-border-right "+(n%2!=0?"even-row":"odd-row"),width:r.width,height:o?o[n]:r.rowSize,text:i.start+n,styleGetter:function(){return r.sequenceCellStyleGetter(i.start+n-1)},_store:r.tableStyleCellStoreGetter}})})},_calculateChildrenToRender:function(){var e=this.options;this.gridView._populate(this.numbers),this.gridView.setScrollTop(e.scrollTop)},_populate:function(){this._calculateChildrenToRender()},setVerticalScroll:function(e){var t=this.options;t.scrollTop!==e&&(t.scrollTop=e,this.gridView.setScrollTop(t.scrollTop))},getVerticalScroll:function(){return this.options.scrollTop},setVPage:function(e){var t=this.options;this.start=((e=e<1?1:e)-1)*t.pageSize+1},setWidth:function(e){BI.SequenceTableListNumber.superclass.setWidth.apply(this,arguments),this.gridView.setWidth(e),this.headerContainer.setWidth(e)},_restore:function(){this.gridView.restore()},restore:function(){this._restore()},setPagesize:function(e){this.options.pageSize=e},populate:function(e,t){var n=this.options;e&&e!==this.options.items&&(n.items=e),t&&t!==this.options.header&&(n.header=t),this._restore(),this._layout(),this._populate()}}),BI.shortcut("bi.sequence_table_list_number",BI.SequenceTableListNumber)},function(e,t,n){"use strict";BI.SequenceTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.SequenceTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sequence-table",el:{type:"bi.adaptive_table"},sequence:{},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[],showSequence:!1,startSequence:1,seqWidth:60})},_init:function(){BI.SequenceTable.superclass._init.apply(this,arguments);var e=this,t=this.options;this.table=BI.createWidget(t.el,{type:"bi.adaptive_table",width:!0===t.showSequence?t.width-t.seqWidth:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:t.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:t.mergeCols,mergeRule:t.mergeRule,columnSize:t.columnSize,minColumnSize:t.minColumnSize,maxColumnSize:t.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,headerCellStyleGetter:t.headerCellStyleGetter,summaryCellStyleGetter:t.summaryCellStyleGetter,sequenceCellStyleGetter:t.sequenceCellStyleGetter,tableStyleCellStoreGetter:t.tableStyleCellStoreGetter,header:t.header,items:t.items,crossHeader:t.crossHeader,crossItems:t.crossItems}),this.sequence=BI.createWidget(t.sequence,{type:"bi.sequence_table_list_number",invisible:!1===t.showSequence,startSequence:t.startSequence,isNeedFreeze:t.isNeedFreeze,header:t.header,items:t.items,crossHeader:t.crossHeader,crossItems:t.crossItems,headerRowSize:t.headerRowSize,rowSize:t.rowSize,rowSizeGetter:function(){return e.table.getFirstColumnRowSize()},headerRowSizeGetter:function(){return e.table.getFirstColumnHeaderRowSize()},width:t.seqWidth,height:t.height&&t.height-BI.GridTableScrollbar.SIZE,headerCellStyleGetter:t.headerCellStyleGetter,summaryCellStyleGetter:t.summaryCellStyleGetter,sequenceCellStyleGetter:t.sequenceCellStyleGetter,tableStyleCellStoreGetter:t.tableStyleCellStoreGetter}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.sequence.getVerticalScroll()!==this.getVerticalScroll()&&e.sequence.setVerticalScroll(this.getVerticalScroll()),e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.sequence.setVerticalScroll(this.getVerticalScroll()),e.sequence.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.sequence.setVerticalScroll(this.getVerticalScroll()),e.sequence.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)}),this.htape=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.sequence,left:0,top:0},{el:this.table,top:0,left:!0===t.showSequence?t.seqWidth:0}]}),this._populate()},_populate:function(){var e=this.options;!0===e.showSequence?(this.sequence.setVisible(!0),this.table.element.css("left",e.seqWidth+"px"),this.table.setWidth(e.width-e.seqWidth),this.sequence.setWidth(e.seqWidth)):(this.sequence.setVisible(!1),this.table.element.css("left","0px"),this.table.setWidth(e.width))},setWidth:function(e){BI.PageTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(this.options.showSequence?e-this.options.seqWidth:e)},setHeight:function(e){BI.PageTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e),this.sequence.setHeight(e-BI.GridTableScrollbar.SIZE)},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},setRegionColumnSize:function(e){this.options.columnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},hasLeftHorizontalScroll:function(){return this.table.hasLeftHorizontalScroll()},hasRightHorizontalScroll:function(){return this.table.hasRightHorizontalScroll()},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e),this.sequence.setVerticalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},setVPage:function(e){this.sequence.setVPage&&this.sequence.setVPage(e)},setHPage:function(e){this.sequence.setHPage&&this.sequence.setHPage(e)},attr:function(){BI.SequenceTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments),this.sequence.attr.apply(this.sequence,arguments)},restore:function(){this.table.restore(),this.sequence.restore()},populate:function(e,t,n,i){var r=this.options;e&&(r.items=e),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._populate(),this.table.populate.apply(this.table,arguments),this.sequence.populate.apply(this.sequence,arguments),this.sequence.setVerticalScroll(this.table.getVerticalScroll())},destroy:function(){this.table.destroy(),BI.SequenceTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.sequence_table",BI.SequenceTable)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-grid-table",el:{},isNeedResize:!0,freezeCols:[],columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},render:function(){var e=this.options;this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[]}),this.header=this._getHeader(),this.items=this._getItems(),(0<e.header.length||0<e.items.length)&&this._populate()},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize},_getActualItems:function(){return this.options.items},_getHeader:function(){var e=this.options,i=[];return BI.each(e.header,function(n,e){i[n]=[],BI.each(e,function(e,t){i[n].push({type:"bi.grid_table_cell",extraCls:(0===n?"first-row":"")+(0===e?" first-col":""),cell:t})})}),i},_getItems:function(){var r=this.options,o=[],a=!(r.header&&0<r.header.length);return BI.each(this._getActualItems(),function(i,e){o[i]=[],BI.each(e,function(e,t){var n=r.customCell?(t&&(t.firstRowTopLine=a),n.extraCls=(0===i?"first-row":"")+(0===e?" first-col":""),t):{type:"bi.grid_table_cell",cell:t,extraCls:(0===i?"first-row":"")+(0===e?" first-col":""),firstRowTopLine:a};o[i].push(n)})}),o},_populateTable:function(){var i=this.options;this.getRegionSize(),this._getFreezeColLength();BI.each(i.columnSize,function(e,t){!0===i.isNeedFreeze&&i.freezeCols.includes(e)?0:0,e,0}),this.contextLayout.populate(BI.map(this.header,function(e,t){t={type:"bi.vertical_adapt",items:BI.map(t,function(e,t){return BI.extend({width:i.columnSize[e],height:i.headerRowSize},t)})};return i.showSequence?{type:"bi.vertical_adapt",items:[{type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:i.seqWidth,height:i.headerRowSize,styleGetter:i.headerCellStyleGetter,_store:i.tableStyleCellStoreGetter},t]}:t}).concat(BI.map(this.items,function(e,t){var n,t={type:"bi.vertical_adapt",verticalAlign:"stretch",items:BI.map(t,function(e,t){return BI.extend({width:i.columnSize[e],height:i.rowSize},t)})};return i.showSequence?{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:i.seqWidth,styleGetter:function(){return i.sequenceCellStyleGetter(n)},text:(n=e)+1,_store:i.tableStyleCellStoreGetter},t]}:t})))},_populate:function(){this._populateTable()},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this.options.columnSize=e,this._isNeedDigest=!0},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this._isNeedDigest=!0},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},populate:function(e,t){var n=this.options.header!==t,i=this.options.items!==e;t&&n&&(this.options.header=t),e&&i&&(this.options.items=e),e&&i&&(this.items=this._getItems()),t&&n&&(this.header=this._getHeader()),this._populate()},restore:function(){}}),BI.shortcut("bi.spread_sequence_grid_table",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-layer-tree-table",el:{},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1,showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_createHeader:function(e){var t=this.options,n=t.header||[],i=t.crossHeader||[],e=BI.isEmpty(n)?BI.TableTree.formatCrossItems4Special(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}):BI.TableTree.formatCrossItems(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}),r=[],e=(BI.each(e,function(e,t){e=[i[e]];r.push(e.concat(t||[]))}),BI.isFunction(t.rowHeaderCreator)?t.rowHeaderCreator():t.rowHeaderCreator);return n&&0<n.length&&(n=this._formatColumns(n),this._getHDeep()<=0?n.unshift(e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter}):n[0]=e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter},r.push(n)),r},_formatItems:function(e,t,n){var i=this.options,r=[];return BI.each(e,function(e,t){var n;BI.each(t.children,function(e,t){!function i(e,n){e.type||(e.type="bi.layer_tree_table_cell"),e.layer=n;var t=[e];0<(t=t.concat(e.values||[])).length&&r.push(t),BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){i(t,n+1)})}(t,0)}),BI.isArray(t.values)&&(n=[{type:"bi.table_style_cell",text:i.summaryText,title:i.summaryText,styleGetter:function(){return i.summaryCellStyleGetter(!0,BI.get(t,["children",0,"dId"]))},_store:i.tableStyleCellStoreGetter}].concat(t.values),"bottom"===i.rowPosition?r.push(n):r.unshift(n))}),BI.DynamicSummaryTreeTable.formatSummaryItems(r,t,i.crossItems,1)},_formatColumns:function(e,t){return BI.isNotEmptyArray(e)?(t=t||this._getHDeep(),e.slice(Math.max(0,t-1))):e},_formatFreezeCols:function(){return 0<this.options.freezeCols.length?[0]:[]},_formatMergeCols:function(){return 0<this.options.mergeCols.length?[0]:[]},_formatColumnSize:function(e,n){var i;return e.length<=0?[]:(i=[0],n=n||this._getHDeep(),BI.each(e,function(e,t){e<n?i[0]+=t:i.push(t)}),i)},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=this._createHeader(n),n=this._formatItems(e.items,n,t),i=e.columnSize.slice(),r=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(i,n.deletedCols),BI.removeAt(r,n.deletedCols),BI.removeAt(e,n.deletedCols),{header:n.header,items:n.items,columnSize:this._formatColumnSize(i,t),minColumnSize:this._formatColumns(r,t),maxColumnSize:this._formatColumns(e,t),freezeCols:this._formatFreezeCols(),mergeCols:this._formatMergeCols()}},render:function(){var t=this,e=this.options,n=(this._width=0,this._height=0,this._digest());this.topRightCollection=BI.createWidget({type:"bi.collection_view",cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1}),this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[e.showSequence?{type:"bi.vertical_adapt",items:[BI.extend({type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:e.seqWidth,height:this._getFreezeHeaderHeight(n.header),styleGetter:e.headerCellStyleGetter,ref:function(e){t.headerSeq=e},_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),this.topRightCollection]}:{el:this.topRightCollection},{el:this.bottomRight}]}),(0<n.header.length||0<n.items.length)&&(this._digestTable(n.header,n.items,n),this._populate(n.header,n.items,n))},populate:function(e,t,n,i){var r=this.options,n=(e&&(r.items=e),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.headerSeq&&this.headerSeq.setHeight(this._getFreezeHeaderHeight(n.header)),e=n.items,t=n.header,e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate(t,e,n)},_getFreezeHeaderHeight:function(e){var t=this.options;return e.length*t.headerRowSize},_populateTable:function(e,t,n){var a=this.options,i=(this.getRegionSize(),0),r=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,i+=t,e,0}),this.topRightCollection.setWidth(i),this.topRightCollection.setHeight(this._getFreezeHeaderHeight(e)),[]);(function(e,n,i,r,o){BI.each(e,function(e,t){!r&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=r,n[t.row][t.col].firstColumnLeftLine=o,i.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:r,firstColumnLeftLine:o},i.push(t))})})(this.topRightItems,e,r,!0,!0),this.topRightCollection._populate(r),this.bottomRight.populate(this.bottomRightItems)},_digestTable:function(e,t,n){var i=this.options,r=!0===i.isNeedMerge?BI.clamp(n.mergeCols.length,0,n.columnSize.length):0;this.topRightItems=BI.CollectionTable.serialize(e,0,n.columnSize.length,i.headerRowSize,n.columnSize,!0,[],i.mergeRule),this.bottomRightItems=this._serializeItems(t,0,r,i.rowSize,n.columnSize,n.mergeCols)},_serializeItems:function(a,o,s,r,l,c,u){c=c||[],u=u||[];for(var h=this.options,d=h.startSequence,p=[],f={},m={},g={},y={},b=[],e=o;e<s;e++)b[e]=e===o?l[e]:b[e-1]+l[e];var i,v=function v(e,t){m[t]._height+=r,m[t].__mergeRows.push(e),g[e]=m[t]},x=function x(e,t){g[e]._width+=l[t],g[e].__mergeCols.push(t)},I=function I(e,t){var n=l[t],i=r,n=(y[e][t]._row=e,y[e][t]._col=t,y[e][t]._width=n,y[e][t]._height=i,{x:b[t]-l[t],y:+e*r,item:y[e][t]});m[t]=y[e][t],m[t].__mergeRows=[e],g[e]=y[e][t],g[e].__mergeCols=[t],p.push(n)},S=(BI.each(a,function(e,t){for(var n,i,r=o;r<s;r++)f[e]||(f[e]={}),y[e]||(y[e]={}),f[e][r]=t[r],y[e][r]={},!0===c||-1<c.indexOf(r)||!0===u||-1<u.indexOf(e)?0===e&&r===o?I(0,o):r===o&&0<e?!0===(n=h.mergeRule(f[e][r],f[e-1][r]))?(v(e,r),g[e]=m[r]):I(e,r):0===e&&o<r?!0===(i=h.mergeRule(f[e][r],f[e][r-1]))?(x(e,r),m[r]=g[e]):I(e,r):(n=h.mergeRule(f[e][r],f[e-1][r]),(i=h.mergeRule(f[e][r],f[e][r-1]))&&n||(i&&x(e,r),n&&v(e,r),i)||n||I(e,r)):I(e,r)}),[]),n=(BI.each(p,function(e,t){var n=a[t.item._row][t.item._col];(!n.layer||n.layer<=i)&&(S=S.slice(0,n.layer||0)),t.parent=S[S.length-1],n.children&&0!==n.children.length?(S.push(t),i=n.layer):t.isLastNode=!0}),[]),_=BI.UUID();function C(e,t,n){return BI.extend({type:"bi.label",textAlign:"left",lgap:25,width:e.item._width,_columnIndex:e.item._col,_rowIndex:e.item._row,firstRowTopLine:!1,firstColumnLeftLine:!0,extraCls:"collection-cell"+(0===e.item._row?" first-row":"")+(0===e.item._col?" first-col":""),mounted:function(){e.isLastNode||BI.createWidget({type:"bi.absolute_vertical_adapt",element:this,lgap:6,items:[{type:"bi.icon_button",tagName:"label",attributes:{"for":_+"-"+e.item._row+"-"+e.item._col},cls:(n?"plus-font":"minus-font")+" icon-size-12",iconWidth:12,iconHeight:12,width:12,height:12}]})}},t,a[e.item._row][e.item._col])}function w(e,t){t=y[e][t];return"bottom"===h.rowPosition?e+t.__mergeRows.length-1:e}function E(e){e=a[e].slice(s);return{type:"bi.vertical_adapt",items:BI.map(e,function(e,t){return BI.extend({type:"bi.label",width:l[s+e],height:r,extraCls:"collection-cell"},t)})}}return BI.each(p,function(e,t){var n,i,r=a.length-1===t.item._row,o={type:"bi.vertical",scrolly:!1,items:[{type:"bi.layout",tagName:"input",cls:"spread-sequence-table-checkbox",invisible:!0,attributes:{type:"checkbox",id:_+"-"+t.item._row+"-"+t.item._col}},a[t.item._row][t.item._col].children?{type:"bi.vertical_adapt",cls:"summary-line",verticalAlign:"stretch",items:[t.parent||!0!==h.showSequence?{type:"bi.layout"}:{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(i=d,function(){return r?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(i)}),text:r?h.summaryText:d,_store:h.tableStyleCellStoreGetter},{el:C(t,{width:b[s-1]-(0<t.item._col?b[t.item._col-1]:0)},!0)},E(w(t.item._row,t.item._col))]}:{type:"bi.layout"},{type:"bi.vertical_adapt",cls:"expand-line",verticalAlign:"stretch",items:[t.parent||!0!==h.showSequence?{type:"bi.layout"}:{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(n=d,function(){return r?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(n)}),text:r?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{type:"bi.vertical",items:[{el:{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{el:C(t)},E(w(t.item._row,t.item._col))]}},{type:"bi.vertical",scrolly:!1,items:[]}]}]}]};t.layout=o,t.parent&&t.parent.layout.items[2].items[1].items[1].items.push(o)}),BI.each(p,function(e,t){t.parent||n.push(t.layout)}),n},_populate:function(e,t,n){!0===this._isNeedDigest&&this._digestTable(e,t,n),this._isNeedDigest=!1,this._populateTable(e,t,n)},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},_restore:function(){this.topRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.spread_sequence_layer_tree_table",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-list-table",el:{},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1,showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},render:function(){var t=this,e=this.options,n=(this._width=0,this._height=0,this._digest());this.topRightCollection=BI.createWidget({type:"bi.collection_view",cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1}),this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[e.showSequence?{type:"bi.vertical_adapt",items:[BI.extend({type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:e.seqWidth,height:this._getFreezeHeaderHeight(n.header),styleGetter:e.headerCellStyleGetter,ref:function(e){t.headerSeq=e},_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),this.topRightCollection]}:{el:this.topRightCollection},{el:this.bottomRight}]}),(0<n.header.length||0<n.items.length)&&(this._digestTable(n.header,n.items),this._populate(n.header,n.items))},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),i=BI.DynamicSummaryTreeTable.formatHorizontalItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter}),i=BI.DynamicSummaryTreeTable.formatSummaryItems(i,n,e.crossItems,t),n=e.columnSize.slice(),t=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(n,i.deletedCols),BI.removeAt(t,i.deletedCols),BI.removeAt(e,i.deletedCols),{header:i.header,items:i.items,columnSize:n,minColumnSize:t,maxColumnSize:e}},populate:function(e,t,n,i){var r=this.options,n=(e&&(r.items=e),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.headerSeq&&this.headerSeq.setHeight(this._getFreezeHeaderHeight(n.header)),this.setColumnSize(n.columnSize),r.minColumnSize=n.minColumnSize,r.maxColumnSize=n.maxColumnSize,e=n.items,t=n.header,e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate(t,e)},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedMerge?BI.clamp(e.mergeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(e){var t=this.options;return e.length*t.headerRowSize},_populateTable:function(e,t){var a=this.options,n=(this.getRegionSize(),0),i=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,n+=t,e,0}),this.topRightCollection.setWidth(n),this.topRightCollection.setHeight(this._getFreezeHeaderHeight(e)),[]);(function(e,n,i,r,o){BI.each(e,function(e,t){!r&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=r,n[t.row][t.col].firstColumnLeftLine=o,i.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:r,firstColumnLeftLine:o},i.push(t))})})(this.topRightItems,e,i,!0,!0),this.topRightCollection._populate(i),this.bottomRight.populate(this.bottomRightItems)},_digestTable:function(e,t){var n=this.options,i=this._getFreezeColLength();this.topRightItems=BI.CollectionTable.serialize(e,0,n.columnSize.length,n.headerRowSize,n.columnSize,!0,[],n.mergeRule),this.bottomRightItems=this._serializeItems(t,0,i,n.rowSize,n.columnSize,n.mergeCols)},_serializeItems:function(s,o,a,l,r,c,u){c=c||[],u=u||[];for(var h=this.options,d=h.startSequence,p=[],f={},m={},g={},y={},b=[],e=o;e<a;e++)b[e]=e===o?r[e]:b[e-1]+r[e];var v=function v(e,t){m[t]._height+=l,m[t].__mergeRows.push(e),g[e]=m[t]},x=function x(e,t){g[e]._width+=r[t],g[e].__mergeCols.push(t)},I=function I(e,t){var n=r[t],i=l,n=(y[e][t]._row=e,y[e][t]._col=t,y[e][t]._width=n,y[e][t]._height=i,{x:b[t]-r[t],y:+e*l,item:y[e][t],parent:g[e]&&g[e].el});m[t]=y[e][t],m[t].__mergeRows=[e],g[e]=y[e][t],g[e].__mergeCols=[t],g[e].el=n,p.push(n)},i=(BI.each(s,function(e,t){for(var n,i,r=o;r<a;r++)f[e]||(f[e]={}),y[e]||(y[e]={}),f[e][r]=t[r],y[e][r]={},!0===c||-1<c.indexOf(r)||!0===u||-1<u.indexOf(e)?0===e&&r===o?I(0,o):r===o&&0<e?!0===(n=h.mergeRule(f[e][r],f[e-1][r]))?(v(e,r),g[e]=m[r]):I(e,r):0===e&&o<r?!0===(i=h.mergeRule(f[e][r],f[e][r-1]))?(x(e,r),m[r]=g[e]):I(e,r):(n=h.mergeRule(f[e][r],f[e-1][r]),(i=h.mergeRule(f[e][r],f[e][r-1]))&&n||(i&&x(e,r),n&&v(e,r),i)||n||I(e,r)):I(e,r)}),[]),S=BI.UUID();function _(e,t,n,i){return BI.extend({type:"bi.label",textAlign:"left",lgap:25,width:e.item._width,height:l,_columnIndex:e.item._col,_rowIndex:e.item._row,firstRowTopLine:!1,firstColumnLeftLine:!0,extraCls:"collection-cell"+(0===e.item._row?" first-row":"")+(0===e.item._col?" first-col":""),mounted:function(){i&&!e.isLastNode&&BI.createWidget({type:"bi.absolute_vertical_adapt",element:this,lgap:6,items:[{type:"bi.icon_button",tagName:"label",attributes:{"for":S+"-"+e.item._row+"-"+e.item._col},cls:(n?"plus-font":"minus-font")+" icon-size-12",iconWidth:12,iconHeight:12,width:12,height:12}]})}},t,s[e.item._row][e.item._col])}function C(e,t,n){var i,r,o=_(e,t,n,!0),a=s[e.item._row][e.item._col],a=!a.children||0===a.children.length;return e.parent||!0!==h.showSequence?a?[{el:o}]:BI.map([o].concat(BI.map(BI.range(e.item.__mergeRows.length-1),function(){return _(e,t,n,!1)})),function(e,t){return{el:t,height:l}}):(i=s.length-1===e.item._row,{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(r=d,function(){return i?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(r)}),text:n?d:i?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{el:{type:"bi.vtape",width:e.item._width,scrolly:!1,scrollable:!1,items:a?[{el:o}]:BI.map([o].concat(BI.map(BI.range(e.item.__mergeRows.length-1),function(){return _(e,t,n,!1)})),function(e,t){return{el:t,height:l}})}}]})}function w(e){return e.layout.items[2].items[1].items}function E(e){e=s[e].slice(a);return{type:"bi.vertical_adapt",items:BI.map(e,function(e,t){return BI.extend({type:"bi.label",width:r[a+e],height:l,extraCls:"collection-cell"},t)})}}return BI.each(p,function(e,t){var n,i,r,o={type:"bi.vertical",scrolly:!1,items:[{type:"bi.layout",tagName:"input",cls:"spread-sequence-table-checkbox",invisible:!0,attributes:{type:"checkbox",id:S+"-"+t.item._row+"-"+t.item._col}},s[t.item._row][t.item._col].children?{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"summary-line",items:[{el:(n={width:b[a-1]-(0<(o=t).item._col?b[t.item._col-1]:0)},n=_(o,n,i=!0,!0),o.parent||!0!==h.showSequence?n:(r=s.length-1===o.item._row,{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:function(e){return function(){return r?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(e)}}(d),text:i?d:r?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{el:n}]}))},E(function(e,t){t=y[e][t];return"bottom"===h.rowPosition?e+t.__mergeRows.length-1:e}(t.item._row,t.item._col))]}:{type:"bi.layout"},{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"expand-line",items:[{el:t.parent||!0!==h.showSequence?{type:"bi.vtape",width:t.item._width,scrolly:!1,scrollable:!1,items:C(t)}:C(t)},{type:"bi.vertical",scrolly:!1,items:[]}]}]};t.layout=o,t.parent&&w(t.parent).push(o)}),BI.each(p,function(e,t){var n;0===w(t).length&&(n=E(t.item._row),t.isLastNode=!0,w(t).push(n)),t.parent||i.push(t.layout)}),i},_populate:function(e,t){!0===this._isNeedDigest&&this._digestTable(e,t),this._isNeedDigest=!1,this._populateTable(e,t)},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},_restore:function(){this.topRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.spread_sequence_list_table",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-table",el:{},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1,showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},render:function(){var t=this,e=this.options,n=(this._width=0,this._height=0,this._digest());this.topRightCollection=BI.createWidget({type:"bi.collection_view",cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1}),this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[e.showSequence?{type:"bi.vertical_adapt",items:[BI.extend({type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:e.seqWidth,height:this._getFreezeHeaderHeight(n.header),styleGetter:e.headerCellStyleGetter,ref:function(e){t.headerSeq=e},_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),this.topRightCollection]}:{el:this.topRightCollection},{el:this.bottomRight}]}),(0<n.header.length||0<n.items.length)&&(this._digestTable(n.header,n.items),this._populate(n.header,n.items))},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),i=BI.DynamicSummaryTreeTable.formatHorizontalItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter}),i=BI.DynamicSummaryTreeTable.formatSummaryItems(i,n,e.crossItems,t),n=e.columnSize.slice(),t=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(n,i.deletedCols),BI.removeAt(t,i.deletedCols),BI.removeAt(e,i.deletedCols),{header:i.header,items:i.items,columnSize:n,minColumnSize:t,maxColumnSize:e}},populate:function(e,t,n,i){var r=this.options,n=(e&&(r.items=e),t&&(r.header=t),n&&(r.crossItems=n),i&&(r.crossHeader=i),this._digest());this.headerSeq&&this.headerSeq.setHeight(this._getFreezeHeaderHeight(n.header)),this.setColumnSize(n.columnSize),r.minColumnSize=n.minColumnSize,r.maxColumnSize=n.maxColumnSize,e=n.items,t=n.header,e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate(t,e)},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedMerge?BI.clamp(e.mergeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(e){var t=this.options;return e.length*t.headerRowSize},_populateTable:function(e,t){var a=this.options,n=(this.getRegionSize(),0),i=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,n+=t,e,0}),this.topRightCollection.setWidth(n),this.topRightCollection.setHeight(this._getFreezeHeaderHeight(e)),[]);(function(e,n,i,r,o){BI.each(e,function(e,t){!r&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=r,n[t.row][t.col].firstColumnLeftLine=o,i.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:r,firstColumnLeftLine:o},i.push(t))})})(this.topRightItems,e,i,!0,!0),this.topRightCollection._populate(i),this.bottomRight.populate(this.bottomRightItems)},_digestTable:function(e,t){var n=this.options,i=this._getFreezeColLength();this.topRightItems=BI.CollectionTable.serialize(e,0,n.columnSize.length,n.headerRowSize,n.columnSize,!0,[],n.mergeRule),this.bottomRightItems=this._serializeItems(t,0,i,n.rowSize,n.columnSize,n.mergeCols)},_serializeItems:function(o,a,s,r,l,c,u){c=c||[],u=u||[];for(var h=this.options,d=h.startSequence,p=[],f={},m={},g={},y={},b=[],e=a;e<s;e++)b[e]=e===a?l[e]:b[e-1]+l[e];var v=function v(e,t){m[t]._height+=r,m[t].__mergeRows.push(e),g[e]=m[t]},x=function x(e,t){g[e]._width+=l[t],g[e].__mergeCols.push(t)},I=function I(e,t){var n=l[t],i=r,n=(y[e][t]._row=e,y[e][t]._col=t,y[e][t]._width=n,y[e][t]._height=i,{x:b[t]-l[t],y:+e*r,item:y[e][t],parent:g[e]&&g[e].el});m[t]=y[e][t],m[t].__mergeRows=[e],g[e]=y[e][t],g[e].__mergeCols=[t],g[e].el=n,p.push(n)},i=(BI.each(o,function(e,t){for(var n,i,r=a;r<s;r++)f[e]||(f[e]={}),y[e]||(y[e]={}),f[e][r]=t[r],y[e][r]={},!0===c||-1<c.indexOf(r)||!0===u||-1<u.indexOf(e)?0===e&&r===a?I(0,a):r===a&&0<e?!0===(n=h.mergeRule(f[e][r],f[e-1][r]))?(v(e,r),g[e]=m[r]):I(e,r):0===e&&a<r?!0===(i=h.mergeRule(f[e][r],f[e][r-1]))?(x(e,r),m[r]=g[e]):I(e,r):(n=h.mergeRule(f[e][r],f[e-1][r]),(i=h.mergeRule(f[e][r],f[e][r-1]))&&n||(i&&x(e,r),n&&v(e,r),i)||n||I(e,r)):I(e,r)}),[]),S=BI.UUID();function _(e,t,n){var i,r,t=BI.extend({type:"bi.label",textAlign:"left",lgap:25,width:e.item._width,_columnIndex:e.item._col,_rowIndex:e.item._row,firstRowTopLine:!1,firstColumnLeftLine:!0,extraCls:"collection-cell"+(0===e.item._row?" first-row":"")+(0===e.item._col?" first-col":""),mounted:function(){e.isLastNode||BI.createWidget({type:"bi.absolute_vertical_adapt",element:this,lgap:6,items:[{type:"bi.icon_button",tagName:"label",attributes:{"for":S+"-"+e.item._row+"-"+e.item._col},cls:(n?"plus-font":"minus-font")+" icon-size-12",iconWidth:12,iconHeight:12,width:12,height:12}]})}},t,o[e.item._row][e.item._col]);return e.parent||!0!==h.showSequence?t:(i=o.length-1===e.item._row,{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(r=d,function(){return i?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(r)}),text:n?d:i?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{el:t}]})}function C(e){return e.layout.items[2].items[1].items}function w(e){e=o[e].slice(s);return{type:"bi.vertical_adapt",items:BI.map(e,function(e,t){return BI.extend({type:"bi.label",width:l[s+e],height:r,extraCls:"collection-cell"},t)})}}return BI.each(p,function(e,t){var n={type:"bi.vertical",scrolly:!1,items:[{type:"bi.layout",tagName:"input",cls:"spread-sequence-table-checkbox",invisible:!0,attributes:{type:"checkbox",id:S+"-"+t.item._row+"-"+t.item._col}},o[t.item._row][t.item._col].children?{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"summary-line",items:[{el:_(t,{width:b[s-1]-(0<t.item._col?b[t.item._col-1]:0)},!0)},w(function(e,t){t=y[e][t];return"bottom"===h.rowPosition?e+t.__mergeRows.length-1:e}(t.item._row,t.item._col))]}:{type:"bi.layout"},{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"expand-line",items:[{el:_(t)},{type:"bi.vertical",scrolly:!1,items:[]}]}]};t.layout=n,t.parent&&C(t.parent).push(n)}),BI.each(p,function(e,t){var n;0===C(t).length&&(n=w(t.item._row),t.isLastNode=!0,C(t).push(n)),t.parent||i.push(t.layout)}),i},_populate:function(e,t){!0===this._isNeedDigest&&this._digestTable(e,t),this._isNeedDigest=!1,this._populateTable(e,t)},getRegionSize:function(){var n=this.options,i=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(i||BI.each(n.freezeCols,function(e,t){i+=n.columnSize[t]}),i)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},_restore:function(){this.topRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.spread_sequence_table",i)},function(e,t,n){"use strict";n(44);var r=n(73),u=(n(72),["items","id","pId","layer","isParent","draggable","checkable","prevComponent"]);function h(e,t){if(null==e)return{};var n,i=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)n=r[o],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n]);return i}function i(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){a(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var s=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(s.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sticky-table",headerRowSize:30,rowSize:30,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[0],scrollLeft:0,scrollTop:0,sortable:!0,checkable:!0,bordered:!1,stripe:!1,hover:!1,header:[],items:[],itemsCreator:BI.emptyFn})},render:function(){var e,n=this,i=this.options;this.headerColletion=BI.createWidget({type:"bi.sticky_table_header",css:{overflowY:"scroll",overflowX:"hidden"},columnSize:i.columnSize,minColumnSize:i.minColumnSize,maxColumnSize:i.maxColumnSize,freezeCols:i.freezeCols.slice(),header:i.header,headerRowSize:i.headerRowSize}),this.bottomRightCollection=BI.createWidget({type:"bi.virtual_tree_list",css:{overflowY:"scroll",overflowX:"auto"},items:this._formatItems(i.items),itemsCreator:function(e,t){i.itemsCreator(e,function(e){t(n._formatItems(e))})},el:{type:"bi.virtual_group_list",configRender:function(e){return o(o({},e),{},{scrolly:!1})},rowHeight:i.rowSize,el:{type:"bi.sticky_table_layout",ref:function(e){n.tableColletion=e},mirror:{appendTo:this.element[0]},columnSize:i.columnSize,minColumnSize:i.minColumnSize,maxColumnSize:i.maxColumnSize,isNeedFreeze:i.isNeedFreeze,freezeCols:i.freezeCols.slice(),sortable:i.sortable,checkable:i.checkable,listeners:(a(e={},r.StickyTableLayout.EVENT_END_DRAG,function(e){BI.nextTick(function(){n.bottomRightCollection.move(e[0],e[1]),n.fireEvent("EVENT_SORT",n.bottomRightCollection.getTree(),e[0],e[1])})}),a(e,r.StickyTableLayout.EVENT_START_DRAG,function(){i.scrollLeft=0,n._scrollHandler(),n.bottomRightCollection.element.scrollLeft(0),n.headerColletion.element.scrollLeft(0)}),e)}}}),this.contextLayout=BI.createWidget({type:"bi.vertical_fill",rowSize:["","fill"],cls:"".concat(i.bordered?"bordered":""," ").concat(i.stripe?"stripe":""," ").concat(i.hover?"hover":""),element:this,items:[{el:this.headerColletion},{el:this.bottomRightCollection}]})},_scrollHandler:function(){var e=this.options,t=(0<e.scrollLeft?this.element.addClass("fixed-left-scroll"):this.element.removeClass("fixed-left-scroll"),this.tableColletion.table.element.width()),n=this.element.width();t-(e.scrollLeft+n-BI.GridTableScrollbar.SIZE)<1?this.element.removeClass("fixed-right-scroll"):this.element.addClass("fixed-right-scroll")},_freeHandler:function(){var n,i=this;this._hasOtherFreezeCol()&&(n=this.headerColletion.getRealColumnSize(),this.options.freezeCols.forEach(function(e){var t=i.options.header[0].length;0!==e&&e!==t-1&&i.element[0].style.setProperty("--index-".concat(e,"-left"),"".concat(n.slice(0,e).reduce(function(e,t){return t+e},0),"px"))}))},_handleResize:function(){this.options.scrollLeft=this.bottomRightCollection.element.scrollLeft(),this._scrollHandler(),this._freeHandler()},_hasOtherFreezeCol:function(){var i=this.options;return BI.some(i.freezeCols,function(e,t){var n=i.header[0].length;if(0!==t&&t!==n-1)return!0})},mounted:function(){var e=this,t=this.options;(0<t.header.length||0<t.items.length)&&(this._digest(),this._populate()),this._scrollHandler(),this._freeHandler(),this.bottomRightCollection.element.scroll(function(){t.scrollTop=e.bottomRightCollection.element.scrollTop(),t.scrollLeft=e.bottomRightCollection.element.scrollLeft(),e._scrollHandler(),e.headerColletion.element.scrollLeft(t.scrollLeft)}),this.resizeObserver=BI.ResizeDetector.addResizeListener(this,this._handleResize.bind(this))},destroyed:function(){this.resizeObserver()},_populateTable:function(){var e=this.options;this.headerColletion.populate(e.header),this.bottomRightCollection.populate(this._formatItems(e.items))},_formatItems:function(e){var c=this;return e.map(function(e){var t=e.items,n=e.id,i=e.pId,r=e.layer,o=e.isParent,a=e.draggable,s=e.checkable,l=e.prevComponent,e=h(e,u);return{type:"bi.sticky_table_row",id:n,pId:i,layer:r,isParent:o,draggable:a,checkable:s,prevComponent:l,height:c.options.rowSize,dimension:e,items:t}})},_digest:function(){this.options},_populate:function(){this._populateTable()},setVerticalScroll:function(e){return this.bottomRightCollection.scrollTo(e)},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){return this.options.scrollTop},getRightHorizontalScroll:function(){return this.options.scrollLeft},setWidth:function(e){s.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){s.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this.options;this._isNeedDigest=!0,this.options.columnSize=e,this.headerColletion.setColumnSize(e),this.tableColletion.setColumnSize(e),this._scrollHandler(),this._freeHandler()},getColumnSize:function(){return this.options.columnSize},getRegionSize:function(){return 0},getRegionColumnSize:function(){return[]},setRegionColumnSize:function(){},getValue:function(){return this.bottomRightCollection.getValue()},populate:function(e,t){e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate()},_restore:function(){},restore:function(){this._restore()}}),l=(BI.shortcut("bi.freeze_table",s),BI.TableComponnet=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(l.superclass._defaultConfig.apply(this,arguments),{freezeCols:[],isNeedMerge:!1,mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:30,rowSize:30,sortable:!0,resizable:!0,checkable:!0,bordered:!1,stripe:!0,hover:!0,header:[],items:[],itemsCreator:BI.emptyFn})},attr:function(e,t){var n=l.superclass.attr.apply(this,arguments);return BI.isNull(t)?n:this.table.attr.apply(this.table,arguments)},render:function(){var i=this,e=this.options;return e.items[0]&&0<e.items[0].length?{type:"bi.resizable_table",ref:function(e){i.table=e},el:{type:"bi.table_view",bordered:e.bordered,stripe:e.stripe,hover:e.hover},width:e.width,height:e.height,isNeedFreeze:!0,freezeCols:e.freezeCols,isNeedResize:e.isNeedResize||e.resizable,minColumnSize:e.minColumnSize,maxColumnSize:e.maxColumnSize,columnSize:e.columnSize,headerRowSize:e.headerRowSize,rowSize:e.rowSize,isNeedMerge:e.isNeedMerge,mergeRule:e.mergeRule,header:e.header,items:e.items}:{type:"bi.resizable_table",ref:function(e){i.table=e},el:{type:"bi.freeze_table",ref:function(e){i.innerTable=e},listeners:[{eventName:"EVENT_SORT",action:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.fireEvent.apply(i,["EVENT_SORT"].concat(t))}}],freezeCols:e.freezeCols,itemsCreator:e.itemsCreator,sortable:e.sortable,checkable:e.checkable,bordered:e.bordered,stripe:e.stripe,hover:e.hover},width:e.width,height:e.height,isNeedResize:e.isNeedResize||e.resizable,minColumnSize:e.minColumnSize,maxColumnSize:e.maxColumnSize,columnSize:e.columnSize,headerRowSize:e.headerRowSize,rowSize:e.rowSize,header:e.header,items:e.items}},setVerticalScroll:function(e){return this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){return this.table.getVerticalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},setWidth:function(e){l.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){l.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.table.setColumnSize(e)},getColumnSize:function(){return this.options.columnSize},populate:function(e,t){this.table.populate(e,t)},getValue:function(){return this.innerTable.getValue()},restore:function(){this.table.restore()}}));BI.shortcut("bi.components.table",l)},function(e,t,n){"use strict";BI.WaterMark=BI.inherit(BI.Widget,{props:{baseCls:"bi-watermark",watermark:{},angle:20},mounted:function(){var e=this;BI.$(this.container.paper.canvas).css({position:"absolute",zIndex:"99999",pointerEvents:"none"}),this.canvas=BI.Func.createEmptyCanvas(),this._paint(),BI.ResizeDetector.addResizeListener(this,function(){e._paint()})},render:function(){var t=this,e=this.options;return this.value=BI.extend({text:"",fontSize:12,color:"#999",horizontalGap:200,verticalGap:100},e.watermark),{type:"bi.svg",ref:function(e){t.container=e}}},_initCanvas:function(){var e=this.container.element.width(),t=this.container.element.height();return 0!==t&&0!==e&&(this.canvas.width=e,this.canvas.height=t,!0)},_initSvg:function(){this.svgImage&&this.container.clear()},_paint:function(){var e;this._initCanvas()&&(this._initSvg(),BI.Func.paintWaterMark(this.canvas,this.value),e=this.canvas.toDataURL("image/png"),this.svgImage=this.container.image(e,0,0,this.canvas.width,this.canvas.height))},setValue:function(e){this.value=BI.extend(this.value,e),this._paint()}}),BI.shortcut("bi.watermark",BI.WaterMark)},function(e,t,n){"use strict";BI.DivWaterMark=BI.inherit(BI.Widget,{props:{baseCls:"bi-div-watermark",watermark:{},angle:20},mounted:function(){var e=this;this.options;this.element.css({fontSize:this.value.fontSize+"px",color:this.value.color}),this._showWatermark(),BI.ResizeDetector.addResizeListener(this,function(){e._showWatermark()})},render:function(){var t=this,e=this.options;return this.value=BI.extend({text:"",fontSize:12,color:"#999",horizontalGap:200,verticalGap:100},e.watermark),this.deg=Math.PI/180*this.options.angle,this.markWidth=BI.DOM.getTextSizeWidth(this.value.text,this.value.fontSize)+this.value.horizontalGap,{type:"bi.absolute",ref:function(e){t.container=e},items:[{el:{type:"bi.button_group",layouts:[{type:"bi.vertical",bgap:this.value.verticalGap}],cls:"watermark-container",ref:function(e){t.watermarkContainer=e}},left:0,top:0,right:0,bottom:0}]}},setValue:function(e){this.value=BI.extend(this.value,e),this._showWatermark()},_showWatermark:function(){this.options;for(var e=this.value.horizontalGap,t=(this.markWidth=BI.DOM.getTextSizeWidth(this.value.text,this.value.fontSize)+e,[]),n=this._getContainerSize(),i=BI.DOM.getTextSizeHeight(this.value.text,this.value.fontSize)+this.value.verticalGap,r=BI.parseInt(n.width/this.markWidth),o=BI.parseInt(n.height/i),a=this._addFilterForOldIE(),s=(this.value.text+"").split("\n"),l=0;l<o+3;l++){for(var c=[],u=0;u<r+3;u++){var h=1<s.length?BI.createWidget({type:"bi.vertical",hgap:e/2,items:BI.map(s,function(e,t){return{type:"bi.label",cls:"watermark-text",text:t}})}):BI.createWidget({type:"bi.label",hgap:e/2,cls:"watermark-text",text:this.value.text});h.element.css(BI.extend({fontSize:this.value.fontSize+"px",color:this.value.color},a)),c.push(h)}t.push({el:{type:"bi.horizontal",scrollx:!1,items:c},lgap:l%2==0?-this.markWidth/2:0})}this.watermarkContainer.populate(t),this.container.attr("items")[0].left=-this._getContainerLeft(),this.container.attr("items")[0].right=-this.markWidth,this.container.attr("items")[0].bottom=-this._getContainerBottom(),this.container.resize()},_addFilterForOldIE:function(){var e,t;return BI.isIE9Below()?(e=-this.deg,{filter:"progid:DXImageTransform.Microsoft.Chroma(color='white') progid:DXImageTransform.Microsoft.Matrix(M11="+(t=Math.cos(e))+",M12="+-1*Math.sin(e)+",M21="+Math.sin(e)+",M22="+t+",SizingMethod='auto expand')"}):{}},_getContainerSize:function(){var e=this.element.height(),t=this.element.width();return{width:t*Math.cos(this.deg)+e*Math.sin(this.deg),height:t*Math.sin(this.deg)+e/Math.cos(this.deg)}},_getContainerLeft:function(){return this.element.height()*Math.tan(Math.PI/180*20)},_getContainerBottom:function(){return this._getContainerSize().height-this.element.height()}}),BI.shortcut("bi.div.watermark",BI.DivWaterMark)},function(e,t){e.exports=function(e){function t(e){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",e)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(e):"undefined"!=typeof eval?eval.call(null,e):t("EvalError: No eval function available")}catch(n){t(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="10.4.1"},function(e,t,n){"use strict";e.exports=function(t,n){return function(e){return t(n(e))}}},function(n,e,t){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e="object"==(void 0===e?"undefined":t(e))&&e&&e.Object===Object&&e;n.exports=e}.call(this,t(69))},function(e,t,n){"use strict";var i=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return i.call(e)}catch(t){}try{return e+""}catch(t){}}return""}},function(e,t,n){"use strict";n=n(19)(n(10),"Set");e.exports=n},function(e,t,n){"use strict";var o=n(428),a=n(12);e.exports=function s(e,t,n,i,r){return e===t||(null==e||null==t||!a(e)&&!a(t)?e!=e&&t!=t:o(e,t,n,i,s,r))}},function(e,t,n){"use strict";var g=n(80),y=n(216),b=n(81);e.exports=function(e,t,n,i,r,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;var l=o.get(e),c=o.get(t);if(l&&c)return l==t&&c==e;var u=-1,h=!0,d=2&n?new g:undefined;for(o.set(e,t),o.set(t,e);++u<s;){var p,f=e[u],m=t[u];if((p=i?a?i(m,f,u,t,e,o):i(f,m,u,e,t,o):p)!==undefined){if(p)continue;h=!1;break}if(d){if(!y(t,function(e,t){if(!b(d,t)&&(f===e||r(f,e,n,i,o)))return d.push(t)})){h=!1;break}}else if(f!==m&&!r(f,m,n,i,o)){h=!1;break}}return o["delete"](e),o["delete"](t),h}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}},function(e,t,n){"use strict";n=n(10).Uint8Array;e.exports=n},function(e,t,n){"use strict";var i=n(219),r=n(84),o=n(6);e.exports=function(e){return i(e,o,r)}},function(e,t,n){"use strict";var i=n(83),r=n(0);e.exports=function(e,t,n){return t=t(e),r(e)?t:i(t,n(e))}},function(e,t,n){"use strict";e.exports=function(){return[]}},function(e,t,n){"use strict";var u=n(434),h=n(50),d=n(0),p=n(51),f=n(57),m=n(77),g=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n,i=d(e),r=!i&&h(e),o=!i&&!r&&p(e),a=!i&&!r&&!o&&m(e),s=i||r||o||a,l=s?u(e.length,String):[],c=l.length;for(n in e)!t&&!g.call(e,n)||s&&("length"==n||o&&("offset"==n||"parent"==n)||a&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||f(n,c))||l.push(n);return l}},function(e,t,n){"use strict";var i=n(11);e.exports=function(e){return e==e&&!i(e)}},function(e,t,n){"use strict";e.exports=function(t,n){return function(e){return null!=e&&e[t]===n&&(n!==undefined||t in Object(e))}}},function(e,t,n){"use strict";var i=n(440);e.exports=function(e){return null==e?"":i(e)}},function(e,t,n){"use strict";var s=n(58),l=n(50),c=n(0),u=n(57),h=n(76),d=n(34);e.exports=function(e,t,n){for(var i=-1,r=(t=s(t,e)).length,o=!1;++i<r;){var a=d(t[i]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++i!=r?o:!!(r=null==e?0:e.length)&&h(r)&&u(a,r)&&(c(e)||l(e))}},function(e,t,n){"use strict";e.exports=function(t){return function(e){return null==e?undefined:e[t]}}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}},function(e,t,n){"use strict";var i=n(19),n=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();e.exports=n},function(e,t,n){"use strict";var i=n(83),r=n(230),o=n(84),n=n(220),a=Object.getOwnPropertySymbols;e.exports=a?function(e){for(var t=[];e;)i(t,o(e)),e=r(e);return t}:n},function(e,t,n){"use strict";n=n(210)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,n){"use strict";var i=n(219),r=n(229),o=n(61);e.exports=function(e){return i(e,o,r)}},function(e,t,n){"use strict";var i=n(482),r=n(31),n=n(52),n=n&&n.isRegExp,n=n?r(n):i;e.exports=n},function(e,t,n){"use strict";var i=n(32),r=n(13),o=n(483),a=n(231);e.exports=function(e,n){var t;return null==e?{}:(t=i(a(e),function(e){return[e]}),n=r(n),o(e,t,function(e,t){return n(e,t[0])}))}},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.firstForTerminal=t.firstForBranching=t.firstForSequence=t.first=void 0,i(n(16))),s=i(n(99)),o=i(n(4)),a=n(2),l=n(2);function c(e){if(e instanceof a.NonTerminal)return c(e.referencedRule);if(e instanceof a.Terminal)return d(e);if((0,l.isSequenceProd)(e))return u(e);if((0,l.isBranchingProd)(e))return h(e);throw Error("non exhaustive match")}function u(e){for(var t,n=[],i=e.definition,r=0,o=i.length>r,a=!0;o&&a;)t=i[r],a=(0,l.isOptionalProd)(t),n=n.concat(c(t)),o=i.length>(r+=1);return(0,s["default"])(n)}function h(e){e=(0,o["default"])(e.definition,c);return(0,s["default"])((0,r["default"])(e))}function d(e){return[e.terminalType]}t.first=c,t.firstForSequence=u,t.firstForBranching=h,t.firstForTerminal=d},function(e,t,n){"use strict";var i=n(97);e.exports=function(e,t){return!!(null==e?0:e.length)&&-1<i(e,t,0)}},function(e,t,n){"use strict";e.exports=function(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN=void 0,t.IN="_~IN~_"},function(h,b,e){"use strict";function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||(n({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var i,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},t=function(e){return e&&e.__esModule?e:{"default":e}},a=(Object.defineProperty(b,"__esModule",{value:!0}),b.charCodeToOptimizedIndex=b.minOptimizationVal=b.buildLineBreakIssueMessage=b.LineTerminatorOptimizedTester=b.isShortPattern=b.isCustomPattern=b.cloneEmptyGroups=b.performWarningRuntimeChecks=b.performRuntimeChecks=b.addStickyFlag=b.addStartOfInput=b.findUnreachablePatterns=b.findModesThatDoNotExist=b.findInvalidGroupType=b.findDuplicatePatterns=b.findUnsupportedFlags=b.findStartOfInputAnchor=b.findEmptyMatchRegExps=b.findEndOfInputAnchor=b.findInvalidPatterns=b.findMissingPatterns=b.validatePatterns=b.analyzeTokenTypes=b.enableSticky=b.disableSticky=b.SUPPORT_STICKY=b.MODES=b.DEFAULT_MODE=void 0,e(101)),x=e(65),d=t(e(40)),I=t(e(8)),s=t(e(66)),S=t(e(0)),p=t(e(15)),f=t(e(16)),_=t(e(102)),r=t(e(103)),C=t(e(506)),w=t(e(4)),E=t(e(3)),T=t(e(39)),B=t(e(30)),R=t(e(22)),m=t(e(104)),N=t(e(7)),g=t(e(6)),O=t(e(232)),l=t(e(105)),W=t(e(242)),L=t(e(23)),k=t(e(18)),A=e(37),P=e(510),c=e(106),z="PATTERN";function u(e){var t=(0,l["default"])(e,function(e){return!(0,N["default"])(e,z)});return{errors:(0,w["default"])(t,function(e){return{message:"Token Type: ->"+e.name+"<- missing static 'PATTERN' property",type:x.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}}),valid:(0,r["default"])(e,t)}}function y(e){var t=(0,l["default"])(e,function(e){e=e[z];return!((0,O["default"])(e)||(0,B["default"])(e)||(0,N["default"])(e,"exec")||(0,T["default"])(e))});return{errors:(0,w["default"])(t,function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:x.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}}),valid:(0,r["default"])(e,t)}}b.DEFAULT_MODE="defaultMode",b.MODES="modes",b.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,b.disableSticky=function(){b.SUPPORT_STICKY=!1},b.enableSticky=function(){b.SUPPORT_STICKY=!0},b.analyzeTokenTypes=function(e,o){(n=(o=(0,W["default"])(o,{useSticky:b.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:function n(e,t){return t()}})).tracer)("initCharCodeToOptimizedIndexMap",function(){if((0,I["default"])(j)){j=new Array(65536);for(var e=0;e<65536;e++)j[e]=255<e?255+~~(e/255):e}}),n("Reject Lexer.NA",function(){i=(0,_["default"])(e,function(e){return e[z]===x.Lexer.NA})});var n,i,r,a,s,l,c,u,h,d,p,t,f,m=!1,g=(n("Transform Patterns",function(){r=(m=!1,w["default"])(i,function(e){var t,e=e[z];if((0,O["default"])(e))return 1!==(t=e.source).length||"^"===t||"$"===t||"."===t||e.ignoreCase?2!==t.length||"\\"!==t[0]||(0,k["default"])(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],t[1])?(o.useSticky?M:F)(e):t[1]:t;if((0,B["default"])(e))return m=!0,{exec:e};if("object"===v(e))return m=!0,e;if("string"==typeof e)return 1===e.length?e:(t=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),e=new RegExp(t),(o.useSticky?M:F)(e));throw Error("non exhaustive match")})}),n("misc mapping",function(){a=(0,w["default"])(i,function(e){return e.tokenTypeIdx}),s=(0,w["default"])(i,function(e){e=e.GROUP;if(e===x.Lexer.SKIPPED)return undefined;if((0,T["default"])(e))return e;if((0,R["default"])(e))return!1;throw Error("non exhaustive match")}),l=(0,w["default"])(i,function(e){e=e.LONGER_ALT;if(e)return(0,S["default"])(e)?(0,w["default"])(e,function(e){return(0,C["default"])(i,e)}):[(0,C["default"])(i,e)]}),c=(0,w["default"])(i,function(e){return e.PUSH_MODE}),u=(0,w["default"])(i,function(e){return(0,N["default"])(e,"POP_MODE")})}),n("Line Terminator Handling",function(){var t=ie(o.lineTerminatorCharacters);h=(0,w["default"])(i,function(e){return!1}),"onlyOffset"!==o.positionTracking&&(h=(0,w["default"])(i,function(e){return(0,N["default"])(e,"LINE_BREAKS")?!!e.LINE_BREAKS:!1===te(e,t)&&(0,P.canMatchCharCode)(t,e.PATTERN)}))}),n("Misc Mapping #2",function(){d=(0,w["default"])(i,D),p=(0,w["default"])(r,ee),t=(0,L["default"])(i,function(e,t){t=t.GROUP;return(0,T["default"])(t)&&t!==x.Lexer.SKIPPED&&(e[t]=[]),e},{}),f=(0,w["default"])(r,function(e,t){return{pattern:r[t],longerAlt:l[t],canLineTerminator:h[t],isCustom:d[t],"short":p[t],group:s[t],push:c[t],pop:u[t],tokenTypeIdx:a[t],tokenType:i[t]}})}),!0),y=[];return o.safeMode||n("First Char Optimization",function(){y=(0,L["default"])(i,function(t,e,n){var i,r;return"string"==typeof e.PATTERN?(r=V(e.PATTERN.charCodeAt(0)),H(t,r,f[n])):(0,S["default"])(e.START_CHARS_HINT)?(0,E["default"])(e.START_CHARS_HINT,function(e){e=V("string"==typeof e?e.charCodeAt(0):e);i!==e&&H(t,i=e,f[n])}):(0,O["default"])(e.PATTERN)?e.PATTERN.unicode?(g=!1,o.ensureOptimizations&&(0,A.PRINT_ERROR)("".concat(P.failedOptimizationPrefixMsg)+"\tUnable to analyze < ".concat(e.PATTERN.toString()," > pattern.\n")+"\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE")):(r=(0,P.getOptimizedStartCodesIndices)(e.PATTERN,o.ensureOptimizations),(0,I["default"])(r)&&(g=!1),(0,E["default"])(r,function(e){H(t,e,f[n])})):(o.ensureOptimizations&&(0,A.PRINT_ERROR)("".concat(P.failedOptimizationPrefixMsg)+"\tTokenType: <".concat(e.name,"> is using a custom token pattern without providing <start_chars_hint> parameter.\n")+"\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),g=!1),t},[])}),{emptyGroups:t,patternIdxToConfig:f,charCodeToPatternIdxToConfig:y,hasCustom:m,canBeOptimized:g}},b.validatePatterns=function(e,t){var n,i=[],e=u(e),i=i.concat(e.errors),r=(e=y(e.valid)).valid;return i=(i=(i=(i=(i=i.concat(e.errors)).concat((e=r,n=[],e=(0,l["default"])(e,function(e){return(0,O["default"])(e[z])}),n=(n=(n=(n=(n=n.concat(U(e))).concat(q(e))).concat(X(e))).concat(K(e))).concat($(e))))).concat(Z(r))).concat(Q(r,t))).concat(J(r))},b.findMissingPatterns=u,b.findInvalidPatterns=y;var G=/[^\\][$]/;function U(e){t=a.BaseRegExpVisitor,o(n,t),n.prototype.visitEndAnchor=function(e){this.found=!0};var t,r=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.found=!1,e}e=(0,l["default"])(e,function(e){e=e.PATTERN;try{var t=(0,c.getRegExpAst)(e),n=new r;return n.visit(t),n.found}catch(i){return G.test(e.source)}});return(0,w["default"])(e,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:x.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}})}function $(e){e=(0,l["default"])(e,function(e){return e.PATTERN.test("")});return(0,w["default"])(e,function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' must not match an empty string",type:x.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}})}b.findEndOfInputAnchor=U,b.findEmptyMatchRegExps=$;var Y=/[^\\[][\^]|^\^/;function q(e){t=a.BaseRegExpVisitor,o(n,t),n.prototype.visitStartAnchor=function(e){this.found=!0};var t,r=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.found=!1,e}e=(0,l["default"])(e,function(e){e=e.PATTERN;try{var t=(0,c.getRegExpAst)(e),n=new r;return n.visit(t),n.found}catch(i){return Y.test(e.source)}});return(0,w["default"])(e,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:x.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}})}function X(e){e=(0,l["default"])(e,function(e){e=e[z];return e instanceof RegExp&&(e.multiline||e.global)});return(0,w["default"])(e,function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:x.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}})}function K(e){var i=[],t=(0,w["default"])(e,function(n){return(0,L["default"])(e,function(e,t){return n.PATTERN.source!==t.PATTERN.source||(0,k["default"])(i,t)||t.PATTERN===x.Lexer.NA||(i.push(t),e.push(t)),e},[])}),t=(0,s["default"])(t),t=(0,l["default"])(t,function(e){return 1<e.length});return(0,w["default"])(t,function(e){var t=(0,w["default"])(e,function(e){return e.name}),n=(0,d["default"])(e).PATTERN;return{message:"The same RegExp pattern ->".concat(n,"<-")+"has been used in all of the following Token Types: ".concat(t.join(", ")," <-"),type:x.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}function Z(e){e=(0,l["default"])(e,function(e){return!!(0,N["default"])(e,"GROUP")&&(e=e.GROUP)!==x.Lexer.SKIPPED&&e!==x.Lexer.NA&&!(0,T["default"])(e)});return(0,w["default"])(e,function(e){return{message:"Token Type: ->"+e.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:x.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}})}function Q(e,t){e=(0,l["default"])(e,function(e){return e.PUSH_MODE!==undefined&&!(0,k["default"])(t,e.PUSH_MODE)});return(0,w["default"])(e,function(e){return{message:"Token Type: ->".concat(e.name,"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->").concat(e.PUSH_MODE,"<-")+"which does not exist",type:x.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}})}function J(e){var o=[],t=(0,L["default"])(e,function(e,t,n){var i,r=t.PATTERN;return r!==x.Lexer.NA&&((0,T["default"])(r)?e.push({str:r,idx:n,tokenType:t}):(0,O["default"])(r)&&(i=r,(0,m["default"])([".","\\","[","]","|","^","$","(",")","?","*","+","{"],function(e){return-1!==i.source.indexOf(e)})===undefined)&&e.push({str:r.source,idx:n,tokenType:t})),e},[]);return(0,E["default"])(e,function(i,r){(0,E["default"])(t,function(e){var t=e.str,n=e.idx,e=e.tokenType;r<n&&function(e,t){{var n;if((0,O["default"])(t))return null!==(n=t.exec(e))&&0===n.index;if((0,B["default"])(t))return t(e,0,[],{});if((0,N["default"])(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}}(t,i.PATTERN)&&(n="Token: ->".concat(e.name,"<- can never be matched.\n")+"Because it appears AFTER the Token Type ->".concat(i.name,"<-")+"in the lexer's definition.\nSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE",o.push({message:n,type:x.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[i,e]}))})}),o}function F(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:".concat(e.source,")"),t)}function M(e){var t=e.ignoreCase?"iy":"y";return new RegExp("".concat(e.source),t)}function D(e){e=e.PATTERN;if((0,O["default"])(e))return!1;if((0,B["default"])(e))return!0;if((0,N["default"])(e,"exec"))return!0;if((0,T["default"])(e))return!1;throw Error("non exhaustive match")}function ee(e){return!(!(0,T["default"])(e)||1!==e.length)&&e.charCodeAt(0)}function te(e,t){if((0,N["default"])(e,"LINE_BREAKS"))return!1;if((0,O["default"])(e.PATTERN)){try{(0,P.canMatchCharCode)(t,e.PATTERN)}catch(n){return{issue:x.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}if((0,T["default"])(e.PATTERN))return!1;if(D(e))return{issue:x.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function ne(e,t){if(t.issue===x.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n"+"\tThe problem is in the <".concat(e.name,"> Token Type\n")+"\t Root cause: ".concat(t.errMsg,".\n")+"\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===x.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n"+"\tThe problem is in the <".concat(e.name,"> Token Type\n")+"\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function ie(e){return(0,w["default"])(e,function(e){return(0,T["default"])(e)?e.charCodeAt(0):e})}function H(e,t,n){e[t]===undefined?e[t]=[n]:e[t].push(n)}b.findStartOfInputAnchor=q,b.findUnsupportedFlags=X,b.findDuplicatePatterns=K,b.findInvalidGroupType=Z,b.findModesThatDoNotExist=Q,b.findUnreachablePatterns=J,b.addStartOfInput=F,b.addStickyFlag=M,b.performRuntimeChecks=function(e,t,n){var r=[];return(0,N["default"])(e,b.DEFAULT_MODE)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+b.DEFAULT_MODE+"> property in its definition\n",type:x.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),(0,N["default"])(e,b.MODES)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+b.MODES+"> property in its definition\n",type:x.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),(0,N["default"])(e,b.MODES)&&(0,N["default"])(e,b.DEFAULT_MODE)&&!(0,N["default"])(e.modes,e.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a ".concat(b.DEFAULT_MODE,": <").concat(e.defaultMode,">")+"which does not exist\n",type:x.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),(0,N["default"])(e,b.MODES)&&(0,E["default"])(e.modes,function(n,i){(0,E["default"])(n,function(t,e){(0,R["default"])(t)?r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+"<".concat(i,"> at index: <").concat(e,">\n"),type:x.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED}):(0,N["default"])(t,"LONGER_ALT")&&(e=(0,S["default"])(t.LONGER_ALT)?t.LONGER_ALT:[t.LONGER_ALT],(0,E["default"])(e,function(e){(0,R["default"])(e)||(0,k["default"])(n,e)||r.push({message:"A MultiMode Lexer cannot be initialized with a longer_alt <".concat(e.name,"> on token <").concat(t.name,"> outside of mode <").concat(i,">\n"),type:x.LexerDefinitionErrorType.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})}))})}),r},b.performWarningRuntimeChecks=function(e,t,n){var i=[],r=!1,e=(0,s["default"])((0,f["default"])((0,p["default"])(e.modes))),e=(0,_["default"])(e,function(e){return e[z]===x.Lexer.NA}),o=ie(n);return t&&(0,E["default"])(e,function(e){var t=te(e,o);!1!==t?(t={message:ne(e,t),type:t.issue,tokenType:e},i.push(t)):(0,N["default"])(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(r=!0):(0,P.canMatchCharCode)(o,e.PATTERN)&&(r=!0)}),t&&!r&&i.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:x.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),i},b.cloneEmptyGroups=function(n){var i={},e=(0,g["default"])(n);return(0,E["default"])(e,function(e){var t=n[e];if(!(0,S["default"])(t))throw Error("non exhaustive match");i[e]=[]}),i},b.isCustomPattern=D,b.isShortPattern=ee,b.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,n=this.lastIndex;n<t;n++){var i=e.charCodeAt(n);if(10===i)return this.lastIndex=n+1,!0;if(13===i)return 10===e.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0},b.buildLineBreakIssueMessage=ne,b.minOptimizationVal=256;var j=[];function V(e){return e<b.minOptimizationVal?e:j[e]}b.charCodeToOptimizedIndex=V},function(e,t,n){"use strict";var o=n(21);e.exports=function(e,i){var r=[];return o(e,function(e,t,n){i(e,t,n)&&r.push(e)}),r}},function(e,t,n){"use strict";var r=n(234),o=n(13),a=n(38),s=Math.max;e.exports=function(e,t,n){var i=null==e?0:e.length;return i?((n=null==n?0:a(n))<0&&(n=s(i+n,0)),r(e,o(t,3),n)):-1}},function(e,t,n){"use strict";var i=n(95),h=n(33),d=n(63),p=n(61),f=Object.prototype,m=f.hasOwnProperty,n=i(function(e,t){e=Object(e);var n=-1,i=t.length,r=2<i?t[2]:undefined;for(r&&d(t[0],t[1],r)&&(i=1);++n<i;)for(var o=t[n],a=p(o),s=-1,l=a.length;++s<l;){var c=a[s],u=e[c];(u===undefined||h(u,f[c])&&!m.call(e,c))&&(e[c]=o[c])}return e});e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider=void 0,t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->".concat(e.image,"<- The Mode Stack is empty")},buildUnexpectedCharactersMessage:function(e,t,n,i,r){return"unexpected character: ->".concat(e.charAt(t),"<- at offset: ").concat(t,",")+" skipped ".concat(n," characters.")}}},function(e,t,n){"use strict";var i=n(89),n=n(513),r=Object.prototype.hasOwnProperty,n=n(function(e,t,n){r.call(e,n)?e[n].push(t):i(e,n,[t])});e.exports=n},function(e,t,n){"use strict";var i=n(98),r=n(4);e.exports=function(e,t){return i(r(e,t),1)}},function(e,o,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||(n({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var i,r,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},c=(Object.defineProperty(o,"__esModule",{value:!0}),o.attemptInRepetitionRecovery=o.Recoverable=o.InRuleRecoveryException=o.IN_RULE_RECOVERY_EXCEPTION=o.EOF_FOLLOW_KEY=void 0,t(26)),l=s(t(8)),d=s(t(108)),u=s(t(16)),h=s(t(4)),p=s(t(104)),f=s(t(7)),m=s(t(18)),g=s(t(17)),y=t(43),b=t(238),v=t(5),x=(o.EOF_FOLLOW_KEY={},o.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",r=Error,a(I,r),I);function I(e){e=r.call(this,e)||this;return e.name=o.IN_RULE_RECOVERY_EXCEPTION,e}function S(){}function _(e,t,n,i,r,o,a){var i=this.getKeyForAutomaticLookahead(i,r),s=this.firstAfterRepMap[i],l=(s===undefined&&(l=this.getCurrRuleFullName(),s=new o(this.getGAstProductions()[l],r).startWalking(),this.firstAfterRepMap[i]=s),s.token),r=s.occurrence,o=s.isEndOfRule;1===this.RULE_STACK.length&&o&&l===undefined&&(l=c.EOF,r=1),l!==undefined&&r!==undefined&&this.shouldInRepetitionRecoveryBeTried(l,r,a)&&this.tryInRepetitionRecovery(e,t,n,l)}o.InRuleRecoveryException=x,S.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=((0,f["default"])(e,"recoveryEnabled")?e:v.DEFAULT_PARSER_CONFIG).recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=_)},S.prototype.getTokenToInsert=function(e){e=(0,c.createTokenInstance)(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return e.isInsertedInRecovery=!0,e},S.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},S.prototype.canTokenTypeBeDeletedInRecovery=function(e){return!0},S.prototype.tryInRepetitionRecovery=function(e,t,n,i){for(var r=this,o=this.findReSyncTokenType(),a=this.exportLexerState(),s=[],l=!1,c=this.LA(1),u=this.LA(1),h=function h(){var e=r.LA(0),e=r.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:c,previous:e,ruleName:r.getCurrRuleFullName()}),e=new y.MismatchedTokenException(e,c,r.LA(0));e.resyncedTokens=(0,d["default"])(s),r.SAVE_ERROR(e)};!l;){if(this.tokenMatcher(u,i))return void h();if(n.call(this))return h(),void e.apply(this,t);this.tokenMatcher(u,o)?l=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,s))}this.importLexerState(a)},S.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,n){return!1!==n&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},S.prototype.getFollowsForInRuleRecovery=function(e,t){e=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(e)},S.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e))return t=this.SKIP_TOKEN(),this.consumeToken(),t;throw new x("sad sad panda")},S.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},S.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var n,i=this;return!!this.canTokenTypeBeInsertedInRecovery(e)&&!(0,l["default"])(t)&&(n=this.LA(1),(0,p["default"])(t,function(e){return i.tokenMatcher(n,e)})!==undefined)},S.prototype.canRecoverWithSingleTokenDeletion=function(e){return!!this.canTokenTypeBeDeletedInRecovery(e)&&this.tokenMatcher(this.LA(2),e)},S.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),t=this.getFollowSetFromFollowKey(t);return(0,m["default"])(t,e)},S.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),n=2;;){var i=(0,p["default"])(e,function(e){return(0,c.tokenMatcher)(t,e)});if(i!==undefined)return i;t=this.LA(n),n++}},S.prototype.getCurrFollowKey=function(){var e,t,n;return 1===this.RULE_STACK.length?o.EOF_FOLLOW_KEY:(e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName(),{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(n)})},S.prototype.buildFullFollowKeyStack=function(){var n=this,i=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return(0,h["default"])(i,function(e,t){return 0===t?o.EOF_FOLLOW_KEY:{ruleName:n.shortRuleNameToFullName(e),idxInCallingRule:r[t],inRule:n.shortRuleNameToFullName(i[t-1])}})},S.prototype.flattenFollowSet=function(){var t=this,e=(0,h["default"])(this.buildFullFollowKeyStack(),function(e){return t.getFollowSetFromFollowKey(e)});return(0,u["default"])(e)},S.prototype.getFollowSetFromFollowKey=function(e){return e===o.EOF_FOLLOW_KEY?[c.EOF]:(e=e.ruleName+e.idxInCallingRule+b.IN+e.inRule,this.resyncFollows[e])},S.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,c.EOF)||t.push(e),t},S.prototype.reSyncTo=function(e){for(var t=[],n=this.LA(1);!1===this.tokenMatcher(n,e);)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,t);return(0,d["default"])(t)},S.prototype.attemptInRepetitionRecovery=function(e,t,n,i,r,o,a){},S.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:(0,g["default"])(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},S.prototype.getHumanReadableRuleStack=function(){var t=this;return(0,h["default"])(this.RULE_STACK,function(e){return t.shortRuleNameToFullName(e)})},o.Recoverable=S,o.attemptInRepetitionRecovery=_},function(e,t,n){"use strict";var r=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||((i=i||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},i=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.LLkLookaheadStrategy=void 0,i(n(245))),a=i(n(8)),s=n(41),l=n(5),c=n(67),u=n(42);function h(e){this.maxLookahead=null!=(e=null==e?void 0:e.maxLookahead)?e:l.DEFAULT_PARSER_CONFIG.maxLookahead}h.prototype.validate=function(e){var t,n,i=this.validateNoLeftRecursion(e.rules);return(0,a["default"])(i)?(t=this.validateEmptyOrAlternatives(e.rules),n=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),e=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead),r(r(r(r([],i,!0),t,!0),n,!0),e,!0)):i},h.prototype.validateNoLeftRecursion=function(e){return(0,o["default"])(e,function(e){return(0,c.validateNoLeftRecursion)(e,e,s.defaultGrammarValidatorErrorProvider)})},h.prototype.validateEmptyOrAlternatives=function(e){return(0,o["default"])(e,function(e){return(0,c.validateEmptyOrAlternative)(e,s.defaultGrammarValidatorErrorProvider)})},h.prototype.validateAmbiguousAlternationAlternatives=function(e,t){return(0,o["default"])(e,function(e){return(0,c.validateAmbiguousAlternationAlternatives)(e,t,s.defaultGrammarValidatorErrorProvider)})},h.prototype.validateSomeNonEmptyLookaheadPath=function(e,t){return(0,c.validateSomeNonEmptyLookaheadPath)(e,t,s.defaultGrammarValidatorErrorProvider)},h.prototype.buildLookaheadForAlternation=function(e){return(0,u.buildLookaheadFuncForOr)(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,u.buildAlternativesLookAheadFunc)},h.prototype.buildLookaheadForOptional=function(e){return(0,u.buildLookaheadFuncForOptionalProd)(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,(0,u.getProdType)(e.prodType),u.buildSingleAlternativeLookaheadFunction)},t.LLkLookaheadStrategy=h},function(e,t,n){"use strict";window.BICst=window.BICst||{},BICst.FORMULA_STATE=BICst.FORMULA_STATE||{},BICst.FORMULA_STATE.VALID="valid",BICst.FORMULA_STATE.INVALID="invalid",BICst.FORMULA_STATE.AGG_INVALID="aggInvalid",BICst.FORMULA_STATE.FIXED_INVALID="fixedInvalid",BICst.FORMULA_STATE.RAPID_INVALID="rapidInvalid",BICst.FORMULA_STATE.FIELD_MISS="field_miss",BICst.FORMULA_STATE.NOT_SUPPORT_STRING_OR_DATE="no_string_or_date",BICst.FORMULA_STATE.DETAIL_FILTER_NOT_SUPPORT="detail filter not support",BICst.FORMULA_WIDGET_FIELD_TYPE=BICst.FORMULA_WIDGET_FIELD_TYPE||{},BICst.FORMULA_WIDGET_FIELD_TYPE.DATE=1,BICst.FORMULA_WIDGET_FIELD_TYPE.STRING=2,BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER=3,BICst.DESIGN=BICst.DESIGN||{},BICst.DESIGN.TABLE_ROW_SUM_POSITION=BICst.DESIGN.TABLE_ROW_SUM_POSITION||{},BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP="top",BICst.DESIGN.TABLE_ROW_SUM_POSITION.BOTTOM="bottom",BICst.FORMULA_KEYWORD_TYPE={},BICst.FORMULA_KEYWORD_TYPE.KEYWORD=1,BICst.FORMULA_KEYWORD_TYPE.FUNCTION=2,BICst.FORMULA_KEYWORD_TYPE.PARAM=3},function(e,t,n){"use strict";BI.config("bi.grid_table_scrollbar",function(e){return BI.isIE9Below()?BI.extend(e,{type:"bi.native_table_scrollbar"}):e}),BI.config("bi.grid_table_horizontal_scrollbar",function(e){return BI.isIE9Below()?BI.extend(e,{type:"bi.native_table_horizontal_scrollbar"}):e}),BI.config("bi.watermark",function(e){return BI.isIE9Below()?BI.extend(e,{type:"bi.div.watermark"}):e}),_global.BI.$&&BI.$(function(){BI.isIE9Below()&&(BI.GridTableScrollbar.SIZE=18)})},function(e,t,n){"use strict";!function(n){function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}try{!function(e){var t="undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this;t.Clipboard=e()}(function(){return function l(i,r,o){function a(n,e){if(!r[n]){if(!i[n]){if(s)return s(n,!0);var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}t=r[n]={exports:{}};i[n][0].call(t.exports,function(e){var t=i[n][1][e];return a(t||e)},t,t.exports,l,i,r,o)}return r[n].exports}for(var s=!1,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(e,t,n){var i;"undefined"==typeof Element||Element.prototype.matches||((i=Element.prototype).matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector),t.exports=function(e,t){for(;e&&9!==e.nodeType;){if(e.matches(t))return e;e=e.parentNode}}},{}],2:[function(e,t,n){var a=e("./closest");t.exports=function(e,t,n,i,r){var o=function(t,n,e,i){return function(e){e.delegateTarget=a(e.target,n),e.delegateTarget&&i.call(t,e)}}.apply(this,arguments);return e.addEventListener(n,o,r),{destroy:function(){e.removeEventListener(n,o,r)}}}},{"./closest":1}],3:[function(e,t,n){n.node=function(e){return e!==undefined&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return e!==undefined&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{}],4:[function(e,t,n){var c=e("./is"),u=e("delegate");t.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!c.string(t))throw new TypeError("Second argument must be a String");if(!c.fn(n))throw new TypeError("Third argument must be a Function");if(c.node(e))return s=t,l=n,(a=e).addEventListener(s,l),{destroy:function(){a.removeEventListener(s,l)}};if(c.nodeList(e))return i=e,r=t,o=n,Array.prototype.forEach.call(i,function(e){e.addEventListener(r,o)}),{destroy:function(){Array.prototype.forEach.call(i,function(e){e.removeEventListener(r,o)})}};if(c.string(e))return u(document.body,e,t,n);var i,r,o,a,s,l;throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},{"./is":3,delegate:2}],5:[function(e,t,n){t.exports=function(e){var t,n;return e="SELECT"===e.nodeName?(e.focus(),e.value):"INPUT"===e.nodeName||"TEXTAREA"===e.nodeName?((t=e.hasAttribute("readonly"))||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),t||e.removeAttribute("readonly"),e.value):(e.hasAttribute("contenteditable")&&e.focus(),t=window.getSelection(),(n=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t.toString())}},{}],6:[function(e,t,n){function i(){}i.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function r(){i.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var o=0,a=i.length;o<a;o++)i[o].fn!==t&&i[o].fn._!==t&&r.push(i[o]);return r.length?n[e]=r:delete n[e],this}},t.exports=i},{}],7:[function(e,t,n){var i,r;i=this,r=function(e,t){var n=(t=t)&&t.__esModule?t:{"default":t};var i="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":h(e)};function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)})(o,[{key:"resolveOptions",value:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir"),t=(this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px",window.pageYOffset||document.documentElement.scrollTop);this.fakeElem.style.top=t+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,n["default"])(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,n["default"])(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(e!==undefined){if(!e||"object"!==(void 0===e?"undefined":i(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]);t=o;function o(e){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.resolveOptions(e),this.initSelection()}e.exports=t},void 0!==n?r(t,e("select")):(r(n={exports:{}},i.select),i.clipboardAction=n.exports)},{select:5}],8:[function(e,t,n){var i,r;i=this,r=function(e,t,n,i){var r=a(t),t=a(n),o=a(i);function a(e){return e&&e.__esModule?e:{"default":e}}n=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+h(t));if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t)if(Object.setPrototypeOf)Object.setPrototypeOf(e,t);else for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}l(c,t["default"]),n(c,[{key:"resolveOptions",value:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,o["default"])(e,"click",function(e){return t.onClick(e)})}},{key:"onClick",value:function(e){e=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new r["default"]({action:this.action(e),target:this.target(e),text:this.text(e),trigger:e,emitter:this})}},{key:"defaultAction",value:function(e){return u("action",e)}},{key:"defaultTarget",value:function(e){e=u("target",e);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(e){return u("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:["copy","cut"],e="string"==typeof e?[e]:e,t=!!document.queryCommandSupported;return e.forEach(function(e){t=t&&!!document.queryCommandSupported(e)}),t}}]);i=c;function c(e,t){var n;if(this instanceof c)return(n=function(e,t){if(e)return!t||"object"!==h(t)&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this))).resolveOptions(t),n.listenClick(e),n;throw new TypeError("Cannot call a class as a function")}function u(e,t){e="data-clipboard-"+e;if(t.hasAttribute(e))return t.getAttribute(e)}e.exports=i},void 0!==n?r(t,e("./clipboard-action"),e("tiny-emitter"),e("good-listener")):(r(n={exports:{}},i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=n.exports)},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)})}catch(e){}}.call(this,n(69))},function(e,t,n){"use strict";BI.ClipBoard=BI.inherit(BI.BasicButton,{_defaultConfig:function(){return BI.extend(BI.ClipBoard.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-clipboard",el:{type:"bi.layout"},copy:BI.emptyFn,afterCopy:BI.emptyFn})},render:function(){return this.options.el},mounted:function(){var e=this.options;if(window.Clipboard)this.clipboard=new Clipboard(this.element[0],{text:function(){return BI.isFunction(e.copy)?e.copy():e.copy}}),this.clipboard.on("success",e.afterCopy);else{if(!window.clipboardData)throw new Error("not support");this.element.on("click",function(){window.clipboardData.setData("Text",BI.isFunction(e.copy)?e.copy():e.copy)&&e.afterCopy()})}},destroyed:function(){this.clipboard&&this.clipboard.destroy()}}),BI.shortcut("bi.clipboard",BI.ClipBoard)},function(e,t,n){"use strict";BI.Draggable=BI.inherit(BI.Widget,{props:{baseCls:"bi-materials-draggable",onDragStart:BI.emptyFn,onDrag:BI.emptyFn,onDragEnd:BI.emptyFn,el:{}},render:function(){var o=this,a=this.options;return this.startX=0,this.startY=0,this.tracker=new BI.MouseMoveTracker(function(e,t){var n=BI.$("body").width(),i=BI.$("body").height(),r=o.element.bounds(),e=(o.startX+=e,o.startY+=t,BI.clamp(o.startX,0,n-r.width)),t=BI.clamp(o.startY,0,i-r.height);o.element.css({left:e+"px",top:t+"px"}),a.onDrag({left:e,top:t})},function(){o.tracker.releaseMouseMoves(),a.onDragEnd()},window),this.options.el},mounted:function(){var n=this,i=this.options;this.element.mousedown(function(e){var t=n.element.offset();n.startX=t.left,n.startY=t.top,n.tracker.captureMouseMoves(e),i.onDragStart()})}}),BI.shortcut("bi.materials.draggable",BI.Draggable)},function(e,t,n){"use strict";BI.CodeEditor=BI.inherit(BI.Single,{props:{baseCls:"bi-code-editor",value:"",watermark:"",lineHeight:2,readOnly:!1,lineNumbers:!1,paramMatch:!0,paramFormatter:function(e){return e}},render:function(){var n=this.options,i=this,e={lineWrapping:!0,lineNumbers:n.lineNumbers,readOnly:n.readOnly,specialChars:/[\u0000-\u001f\u007f\u00ad\u200c-\u200f\u2028\u2029\ufeff]/,mode:n.mode};n.readOnly&&(e.cursorBlinkRate=-1),this.editor=BI.CodeMirror(this.element[0],e),1===n.lineHeight?this.element.addClass("codemirror-low-line-height"):this.element.addClass("codemirror-high-line-height"),this.editor.on("change",function(e,t){!0===e.options.readOnly&&"paste"===t.origin&&i.editor.setValue(n.value),i._checkWaterMark(),BI.nextTick(function(){i.fireEvent(BI.CodeEditor.EVENT_CHANGE)})}),this.editor.on("focus",function(){i._checkWaterMark(!1),i.fireEvent(BI.CodeEditor.EVENT_FOCUS)}),this.editor.on("blur",function(){i.watermark.setVisible(BI.isEmptyString(i.getValue())),i.fireEvent(BI.CodeEditor.EVENT_BLUR)}),this.editor.on("inputRead",function(e,t){"paste"===t.origin&&BI.nextTick(function(){i.editor.replaceSelection(" ");var e=i.editor.getDoc().getCursor();i.editor.getDoc().replaceRange("",{line:e.line,ch:e.ch-1},e)})}),this.watermark=BI.createWidget({type:"bi.label",text:n.watermark,cls:"bi-water-mark",whiteSpace:"normal",textAlign:"left"}),this.watermark.element.bind("mousedown",function(e){i.insertString(""),i.editor.focus(),e.stopEvent()}),this.watermark.element.bind("click",function(e){i.editor.focus(),e.stopEvent()}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.watermark,top:3,left:n.lineNumbers?36:6,right:n.lineNumbers?36:6}]})},mounted:function(){var e=this.options;(BI.isNumber(e.value)||BI.isString(e.value))&&this.setValue(e.value),BI.isNotNull(e.style)&&this.setStyle(e.style)},_setEnable:function(e){BI.CodeEditor.superclass._setEnable.apply(this,arguments),this.editor.setOption("readOnly",!0!==e&&"nocursor")},_checkWaterMark:function(){var e=this.options;BI.isEmptyString(this.editor.getValue())&&BI.isKey(e.watermark)?this.watermark&&this.watermark.visible():this.watermark&&this.watermark.invisible()},_insertParam:function(e){var t=e,n="param",i=(e=this.options.paramFormatter(e),BI.isNotNull(e.match(/^<!.*!>$/))&&(n="error-param"),BI.isNotEmptyString(this.editor.getSelection())&&this.editor.replaceSelection(""),this.editor.getCursor()),r=(this.editor.replaceSelection("​"+e+"​"),this.editor.getCursor()),n={className:n,atomic:!0,replacedWith:BI.$("<span class='"+n+" start end' />").text(e)[0]};n.value=t,this.editor.markText(i,r,n)},_insertString:function(e){this.editor.replaceSelection(e)},_analyzeContent:function(e){return e.match(/\n|\$[\{][^\}]*[\}]|((?!\$\{).)*((?!\$\{).)|\$[^\{]*[^\$\{]/g)},getValue:function(){return this.editor.getValue("\n",function(e){var i=e.text,r=0;return _.forEach(_.sortBy(e.markedSpans,"from"),function(e,t){switch(e.marker.className){case"param":case"error-param":var n=e.to-e.from;i=i.substr(0,e.from+r)+"${"+e.marker.value+"}"+i.substr(e.to+r,i.length),r=(r+=3)+(e.marker.value.length-n)}}),i})},setValue:function(e){var i=this,t=this.options;this.refresh(),this.options.value=e,i.editor.setValue(""),t.paramMatch?(t=this._analyzeContent(e||""),BI.each(t,function(e,t){var n=t.match(/\$[\{][^\}]*[\}]/);BI.isNotEmptyArray(n)?i._insertParam(n[0].substring(2,t.length-1)):i._insertString(t)})):i.editor.setValue(e),this._checkWaterMark()},insertParam:function(e){this._insertParam(e),this.editor.focus()},insertString:function(e){this._insertString(e),this.editor.focus()},focus:function(){this.editor.focus()},blur:function(){this.editor.getInputField().blur()},setStyle:function(e){this.style=e,this.element.css(e)},getStyle:function(){return this.style},refresh:function(){var e=this;BI.nextTick(function(){e.editor.refresh()})},setVisible:function(e){BI.CodeEditor.superclass.setVisible.apply(this,arguments),e&&this.refresh()}}),BI.CodeEditor.EVENT_CHANGE="EVENT_CHANGE",BI.CodeEditor.EVENT_BLUR="EVENT_BLUR",BI.CodeEditor.EVENT_FOCUS="EVENT_FOCUS",BI.shortcut("bi.code_editor",BI.CodeEditor)},function(e,t,n){"use strict";function i(e,t,n){n=n||{},this.tokens=e,this.flags={lastToken:null,indentationLevel:0},this.flagsStore=[],this.valueGetter=n.valueGetter,this.output=t.getOutput()}i.prototype.beautify=function(){for(var e=this.tokens.next();e;)this.handleToken(e),this.flags.lastToken=e,e=this.tokens.next();return this.output.getResult()},i.prototype.handleToken=function(e){switch(e.type){case"string":this.handleString(e);break;case"field":this.handleField(e);break;case"comma":this.handleComma(e);break;case"bracket":this.handleBracket(e);break;case"atom":case"word":this.handleWord(e);break;case"keyword":this.handleKeyword(e);break;case"operator":this.handleOperator(e);break;default:this.handleCommon(e)}},i.prototype.handleCommon=function(e){this.checkNeedSpace(),this.output.addToken(e)},i.prototype.handleOperator=function(e){this.output.addSpaceBeforeToken(),this.output.addToken(e)},i.prototype.handleKeyword=function(e){this.checkNeedSpace(),this.output.addToken(e)},i.prototype.handleBracket=function(e){this.checkNeedSpace(),"("===e.string&&(this.flagsStore.push(this.flags),this.flags={lastToken:null,indentationLevel:this.flags.indentationLevel},this.output.addToken(e),this.indent(),this.output.addNewLine()),")"===e.string&&0<this.flagsStore.length&&(this.flags=this.flagsStore.pop(),this.setIndent(),this.output.addNewLine(),this.output.addToken(e))},i.prototype.checkNeedSpace=function(){this.flags.lastToken&&"operator"===this.flags.lastToken.type&&this.output.addSpaceBeforeToken()},i.prototype.handleComma=function(e){this.output.addToken(e),this.output.addNewLine()},i.prototype.handleString=function(e){this.checkNeedSpace(),this.output.addToken(e)},i.prototype.handleField=function(e){this.checkNeedSpace(),this.output.addToken(e,{valueGetter:this.valueGetter})},i.prototype.handleWord=function(e){this.checkNeedSpace(),this.output.addToken(e)},i.prototype.indent=function(){this.flags.indentationLevel+=1,this.output.setIndent(this.flags.indentationLevel)},i.prototype.setIndent=function(){this.output.setIndent(this.flags.indentationLevel)},i.prototype.deIndent=function(){this.flags.indentationLevel=this.flags.indentationLevel<0?0:this.flags.indentationLevel-1,this.output.setIndent(this.flags.indentationLevel)},BI.CodeMirror.defineExtension("beautify",function(e){return new i(this.getTokens(),this,e).beautify()})},function(e,t,n){"use strict";function i(){this.lines=[],this.previousLine=null,this.currentLine=null,this.nextLine=new r,this.addOutputLine()}function r(){this._indent_count=0,this.items=[]}i.prototype.addToken=function(e,t){this.currentLine.addText((t=t||{}).valueGetter?t.valueGetter(e.string):e.string)},i.prototype.addNewLine=function(e){return!(this.isEmpty()||!e&&this.justAddedNewline()||(this.addOutputLine(),0))},i.prototype.addNewLine=function(e){return!(this.isEmpty()||!e&&this.justAddedNewline()||(this.addOutputLine(),0))},i.prototype.addOutputLine=function(){this.previousLine=this.currentLine,this.currentLine=this.nextLine.cloneEmpty(),this.lines.push(this.currentLine)},i.prototype.justAddedNewline=function(){return this.currentLine.isEmpty()},i.prototype.isEmpty=function(){return!this.previousLine&&this.currentLine.isEmpty()},i.prototype.setIndent=function(e){this.nextLine.setIndent(e=e||0)},i.prototype.addSpaceBeforeToken=function(){this.justAddedNewline()||this.currentLine.addText(" ")},i.prototype.getResult=function(e){return this.lines.join("\n")},r.prototype.setIndent=function(e){this.isEmpty()&&(this._indent_count=e||0)},r.prototype.addText=function(e){this.items.push(e)},r.prototype.cloneEmpty=function(){var e=new r;return e.setIndent(this._indent_count),e},r.prototype.isEmpty=function(){return 0===this.items.length},r.prototype.toString=function(){for(var e="",t=0;t<this._indent_count;t++)e+="\t";return e+this.items.join("")},BI.CodeMirror.defineExtension("getOutput",function(){return new i})},function(e,t,n){"use strict";function i(e){this.tokens=e.filter(function(e){return!e.string.match(/\s/)})||[],this.position=-1}i.prototype.hasNext=function(){return 0<this.tokens.length&&this.position<this.tokens.length-1},i.prototype.next=function(){var e=null;return e=this.hasNext()?this.tokens[++this.position]:e},i.prototype.peek=function(e){var t=null;return e=e||0,t=0<=(e+=this.position)&&e<this.tokens.length?this.tokens[e]:t},BI.CodeMirror.defineExtension("getTokens",function(){var t=this;return new i(BI.flatten(BI.map(BI.range(0,this.getDoc().lineCount()),function(e){return t.getLineTokens(e)})))})},function(e,t,n){"use strict";var s,l;s=BI.CodeMirror,l=s.Pos,s.registerHelper("hint","formula",function(e,t){return function(e,t,n){var i=e.getCursor(),r=n(e,i);if(!/\b(?:string)\b/.test(r.type)){r.state=s.innerMode(e.getMode(),r.state).state,/^[\w$_\u4e00-\u9fa5]*$/.test(r.string)?r.end>i.ch&&(r.end=i.ch,r.string=r.string.slice(0,i.ch-r.start)):r={start:i.ch,end:i.ch,string:"",state:r.state,type:"."==r.string?"property":null};for(var o,a=r;"property"==a.type;){if("."!=(a=n(e,l(i.line,a.start))).string)return;a=n(e,l(i.line,a.start)),(o=o||[]).push(a)}return{list:function(e,t,n){var r=[],o=[],a=e.string;if(a)if(t&&t.length)t.pop();else for(var i=n,s=function(n){var e=[n.text];n.type===BICst.FORMULA_KEYWORD_TYPE.PARAM&&(t=BI.makeFirstPY(n.text,{splitChar:"​"}),i=t.toUpperCase(),(e=t.split("​").concat(i.split("​"))).push(n.text));{var t,i;BI.some(e,function(e,t){return 0==t.lastIndexOf(a,0)})&&(t=BI.filter(r,function(e,t){return t.value===n.value}),i=BI.some(t,function(e,t){return t.type===n.type}),!BI.isEmptyArray(t)&&i||(o.push(n.text),r.push(n)))}},l=0,c=i.length;l<c;++l)s(i[l]);return r}(r,o,t),from:l(i.line,r.start),to:l(i.line,r.end)}}}(e,e.keywordsGetter(),function(e,t){return e.getTokenAt(t)})})},function(e,t,n){"use strict";!function(F){"use strict";var M="CodeMirror-hint",D="CodeMirror-hint-active";function r(e,t){this.cm=e;this.options=t;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var n=this;e.on("cursorActivity",this.activityFunc=function(){n.cursorActivity()})}F.showHint=function(e,t,n){if(!t)return e.showHint(n);if(n&&n["async"])t["async"]=true;var i={hint:t};if(n)for(var r in n)i[r]=n[r];return e.showHint(i)},F.defineExtension("showHint",function(e){e=a(this,this.getCursor("start"),e);var t=this.listSelections();if(t.length>1)return;if(this.somethingSelected()){if(!e.hint.supportsSelection)return;for(var n=0;n<t.length;n++)if(t[n].head.line!=t[n].anchor.line)return}if(this.state.completionActive)this.state.completionActive.close();var i=this.state.completionActive=new r(this,e);if(!i.options.hint)return;F.signal(this,"startCompletion",this);i.update(true)}),F.defineExtension("closeHint",function(){if(this.state.completionActive)this.state.completionActive.close()});var i=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},o=window.cancelAnimationFrame||clearTimeout;function a(e,t,n){var i=e.options.hintOptions;var r={};for(var o in u)r[o]=u[o];if(i)for(var o in i)if(i[o]!==undefined)r[o]=i[o];if(n)for(var o in n)if(n[o]!==undefined)r[o]=n[o];if(r.hint.resolve)r.hint=r.hint.resolve(e,t);return r}function H(e){if(typeof e==="string")return e;return e.text}function j(e,i){var r={Up:function l(){i.moveFocus(-1)},Down:function c(){i.moveFocus(1)},PageUp:function u(){i.moveFocus(-i.menuSize()+1,true)},PageDown:function h(){i.moveFocus(i.menuSize()-1,true)},Home:function d(){i.setFocus(0)},End:function p(){i.setFocus(i.length-1)},Enter:i.pick,Tab:i.pick,Esc:i.close};var t=e.options.customKeys;var o=t?{}:r;function n(e,t){var n;if(typeof t!=="string")n=function n(e){return t(e,i)};else if(r.hasOwnProperty(t))n=r[t];else n=t;o[e]=n}if(t)for(var a in t)if(t.hasOwnProperty(a))n(a,t[a]);var s=e.options.extraKeys;if(s)for(var a in s)if(s.hasOwnProperty(a))n(a,s[a]);return o}function V(e,t){while(t&&t!=e){if(t.nodeName.toUpperCase()==="DIV"&&t.parentNode==e)return t;t=t.parentNode}}function s(r,e){this.completion=r;this.data=e;this.picked=false;var n=this,o=r.cm;var a=o.getInputField().ownerDocument;var s=a.defaultView||a.parentWindow;var l=this.hints=a.createElement("div");var t=BI.createWidget({type:"bi.button_group",cls:"CodeMirror-hints bi-card",element:l,layouts:[{type:"bi.vertical"}]});this.selectedHint=e.selectedHint||0;var i=e.list;var c=[];for(var u=0;u<i.length;++u){var h=a.createElement("div"),d=i[u];var p={};var f=M+(u!=this.selectedHint?"":" "+D);if(d.className!=null)f=d.className+" "+f;if(d.render)p=BI.createWidget(d.render(h,e,d));else{var m=d.displayText||H(d);p=BI.createWidget({type:BI.isNotNull(d.iconCls)?"bi.icon_text_item":"bi.single_select_item",logic:{dynamic:true},height:24,cls:BI.isNotNull(d.iconCls)?f+" "+d.iconCls:f,textAlign:"left",text:m,title:m})}p.element[0].hintId=u;c.push(p)}t.populate(c);var g=o.cursorCoords(r.options.alignWithWord?e.from:null);var y=g.left,b=g.bottom,v=true;l.style.left=y+"px";l.style.top=b+"px";var x=s.innerWidth||Math.max(a.body.offsetWidth,a.documentElement.offsetWidth);var I=s.innerHeight||Math.max(a.body.offsetHeight,a.documentElement.offsetHeight);(r.options.container||a.body).appendChild(l);var S=l.getBoundingClientRect(),_=S.bottom-I;var C=l.scrollHeight>l.clientHeight+1;var w=o.getScrollInfo();if(_>0){var E=S.bottom-S.top,T=g.top-(g.bottom-S.top);if(T-E>0){l.style.top=(b=g.top-E)+"px";v=false}else if(E>I){l.style.height=I-5+"px";l.style.top=(b=g.bottom-S.top)+"px";var B=o.getCursor();if(e.from.ch!=B.ch){g=o.cursorCoords(B);l.style.left=(y=g.left)+"px";S=l.getBoundingClientRect()}}}var R=S.right-x;if(R>0){if(S.right-S.left>x){l.style.width=x-5+"px";R-=S.right-S.left-x}l.style.left=(y=g.left-R)+"px"}if(C)for(var N=l.firstChild;N;N=N.nextSibling)N.style.paddingRight=o.display.nativeBarWidth+"px";o.addKeyMap(this.keyMap=j(r,{moveFocus:function L(e,t){n.changeActive(n.selectedHint+e,t)},setFocus:function k(e){n.changeActive(e)},menuSize:function A(){return n.screenAmount()},length:i.length,close:function P(){r.close()},pick:function z(){n.pick()},data:e}));if(r.options.closeOnUnfocus){var O;o.on("blur",this.onBlur=function(){O=setTimeout(function(){r.close()},100)});o.on("focus",this.onFocus=function(){clearTimeout(O)})}o.on("scroll",this.onScroll=function(){var e=o.getScrollInfo(),t=o.getWrapperElement().getBoundingClientRect();var n=b+w.top-e.top;var i=n-(s.pageYOffset||(a.documentElement||a.body).scrollTop);if(!v)i+=l.offsetHeight;if(i<=t.top||i>=t.bottom)return r.close();l.style.top=n+"px";l.style.left=y+w.left-e.left+"px"});F.on(l,"dblclick",function(e){var t=V(l,e.target||e.srcElement);if(t&&t.hintId!=null){n.changeActive(t.hintId);n.pick()}});F.on(l,"click",function(e){var t=V(l,e.target||e.srcElement);if(t&&t.hintId!=null){n.changeActive(t.hintId);if(r.options.completeOnSingleClick)n.pick()}});F.on(l,"mousedown",function(){setTimeout(function(){o.focus()},20)});F.signal(e,"select",i[this.selectedHint],l.childNodes[this.selectedHint]);return true}function l(e,t){if(!e.somethingSelected())return t;var n=[];for(var i=0;i<t.length;i++)if(t[i].supportsSelection)n.push(t[i]);return n}function c(e,t,n,i){if(e["async"])e(t,i,n);else{var r=e(t,n);if(r&&r.then)r.then(i);else i(r)}}function e(e,t){var a=e.getHelpers(t,"hint"),n;if(a.length){var s=function s(e,n,i){var r=l(e,a);function o(t){if(t==r.length)return n(null);c(r[t],e,i,function(e){if(e&&e.list.length>0)n(e);else o(t+1)})}o(0)};s["async"]=true;s.supportsSelection=true;return s}else if(n=e.getHelper(e.getCursor(),"hintWords"))return function(e){return F.hint.fromList(e,{words:n})};else if(F.hint.anyword)return function(e,t){return F.hint.anyword(e,t)};else return function(){}}r.prototype={close:function t(){if(!this.active())return;this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data)F.signal(this.data,"close");if(this.widget)this.widget.close();F.signal(this.cm,"endCompletion",this.cm)},active:function n(){return this.cm.state.completionActive==this},pick:function h(e,t){var n=e.list[t];if(n.hint)n.hint(this.cm,e,n);else switch(n.type){case BICst.FORMULA_KEYWORD_TYPE.KEYWORD:this.cm.replaceRange(H(n).toUpperCase(),n.from||e.from,n.to||e.to,"complete");this.cm.replaceSelection(" ");break;case BICst.FORMULA_KEYWORD_TYPE.FUNCTION:this.cm.replaceRange(H(n).toUpperCase(),n.from||e.from,n.to||e.to,"complete");var i=this.cm.getCursor();this.cm.markText(n.from||e.from,i,{className:"#function",atomic:true});this.cm.replaceSelection("()");i=this.cm.getCursor();i.ch=i.ch-1;this.cm.setCursor(i);this.cm.focus();break;case BICst.FORMULA_KEYWORD_TYPE.PARAM:var r=n.value;var o=n.text;var a=e.from;var s=o.replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)});this.cm.replaceRange("​"+s+"​",a,e.to,"complete");var i=this.cm.getCursor("to");var l="fieldName";this.cm.markText(a,i,{className:l,handleMouseEvents:true,atomic:true,startStyle:"start",endStyle:"end",value:r,replacedWith:BI.$("<span class='"+l+"  start end' />").text(s)[0]});break;default:break}F.signal(e,"pick",n);this.close()},cursorActivity:function d(){if(this.debounce){o(this.debounce);this.debounce=0}var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||!e.ch||this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var n=this;this.debounce=i(function(){n.update()});if(this.widget)this.widget.disable()}},update:function p(t){if(this.tick==null)return;var n=this,i=++this.tick;c(this.options.hint,this.cm,this.options,function(e){if(n.tick==i)n.finishUpdate(e,t)})},finishUpdate:function f(e,t){if(this.data)F.signal(this.data,"update");var n=this.widget&&this.widget.picked||t&&this.options.completeSingle;if(this.widget)this.widget.close();this.data=e;if(e&&e.list.length)if(n&&e.list.length==1)this.pick(e,0);else{this.widget=new s(this,e);F.signal(e,"shown")}}},s.prototype={close:function t(){if(this.completion.widget!=this)return;this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;if(this.completion.options.closeOnUnfocus){e.off("blur",this.onBlur);e.off("focus",this.onFocus)}e.off("scroll",this.onScroll)},disable:function m(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function t(){e.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function h(){this.completion.pick(this.data,this.selectedHint)},changeActive:function g(e,t){if(e>=this.data.list.length)e=t?this.data.list.length-1:0;else if(e<0)e=t?0:this.data.list.length-1;if(this.selectedHint==e)return;var n=this.hints.childNodes[this.selectedHint];if(n)n.className=n.className.replace(" "+D,"");n=this.hints.childNodes[this.selectedHint=e];n.className+=" "+D;if(n.offsetTop<this.hints.scrollTop)this.hints.scrollTop=n.offsetTop-3;else if(n.offsetTop+n.offsetHeight>this.hints.scrollTop+this.hints.clientHeight)this.hints.scrollTop=n.offsetTop+n.offsetHeight-this.hints.clientHeight+3;F.signal(this.data,"select",this.data.list[this.selectedHint],n)},screenAmount:function y(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},F.registerHelper("hint","auto",{resolve:e}),F.registerHelper("hint","fromList",function(e,t){var n=e.getCursor(),i=e.getTokenAt(n);var r,o=F.Pos(n.line,i.start),a=n;if(i.start<n.ch&&/\w/.test(i.string.charAt(n.ch-i.start-1)))r=i.string.substr(0,n.ch-i.start);else{r="";o=n}var s=[];for(var l=0;l<t.words.length;l++){var c=t.words[l];if(c.slice(0,r.length)==r)s.push(c)}if(s.length)return{list:s,from:o,to:a}}),F.commands.autocomplete=F.showHint;var u={hint:F.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};F.defineOption("hintOptions",null)}(BI.CodeMirror)},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){return e&&e.bracketRegex||/[(){}[\]]/}function u(e,t,n){var i=e.getLineHandle(t.line),r=t.ch-1,o=n&&n.afterCursor,a=(null==o&&(o=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className)),m(n)),o=!o&&0<=r&&a.test(i.text.charAt(r))&&y[i.text.charAt(r)]||a.test(i.text.charAt(r+1))&&y[i.text.charAt(++r)];return!o||(a=">"==o.charAt(1)?1:-1,n&&n.strict&&0<a!=(r==t.ch))||(i=e.getTokenTypeAt(g(t.line,r+1)),null==(e=s(e,g(t.line,r+(0<a?1:0)),a,i||null,n)))?null:{from:g(t.line,r),to:e&&e.pos,match:e&&e.ch==o.charAt(0),forward:0<a}}function s(e,t,n,i,r){for(var o=r&&r.maxScanLineLength||1e4,a=r&&r.maxScanLines||1e3,s=[],l=m(r),c=0<n?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a),u=t.line;u!=c;u+=n){var h=e.getLine(u);if(h){var d=0<n?0:h.length-1,p=0<n?h.length:-1;if(!(h.length>o))for(u==t.line&&(d=t.ch-(n<0?1:0));d!=p;d+=n){var f=h.charAt(d);if(l.test(f)&&(i===undefined||e.getTokenTypeAt(g(u,d+1))==i))if(">"==y[f].charAt(1)==0<n)s.push(f);else{if(!s.length)return{pos:g(u,d),ch:f};s.pop()}}}}return u-n!=(0<n?e.lastLine():e.firstLine())&&null}function o(e,t,n){for(var i=e.state.matchBrackets.maxHighlightLineLength||1e3,r=[],o=e.listSelections(),a=0;a<o.length;a++){var s,l=o[a].empty()&&u(e,o[a].head,n);l&&e.getLine(l.from.line).length<=i&&(s=l.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",r.push(e.markText(l.from,g(l.from.line,l.from.ch+1),{className:s})),l.to)&&e.getLine(l.to.line).length<=i&&r.push(e.markText(l.to,g(l.to.line,l.to.ch+1),{className:s}))}if(r.length){h&&e.state.focused&&e.focus();var c=function c(){e.operation(function(){for(var e=0;e<r.length;e++)r[e].clear()})};if(!t)return c;setTimeout(c,800)}}var a,h,g,y;a=BI.CodeMirror,h=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),g=a.Pos,y={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"},a.defineOption("matchBrackets",!1,function(e,t,n){var i=function i(){var e=arguments;BI.defer(function(){!function(e){e.operation(function(){e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null),e.state.matchBrackets.currentlyHighlighted=o(e,!1,e.state.matchBrackets)})}.apply(null,e)})};n&&n!=a.Init&&(e.off("cursorActivity",i),e.state.matchBrackets)&&e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null),t&&(e.state.matchBrackets="object"==r(t)?t:{},e.on("cursorActivity",i))}),a.defineExtension("matchBrackets",function(){o(this,!0)}),a.defineExtension("findMatchingBracket",function(e,t,n){return u(this,e,t=!n&&"boolean"!=typeof t?t:n?(n.strict=t,n):t?{strict:!0}:null)}),a.defineExtension("scanForBracket",function(e,t,n,i){return s(this,e,t,n,i)})},function(e,t,n){"use strict";!function(e){"use strict";e.defineMode("formula",function(e){function t(e){var t={};for(var n=0,i=e.length;n<i;++n)t[e[n]]=true;return t}var r=t(["false","true"]);var o=t(BI.map(e.keywordsGetter(),"text"));function n(e,t){if(e.eatSpace())return null;var n=e.next();if(n==='"'||n==="'"){a(e,n);return"string"}if(n==="​"){a(e,n);return"field"}if(/,/.test(n))return"comma";if(/[()\[\]]/.test(n))return"bracket";if(/[+\-*\/=<>!&\^|]/.test(n))return"operator";e.eatWhile(/[\u4e00-\u9fa5\w-]/);var i=e.current();if(r.hasOwnProperty(i))return"atom";if(o.hasOwnProperty(i))return"keyword";return"word"}function a(e,t){var n=false,i;while((i=e.next())!=null){if(i===t&&!n)return false;n=!n&&i==="\\"}return n}function i(e,t){return(t.tokens[0]||n)(e,t)}return{startState:function s(){return{tokens:[]}},token:function l(e,t){return i(e,t)},fold:"brace"}}),e.defineMIME("text/fx-formula","formula"),e.defineOption("keywordsGetter",false,function(e,t){e.keywordsGetter=BI.isFunction(t)?t:function(e){return e}})}(BI.CodeMirror)},function(e,t,n){"use strict";BI.FormulaCollections=["abs","ABS","acos","ACOS","acosh","ACOSH","add2array","ADD2ARRAY","and","AND","array","ARRAY","asin","ASIN","asinh","ASINH","atan","ATAN","atan2","ATAN2","atanh","ATANH","average","AVERAGE","bitnot","BITNOT","bitoperation","BITOPERATION","ceiling","CEILING","char","CHAR","circular","CIRCULAR","class","CLASS","cnmoney","CNMONEY","code","CODE","col","COL","colcount","COLCOUNT","colname","COLNAME","combin","COMBIN","concatenate","CONCATENATE","correl","CORREL","cos","COS","cosh","COSH","count","COUNT","crosslayertotal","CROSSLAYERTOTAL","date","DATE","datedelta","DATEDELTA","datedif","DATEDIF","dateinmonth","DATEINMONTH","dateinquarter","DATEINQUARTER","dateinweek","DATEINWEEK","dateinyear","DATEINYEAR","datesubdate","DATESUBDATE","datetime","DATETIME","datetonumber","DATETONUMBER","day","DAY","days360","DAYS360","daysofmonth","DAYSOFMONTH","daysofquarter","DAYSOFQUARTER","daysofyear","DAYSOFYEAR","dayvalue","DAYVALUE","decimal","DECIMAL","decode","DECODE","degrees","DEGREES","encode","ENCODE","endwith","ENDWITH","enmoney","ENMONEY","ennumber","ENNUMBER","eval","EVAL","even","EVEN","exact","EXACT","exp","EXP","fact","FACT","fields","FIELDS","filename","FILENAME","filesize","FILESIZE","filetype","FILETYPE","find","FIND","floor","FLOOR","format","FORMAT","getuserdepartments","GETUSERDEPARTMENTS","getuserjobtitles","GETUSERJOBTITLES","greparray","GREPARRAY","hierarchy","HIERARCHY","hour","HOUR","i18n","I18N","if","IF","inarray","INARRAY","index","INDEX","indexof","INDEXOF","indexofarray","INDEXOFARRAY","int","INT","isnull","ISNULL","joinarray","JOINARRAY","jvm","JVM","layertotal","LAYERTOTAL","left","LEFT","len","LEN","let","LET","ln","LN","log","LOG","log10","LOG10","lower","LOWER","lunar","LUNAR","map","MAP","maparray","MAPARRAY","max","MAX","median","MEDIAN","mid","MID","min","MIN","minute","MINUTE","mod","MOD","mom","MOM","month","MONTH","monthdelta","MONTHDELTA","now","NOW","numto","NUMTO","nvl","NVL","odd","ODD","or","OR","pi","PI","power","POWER","product","PRODUCT","promotion","PROMOTION","proper","PROPER","proportion","PROPORTION","radians","RADIANS","rand","RAND","randbetween","RANDBETWEEN","range","RANGE","rank","RANK","records","RECORDS","regexp","REGEXP","removearray","REMOVEARRAY","repeat","REPEAT","replace","REPLACE","reverse","REVERSE","reversearray","REVERSEARRAY","right","RIGHT","round","ROUND","round5","ROUND5","rounddown","ROUNDDOWN","roundup","ROUNDUP","row","ROW","rowcount","ROWCOUNT","second","SECOND","seq","SEQ","sign","SIGN","sin","SIN","sinh","SINH","slicearray","SLICEARRAY","sort","SORT","sortarray","SORTARRAY","split","SPLIT","sql","SQL","sqrt","SQRT","startwith","STARTWITH","stdev","STDEV","substitute","SUBSTITUTE","sum","SUM","sumsq","SUMSQ","switch","SWITCH","tabledatafields","TABLEDATAFIELDS","tabledatas","TABLEDATAS","tables","TABLES","tan","TAN","tanh","TANH","time","TIME","tobigdecimal","TOBIGDECIMAL","tobinary","TOBINARY","todate","TODATE","today","TODAY","todouble","TODOUBLE","tohex","TOHEX","toimage","TOIMAGE","tointeger","TOINTEGER","tooctal","TOOCTAL","totext","TOTEXT","treelayer","TREELAYER","trim","TRIM","trunc","TRUNC","uniquearray","UNIQUEARRAY","upper","UPPER","uuid","UUID","value","VALUE","webimage","WEBIMAGE","week","WEEK","weekdate","WEEKDATE","weekday","WEEKDAY","weightedaverage","WEIGHTEDAVERAGE","year","YEAR","yeardelta","YEARDELTA"]},function(e,t,n){"use strict";var o=(n=n(112))&&n.__esModule?n:{"default":n};var i=function i(){var t={};this.addChecker=function(e){BI.extend(t,e)},this.$get=function(){return function(){return t}}};BI.provider("bi.formula_editor.checker",i),BI.FormulaEditor=BI.inherit(BI.Single,{constants:{paramRegex:/(\$[\{][^\}]*[\}])/},props:{baseCls:"bi-formula-editor",watermark:"",value:"",showHint:!0,showTip:!0,lineHeight:2,lineWrapping:!0,lineNumbers:!1,paramFormatter:function(e){return e},valueGetter:function(e){return e},keywordsGetter:function(){return BI.FormulaCollections},formulaChecker:BI.emptyFn,paramTypeGetter:BI.emptyFn},render:function(){var n=this.options,r=this,i=(this.errorTipText="",this._isEditing=!1,this.formulaEditor=BI.createWidget({type:"bi.default"}),BI.CodeMirror.hint.formula),o=(BI.CodeMirror.hint.formula=function(e,t){var n=i(e,t);return n&&(BI.CodeMirror.on(n,"shown",function(){r.fireEvent("EVENT_SHOW_HINT",BI.get(n,"list",[]))}),BI.CodeMirror.on(n,"select",function(e){r.fireEvent("EVENT_SELECT_HINT",e)}),BI.CodeMirror.on(n,"pick",function(e){r.fireEvent("EVENT_PICK_HINT",e)})),n},this.editor=BI.CodeMirror(this.formulaEditor.element[0],{lineWrapping:n.lineWrapping,lineNumbers:n.lineNumbers,mode:"formula",specialChars:/[\u0000-\u001f\u007f\u00ad\u200c-\u200f\u2028\u2029\ufeff]/,matchBrackets:BI.isIE()?null:{maxScanLines:2e3,maxHighlightLineLength:2e3},keywordsGetter:function(){var e=n.keywordsGetter();return BI.map(e,function(e,t){return BI.isKey(t)?{text:t,value:t,type:BICst.FORMULA_KEYWORD_TYPE.FUNCTION,iconCls:"formula-function-font"}:t})},configureMouse:function(){return{addNew:!1}}}),1===n.lineHeight?this.element.addClass("codemirror-low-line-height"):this.element.addClass("codemirror-high-line-height"),BI.debounce(function(){BI.nextTick(function(){r.fireEvent(BI.FormulaEditor.EVENT_CHANGE)})},300)),a=(this.editor.on("change",function(e,t){r._checkWaterMark(),n.showHint&&r.editor.hasFocus()&&BI.CodeMirror.showHint(e,BI.CodeMirror.formulaHint,{completeSingle:!1}),o()}),this.editor.setOption("extraKeys",{"Ctrl-X":function(e){r._getSelection(e),e.replaceSelection(""),e.focus()},"Cmd-X":function(e){r._getSelection(e),e.replaceSelection(""),e.focus()},"Cmd-C":function(e){r._getSelection(e)},"Ctrl-C":function(e){r._getSelection(e)}}),{"（）":"()","【】":"[]","｛｝":"{}","「」":"{}","『』":"{}","，":",","（":"(","【":"[","｛":"{","）":")","】":"]","｝":"}","「":"{","」":"}","『":"{","』":"}","“”":'""',"‘’":"''","“":'"',"‘":"'","”":'"',"’":"'"}),e=(this.editor.on("inputRead",function(e,t){if(("*compose"===t.origin||"+input"===t.origin)&&a[t.text[0]]){var n=e.getCursor(),n=e.getTokenAt(n);if(/\b(?:string)\b/.test(n.type)){e=n.string.length;if(2<n.string.length&&'"'===n.string.charAt(0)&&'"'===n.string.charAt(e-1))return}var i=BI.clone(t.from);BI.nextTick(function(){var e=r.editor.getDoc().getCursor();r.editor.getDoc().replaceRange("",i,e),r._setValue(a[t.text[0]],i),o()})}"paste"===t.origin&&(i=BI.clone(t.from),BI.nextTick(function(){var e=r.editor.getDoc().getCursor();r.editor.getDoc().replaceRange("",i,e),r._setValue(r._removeInvisibleChar(t.text.join("\n")),i),o()}))}),this.editor.on("focus",function(){r._isEditing=!0,r._checkWaterMark(),r.fireEvent(BI.FormulaEditor.EVENT_FOCUS)}),this.editor.on("blur",function(){r._isEditing=!1,r.fireEvent(BI.FormulaEditor.EVENT_BLUR)}),this.editor.on("keyup",function(e,t){r.fireEvent(BI.FormulaEditor.EVENT_KEY_UP,t.key)}),this.editor.on("cursorActivity",function(e){r.fireEvent(BI.FormulaEditor.EVENT_CURSOR_ACTIVITY,e)}),[{el:{type:"bi.vertical",invisible:!0,items:[{type:"bi.label",cls:"error-tip",hgap:5,vgap:2,ref:function(e){r.errorText=e},text:""}],ref:function(e){r.errorTip=e}},left:0,bottom:0},{el:{type:"bi.vertical",invisible:!n.showTip,items:[{type:"bi.label",hgap:5,vgap:2,cls:"bi-tips",text:BI.i18nText("BI-Basic_Formula_Valid")}],ref:function(e){r.normalTip=e}},left:0,bottom:0}]);BI.isKey(this.options.watermark)?((r=this).watermark=BI.createWidget({type:"bi.text",cls:"bi-water-mark",text:this.options.watermark,whiteSpace:"normal",textAlign:"left"}),BI.createWidget({type:"bi.absolute",element:r,items:[{el:this.formulaEditor,left:0,right:0,top:0,bottom:n.showTip?24:0},{el:r.watermark,left:6,right:6,top:3}].concat(e)}),this.watermark.element.bind("mousedown",function(e){r.insertString(""),r.editor.focus(),e.stopEvent()}),this.watermark.element.bind("click",function(e){r.editor.focus(),e.stopEvent()})):BI.createWidget({type:"bi.absolute",element:r,items:[{el:this.formulaEditor,left:0,right:0,top:0,bottom:n.showTip?24:0}].concat(e)})},mounted:function(){var e=this.options;BI.isNotNull(e.value)&&this.setValue(e.value)},_removeInvisibleChar:function(e){return BI.replaceAll(e||"","​","")},_getSelection:function(e){var t=this,n=(this.clipboard||(i=BI.createWidget({type:"bi.layout",invisible:!0}),this.clipboard=BI.createWidget({type:"bi.clipboard",el:i,copy:function(){return n},afterCopy:function(){t.clipboard.destroy(),t.clipboard=null}}),BI.createWidget({type:"bi.absolute",element:"body",items:[{el:this.clipboard}]})),e.getDoc().getSelection()||""),i=BI.filter(n.split("​"),function(e){return e%2==1}).sort(function(e,t){return t.length-e.length}),i=BI.map(i,function(e,t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}),n=n.replaceAll(BI.concat(i,"​").join("|"),function(e,t){return"​"!==e?0===t||"​"!==n[t-1]?e:"${"+e+"}":""});this.clipboard.element.click()},_checkWaterMark:function(){var e=this.options;!this.disabledWaterMark&&BI.isEmptyString(this.editor.getValue())&&BI.isKey(e.watermark)?this.watermark&&this.watermark.visible():this.watermark&&this.watermark.invisible()},_setEnable:function(e){BI.FormulaEditor.superclass._setEnable.apply(this,arguments),this.editor.setOption("readOnly",!0!==e&&"nocursor")},_analyzeContent:function(e){return e.match(/\$[\{][^\}]*[\}]|(\w|\.)+|\$\{[^\$\(\)\+\-\*\/)\$,]*\w\}|\$\{[^\$\(\)\+\-\*\/]*\w\}|\$\{[^\$\(\)\+\-\*\/]*[\u4e00-\u9fa5]\}|\w|(.)|\n/g)},selectAll:function(){this.editor.execCommand("selectAll"),this._isEditing=!0},disableWaterMark:function(){this.disabledWaterMark=!0,this._checkWaterMark()},focus:function(){!0==!this._isEditing&&(this.editor.focus(),this.selectAll())},showTip:function(e){this.normalTip.setVisible(!1),this.errorTip.setVisible(!0),e&&this.errorText.setText(e)},hideTip:function(){this.normalTip.setVisible(!0),this.errorTip.setVisible(!1)},getTip:function(){return this.errorTipText},_insertField:function(e,t){var n=e,e=this.options.paramFormatter(e)||"undefined",i=BI.clone(this.editor.getCursor("from")),r=e.replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)}),o=(this.editor.replaceSelection("​"+r+"​"),this.editor.getCursor("to")),a="fieldName";BI.isNotNull(e.match("^<!.*!>$"))&&!t&&(a="error-field"),this.editor.markText(i,o,{className:a,handleMouseEvents:!0,atomic:!0,startStyle:"start",endStyle:"end",value:n,replacedWith:BI.$("<span class='"+a+"  start end' />").text(r)[0]})},insertField:function(e,t){this._insertField(e,t),this.editor.focus()},_insertFunction:function(e){var t=BI.clone(this.editor.getCursor("from")),e=(this.editor.replaceSelection(e),this.editor.getCursor("to"));this.editor.markText(t,e,{className:"#function",atomic:!0}),this.editor.replaceSelection("()"),(e=this.editor.getCursor()).ch=e.ch-1,this.editor.setCursor(e)},_isFunction:function(n){return BI.some(this.options.keywordsGetter(),function(e,t){t=t.text||t;return n===t.toLowerCase()||n===t.toUpperCase()})},_setFunction:function(e){var t=this.editor.getCursor(),e=(this.editor.replaceSelection(e),this.editor.getCursor());this.editor.markText(t,e,{className:"#function",atomic:!0})},insertFunction:function(e){this._insertFunction(e),this.editor.focus()},_insertOperator:function(e){var t=this.editor.getCursor(),e=(this.editor.replaceSelection(e),this.editor.getCursor());this.editor.markText(t,e,{className:"%operator",atomic:!0})},insertOperator:function(e){this._insertOperator(e),this.editor.focus()},_insertString:function(e){this.editor.replaceSelection(e)},insertString:function(e){this._insertString(e),this.editor.focus()},getFormulaString:function(){return this.editor.getValue()},getUsedFields:function(){var i=[];return this.editor.getValue(!0,function(e){_.forEach(e.markedSpans,function(e,t){switch(e.marker.className){case"fieldName":case"error-field":var n=e.marker.value;BI.contains(i,n)||i.push(n)}})}),i},getCheckString:function(){return this.editor.getValue(!0,function(e){var i=e.text,r=0,e=_.clone(e.markedSpans)||[];return e.sort(function(e,t){return e.from-t.from}),_.forEach(e,function(e,t){switch(e.marker.className){case"fieldName":case"error-field":var n=e.to-e.from;i=i.substr(0,e.from+r)+"$a"+i.substr(e.to+r,i.length),r=r+2-n}}),i}).replaceAll("(\\$\\{.*?\\})\\s*|​",function(e,t){return"​"!==e?t:""})},getValue:function(){return this.editor.getValue("\n",function(e){var r=e.text,o=0,e=_.clone(e.markedSpans)||[];return e.sort(function(e,t){return e.from-t.from}),_.forEach(e,function(e,t){switch(e.marker.className){case"fieldName":case"error-field":var n=e.to-e.from,i=e.marker.value;r=r.substr(0,e.from+o)+"${"+i+"}"+r.substr(e.to+o,r.length),o+=i.length-n+3}}),r}).replaceAll("(\\$\\{.*?\\})\\s*|​",function(e,t){return"​"!==e?t:""})},markField:function(e){var t=e.invalid?"error-field":"fieldName";this.editor.markText(e.from,e.to,{handleMouseEvents:!0,className:t,atomic:!0,startStyle:"start",endStyle:"end",value:e.value,replacedWith:BI.$("<span class='"+t+"  start end' />").text(e.text)[0]})},markFunction:function(e){this.editor.markText(e.from,e.to,{className:"#function",atomic:!0})},getParamWrap:function(){return"​"},beautify:function(){var t=this,n=this.options,e=this.editor.beautify({valueGetter:function(e){return"${"+n.valueGetter(t._removeInvisibleChar(e))+"}"}});this.setValue(e)},_setValue:function(e,t){var s=this,l=this.constants,c=this.options,u=this._analyzeContent(e=e||""),h=[],d=[],p=0,f=0,m="",g=(BI.isNotNull(t)&&(p=t.line,f=t.ch),s.getParamWrap());BI.each(u,function(e,t){var n,i,r,o,a,e=e===u.length-1?"":u[e+1];l.paramRegex.test(t)?(n=t.substring(2,t.length-1),i=c.paramFormatter(n),r=(i=BI.isNull(i)?c.valueGetter(n)?(i=n,n=c.valueGetter(i),c.paramFormatter(n)):"<!"+n+"!>":i).replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)}),r=g+r+g,o=BI.CodeMirror.Pos(p,f),m+=r,f+=r.length,a=BI.CodeMirror.Pos(p,f),h.push({from:o,to:a,value:n,invalid:/^<!.*!>$/.test(i),text:r})):("("===e[0]&&s._isFunction(t)&&(o=BI.CodeMirror.Pos(p,f),a=BI.CodeMirror.Pos(p,f+t.length),d.push({from:o,to:a,value:t})),"\n"===t&&(p++,f=0),m+=t,"\n"!==t&&(f+=t.length))}),this.insertString(m),BI.each(h,function(e,t){s.markField(t)}),BI.each(d,function(e,t){s.markFunction(t)})},setValue:function(e){this.editor.setValue(""),this._setValue(e)},refresh:function(){var e=this;BI.nextTick(function(){e.editor.refresh()})},setVisible:function(e){BI.FormulaEditor.superclass.setVisible.apply(this,arguments),e&&this.refresh()},check:function(e){var t,n=this,i=new o["default"](this.options.formulaChecker()),e=e||this.getValue();if(e){try{i.parse(e.replace(/\$\{.*?\}/g,function(e){var t=e.substring(2,e.length-1);switch(n.options.paramTypeGetter(t)){case"number":return 1;case"boolean":return!0;case"date":return'"bi-date-place-holder"';default:return'"'+t+'"'}}))}catch(r){t=r}return t}}}),BI.FormulaEditor.EVENT_CHANGE="EVENT_CHANGE",BI.FormulaEditor.EVENT_BLUR="EVENT_BLUR",BI.FormulaEditor.EVENT_FOCUS="EVENT_FOCUS",BI.FormulaEditor.EVENT_KEY_UP="EVENT_KEY_UP",BI.FormulaEditor.EVENT_CURSOR_ACTIVITY="EVENT_CURSOR_ACTIVITY",BI.shortcut("bi.formula_editor",BI.FormulaEditor)},function(e,t,n){"use strict";BI.RichEditorAction=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.RichEditorAction.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"",used:!0})},_init:function(){BI.RichEditorAction.superclass._init.apply(this,arguments);var n=this,i=this.options;i.editor.on(BI.NicEditor.EVENT_SELECTED,function(t){BI.defer(function(){var e;!0===i.used&&(e=window.getSelection().focusNode,n.setEnable(!0),n.checkNodes(e||t.target),n.key(t))})})},checkNodes:function(e){if(e){var t=e;do{if(this.options.tags&&BI.contains(this.options.tags,t.nodeName))return this.activate(),!0}while(t=t.parentNode&&t.className&&-1<=t.className.indexOf("bi-nic-editor"));for(t=e;3==t.nodeType;)t=t.parentNode;if(this.options.css)for(var n in this.options.css){if(null==this.options.css[n])return this.activate(this._getDomStyle(t,n),e),!0;if(BI.$(t).css(n)==this.options.css[n])return this.activate(),!0}this.deactivate()}return!1},start:function(){},key:function(){},keydown:function(){},hideIf:function(e){},activate:function(){},deactivate:function(){},restoreRng:function(){this.options.editor.restoreRng()},doCommand:function(e){this.restoreRng(),this.options.command&&this.options.editor.nicCommand(this.options.command,e)},getValue:function(){},_getDomStyle:function(e,n){var i,r,o=this;return"color"===n?o._getDomColor(e):(i=BI.$(e).css(n),e.children&&1===e.children.length?o._getDomStyle(e.children[0],n)||i:(r=null,BI.each(e.children,function(e,t){""!==t.innerText&&(t=o._getDomStyle(t,n)||i,r?r!==t&&(r=i):r=t)}),r||i))},_getDomColor:function(e){for(var t=BI.get(e,["style","color"],BI.DOM.hex2rgb(e.getAttribute("color")));BI.isEmpty(t)&&"P"!==e.tagName;)e=e.parentNode,t=BI.get(e,["style","color"],BI.DOM.hex2rgb(e.getAttribute("color")));return t="transparent"===(t=""!==t&&"inherit"!==t?t:"")?"rgba(0, 0, 0, 0)":t}})},function(e,t,n){"use strict";BI.RichEditorParamAction=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorParamAction.superclass._defaultConfig.apply(this,arguments),{paramFormatter:function(e){return e}})},_init:function(){BI.RichEditorParamAction.superclass._init.apply(this,arguments)},addParam:function(e,t){var n=this.options,i=n.editor.instance,r=new Image,n=n.paramFormatter(e),o=BI.DOM.getImage(n);r.src=o.src,r.alt=BI.isFunction(t)?t(e):e,BI.$(r).addClass("rich-editor-param"),BI.$(r).attr("style",o.style),BI.$(r).attr("name",window.encodeURIComponent(n)),i.insertHTML(BI.$("<div>").append(r).html(),!0)}})},function(e,t,n){"use strict";BI.RichEditorTextToolbar=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.RichEditorTextToolbar.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-rich-editor-text-toolbar",buttons:[{type:"bi.rich_editor_font_chooser"},{type:"bi.rich_editor_size_chooser"},{type:"bi.rich_editor_bold_button"},{type:"bi.rich_editor_italic_button"},{type:"bi.rich_editor_underline_button"},{type:"bi.rich_editor_color_chooser"},{type:"bi.rich_editor_background_color_chooser"},{type:"bi.rich_editor_align_left_button"},{type:"bi.rich_editor_align_center_button"},{type:"bi.rich_editor_align_right_button"},{type:"bi.rich_editor_param_button"}],height:34})},_init:function(){BI.RichEditorTextToolbar.superclass._init.apply(this,arguments);var n=this.options,e=BI.createWidgets(BI.map(n.buttons,function(e,t){return BI.extend(t,{editor:n.editor,height:24})}));BI.createWidget({type:"bi.horizontal",element:this,items:e,hgap:3,vgap:5})},mounted:function(){var e=this;BI.isIE9Below()&&(this.element.mousedown(function(){e._noSelect(e.element[0])}),this._noSelect(this.element[0]))},_noSelect:function(e){e.setAttribute&&"input"!=e.nodeName.toLowerCase()&&"textarea"!=e.nodeName.toLowerCase()&&e.setAttribute("unselectable","on");for(var t=0;t<e.childNodes.length;t++)this._noSelect(e.childNodes[t])}}),BI.shortcut("bi.rich_editor_text_toolbar",BI.RichEditorTextToolbar)},function(e,t,n){"use strict";function i(){return BI.isIE()&&BI.getIEVersion()<11}function d(e){return BI.isNull(e)?"":BI.replaceAll(e+"",'&|\\$|{|}|"|<|>',function(e){return r[e]||"&nbsp;"})}var r,o,a,s,l,c,u,h,p,f,m,g;r={"&":"&amp;",$:"&dollar;","{":"&lcub;","}":"&rcub;",'"':"&quot;","<":"&lt;",">":"&gt;"},o={NORMAL:"normal",ESCAPE:"escape",JSON:"json"},BI.NicEditor=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.NicEditor.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-nic-editor",$testId:"bi-nic-editor",scrollable:!0})},_init:function(){BI.NicEditor.superclass._init.apply(this,arguments);var e=this.options,e=(BI.$(document).bind("mousedown."+this.getName(),BI.bind(this.selectCheck,this)),e.scrollable?{}:{scrollable:!1,scrolly:!1});BI.createWidget(BI.extend(e,{type:"bi.vertical",element:this,items:[this.instance=this.addInstance()]}))},addInstance:function(){var e,t=this.options,t={type:"bi.nic_editor_instance",ne:this,height:t.height,maxHeight:t.maxHeight||null,readOnly:t.readOnly,singleLine:t.singleLine};return this.element[0].contentEditable||window.opera?e=BI.createWidget(t):console.error("不支持此浏览器"),e},insertElem:function(e){this.selectedInstance&&this.selectedInstance.insertElem(e)},insertHTML:function(e){this.selectedInstance&&this.selectedInstance.insertHTML(e)},nicCommand:function(e,t){this.selectedInstance&&this.selectedInstance.nicCommand(e,t)},selectCheck:function(e){var t=e.target;do{if(t===this.instance.element[0]||!this.instance.element.is(":visible"))return;if(this.instance.checkToolbar(t))return void this.instance.saveRng()}while(t=t.parentNode);this.instance.saveRng(),this.fireEvent("blur",t),this.lastSelectedInstance=this.selectedInstance||this.lastSelectedInstance,this.selectedInstance=null},blur:function(){this.instance.blur(),this.instance.nicCommand("UnSelect")},focus:function(){this.instance.focus()},bindToolbar:function(e){this.instance.bindToolbar(e)},setValue:function(e){BI.isString(e)?this.instance.setContent(e):this.instance.setJSONValue(e)},getValue:function(e){switch(e){case o.ESCAPE:return this.instance.getEscapeContent();case o.JSON:return this.instance.getJSONValue();default:return this.instance.getContent()}},getContentHeight:function(){return this.instance.getContentHeight()},getInstance:function(){return this.instance},restoreRng:function(){this.selectedInstance=this.instance,this.selectedInstance.restoreRng()},destroyed:function(){(window.getSelection?window.getSelection():document.selection).removeAllRanges(),BI.$(document).unbind("mousedown."+this.getName())}}),BI.NicEditor.EVENT_SELECTED="selected",BI.NicEditor.EVENT_BLUR="blur",BI.NicEditor.EVENT_FOCUS="focus",BI.NicEditor.EVENT_KEYDOWN="keydown",BI.NicEditor.EVENT_KEYUP="keyup",BI.NicEditor.htmlEncode=d,BI.NicEditor.htmlDecode=function(e){return BI.isNull(e)?"":BI.replaceAll(e+"","&amp;|&dollar;|&lcub;|&rcub;|&quot;|&lt;|&gt;|&nbsp;",function(e){switch(e){case"&amp;":return"&";case"&dollar;":return"$";case"&lcub;":return"{";case"&rcub;":return"}";case"&quot;":return'"';case"&lt;":return"<";case"&gt;":return">";default:return" "}})},BI.NicEditor.FormatType=o,BI.shortcut("bi.nic_editor",BI.NicEditor),a="niceditor-",s=["class","style","color","face","name","width","height","alt","src","align","href","target"],l={1:12,2:13,3:16,4:18,5:24,6:32,7:48},c=["div","p","span","font","b","strong","i","u","em","br"],u=["color","font-family","font-size","font-weight"],h=["style","face","color"],p=function p(n){return 3!==n.nodeType&&1===n.nodeType&&"img"!==n.tagName.toLowerCase()&&(n.style.cssText=BI.reduce(n.style.cssText.split(";"),function(e,t){var n=BI.replaceAll(e.split(":")[0]," ",""),i="";return t+(i=u.includes(n)?n+":"+e.split(":")[1]:i)+";"},""),BI.each(Object.values(n.attributes),function(e,t){t&&!h.includes(t.name)&&n.removeAttribute(t.name)})),n},f=function f(e){if(e&&3!==e.nodeType){if(1===e.nodeType){var t=e.tagName.toLowerCase();if(c.includes(t)||"img"===t&&e.className.includes("rich-editor-param"))p(e);else try{var n=e.innerText;return"style"!==t&&"script"!==t&&"title"!==t||(n=""),e.parentNode.replaceChild(document.createTextNode(n),e),e}catch(r){console.log(r)}}for(var i=e.childNodes.length-1;0<=i;i--)1!==e.childNodes[i].nodeType&&3!==e.childNodes[i].nodeType?e.removeChild(e.childNodes[i]):f(e.childNodes[i])}return e},m={replaceHtmlSymbol:function(e){return null==e?"":e.replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/(\r\n|\r|\n)/g,"<br/>")},_cleanBlockAttr:function(e,n){return function i(e){var r=BI.$(e),t=BI.map(e.attributes,function(e,t){return t.nodeName});return r[0]&&"SCRIPT"===r[0].tagName?(r.destroy(),null):r[0]&&3===r[0].nodeType?r[0]:(BI.each(n,function(e,t){var n,i;t&&("fontSize"===e&&r[0].style&&r[0].style.fontSize?(n=-1<(t=r[0].style.fontSize).indexOf("pt")?4/3:1,i=BI.Constants.getConstant("bi.constant.materials.rich_editor.font_size_range"),r.css(e,BI.clamp(parseInt(t)*n,i.MIN,i.MAX)+"px")):r.css(e,""))}),BI.each(t,function(e,t){try{"size"===t&&"FONT"===r[0].tagName&&r.css("fontSize",l[r.attr("size")]),BI.contains(s,t)||r.removeAttr(t)}catch(n){}}),BI.each(e.children,function(e,t){i(t)}),e)}(e)},_formatAttr:function(e){var t=BI.isIE();return function n(e){return t&&e.style&&""!==e.style.textAlign&&(e.align=e.style.textAlign,e.style.textAlign=""),BI.each(e.children,function(e,t){n(t)}),e}(e)},getPasteHtml:function(e,t){var n;return(e=!e&&t?BI.$("<p>"+m.replaceHtmlSymbol(t)+"</p>"):e)?(n=document.createElement("div"),BI.each(e,function(e,t){n.appendChild(t)}),f(n),BI.reduce(n.childNodes,function(e,t){return t+((3===e.nodeType?e.nodeValue:e.outerHTML)||"")},"")):""},getFormatHtml:function(e){return BI.reduce(e,function(e,t){e=m._cleanBlockAttr(e,{fontSize:!0});return t+((3===(e=m._formatAttr(e)).nodeType?e.nodeValue:e.outerHTML)||"")},"")}},g=BI.inherit(BI.Layout,{isSelected:!1,_init:function(){g.superclass._init.apply(this,arguments);var e=this.options,t=(t=e.value||"<br>").startWith("<p>")?t:"<p>"+t+"</p>";this.ne=this.options.ne,this.elm=BI.createWidget({type:"bi.layout",width:e.width-8,scrollable:!1}),this.elm.element.css({minHeight:BI.isNumber(e.height)?e.height-8+"px":e.height,outline:"none",padding:"0 10px",wordBreak:"break-all"}).html(e.readOnly?BI.Text.formatText(t):t),e.readOnly&&this.elm.element.attr("contentEditable",!1),this.element.css("maxHeight",e.maxHeight?e.maxHeight+"px":null),this.e=BI.createWidget({type:"bi.layout",invisible:!0,tagName:"textarea"}),BI.createWidget({type:"bi.default",element:this,scrolly:!0,items:[this.elm,this.e]}),this.ne.on("blur",BI.bind(this.blur,this)),this.start(),this.blur()},start:function(){this.elm.element.attr("contentEditable",!0!==this.options.readOnly),this.getContent(),this.instanceDoc=document.defaultView,this.elm.element.on("mousedown",BI.bind(this.selected,this)),this.elm.element.on("keydown",BI.bind(this.keyDown,this)),this.elm.element.on("focus",BI.bind(this.selected,this)),this.elm.element.on("blur",BI.bind(this.blur,this)),this.elm.element.on("keyup",BI.bind(this.selected,this)),this.elm.element.on("paste",BI.bind(this.paste,this)),this.ne.fireEvent("add")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var e=this.getSel();if(e&&0!==e.rangeCount)return 0<e.rangeCount?e.getRangeAt(0):e.createRange()},getSavedRng:function(){return this.savedRange},selRng:function(e,t){window.getSelection?(t.removeAllRanges(),t.addRange(e)):e.select()},selElm:function(){var e=this.getRng();if(e){if(e.startContainer){var t=e.startContainer;if(1==e.cloneContents().childNodes.length)for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n].ownerDocument.createRange();if(i.selectNode(t.childNodes[n]),1!=e.compareBoundaryPoints(Range.START_TO_START,i)&&-1!=e.compareBoundaryPoints(Range.END_TO_END,i))return t.childNodes[n]}return t}return"Control"==this.getSel().type?e.item(0):e.parentElement()}},saveRng:function(e){try{var t=this.getRng();(this._isChildOf(this.getSelectionContainerElem(t),this.element[0])&&(!this.savedRange||this.savedRange.collapsed)||e)&&(this.savedRange=t,this.savedSel=this.getSel())}catch(n){}},getSelectionContainerElem:function(e){if(e)return 1===(e=e.commonAncestorContainer).nodeType?e:e.parentNode},setFocus:function(e){try{e.focus()}catch(a){}if(window.getSelection){var t=function(e){var t=BI.$(e)[0];if(!t)return 0;switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}}(e),n=BI.$(e).contents().last(),i=document.createRange(),n=(n.is("br")?--t:n[0]||3===e.nodeType||(t=0),BI.$(e).is("img")?i.setEndAfter(e,t):i.setEnd(e,t),i.collapse(!1),window.getSelection());n.removeAllRanges(),n.addRange(i)}else{try{e.focus()}catch(a){}(t=document.selection.createRange()).moveStart("character",-e.innerText.length);for(var r=t.text,o=0;o<e.innerText.length;o++)e.innerText.substring(0,o+1)==r.substring(r.length-o-1,r.length)&&(result=o+1)}},removeRng:function(){this.savedRange=null},restoreRng:function(){this.savedRange&&this.selRng(this.savedRange,this.savedSel),this.savedRange=null},restoreRngAndClearRange:function(){this.savedRange&&(this.savedRange.setStart(this.savedRange.endContainer,this.savedRange.endOffset),this.selRng(this.savedRange,this.savedSel))},keyDown:function(e,t){if(8===e.keyCode){var n=this.elm.element.html().toLowerCase().trim();if("<p><br></p>"===n||"<p></p>"===n)return void e.preventDefault()}13===e.keyCode&&this.options.singleLine?e.preventDefault():this.ne.fireEvent("keydown",e)},selected:function(e){"mousedown"===e.type&&this.removeRng();var t;e.target||this.selElm()||this.selElm();e.ctrlKey||((t=this.ne.selectedInstance)!=this&&(t&&this.ne.fireEvent("blur",e),(this.ne.selectedInstance=this).ne.fireEvent("focus",e)),this.ne.fireEvent("selected",e),this.isFocused=!0,this.elm.element.addClass(a+"selected")),this.ne.fireEvent("keyup",e),8!==e.keyCode||(t=this.elm.element.html().toLowerCase().trim())&&"<br>"!==t||(e=BI.$(this._getNewLine()),this.elm.element.html(""),this.elm.element.append(e),this.setFocus(e[0]))},focus:function(){var e=this;try{this.removeRng(),this.setFocus(this.elm.element[0]),this.nicCommand("selectAll")}catch(t){setTimeout(function(){e.focus()})}},blur:function(){this.isFocused=!1,this.elm.element.removeClass(a+"selected")},paste:function(e){var t="",n="";if(e.originalEvent.clipboardData&&!BI.isIE()&&(t=e.originalEvent.clipboardData.getData("text/html"),n=e.originalEvent.clipboardData.getData("text/plain")),t)try{this.saveRng(),this.insertHTML(m.getPasteHtml(BI.$(t),n)),e.preventDefault()}catch(e){this._pasteByBin()}else BI.isEmpty(n)&&this._pasteByBin()},_pasteByBin:function(){var i=this,r=BI.$("<div contenteditable='true' />").addClass("bi-paste-bin").attr("tabIndex","-1").appendTo(this.element);this.savedRange=null,this.saveRng(!0),r.focus(),BI.defer(function(){i.restoreRng();var e=BI.$("<div />").append(r.contents()),t=r[0].innerText,e=m.getPasteHtml(e,t);try{i.insertHTML(e)}catch(n){i.insertHTML("<p>"+t+"</p>")}r.remove()})},saveContent:function(){this.ne.fireEvent("save"),this.e.element.value(this.getContent())},getElm:function(){return this.elm},getEscapeContent:function(){return this.ne.fireEvent("get"),this.elm.element?BI.reduce(this.elm.element.contents(),function(e,t){return t+function h(e){var i={"for":"htmlFor","class":"className"},t="",n="",r="",o=e,e=o.nodeType,a=String.prototype.toLowerCase.call(o.tagName||"");switch(e){case 1:var s=o.attributes,l="";if(s){for(var c={},u=0;u<s.length;u++)c[s[u].nodeName]=undefined;"input"===o.tagName?"checkbox"===o.type||"radio"===o.type?c.checked=!1:"file"!==o.type&&(c.value=""):"option"===a?c.selected=!1:"textarea"===a&&(c.value=""),BI.each(c,function(e,t){var n=i[e]||e;(o.getAttribute?o.getAttribute(e):o[n])!==t&&(l=l+" "+e+'="'+d(o.getAttribute(e))+'"')})}t="<"+a+l+">",BI.contains(["img","br","input","hr","meta","link","param"],a)||(n="</"+a+">");break;case 3:t=d(o.nodeValue)||""}return BI.each(o.childNodes,function(e,t){r+=h(t)}),t+r+n}(e)},""):""},getContent:function(){return this.content=this.getElm().element.html(),this.ne.fireEvent("get"),this.content},getParseContent:function(){},getContentHeight:function(){return this.elm.element.height()},getJSONValue:function(){return this.getContent(),{tagName:"root",childNodes:BI.map(this.getElm().element.contents(),function(e,t){return function l(i){var r={"for":"htmlFor","class":"className"},e={nodeType:i.nodeType},t=(i.tagName?e.tagName=i.tagName.toLowerCase():i.nodeName&&(e.nodeName=i.nodeName),i.nodeValue&&(e.nodeValue=i.nodeValue),i.attributes);if(t){for(var n={},o=0;o<t.length;o++)n[t[o].nodeName]=undefined;"input"===e.tagName?"checkbox"===i.type||"radio"===i.type?n.checked=!1:"file"!==i.type&&(n.value=""):"option"===e.tagName?n.selected=!1:"textarea"===e.tagName&&(n.value="");var a=[];BI.each(n,function(e,t){var n=r[e]||e;(n=i.getAttribute?i.getAttribute(e):i[n])!==t&&a.push([e,n])}),a.length&&(e.attributes=a)}var s=i.childNodes;if("textarea"!==e.tagName&&s&&s.length)for(a=e.childNodes=[],o=0;o<s.length;o++)a[o]=l(s[o]);return e}(t)})}},setJSONValue:function(e){var n="",e="root"===(e=e||{}).tagName?e.childNodes:BI.isArray(e)?e:[e];BI.each(e,function(e,t){n+=function a(e){var t="",n="",i="",r="string"==typeof e?JSON.parse(e):e,e=r.nodeType,o=r.tagName;switch(e){case 1:t="<"+o+BI.reduce(r.attributes,function(e,t){return t+" "+d(e[0])+'="'+d(e[1])+'"'},"")+">",BI.contains(["img","br","input","hr","meta","link","param"],o)||(n="</"+o+">");break;case 3:t=d(r.nodeValue)||""}return BI.each(r.childNodes,function(e,t){i+=a(t)}),t+i+n}(t)}),this.setContent(n)},setContent:function(e){e=(e=(e=e||(i()?"":"<br>")).startWith("<p")?e:"<p>"+e).endWith("</p>")?e:e+"</p>",this.content=m.getFormatHtml(BI.$(e)),this.ne.fireEvent("set"),this.elm.element.html(this.content)},insertElem:function(e){var t=this.getRng();t.insertNode&&(t.deleteContents(),t.insertNode(e))},insertHTML:function(e,t){this.restoreRng();var i=this.getSel(),r=this.savedRange||this.getRng();if(r){if(t)return n(e);try{if(!document.queryCommandSupported("insertHTML"))throw new Error("Does not support this command");this.nicCommand("insertHTML",e)}catch(o){n(e)}}function n(e){if(r.insertNode){var t=BI.$(e);if(r.deleteContents(),r.startContainer&&r.endContainer&&r.endContainer===r.startContainer&&"BR"===r.startContainer.tagName)try{r.setStart(r.startContainer.parentNode,r.startContainer.parentNode.childNodes.length-1),r.setEnd(r.endContainer.parentNode,r.endContainer.parentNode.childNodes.length)}catch(o){r.setStart(r.startContainer.parentNode,0),r.setEnd(r.endContainer.parentNode,0)}for(var n=0;n<t.length;n++)r.insertNode(t[n]);r.endContainer&&(i.removeAllRanges(),r.setStart(r.endContainer,r.endOffset),r.setEnd(r.endContainer,r.endOffset),i.addRange(r))}else r.pasteHTML&&r.pasteHTML(e)}},bindToolbar:function(e){this.toolbar=e},checkToolbar:function(e){return this.toolbar&&this.toolbar.element[0]===e},nicCommand:function(e,t){document.execCommand(e,!1,t)},initSelection:function(e){var t=this._getNewLine(),n=this.elm.element,i=n.children();if(i.length){i=i.last();if(e){var e=i.html().toLowerCase(),r=i.nodeName;if("<br>"!==e&&"<br/>"!==e||"P"!==r)return n.append(t),void this.initSelection()}for(var o,a=i[0];a;)a=(o=a).childNodes?a.childNodes[a.childNodes.length-1]:null;this.setFocus(o)}else n.append(t),this.initSelection()},_getNewLine:function(){return i()?"<p>&nbsp;</p>":"<p><br></p>"},_isChildOf:function(e,t){var n;if(e&&t)for(n=e.parentNode;n;){if(t===n)return!0;n=n.parentNode}return!1}}),BI.shortcut("bi.nic_editor_instance",g)},function(e,t,n){"use strict";BI.RichEditorBackgroundChooserTrigger=BI.inherit(BI.Widget,{_defaultConfig:function(){var e=BI.RichEditorBackgroundChooserTrigger.superclass._defaultConfig.apply(this,arguments);return BI.extend(e,{width:20,height:20})},_init:function(){BI.RichEditorBackgroundChooserTrigger.superclass._init.apply(this,arguments),this.font=BI.createWidget({type:"bi.icon_button",title:BI.i18nText("BI-Basic_Background_Color"),cls:"text-background-font"}),this.underline=BI.createWidget({type:"bi.icon_button",cls:"text-color-underline-font"}),BI.createWidget({type:"bi.absolute_center_adapt",element:this,items:[{el:this.underline},{el:this.font}]})},setValue:function(e){this.underline.element.css("color",e)},getValue:function(){return this.underline.element.css("color")}}),BI.shortcut("bi.rich_editor_background_color_chooser_trigger",BI.RichEditorBackgroundChooserTrigger)},function(e,t,n){"use strict";BI.RichEditorAlignCenterButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorAlignCenterButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"justifycenter"})},_init:function(){BI.RichEditorAlignCenterButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.align=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Word_Align_Center"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-align-center-font"}),this.align.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){for(var t=this,n=e;3===n.nodeType;)n=n.parentNode;for(;1===n.nodeType&&"div"===n.tagName.toLowerCase();)n=n.firstChild;n&&1===n.nodeType||BI.isNotNull(n.tagName)||(n=n.parentNode);try{BI.defer(function(){"center"===BI.get(getComputedStyle(n),"textAlign")||"-moz-center"===BI.get(getComputedStyle(n),"textAlign")?t.activate():t.deactivate()})}catch(i){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.align.setSelected(!0)},deactivate:function(){this.align.setSelected(!1)}}),BI.shortcut("bi.rich_editor_align_center_button",BI.RichEditorAlignCenterButton)},function(e,t,n){"use strict";BI.RichEditorAlignLeftButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorAlignLeftButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"justifyleft"})},_init:function(){BI.RichEditorAlignLeftButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.align=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Word_Align_Left"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-align-left-font"}),this.align.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){for(var t=this,n=e;3===n.nodeType;)n=n.parentNode;for(;1===n.nodeType&&"div"===n.tagName.toLowerCase();)n=n.firstChild;n&&1===n.nodeType||BI.isNotNull(n.tagName)||(n=n.parentNode);try{BI.defer(function(){"left"===BI.get(getComputedStyle(n),"textAlign")||"start"===BI.get(getComputedStyle(n),"textAlign")||"-moz-left"===BI.get(getComputedStyle(n),"textAlign")?t.activate():t.deactivate()})}catch(i){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.align.setSelected(!0)},deactivate:function(){this.align.setSelected(!1)}}),BI.shortcut("bi.rich_editor_align_left_button",BI.RichEditorAlignLeftButton)},function(e,t,n){"use strict";BI.RichEditorAlignRightButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorAlignRightButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"justifyright"})},_init:function(){BI.RichEditorAlignRightButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.align=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Word_Align_Right"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-align-right-font"}),this.align.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){for(var t=this,n=e;3===n.nodeType;)n=n.parentNode;for(;1===n.nodeType&&"div"===n.tagName.toLowerCase();)n=n.firstChild;n&&1===n.nodeType||BI.isNotNull(n.tagName)||(n=n.parentNode);try{BI.defer(function(){"right"===BI.get(getComputedStyle(n),"textAlign")||"-moz-right"===BI.get(getComputedStyle(n),"textAlign")?t.activate():t.deactivate()})}catch(i){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.align.setSelected(!0)},deactivate:function(){this.align.setSelected(!1)}}),BI.shortcut("bi.rich_editor_align_right_button",BI.RichEditorAlignRightButton)},function(e,t,n){"use strict";BI.RichEditorBoldButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorBoldButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"Bold",tags:["B","STRONG"],css:{}})},_init:function(){BI.RichEditorBoldButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.bold=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Basic_Bold"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-bold-font"}),this.bold.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){var t=this;try{BI.defer(function(){document.queryCommandState("bold")?t.activate():t.deactivate()})}catch(n){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.bold.setSelected(!0)},deactivate:function(){this.bold.setSelected(!1)}}),BI.shortcut("bi.rich_editor_bold_button",BI.RichEditorBoldButton)},function(e,t,n){"use strict";BI.RichEditorItalicButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorItalicButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"Italic",tags:["EM","I"],css:{fontStyle:"italic"}})},_init:function(){BI.RichEditorItalicButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.italic=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Basic_Italic"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-italic-font"}),this.italic.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){var t=this;try{BI.defer(function(){document.queryCommandState("italic")?t.activate():t.deactivate()})}catch(n){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.italic.setSelected(!0)},deactivate:function(){this.italic.setSelected(!1)}}),BI.shortcut("bi.rich_editor_italic_button",BI.RichEditorItalicButton)},function(e,t,n){"use strict";BI.RichEditorParamButton=BI.inherit(BI.RichEditorParamAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorParamButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:30})},_init:function(){BI.RichEditorParamButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.param=BI.createWidget({type:"bi.button",element:this,level:"ignore",minWidth:0,text:BI.i18nText("BI-Formula_Insert"),height:t.height,width:t.width}),this.param.on(BI.Button.EVENT_CHANGE,function(){e.addParam("参数")})},activate:function(){},deactivate:function(){}}),BI.shortcut("bi.rich_editor_param_button",BI.RichEditorParamButton)},function(e,t,n){"use strict";BI.RichEditorUnderlineButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorUnderlineButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"Underline",tags:["U"],css:{}})},_init:function(){BI.RichEditorUnderlineButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.underline=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Basic_Underline"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-underline-font"}),this.underline.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){var t=this;try{BI.defer(function(){document.queryCommandState("underline")?t.activate():t.deactivate()})}catch(n){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.underline.setSelected(!0)},deactivate:function(){this.underline.setSelected(!1)}}),BI.shortcut("bi.rich_editor_underline_button",BI.RichEditorUnderlineButton)},function(e,t,n){"use strict";BI.RichEditorColorChooserTrigger=BI.inherit(BI.Widget,{_defaultConfig:function(){var e=BI.RichEditorColorChooserTrigger.superclass._defaultConfig.apply(this,arguments);return BI.extend(e,{width:20,height:20})},_init:function(){BI.RichEditorColorChooserTrigger.superclass._init.apply(this,arguments),this.font=BI.createWidget({type:"bi.icon_button",title:BI.i18nText("BI-Basic_Font_Color"),cls:"text-color-font",warningTitle:this.options.warningTitle}),this.underline=BI.createWidget({type:"bi.icon_button",cls:"text-color-underline-font"}),BI.createWidget({type:"bi.absolute_center_adapt",element:this,items:[{el:this.underline},{el:this.font}]}),BI.isNotNull(this.options.value)&&this.setValue(this.options.value)},setValue:function(e){this.underline.element.css("color",e)},getValue:function(){return this.underline.element.css("color")}}),BI.shortcut("bi.rich_editor_color_chooser_trigger",BI.RichEditorColorChooserTrigger)},function(e,t,n){"use strict";BI.RichEditorBackgroundColorChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorBackgroundColorChooser.superclass._defaultConfig.apply(this,arguments),{width:20,height:20})},_init:function(){BI.RichEditorBackgroundColorChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.colorchooser=BI.createWidget({type:"bi.color_chooser",container:null,element:this,width:e.width,height:e.height,destroyWhenHide:e.destroyWhenHide,recommendColorsGetter:e.recommendColorsGetter,el:{type:"bi.rich_editor_background_color_chooser_trigger",title:BI.i18nText("BI-Widget_Background_Colour"),cls:"text-toolbar-button"}}),this.colorchooser.on(BI.ColorChooser.EVENT_CHANGE,function(){var e=this.getValue();t.fireEvent("EVENT_CHANGE",e)}),this.colorchooser.on(BI.ColorChooser.EVENT_AFTER_POPUPVIEW,function(){t.fireEvent("EVENT_AFTER_POPUPVIEW")})},setValue:function(e){this.colorchooser.setValue(e)},hideIf:function(e){0<!this.colorchooser.element.find(e.target).length&&this.colorchooser.hideView()},deactivate:function(){}}),BI.RichEditorBackgroundColorChooser.EVENT_CHANGE="EVENT_CHANGE",BI.RichEditorBackgroundColorChooser.EVENT_AFTER_POPUPVIEW="EVENT_AFTER_POPUPVIEW",BI.shortcut("bi.rich_editor_background_color_chooser",BI.RichEditorBackgroundColorChooser)},function(e,t,n){"use strict";BI.RichEditorColorChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorColorChooser.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"foreColor",css:{color:null}})},_init:function(){BI.RichEditorColorChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.colorchooser=BI.createWidget({type:"bi.color_chooser",container:null,element:this,width:e.width,height:e.height,destroyWhenHide:e.destroyWhenHide,recommendColorsGetter:e.recommendColorsGetter,el:{type:"bi.rich_editor_color_chooser_trigger",title:BI.i18nText("BI-Font_Colour"),cls:"text-toolbar-button",disabled:e.disabled,warningTitle:e.warningTitle}}),this.colorchooser.on(BI.ColorChooser.EVENT_CHANGE,function(){var e=this.getValue();BI.isIE()?t.doCommand(e):(document.execCommand("styleWithCSS",null,!0),t.doCommand(e||"inherit"),document.execCommand("styleWithCSS",null,!1))})},hideIf:function(e){0<!this.colorchooser.element.find(e.target).length&&this.colorchooser.hideView()},activate:function(t){var n=this;BI.delay(function(){var e=BI.DOM.rgb2hex(t);0===(BI.DOM.isRGBColor(t)?BI.DOM.rgba2json(t):{}).a&&(e="transparent"),n.colorchooser.setValue(e)},0)},deactivate:function(){this.colorchooser.setValue("")}}),BI.shortcut("bi.rich_editor_color_chooser",BI.RichEditorColorChooser)},function(e,t,n){"use strict";BI.RichEditorFontChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorFontChooser.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-rich-editor-font-chooser bi-card",command:"FontName",width:100,height:24,css:{fontFamily:null},$testId:"bi-rich-editor-font-chooser",simple:!1})},_init:function(){BI.RichEditorSizeChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.trigger=BI.createWidget({type:"bi.text_trigger",height:e.height,triggerWidth:16,text:BI.i18nText("BI-Basic_Default")}),this.combo=BI.createWidget({type:"bi.combo",cls:e.simple?"bi-border-bottom":"bi-border",container:null,element:this,el:this.trigger,adjustLength:1,popup:{minWidth:70,el:{type:"bi.button_group",items:BI.createItems(t._formatArray(BI.isNotEmptyArray(e.fontList)?e.fontList:BI.Constants.getConstant("bi.constant.materials.rich_editor.font_family")),{type:"bi.single_select_item"}),layouts:[{type:"bi.vertical"}]}}}),this.combo.on(BI.Combo.EVENT_CHANGE,function(){var e=this.getValue()[0];t.activate(e),t.doCommand(e),this.hideView(),this.setValue([])})},_formatArray:function(e){return BI.map(e,function(e,t){return{text:t.text,value:BI.isString(t.value)?t.value.replaceAll('"',""):""}})},hideIf:function(e){0<!this.combo.element.find(e.target).length&&this.combo.hideView()},activate:function(n){var e=this.options,i=(n={"STHeiti, Hei, SimHei":"STHeiti, Hei, SimHei, 黑体","STSong, Song, SimSun":"STSong, Song, SimSun, 宋体",'STFangSong, "Fang Song", FangSong':'STFangSong, "Fang Song", FangSong, 仿宋',"STKaiti, Kai, KaiTi":"STKaiti, Kai, KaiTi, 楷体"}[n]||n,BI.i18nText("BI-Basic_Default"));BI.any(e.fontList||BI.Constants.getConstant("bi.constant.materials.rich_editor.font_family"),function(e,t){if(n.replaceAll('"',"")===t.value.replaceAll('"',""))return i=t.text,!0}),this.fontFamily=n,this.trigger.setText(i),this.combo.setValue(n.replaceAll('"',""))},deactivate:function(){this.trigger.setText(BI.i18nText("BI-Basic_Default")),this.combo.setValue()},getValue:function(){return this.fontFamily||BI.FontFamily.DEFAULT}}),BI.shortcut("bi.rich_editor_font_chooser",BI.RichEditorFontChooser),BI.FontFamily={DEFAULT:'Avenir, Segoe UI, PingFangSC-Regular, "Microsoft YaHei"',SIM_HEI:"STHeiti, Hei, SimHei, 黑体",SIM_SUN:"STSong, Song, SimSun, 宋体",FANG_SONG:'STFangSong, "Fang Song", FangSong, 仿宋',KAI_TI:"STKaiti, Kai, KaiTi, 楷体",YOU_SHE:"YouShe",PANG_MEM:"pangMen",ARIAL:"Arial",HELVETICA_NEUE:'"Helvetica Neue"',VERDANA:"Verdana",TIMES_NEW_ROMAN:'"Times New Roman"',DIGITAL_NUMBERS:'"Digital Numbers"',POPPINS_BOLD:'"Poppins Bold"'}},function(e,t,n){"use strict";BI.RichEditorSizeChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorSizeChooser.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-rich-editor-size-chooser bi-card",command:"FontSize",width:50,height:24,css:{fontSize:null},$testId:"bi-rich-editor-size-chooser",simple:!1})},_init:function(){BI.RichEditorSizeChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.trigger=BI.createWidget({type:"bi.text_trigger",height:e.height,triggerWidth:16,text:BI.i18nText("BI-Font_Size"),disabled:e.disabled,warningTitle:e.warningTitle}),this.combo=BI.createWidget({type:"bi.combo",cls:e.simple?"bi-border-bottom":"bi-border",container:null,element:this,el:this.trigger,adjustLength:1,popup:{maxWidth:70,minWidth:70,el:{type:"bi.button_group",items:BI.createItems(BI.Constants.getConstant("bi.constant.materials.rich_editor.font_size"),{type:"bi.single_select_item"}),layouts:[{type:"bi.vertical"}]}}}),this.combo.on(BI.Combo.EVENT_CHANGE,function(){var e=this.getValue()[0];t.doAction(e),this.hideView(),this.setValue([])})},hideIf:function(e){0<!this.combo.element.find(e.target).length&&this.combo.hideView()},doAction:function(i){this.activate(i);var r=this.options.editor.instance,e=r.getSavedRng();e&&!e.collapsed?(this.doCommand(7),BI.each(document.getElementsByTagName("font"),function(e,t){BI.contains(BI.$(t).parents(),r.element[0])&&7==t.size&&(!function n(e){BI.$(e).css("font-size",""),BI.each(e.childNodes,function(e,t){n(t)})}(t),BI.$(t).removeAttr("size").css("font-size",i+"px"))})):r.restoreRng()},activate:function(e){e=(e=(e||12)+"").replace("px","");this.fontSize=e,this.trigger.setText(e),this.combo.setValue(BI.parseInt(e))},deactivate:function(){this.trigger.setText(BI.i18nText("BI-Font_Size")),this.combo.setValue()},getValue:function(){return this.fontSize||12}}),BI.shortcut("bi.rich_editor_size_chooser",BI.RichEditorSizeChooser)},function(e,t,n){"use strict";BI.constant("bi.constant.materials.rich_editor.font_family",[{value:BI.FontFamily.DEFAULT,text:BI.i18nText("BI-Basic_Default")},{value:BI.FontFamily.SIM_HEI,text:BI.i18nText("BI-Basic_Sim_Hei")},{value:BI.FontFamily.SIM_SUN,text:BI.i18nText("BI-Basic_Sim_Sun")},{value:BI.FontFamily.FANG_SONG,text:BI.i18nText("BI-Basic_Fang_Song")},{value:BI.FontFamily.KAI_TI,text:BI.i18nText("BI-Basic_Kai_Ti")},{value:BI.FontFamily.ARIAL,text:"Arial"},{value:BI.FontFamily.HELVETICA_NEUE,text:"Helvetica Neue"},{value:BI.FontFamily.VERDANA,text:"Verdana"},{value:BI.FontFamily.TIMES_NEW_ROMAN,text:"Times New Roman"}]),BI.constant("bi.constant.materials.rich_editor.font_size",[{value:12,text:12},{value:13,text:13},{value:14,text:14},{value:16,text:16},{value:18,text:18},{value:20,text:20},{value:22,text:22},{value:24,text:24},{value:26,text:26},{value:28,text:28},{value:30,text:30},{value:32,text:32},{value:34,text:34},{value:36,text:36},{value:38,text:38},{value:40,text:40},{value:64,text:64},{value:128,text:128}]),BI.constant("bi.constant.materials.rich_editor.font_size_range",{MAX:128,MIN:12})},function(e,t,n){"use strict";BI.RichEditor=BI.inherit(BI.Widget,{props:{baseCls:"bi-rich-editor bi-textarea"+(BI.isIE()?" hack":""),toolbar:{},readOnly:!1,scrollable:!0},_defaultConfig:function(){return BI.extend(BI.RichEditor.superclass._defaultConfig.apply(this,arguments),{adjustLength:1,adjustXOffset:0,adjustYOffset:0})},render:function(){var t=this,n=this.options,e={type:"bi.nic_editor",width:n.width,height:n.height,readOnly:n.readOnly,scrollable:n.scrollable,ref:function(){t.editor=this},listeners:[{eventName:BI.NicEditor.EVENT_BLUR,action:function(){!n.readOnly&&t.combo.isViewVisible()&&t.combo.hideView(),t.fireEvent(BI.RichEditor.EVENT_CONFIRM)}},{eventName:BI.NicEditor.EVENT_FOCUS,action:function(){n.readOnly||t.combo.isViewVisible()||t.combo.showView(),t.fireEvent(BI.RichEditor.EVENT_FOCUS)}}]};return n.readOnly?e:(this.editor=BI.createWidget(e),{type:"bi.combo",container:n.container,toggle:!1,trigger:"click",direction:"top,right",isNeedAdjustWidth:!1,isNeedAdjustHeight:!1,adjustLength:n.adjustLength,adjustXOffset:n.adjustXOffset,adjustYOffset:n.adjustYOffset,ref:function(){t.combo=this},el:this.editor,popup:{el:BI.extend({type:"bi.rich_editor_text_toolbar",editor:this.editor},n.toolbar,{ref:function(e){t.editor.bindToolbar(e),n.toolbar.ref&&n.toolbar.ref(e)}}),height:34,stopPropagation:!1,stopEvent:!1},listeners:[{eventName:BI.Combo.EVENT_AFTER_HIDEVIEW,action:function(){t.fireEvent(BI.RichEditor.EVENT_AFTER_HIDEVIEW)}}]})},mounted:function(){var e=this.options;BI.isNotNull(e.value)&&this.editor.setValue(e.value)},focus:function(){this.editor.focus()},setValue:function(e){this.editor.setValue(e)},getValue:function(e){return this.editor.getValue(e)},setVisible:function(e){e||this.combo.hideView(),BI.RichEditor.superclass.setVisible.apply(this,arguments)},getContentHeight:function(){return this.editor.getContentHeight()},getEditor:function(){return this.editor}}),BI.RichEditor.EVENT_AFTER_HIDEVIEW="EVENT_AFTER_HIDEVIEW",BI.RichEditor.EVENT_CONFIRM="EVENT_CONFIRM",BI.RichEditor.EVENT_FOCUS="EVENT_FOCUS",BI.shortcut("bi.rich_editor",BI.RichEditor)},function(e,t,n){"use strict";function d(e){return"[object Array]"==Object.prototype.toString.call(e)}function p(e){return"string"==typeof e?e:e.text}function f(e,t){return(t=d(t)?{columns:t}:t).text||(t.text=e),t}function v(e){return I[e.toUpperCase()]}function m(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function s(e,t){var n;if(BI.isNotEmptyString(e))return n=e.length,t=p(t).substr(0,n),e.toUpperCase()===t.toUpperCase()}function g(e,t,n,i){if(d(n))for(var r=0;r<n.length;r++)s(t,n[r])&&e.push(i(n[r],r));else for(var o in n){var a;n.hasOwnProperty(o)&&s(t,a=(a=n[o])&&!0!==a?a.displayText?{text:a.text,displayText:a.displayText}:a.text:o)&&e.push(i(a,-1))}}function y(e){for(var t=p(e).split("."),n=0;n<t.length;n++)t[n]=_+t[n].replace(new RegExp(_,"g"),_+_)+_;var i=t.join(".");return"string"==typeof e?i:((e=m(e)).text=i,e)}function b(e,t){for(var n=t.doc,i=n.getValue(),r=e.toUpperCase(),o="",a="",s=[],l={start:w(0,0),end:w(t.lastLine(),t.getLineHandle(t.lastLine()).length)},c=i.indexOf(C.QUERY_DIV);-1!=c;)s.push(n.posFromIndex(c)),c=i.indexOf(C.QUERY_DIV,c+1);s.unshift(w(0,0)),s.push(w(t.lastLine(),t.getLineHandle(t.lastLine()).text.length));for(var u=null,h=t.getCursor(),d=0;d<s.length;d++){if((null==u||0<E(h,u))&&E(h,s[d])<=0){l={start:u,end:s[d]};break}u=s[d]}for(var p=n.getRange(l.start,l.end,!1),d=0;d<p.length;d++){for(var f=p[d],m=(b=y=g=m=void 0,f),g=function(e){var t=e.toUpperCase();t===r&&v(o)&&(a=o),t!==C.ALIAS_KEYWORD&&(o=e)},y=m.split(/\s+/),b=0;b<y.length;b++)y[b]&&g(y[b].replace(/[,;]/g,""));if(a)break}return a}var x,I,S,_,C,w,E;x=BI.CodeMirror,C={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},w=x.Pos,E=x.cmpPos,x.registerHelper("hint","sql",function(e,t){I=function(e){var t={};if(d(e))for(var n=e.length-1;0<=n;n--){var i=e[n];t[p(i).toUpperCase()]=f(p(i),i)}else if(e)for(var r in e)t[r.toUpperCase()]=f(r,e[r]);return t}(t&&t.tables);var r,n,i,o,a=t&&t.defaultTable,s=t&&t.disableKeywords,l=(S=a&&v(a),r=function(e){e=e.doc.modeOption;"sql"===e&&(e="text/x-sql");return x.resolveMode(e).keywords}(e),BI.size(r)),c=[],u=e.getCursor(),h=e.getTokenAt(u),t=(t.supportFunction&&(BI.each(BI.FormulaCollections,function(e,t){0!=t.lastIndexOf(h.string,0)||BI.contains(c,t)||c.push(t)}),r=BI.keys(r),BI.each(c,function(e,t){var n=t.toLowerCase(),i=t.toUpperCase();BI.contains(r,n)||BI.contains(r,i)||r.push(t)})),_=function(e){e=e.doc.modeOption;"sql"===e&&(e="text/x-sql");return x.resolveMode(e).identifierQuote||"`"}(e),(S=(S=a&&!S?b(a,e):S)||[]).columns&&(S=S.columns),[]);return h.end>u.ch&&(h.end=u.ch,h.string=h.string.slice(0,u.ch-h.start)),h.string.match(/^[.`"\w@]\w*$/)?(o=h.string,n=h.start,i=h.end):(n=i=u.ch,o=""),"."==o.charAt(0)||o.charAt(0)==_?n=function(e,t,n,i){var r=!1,o=[],a=t.start,s=!0;for(;s;)s="."==t.string.charAt(0),r=r||t.string.charAt(0)==_,a=t.start,o.unshift(function(e){"."==e.charAt(0)&&(e=e.substr(1));for(var t=e.split(_+_),n=0;n<t.length;n++)t[n]=t[n].replace(new RegExp(_,"g"),"");return t.join(_)}(t.string)),"."==(t=i.getTokenAt(w(e.line,t.start))).string&&(s=!0,t=i.getTokenAt(w(e.line,t.start)));var l=o.join("."),c=(g(n,l,I,function(e){return r?y(e):e}),g(n,l,S,function(e){return r?y(e):e}),l=o.pop(),o.join(".")),u=!1,h=c;v(c)||(c=b(d=c,i))!==d&&(u=!0);var d=v(c);d&&d.columns&&(d=d.columns);d&&g(n,l,d,function(e){var t=1==u?h:c;return"string"==typeof e?e=t+"."+e:(e=m(e)).text=t+"."+e.text,r?y(e):e});return a}(u,h,t,e):(g(t,o,I,function(e){return e}),g(t,o,S,function(e){return e}),s||g(t,o,r,function(e,t){return{type:t<l?BICst.FORMULA_KEYWORD_TYPE.KEYWORD:BICst.FORMULA_KEYWORD_TYPE.FUNCTION,text:e}})),{list:t,from:w(u.line,n),to:w(u.line,i)}})},function(e,t,n){"use strict";!function(I){"use strict";I.defineMode("sql",function(r,e){"use strict";var o=e.client||{},a=e.atoms||{"false":true,"true":true,"null":true},s=e.builtin||{},l=e.keywords||{},c=e.operatorChars||/^[*+\-%<>!=&|~^]/,u=e.support||{},h=e.hooks||{},d=e.dateSQL||{date:true,time:true,timestamp:true},p=e.functions||{};function f(e,t){var n=e.next();if(h[n]){var i=h[n](e,t);if(i!==false)return i}if(u.hexNumber&&(n=="0"&&e.match(/^[xX][0-9a-fA-F]+/)||(n=="x"||n=="X")&&e.match(/^'[0-9a-fA-F]+'/)))return"number";else if(u.binaryNumber&&((n=="b"||n=="B")&&e.match(/^'[01]+'/)||n=="0"&&e.match(/^b[01]+/)))return"number";else if(n.charCodeAt(0)>47&&n.charCodeAt(0)<58){e.match(/^[0-9]*(\.[0-9]+)?([eE][-+]?[0-9]+)?/);u.decimallessFloat&&e.match(/^\.(?!\.)/);return"number"}else if(n=="?"&&(e.eatSpace()||e.eol()||e.eat(";")))return"variable-3";else if(n=="'"||n=='"'&&u.doubleQuote){t.tokenize=m(n);return t.tokenize(e,t)}else if((u.nCharCast&&(n=="n"||n=="N")||u.charsetCast&&n=="_"&&e.match(/[a-z][a-z0-9]*/i))&&(e.peek()=="'"||e.peek()=='"'))return"keyword";else if(/^[\(\),\;\[\]]/.test(n))return null;else if(u.commentSlashSlash&&n=="/"&&e.eat("/")){e.skipToEnd();return"comment"}else if(u.commentHash&&n=="#"||n=="-"&&e.eat("-")&&(!u.commentSpaceRequired||e.eat(" "))){e.skipToEnd();return"comment"}else if(n=="/"&&e.eat("*")){t.tokenize=g(1);return t.tokenize(e,t)}else if(n=="."){if(u.zerolessFloat&&e.match(/^(?:\d+(?:e[+-]?\d+)?)/i))return"number";if(e.match(/^\.+/))return null;if(u.ODBCdotTable&&e.match(/^[\w\d_]+/))return"variable-2"}else if(c.test(n)){e.eatWhile(c);return null}else if(n=="{"&&(e.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||e.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";else{e.eatWhile(/^[_\w\d]/);var r=e.current().toLowerCase();if(d.hasOwnProperty(r)&&(e.match(/^( )+'[^']*'/)||e.match(/^( )+"[^"]*"/)))return"number";if(a.hasOwnProperty(r))return"atom";if(s.hasOwnProperty(r))return"builtin";if(p.hasOwnProperty(r)&&e.peek()==="(")return"function";if(l.hasOwnProperty(r))return"keyword";if(o.hasOwnProperty(r))return"string-2";return null}}function m(r){return function(e,t){var n=false,i;while((i=e.next())!=null){if(i==r&&!n){t.tokenize=f;break}n=!n&&i=="\\"}return"string"}}function g(i){return function(e,t){var n=e.match(/^.*?(\/\*|\*\/)/);if(!n)e.skipToEnd();else if(n[1]=="/*")t.tokenize=g(i+1);else if(i>1)t.tokenize=g(i-1);else t.tokenize=f;return"comment"}}function y(e,t,n){t.context={prev:t.context,indent:e.indentation(),col:e.column(),type:n}}function b(e){e.indent=e.context.indent;e.context=e.context.prev}return{startState:function t(){return{tokenize:f,context:null}},token:function v(e,t){if(e.sol())if(t.context&&t.context.align==null)t.context.align=false;if(t.tokenize==f&&e.eatSpace())return null;var n=t.tokenize(e,t);if(n=="comment")return n;if(t.context&&t.context.align==null)t.context.align=true;var i=e.current();if(i=="(")y(e,t,")");else if(i=="[")y(e,t,"]");else if(t.context&&t.context.type==i)b(t);return n},indent:function x(e,t){var n=e.context;if(!n)return I.Pass;var i=t.charAt(0)==n.type;if(n.align)return n.col+(i?0:1);return n.indent+(i?0:r.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:u.commentSlashSlash?"//":u.commentHash?"#":"--"}}),function(){"use strict";function e(e){var t;while((t=e.next())!=null)if(t=="`"&&!e.eat("`"))return"variable-2";e.backUp(e.current().length-1);return e.eatWhile(/\w/)?"variable-2":null}function t(e){var t;while((t=e.next())!=null)if(t=='"'&&!e.eat('"'))return"variable-2";e.backUp(e.current().length-1);return e.eatWhile(/\w/)?"variable-2":null}function n(e){if(e.eat("@")){e.match(/^session\./);e.match(/^local\./);e.match(/^global\./)}if(e.eat("'")){e.match(/^.*'/);return"variable-2"}else if(e.eat('"')){e.match(/^.*"/);return"variable-2"}else if(e.eat("`")){e.match(/^.*`/);return"variable-2"}else if(e.match(/^[0-9a-zA-Z$\.\_]+/))return"variable-2";return null}function i(e){if(e.eat("N"))return"atom";return e.match(/^[a-zA-Z.#!?]/)?"variable-2":null}var r="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";function o(e){var t={},n=e.split(" ");for(var i=0;i<n.length;++i)t[n[i]]=true;return t}I.defineMIME("text/x-sql",{name:"sql",keywords:o(r+"begin"),builtin:o("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),atoms:o("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:o("date time timestamp"),support:o("ODBCdotTable doubleQuote binaryNumber hexNumber"),functions:BI.makeObject(BI.FormulaCollections,true)})}()}(BI.CodeMirror)},function(e,t,n){"use strict";BI.SQLEditor=BI.inherit(BI.Widget,{props:function(){return{baseCls:"bi-sql-editor",value:"",lineHeight:2,showHint:!0,supportFunction:!1,supportParam:!1,paramFormatter:function(e){return e},watermark:BI.i18nText("BI-Please_Enter_SQL"),lineWrapping:!0,lineNumbers:!1}},render:function(){var n=this.options,i=this,e={mode:"text/x-sql",lineWrapping:n.lineWrapping,lineNumbers:n.lineNumbers,readOnly:n.readOnly};n.readOnly&&(e.cursorBlinkRate=-1),this.editor=BI.CodeMirror(this.element[0],e),1===n.lineHeight?this.element.addClass("codemirror-low-line-height"):this.element.addClass("codemirror-high-line-height"),this.editor.on("change",function(e,t){i._checkWaterMark(),n.showHint&&i.editor.hasFocus()&&BI.CodeMirror.showHint(e,BI.CodeMirror.sqlHint,{completeSingle:!1,supportFunction:n.supportFunction}),BI.nextTick(function(){i.fireEvent(BI.FormulaEditor.EVENT_CHANGE)})}),this.editor.on("focus",function(){i._checkWaterMark(),i.fireEvent(BI.FormulaEditor.EVENT_FOCUS)}),this.editor.on("blur",function(){i.fireEvent(BI.FormulaEditor.EVENT_BLUR)}),this.watermark=BI.createWidget({type:"bi.label",text:n.watermark,cls:"bi-water-mark",whiteSpace:"normal",textAlign:"left"}),this.watermark.element.bind("mousedown",function(e){i._insertString(""),i.editor.focus(),e.stopEvent()}),this.watermark.element.bind("click",function(e){i.editor.focus(),e.stopEvent()}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.watermark,top:3,left:6,right:6}]}),BI.isKey(n.value)&&BI.nextTick(function(){i.setValue(n.value)})},_setEnable:function(e){BI.SQLEditor.superclass._setEnable.apply(this,arguments),this.editor.setOption("readOnly",!0!==e&&"nocursor")},_insertString:function(e){this.editor.replaceSelection(e)},_insertParam:function(e){var t=e,n=(e=this.options.paramFormatter(e),this.editor.getCursor()),i=(this.editor.replaceSelection("​"+e+"​"),this.editor.getCursor()),r="param",r={className:r=BI.isNotNull(e.match(/^<!.*!>$/))?"error-param":r,atomic:!0,replacedWith:BI.$("<span class='"+r+" start end' />").text(e)[0]};r.value=t,this.editor.markText(n,i,r)},_checkWaterMark:function(){var e=this.options;!this.disabledWaterMark&&BI.isEmptyString(this.editor.getValue())&&BI.isKey(e.watermark)?this.watermark&&this.watermark.visible():this.watermark&&this.watermark.invisible()},insertString:function(e){this._insertString(e),this.editor.focus()},insertParam:function(e){this._insertParam(e),this.editor.focus()},_analyzeContent:function(e){return e.match(/\n|\$[\{][^\}]*[\}]|((?!\$\{).)*((?!\$\{).)|\$[^\{]*[^\$\{]/g)},getValue:function(){return this.editor.getValue("\n",function(e){var i=e.text,r=0;return _.forEach(_.sortBy(e.markedSpans,"from"),function(e,t){switch(e.marker.className){case"param":case"error-param":var n=e.to-e.from;i=i.substr(0,e.from+r)+"${"+e.marker.value+"}"+i.substr(e.to+r,i.length),r=(r+=3)+(e.marker.value.length-n)}}),i})},setValue:function(e){var i=this,t=this.options;this.refresh(),i.editor.setValue(""),t.supportParam?(t=this._analyzeContent(e||""),BI.each(t,function(e,t){var n=t.match(/\$[\{][^\}]*[\}]/);BI.isNotEmptyArray(n)?i._insertParam(n[0].substring(2,t.length-1)):i._insertString(t)})):this._insertString(e),this._checkWaterMark()},refresh:function(){var e=this;BI.nextTick(function(){e.editor.refresh()})},setVisible:function(e){BI.SQLEditor.superclass.setVisible.apply(this,arguments),e&&this.refresh()}}),BI.shortcut("bi.sql_editor",BI.SQLEditor)},function(e,t,n){"use strict";BI.FormulaFieldPane=BI.inherit(BI.Widget,{props:{baseCls:"bi-formula-field-pane bi-card",items:[],itemsCreator:undefined,searcherHeight:28,searcherGap:8,itemHeight:24,leafItemHeight:24,fieldTreeHgap:0,nodeGap:0},_store:function(){return BI.Models.getModel("bi.model.material.formula_field_pane")},watch:{fieldKeyword:function(){this._search()}},render:function(){var t=this,e=this.options;return{type:"bi.vtape",vgap:e.searcherGap,hgap:e.searcherGap,items:[{el:{type:"bi.vertical",items:[{type:"bi.search_editor",ref:function(e){t.search=e},height:e.searcherHeight,listeners:[{eventName:BI.SearchEditor.EVENT_CHANGE,action:BI.debounce(BI.bind(function(){t.store.setKeyword(t.search.getValue())}),BI.EVENT_RESPONSE_TIME)},{eventName:BI.SearchEditor.EVENT_CLEAR,action:BI.debounce(BI.bind(function(){t.store.setKeyword(t.search.getValue())}),BI.EVENT_RESPONSE_TIME)}]}]},height:e.searcherHeight},{el:{type:"bi.vertical",items:[{type:"bi.formula_fields_tree",items:e.items,itemsCreator:e.itemsCreator,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight,nodeGap:e.nodeGap,redmark:function(){return!0},ref:function(e){t.fieldTree=e},listeners:[{eventName:BI.FormulaFieldsTree.EVENT_CHANGE,action:function(){t.fireEvent(BI.FormulaFieldPane.EVENT_CHANGE,this.getValue())}}]}]},hgap:e.fieldTreeHgap}]}},_search:function(){var n=this,e=this.options,e=BI.map(e.items,function(e,t){t=BI.Func.getSearchResult(t,n.model.fieldKeyword,"text");return t.match.concat(t.find)});this.fieldTree.populate(e,this.model.fieldKeyword)},getAllLeaves:function(){return this.fieldTree.getAllLeaves()},populate:function(e,t){this.options.items=e,this.fieldTree.populate(e,t)}}),BI.FormulaFieldPane.EVENT_SEARCH="EVENT_SEARCH",BI.FormulaFieldPane.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.formula_field_pane",BI.FormulaFieldPane)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{context:["fieldKeyword"],state:function(){return{}},computed:{},actions:{setKeyword:function(e){this.model.fieldKeyword=e}}}),BI.model("bi.model.material.formula_field_pane",i)},function(e,t,n){"use strict";var i=BI.inherit(BI.BasicButton,{props:function(){return{extraCls:"bi-list-item",id:"",pId:"",height:24,hgap:0,lgap:0,rgap:0}},render:function(){var t=this,e=this.options;return{type:"bi.label",ref:function(e){t.text=e},textAlign:"left",whiteSpace:"nowrap",textHeight:e.height,height:e.height,hgap:e.hgap,lgap:e.lgap,rgap:e.hgap,text:e.text,value:e.value,py:e.py,keyword:e.keyword}},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},doHighLight:function(){this.text.doHighLight.apply(this.text,arguments)},unHighLight:function(){this.text.unHighLight.apply(this.text,arguments)},getId:function(){return this.options.id},getPId:function(){return this.options.pId}});BI.shortcut("bi.formula_fields_tree.item",i)},function(e,t,n){"use strict";BI.FormulaFieldsTree=BI.inherit(BI.Widget,{_const:{leafGap:40},props:{baseCls:"bi-formula-field-tree",chooseType:0,items:[],itemsCreator:undefined,redmark:BI.emptyFn,itemHeight:24,leafItemHeight:24,nodeGap:0},render:function(){var e=this.options,t=(this._const,this),n=this._formatItems(BI.deepClone(e.items));return{type:"bi.level_tree",element:this,chooseType:e.chooseType,expander:{isDefaultInit:!0,showLine:!1},items:n,el:{behaviors:{redmark:e.redmark}},ref:function(e){t.fieldtree=e},listeners:[{eventName:BI.LevelTree.EVENT_CHANGE,action:function(){t.fireEvent(BI.FormulaFieldsTree.EVENT_CHANGE),t.fieldtree.setValue()}}]}},_getFieldNum:function(e,t){return BI.isNotNull(e[t])?e[t].length:0},_formatItems:function(e,t){var n,i,r=this.options,o=this._const;return r.itemsCreator?r.itemsCreator(e,t):(n={},BI.each(e,function(e,t){BI.each(BI.Func.getSortedResult(t,"text"),function(e,t){t.fieldType===BICst.COLUMN.CALCULATE&&(t.fieldType=BICst.COLUMN.NUMBER),n[t.fieldType]||(n[t.fieldType]=[]),n[t.fieldType].push(t)})}),i=[{id:BICst.COLUMN.NUMBER,type:"bi.arrow_group_node",$testId:"bi-formula-field-tree-number-node",text:BI.i18nText("BI-Conf_Formula_Numberic_Field")+"("+this._getFieldNum(n,BICst.COLUMN.NUMBER)+")",value:BICst.COLUMN.NUMBER,isParent:!0,open:!0}],1<e.length&&i.push({id:BICst.COLUMN.STRING,type:"bi.arrow_group_node",$testId:"bi-formula-field-tree-string-node",text:BI.i18nText("BI-Conf_Formula_Text_Field")+"("+this._getFieldNum(n,BICst.COLUMN.STRING)+")",value:BICst.COLUMN.STRING,isParent:!0,open:!!t&&0<this._getFieldNum(n,BICst.COLUMN.STRING)||!1}),2<e.length&&i.push({id:BICst.COLUMN.DATE,type:"bi.arrow_group_node",$testId:"bi-formula-field-tree-date-node",text:BI.i18nText("BI-Conf_Formula_Time_Field")+"("+this._getFieldNum(n,BICst.COLUMN.DATE)+")",value:BICst.COLUMN.DATE,isParent:!0,open:!!t&&0<this._getFieldNum(n,BICst.COLUMN.DATE)||!1}),3<e.length&&i.push({id:BICst.FORMULA_WIDGET_FIELD_TYPE.DATE,$testId:"bi-formula-field-tree-date-widget-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Design_Date_Widget_Field")+"("+e[3].length+")",value:BICst.FORMULA_WIDGET_FIELD_TYPE.DATE,isParent:!0,open:!!t&&0<e[3].length||!1}),4<e.length&&i.push({id:BICst.FORMULA_WIDGET_FIELD_TYPE.STRING,$testId:"bi-formula-field-tree-string-widget-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Design_String_Widget_Field")+"("+e[4].length+")",value:BICst.FORMULA_WIDGET_FIELD_TYPE.STRING,isParent:!0,open:!!t&&0<e[4].length||!1}),5<e.length&&i.push({id:BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER,$testId:"bi-formula-field-tree-number-widget-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Design_Number_Widget_Field")+"("+e[5].length+")",value:BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER,isParent:!0,open:!!t&&0<e[5].length||!1}),BI.each(i,function(e,t){BI.extend(t,{height:r.itemHeight,hgap:r.nodeGap,iconWrapperWidth:24,expandIcon:"tree-expander-expand-font",collapseIcon:"tree-expander-collapse-font"})}),BI.each(e,function(e,t){BI.each(t,function(e,t){i.push(BI.extend({id:BI.UUID(),pId:t.fieldType},t,{type:"bi.formula_fields_tree.item",$testId:"bi-formula-field-tree-field-item-"+t.text,cls:"field-item-draggable",textAlign:"left",lgap:o.leafGap,height:r.leafItemHeight}))})}),i)},populate:function(e,t){e=this._formatItems(BI.deepClone(e),BI.isNotNull(t)&&BI.isNotEmptyString(t));this.fieldtree.populate(e,t)},getValue:function(){return this.fieldtree.getValue()},setValue:function(e){this.fieldtree.setValue(e)},doBehavior:function(){this.fieldtree.doBehavior.apply(this.fieldtree,arguments)},getNodeByValue:function(e){return this.fieldtree.getNodeByValue(e)},setTriggerExpand:function(e){e=this.fieldtree.getNodeById(e);BI.isNotNull(e)&&e.showView()},setTriggerCollapse:function(e){this.fieldtree.getNodeById(e).hideView()},expandAll:function(){var n=this;BI.each([BICst.COLUMN.NUMBER,BICst.COLUMN.STRING,BICst.COLUMN.DATE],function(e,t){n.setTriggerExpand(t)})},getAllLeaves:function(){return this.fieldtree.getAllLeaves()}}),BI.FormulaFieldsTree.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.formula_fields_tree",BI.FormulaFieldsTree)},function(e,t,n){"use strict";var i=BI.inherit(BI.Widget,{props:{baseCls:"bi-formula-function-describe",open:!1,expandable:!0,defaultHyperLink:null},render:function(){var t=this,e=this.options;return{type:"bi.vertical_fill",rowSize:[36,e.expandable?164:"fill"],cls:"bi-split-top formula-describe-pane",items:[{el:{type:"bi.basic_button",ref:function(e){t.expanderTrigger=e},selected:!0,invisible:!0,render:function(){return{type:"bi.left_right_vertical_adapt",height:36,items:{left:[{type:"bi.label",text:BI.i18nText("BI-Conf_Function_Description"),cls:"more-function-button"}],right:[{type:"bi.icon_change_button",iconCls:"column-next-page-h-font",width:25,invisible:!e.expandable,ref:function(e){t.describeButton=e}}]},lhgap:10,rhgap:10}},handler:function(){e.expandable&&(this.isSelected()?(t.describeButton.setIcon("column-next-page-h-font"),t.describeGroup.setVisible(!0)):(t.describeButton.setIcon("column-pre-page-h-font"),t.describeGroup.setVisible(!1)))}}},{type:"bi.button_group",layouts:[{type:"bi.vertical",hgap:20,vgap:5}],ref:function(e){t.describeGroup=e},items:[{type:"bi.vertical",vgap:10,items:[{type:"bi.text",whiteSpace:"normal",textAlign:"left",text:BI.i18nText("BI-Formula_Function_Tip1")},{type:"bi.html_label",cls:"cm-s-default",whiteSpace:"normal",textAlign:"left",text:BI.i18nText("BI-Formula_Function_Tip2")},e.defaultHyperLink?{type:"bi.a",cls:"hyperlink-button",whiteSpace:"normal",textAlign:"left",text:BI.i18nText("BI-Formula_Help_Document"),href:e.defaultHyperLink}:null]}]}]}},populate:function(e){this.expanderTrigger.setVisible(!0),this.describeGroup.populate([BI.isFunction(e.description)?e.description():{type:"bi.vertical",bgap:5,items:[{type:"bi.label",cls:"cm-strong",textAlign:"left",text:e.text+":"},{type:"bi.label",whiteSpace:"normal",textAlign:"left",text:e.description},e.hyperlink?{type:"bi.a",text:BI.i18nText("BI-Formula_Function_More_Example"),href:e.hyperlink}:null]}])}});BI.shortcut("bi.formula_function_describe",i)},function(e,t,n){"use strict";var i=BI.inherit(BI.BasicButton,{_defaultConfig:function(){return BI.extend(BI.TreeTextLeafItem.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-list-item-active2",id:"",pId:"",height:24,hgap:0,lgap:0,rgap:0,description:""})},mounted:function(){var e=this;this.element.hover(function(){e.fireEvent("EVENT_HOVER",e.getValue())})},render:function(){var t=this,e=this.options;return{type:"bi.label",ref:function(e){t.text=e},cls:"draggable-handle",textAlign:"left",whiteSpace:"nowrap",height:e.height,hgap:e.hgap,lgap:e.lgap,rgap:e.hgap,text:e.text,value:e.value,py:e.py,keyword:e.keyword}},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},doHighLight:function(){this.text.doHighLight.apply(this.text,arguments)},unHighLight:function(){this.text.unHighLight.apply(this.text,arguments)},getId:function(){return this.options.id},getPId:function(){return this.options.pId}});BI.shortcut("bi.formula_functions_tree.item",i)},function(e,t,n){"use strict";BI.FormulaFunctionsTree=BI.inherit(BI.Widget,{_const:{leafGap:40},props:{baseCls:"bi-formula-function-tree bi-card",chooseType:0,items:[],redmark:BI.emptyFn,itemHeight:24,leafItemHeight:24,nodeGap:0},_store:function(){return BI.Models.getModel("bi.model.material.formula_functions_tree")},render:function(){var e=this,t=this.options;return{type:"bi.level_tree",expander:{isDefaultInit:!0,showLine:!1},items:this._getFormatNodes(t.items),el:{behaviors:{redmark:t.redmark}},ref:function(){e.fieldtree=this},listeners:[{eventName:BI.LevelTree.EVENT_CHANGE,action:function(){e.fireEvent(BI.FormulaFunctionsTree.EVENT_CHANGE,e._getSelectItem(e.getValue(),t.items)),e.fieldtree.setValue(e.getValue())}}]}},_getFieldNum:function(e,t){return BI.isNotNull(e[t])?e[t].length:0},_getFormatNodes:function(e,t){var n=this.options,i=this._const,r=this,o={},t=(BI.each(e,function(e,t){o[t.fieldType]||(o[t.fieldType]=[]),o[t.fieldType].push(t)}),BI.isNotNull(t)&&BI.isNotEmptyString(t)),t=[{id:BICst.FUNCTION.MATH,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-math-node",text:BI.i18nText("BI-Conf_Formula_Numberic_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.MATH)+")",value:BICst.FUNCTION.MATH,isParent:!0,open:t},{id:BICst.FUNCTION.TEXT,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-text-node",text:BI.i18nText("BI-Conf_Formula_Text_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.TEXT)+")",value:BICst.FUNCTION.TEXT,isParent:!0,open:t},{id:BICst.FUNCTION.DATE,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-date-node",text:BI.i18nText("BI-Conf_Formula_Time_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.DATE)+")",value:BICst.FUNCTION.DATE,isParent:!0,open:t},{id:BICst.FUNCTION.ARRAY,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-array-node",text:BI.i18nText("BI-Conf_Formula_Array_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.ARRAY)+")",value:BICst.FUNCTION.ARRAY,isParent:!0,open:t},{id:BICst.FUNCTION.LOGIC,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-logic-node",text:BI.i18nText("BI-Conf_Formula_Logic_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.LOGIC)+")",value:BICst.FUNCTION.LOGIC,isParent:!0,open:t},{id:BICst.FUNCTION.ANALYSIS,type:"bi.arrow_group_node",text:BI.i18nText("BI-Conf_Formula_Analysis")+"("+r._getFieldNum(o,BICst.FUNCTION.ANALYSIS)+")",value:BICst.FUNCTION.ANALYSIS,isParent:!0,open:t},{id:BICst.FUNCTION.OTHER,$testId:"bi-formula-function-tree-other-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Conf_Formula_Other_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.OTHER)+")",value:BICst.FUNCTION.OTHER,isParent:!0,open:t},{id:BICst.FUNCTION.AGG,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-agg-node",text:BI.i18nText("BI-Design_Function_AGG")+"("+r._getFieldNum(o,BICst.FUNCTION.AGG)+")",value:BICst.FUNCTION.AGG,isParent:!0,open:t},{id:BICst.FUNCTION.TABLE_CAL,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-table-cal-node",text:BI.i18nText("BI-Design_Rapid_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.TABLE_CAL)+")",value:BICst.FUNCTION.TABLE_CAL,isParent:!0,open:t},{id:BICst.FUNCTION.COMMON,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-common-node",text:BI.i18nText("BI-Basic_Common_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.COMMON)+")",value:BICst.FUNCTION.COMMON,isParent:!0,open:t},{id:BICst.FUNCTION.FIXED_CAL,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-fixed-cal-node",text:BI.i18nText("BI-Design_Fixed_Function")+"("+r._getFieldNum(o,BICst.FUNCTION.FIXED_CAL)+")",value:BICst.FUNCTION.FIXED_CAL,isParent:!0,open:t}],a=BI.filter(t,function(e,t){return BI.extend(t,{height:n.itemHeight,hgap:n.nodeGap,iconWrapperWidth:24,expandIcon:"tree-expander-expand-font",collapseIcon:"tree-expander-collapse-font"}),BI.contains(r.model.availableFunctionValues,t.value)});return a.sort(function(e,t){return BI.indexOf(r.model.availableFunctionValues,e.value)-BI.indexOf(r.model.availableFunctionValues,t.value)}),BI.first(a).open=!0,BI.each(e,function(e,t){a.push(BI.extend({id:BI.UUID(),pId:t.fieldType},t,{type:"bi.formula_functions_tree.item",$testId:"bi-formula-function-tree-item-"+BI.toLowerCase(t.text),cls:"function-item-draggable",textAlign:"left",lgap:i.leafGap,height:n.leafItemHeight,listeners:[{eventName:"EVENT_HOVER",action:function(){r.fieldtree.setValue(t.value),r.fireEvent(BI.FormulaFunctionsTree.EVENT_HOVER,r._getSelectItem([t.value],n.items))}}]}))}),a},populate:function(e,t){this.options.items=e,this.fieldtree.populate(this._getFormatNodes(e,t),t)},getValue:function(){return this.fieldtree.getValue()},setValue:function(e){this.fieldtree.setValue(e)},doBehavior:function(){this.fieldtree.doBehavior.apply(this.fieldtree,arguments)},getNodeByValue:function(e){return this.fieldtree.getNodeByValue(e)},setTriggerExpand:function(e){e=this.fieldtree.getNodeById(e);BI.isNotNull(e)&&e.showView()},setTriggerCollapse:function(e){this.fieldtree.getNodeById(e).hideView()},expandAll:function(){var n=this;BI.each([BICst.FUNCTION.MATH,BICst.FUNCTION.ARRAY,BICst.FUNCTION.DATE,BICst.FUNCTION.LOGIC,BICst.FUNCTION.ANALYSIS,BICst.FUNCTION.OTHER,BICst.FUNCTION.TEXT,BICst.FUNCTION.COMMON,BICst.FUNCTION.AGG,BICst.FUNCTION.FIXED_CAL],function(e,t){n.setTriggerExpand(t)})},_getSelectItem:function(n,e){return BI.find(e,function(e,t){return t.value===n[0]})},getAllLeaves:function(){return this.fieldtree.getAllLeaves()}}),BI.FormulaFunctionsTree.EVENT_CHANGE="EVENT_CHANGE",BI.FormulaFunctionsTree.EVENT_HOVER="EVENT_HOVER",BI.shortcut("bi.formula_functions_tree",BI.FormulaFunctionsTree)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{context:["functionTypes"],computed:{availableFunctionValues:function(){var n=BI.Services.getService("bi.service.material.formula_insert");return BI.map(this.model.functionTypes,function(e,t){return n.getFunctionValueByType(t)})}}}),BI.model("bi.model.material.formula_functions_tree",i)},function(e,t,n){"use strict";BI.FormulaFunctionPane=BI.inherit(BI.Widget,{props:{baseCls:"bi-formula-function-pane bi-card",items:[],searcherHeight:24,searcherGap:10,functionTreeHgap:0,itemHeight:24,leafItemHeight:24,nodeGap:0},_store:function(){return BI.Models.getModel("bi.model.material.formula_function_pane")},watch:{functionKeyword:function(e){var t=this.options,n=e.toLowerCase(),i=[];BI.each(t.items,function(e,t){(-1<t.value.toLowerCase().indexOf(n)||BI.isEmptyString(n))&&i.push(t)}),this.functionTree.populate(i,n),this.fireEvent(BI.FormulaFunctionPane.EVENT_SEARCH)}},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{el:{type:"bi.vtape",cls:"bi-split-left",vgap:e.searcherGap,hgap:e.searcherGap,items:[{el:{type:"bi.vertical",items:[{type:"bi.search_editor",height:e.searcherHeight,listeners:[{eventName:BI.SearchEditor.EVENT_CHANGE,action:function(){t.store.setKeyword(this.getValue())}},{eventName:BI.SearchEditor.EVENT_CLEAR,action:function(){t.store.setKeyword(this.getValue())}}]}]},height:e.searcherHeight},{el:{type:"bi.vertical",items:[{type:"bi.formula_functions_tree",cls:"style-top",items:e.items,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight,nodeGap:e.nodeGap,ref:function(e){t.functionTree=e},redmark:function(){return!0},listeners:[{eventName:BI.FormulaFunctionsTree.EVENT_CHANGE,action:function(e){t.fireEvent(BI.FormulaFunctionPane.EVENT_INSET,e)}},{eventName:BI.FormulaFunctionsTree.EVENT_HOVER,action:function(e){t.fireEvent(BI.FormulaFunctionPane.EVENT_HOVER,e)}}]}]},hgap:e.functionTreeHgap}]}}]}},getAllLeaves:function(){return this.functionTree.getAllLeaves()},setValue:function(e){this.functionTree.setValue(e)}}),BI.FormulaFunctionPane.EVENT_INSET="EVENT_INSET",BI.FormulaFunctionPane.EVENT_HOVER="EVENT_HOVER",BI.FormulaFunctionPane.EVENT_CLOSE="EVENT_CLOSE",BI.FormulaFunctionPane.EVENT_SEARCH="EVENT_SEARCH",BI.shortcut("bi.formula_function_pane",BI.FormulaFunctionPane)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{context:["functionKeyword"],state:function(){return{}},computed:{},actions:{setKeyword:function(e){this.model.functionKeyword=e}}}),BI.model("bi.model.material.formula_function_pane",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.Widget,{constants:{hgap:7.5,textWidth:14,textHeight:17,enableSwitcher:!1},_defaultConfig:function(){return BI.extend(i.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-formula-symbol-group",fieldType:BICst.FORMULA_GENERATE_TYPE.AUTO,itemHeight:24})},render:function(){var t=this,e=this.constants,n=this.options,e={left:[{type:"bi.button_group",chooseType:-1,items:BI.createItems([{cls:"operator-plus-font",$testId:"bi-formula-symbol-group-plus",value:"+"},{cls:"operator-minus-font",$testId:"bi-formula-symbol-group-minus",value:"-"},{cls:"operator-multi-font",$testId:"bi-formula-symbol-group-mul",value:"*"},{cls:"operator-divide-font",$testId:"bi-formula-symbol-group-div",value:"/"},{cls:"operator-left-brackets-font",$testId:"bi-formula-symbol-group-left-brackets",value:"("},{cls:"operator-right-brackets-font",$testId:"bi-formula-symbol-group-right-brackets",value:")"}],{type:"bi.icon_button",forceNotSelected:!0,once:!1,textWidth:e.textWidth,textHeight:e.textHeight,cls:"symbol-button bi-list-item"}),layouts:[{type:"bi.vertical_adapt",lgap:15}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){t.fireEvent("EVENT_CHANGE",e)}}],ref:function(e){t.symbolgroup=e}}]};return!0===this.options.enableSwitcher&&(e.right=[{el:{type:"bi.label",text:BI.i18nText("BI-Basic_Field_Type")},rgap:10},{el:{type:"bi.icon_combo",cls:"bi-list-item",items:[{iconCls:"formula-auto-font",text:BI.i18nText("BI-Basic_Auto"),$testId:"bi-formula-symbol-group-auto",value:BICst.FORMULA_GENERATE_TYPE.AUTO,height:n.itemHeight},{iconCls:"string-field-font",$testId:"bi-formula-symbol-group-string",text:BI.i18nText("BI-Basic_Text"),value:BICst.FORMULA_GENERATE_TYPE.STRING,height:n.itemHeight},{iconCls:"number-field-font",$testId:"bi-formula-symbol-group-number",text:BI.i18nText("BI-Basic_Number"),value:BICst.FORMULA_GENERATE_TYPE.NUMBER,height:n.itemHeight},{iconCls:"date-field-font",$testId:"bi-formula-symbol-group-date",text:BI.i18nText("BI-Basic_Time"),value:BICst.FORMULA_GENERATE_TYPE.DATE,height:n.itemHeight}],value:this.options.fieldType,ref:function(e){t.iconCombo=e},listeners:[{eventName:BI.IconCombo.EVENT_CHANGE,action:function(){t.fireEvent("EVENT_TYPE_CHANGE")}}]},rgap:5}]),{type:"bi.left_right_vertical_adapt",llgap:5,items:e}},getValue:function(){if(BI.isNotNull(this.iconCombo))return this.iconCombo.getValue()},setValue:function(e){BI.isNotNull(this.iconCombo)&&this.iconCombo.setValue(e||BICst.FORMULA_GENERATE_TYPE.AUTO)}}),BI.shortcut("bi.symbol_group",i)},function(e,t,n){"use strict";BI.FormulaInsert=BI.inherit(BI.Widget,{constants:{height:30,width:160,right:10,button_bottom:7,pane_bottom:-1,MORE_FUNCTION:0,RETRACT:1,retract_width:30,more_width:200,function_pane_width:180,field_pane_width:220,describe_height:200,describe_retract_height:36,enableSwitcher:!1,abandonFunctions:[],functionRegex:/\w+/},props:function(){return{baseCls:"bi-formula-insert",fieldItems:[],fieldItemsCreator:undefined,errorFieldItems:[],functionTypes:["COMMON","MATH","DATETIME","ARRAY","TEXT","LOGIC","OTHER"],validationChecker:function(){return BICst.FORMULA_STATE.VALID},keywordsGetter:function(){return BI.FormulaCollections},formulaJSONGetter:function(){return BI.FormulaJSONs},checkFormulaValidation:BI.Func.checkFormulaValidation,searcherHeight:24,searcherGap:10,functionTreeHgap:0,fieldTreeHgap:0,itemHeight:24,nodeGap:0,functionPaneOpened:!1,autoCheck:!0,direction:"horizontal",watermark:BI.i18nText("BI-Conf_Formula_Water_Mark")}},_store:function(){return BI.Models.getModel("bi.model.material.formula_insert",{fieldItems:this.options.fieldItems,functionTypes:this.options.functionTypes,formulaJSONGetter:this.options.formulaJSONGetter})},render:function(){var r=this,e=this.options,t=this.constants;return r.validation=BICst.FORMULA_STATE.VALID,BI.FormulaCollections=BI.filter(BI.FormulaOriginCollections,function(e,t){return BI.contains(r.model.availableFunctions,t.toUpperCase())}),this.fieldPane=BI.createWidget({type:"bi.formula_field_pane",cls:"bi-formula-field-pane",items:e.fieldItems,itemsCreator:e.fieldItemsCreator,searcherGap:e.searcherGap,searcherHeight:e.searcherHeight,fieldTreeHgap:e.fieldTreeHgap,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight||e.itemHeight,nodeGap:e.nodeGap,width:t.field_pane_width,listeners:[{eventName:BI.FormulaFieldPane.EVENT_CHANGE,action:function(e){r.store.insertField(e[0]),r.formulaedit.insertField(e[0],!0)}},{eventName:BI.FormulaFieldPane.EVENT_SEARCH,action:function(){r._bindFieldDragEvent()}}]}),this.symbolgroup=BI.createWidget({type:"bi.symbol_group",height:t.height,enableSwitcher:e.enableSwitcher,fieldType:e.fieldType,itemHeight:e.itemHeight,cls:"symbol-group-column",listeners:[{eventName:"EVENT_CHANGE",action:function(e){r.store.insertOperator(e),r.formulaedit.insertOperator(e)}},{eventName:"EVENT_TYPE_CHANGE",action:function(){r.fireEvent(BI.FormulaInsert.EVENT_TYPE_CHANGE)}}]}),this.formulaedit=BI.createWidget({type:"bi.formula_editor",$testId:"bi-formula-editor",cls:"bi-split-top",tipType:"warning",paramFormatter:BI.bind(this._paramFormatter,this),valueGetter:BI.bind(this._valueGetter,this),formulaChecker:e.formulaChecker,paramTypeGetter:function(e){var t=r.fieldsDetailMap[e]||{};switch(t.type){case BICst.COLUMN.DATE:return"date";case BICst.COLUMN.NUMBER:return"number";case BICst.COLUMN.STRING:return"string";default:return t.type}},keywordsGetter:function(){return e.keywordsGetter().concat(BI.map(BI.flatten(r._getSortedResult(e.fieldItems)),function(e,t){return{iconCls:r._getIconCls(t),text:t.text,value:t.value,type:BICst.FORMULA_KEYWORD_TYPE.PARAM}}))},watermark:e.watermark,listeners:[{eventName:BI.FormulaEditor.EVENT_CHANGE,action:function(){r._checkValidation()}},{eventName:BI.FormulaEditor.EVENT_BLUR,action:function(){r.hideTip(),r.checkValidation()||(r.formulaedit.setTitle(r.formulaedit.getTip()||r.getErrorText()||BI.i18nText("BI-Basic_Formula_Invalid"),{belowMouse:!0}),r.showTip())}},{eventName:BI.FormulaEditor.EVENT_FOCUS,action:function(){r.formulaedit.setTitle(""),r.checkValidation()||r.showTip()}},{eventName:BI.FormulaEditor.EVENT_KEY_UP,action:function(e){r.store.inputOperator(e)}},{eventName:BI.FormulaEditor.EVENT_CURSOR_ACTIVITY,action:function(e){var n=e.getCursor(),t=e.getTokenAt(n),i="",e=("keyword"===t.type?i=t.string:"bracket"===t.type&&"("===t.string&&(t=e.getLineTokens(n.line),BI.some(t,function(e,t){t.end===n.ch-1&&(i=t.string)})),r._getFunction(i));BI.isNotNull(e)&&(r.describePane.setVisible(!0),r.describePane.populate(e),r.functionpane.setValue(e.value))}},{eventName:"EVENT_SELECT_HINT",action:function(e){}},{eventName:"EVENT_PICK_HINT",action:function(e){e=r._getFunction(e.value);BI.isNotNull(e)&&(r.describePane.setVisible(!0),r.describePane.populate(e),r.functionpane.setValue(e.value))}}]}),this.describePane=BI.createWidget({type:"bi.formula_function_describe",cls:"bi-split-top formula-describe-pane",expandable:"horizontal"===e.direction,invisible:"horizontal"===e.direction,defaultHyperLink:e.defaultHyperLink}),this.functionbutton=BI.createWidget({type:"bi.node_button",open:e.functionPaneOpened,render:function(){return{type:"bi.vertical",width:t.retract_width,cls:"bi-background",items:[{type:"bi.icon_change_button",ref:function(e){r.functionTriggerBtn=e},iconCls:e.functionPaneOpened?"formula-collapse":"formula-expand",cls:"more-function-button",height:30},{type:"bi.label",textWidth:13,textHeight:18,whiteSpace:"normal",text:BI.i18nText("BI-Basic_Function")}]}},handler:function(){this.isOpened()?r._closeFunctionPane():r._openFunctionPane()}}),this.functionpane=BI.createWidget({type:"bi.formula_function_pane",items:r.model.functionItems,searcherHeight:e.searcherHeight,searcherGap:e.searcherGap,functionTreeHgap:e.functionTreeHgap,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight||e.itemHeight,nodeGap:e.nodeGap,width:t.function_pane_width,invisible:"horizontal"===e.direction&&!e.functionPaneOpened,listeners:[{eventName:BI.FormulaFunctionPane.EVENT_INSET,action:function(e){e=e.text;BI.isNotEmptyString(e)&&(r.store.insertFunction(e),r.formulaedit.insertFunction(e))}},{eventName:BI.FormulaFunctionPane.EVENT_SEARCH,action:function(){r._bindFunctionDragEvent()}},{eventName:BI.FormulaFunctionPane.EVENT_HOVER,action:function(e){var t=e.text;BI.isNotEmptyString(t)&&(r.describePane.setVisible(!0),r.describePane.populate(e))}}]}),this.formulaedit.element.droppable({accept:".field-item-draggable,.function-item-draggable",drop:function(e,t){var n=t.helper.attr("fieldId"),t=t.helper.attr("func");BI.isNotNull(n)&&(r.store.insertDragField(n,!0),r.formulaedit.insertField(n,!0)),BI.isNotNull(t)&&(r.store.insertDragFunction(t),r.formulaedit.insertFunction(t))}}),this._bindFunctionDragEvent(),this.populate(e.fieldItems),"vertical"===e.direction?{type:"bi.vertical_fill",rowSize:[.5,"fill"],items:[{el:{type:"bi.vertical_fill",rowSize:["","fill"],horizontalAlign:"stretch",items:[{el:this.symbolgroup},{el:this.formulaedit}]}},{el:{type:"bi.horizontal_fill",columnSize:[.5,.5],items:[{type:"bi.horizontal_fill",columnSize:[.6,.4],cls:"bi-split-top bi-split-right",items:[{el:this.fieldPane},{el:this.functionpane}]},{el:this.describePane}]}}],ref:function(e){r.formulaPane=e}}:{type:"bi.horizontal_fill",columnSize:["","fill"],items:[{el:{type:"bi.horizontal_fill",cls:"bi-split-right",items:[{el:this.functionbutton},{el:this.functionpane}]}},{el:{type:"bi.horizontal_fill",columnSize:["","fill"],items:[{el:this.fieldPane},{type:"bi.vertical_fill",rowSize:["","fill",""],cls:"bi-split-left",items:[{el:this.symbolgroup},{el:this.formulaedit},{el:this.describePane}]}]}}],ref:function(e){r.formulaPane=e}}},mounted:function(){var e=this.options;BI.isNotNull(e.value)&&this.setValue(e.value)},_getSortedResult:function(e){return BI.map(e,function(e,t){return BI.Func.getSortedResult(t,"text")})},_getIconCls:function(e){if(e.iconCls)return e.iconCls;var t;switch(e.fieldType){case BICst.COLUMN.STRING:t="string-field-font";break;case BICst.COLUMN.NUMBER:t="number-field-font";break;case BICst.COLUMN.DATE:t="date-field-font"}return t},_paramFormatter:function(e){return BI.has(this.fieldErrorValueTextMap,e)?"<!"+this.fieldErrorValueTextMap[e]+"!>":this.fieldValueTextMap[e]},_valueGetter:function(e){return this.fieldErrorTextValueMap[e]||this.fieldTextValueMap[e]},_getFunctionItems:function(e){var i=this,e=(this.constants,this._analyzeContent(e.replaceAll(/[\'\"](.+?)[\'\"]/g,"")||"")||[]),n=(this.functionArray=[],BI.each(e.reverse(),function(e,n){var t=i._getFunction(n);BI.isNotEmptyObject(t)&&!BI.some(i.functionArray,function(e,t){return t.text.toLowerCase()===n.toLowerCase()})&&i.functionArray.push(t)}),[]);BI.each(this.functionArray,function(e,t){t=BI.createWidget({type:"bi.vertical",items:[{type:"bi.label",cls:"cm-strong",textAlign:"left",text:t.text+":"},{type:"bi.label",whiteSpace:"normal",textAlign:"left",text:t.description}]});n.push(t)}),this.describePane.populate(n.slice(0,1)),BI.isEmptyArray(n)?this.describePane.setVisible(!1):this.describePane.isVisible()||this.describePane.setVisible(!0)},_reHsize:function(e){this.formulaPane.options.items[0].width=e,this.formulaPane.resize()},_getFunction:function(r){return BI.find(this.model.functionItems,function(e,t){var n,i;return t.text===r||(t=t.text.toLowerCase(),n=r.toLowerCase(),i=r.toUpperCase(),t===n&&(i===r||n===r))})},_checkValidation:function(){var n,i,r=this,e=this.options,t=r.formulaedit.getCheckString(),o=r.getValue(),a=r.getUsedFields(),s=BI.map(e.errorFieldItems,"value"),l=!BI.some(a,function(e,t){return BI.contains(s,t)}),c=l;l&&(n=BI.map(BI.flatten(e.fieldItems),"value"),c=!BI.some(a,function(e,t){return!BI.contains(n,t)})),c?(i=BI.UUID(),r.store.setLastCheckId(i),l=this.formulaedit.check(o),e.autoCheck&&BI.isNotNull(l)?(c=JSON.parse(l.message),this._dealCheckResult(i,o,!1,{errorCode:[],errorMessage:[c.errorText]},{usedFields:a})):e.checkFormulaValidation?e.checkFormulaValidation({str:t,origin:o,fieldsMap:this.fieldsDetailMap},function(e,t){r._dealCheckResult(i,o,e,t,{usedFields:a})}):r._dealCheckResult(i,o,!0,{},{usedFields:a})):(r.validation=BICst.FORMULA_STATE.FIELD_MISS,r.showTip(),r.fireEvent(BI.FormulaInsert.EVENT_ERROR))},_dealCheckResult:function(e,t,n,i,r){var o,a;r=r||{},i=i||{},this.errorMessage=[],e===this.model.lastCheckId&&(e=i.errorCode,a=i.errorMessage,n?o=this.options.validationChecker(r.usedFields,t,i):(this.errorMessage=a,BI.contains(e,BICst.ErrorCode.FORMULA_ERROR.DIS_AGGRESSIVE_FUNCTION_HAS_FIELD_WITH_DETAIL_FILTER)&&(o=BICst.FORMULA_STATE.DETAIL_FILTER_NOT_SUPPORT)),(o=BI.isNull(o)?n?BICst.FORMULA_STATE.VALID:BICst.FORMULA_STATE.INVALID:o)===BICst.FORMULA_STATE.VALID?(this.validation=BICst.FORMULA_STATE.VALID,this.hideTip(),this.fireEvent(BI.FormulaInsert.EVENT_CHANGE),this.fireEvent(BI.FormulaInsert.EVENT_VALID)):(this.validation=o,this.showTip(),this.fireEvent(BI.FormulaInsert.EVENT_ERROR)))},_analyzeContent:function(e){return e.match(/\$[\{][^\}]*[\}]|\w+(\.\w+)*|\$\{[^\$\(\)\+\-\*\/)\$,]*\w\}|\$\{[^\$\(\)\+\-\*\/]*\w\}|\$\{[^\$\(\)\+\-\*\/]*[\u4e00-\u9fa5]\}|\w|(.)|\n/g)},_createFieldTextValueMap:function(e){var n={};return BI.each(e,function(e,t){BI.each(t,function(e,t){n[t.text]=t.value})}),n},_createErrorTextValueMap:function(){var n={};return BI.each(this.options.errorFieldItems,function(e,t){n[t.text]=t.value}),n},_createErrorValueTextMap:function(){var n={};return BI.each(this.options.errorFieldItems,function(e,t){n[t.value]=t.text}),n},_createFieldValueTextMap:function(e){var n={};return BI.each(e,function(e,t){BI.each(t,function(e,t){n[t.value]=t.text})}),n},_createFieldDetailMap:function(e){var i={};return BI.each(e,function(e,t){BI.each(t,function(e,t){var n=t.fieldType;switch(n){case BICst.FORMULA_WIDGET_FIELD_TYPE.DATE:n=BICst.COLUMN.DATE;break;case BICst.FORMULA_WIDGET_FIELD_TYPE.STRING:n=BICst.COLUMN.STRING;break;case BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER:case BICst.COLUMN.CALCULATE:n=BICst.COLUMN.NUMBER}i[t.value]={type:n,isAgg:t.isAgg||!1,hasDetailFilter:t.hasDetailFilter||!1,freeAggregate:t.freeAggregate||!1}})}),i},_bindFieldDragEvent:function(){var n=this;BI.each(n.fieldPane.getAllLeaves(),function(e,t){t.element.draggable({cursorAt:{top:5,left:5},helper:function(){var e=BI.createWidget({type:"bi.helper",value:t.getValue(),text:n.fieldValueTextMap[t.getValue()]});return BI.createWidget({element:n,type:"bi.default",items:[e]}),e.element.attr({fieldId:t.getValue(),field:n.fieldValueTextMap[t.getValue()]}),e.element}})})},_bindFunctionDragEvent:function(){var n=this;BI.each(n.functionpane.getAllLeaves(),function(e,t){t.element.draggable({cursorAt:{top:5,left:5},handle:".draggable-handle",helper:function(){var e=BI.createWidget({type:"bi.helper",value:t.getValue(),text:t.getValue()});return BI.createWidget({element:n,type:"bi.default",items:[e]}),e.element.attr({func:t.getValue()}),e.element}})})},_openFunctionPane:function(){this.functionTriggerBtn.setIcon("formula-collapse"),this.functionpane.setVisible(!0)},_closeFunctionPane:function(){this.functionTriggerBtn.setIcon("formula-expand"),this.functionpane.setVisible(!1)},checkValidation:function(){return this.validation===BICst.FORMULA_STATE.VALID},getErrorText:function(){if(BI.isEmptyString(this.getValue()))return BI.i18nText("BI-Basic_Please_Add_Formula");if(BI.isNotEmptyArray(this.errorMessage))return this.errorMessage.join("\n");var e="";switch(this.validation){case BICst.FORMULA_STATE.DETAIL_FILTER_NOT_SUPPORT:e=BI.i18nText("BI-Design_Formula_Not_Support_Detail_Filter");break;case BICst.FORMULA_STATE.AGG_INVALID:e=BI.i18nText("BI-Design_Detail_Table_Not_Support_AGG");break;case BICst.FORMULA_STATE.FIXED_INVALID:e=BI.i18nText("BI-Design_Detail_Table_Not_Support_Fixed");break;case BICst.FORMULA_STATE.FIELD_MISS:e=BI.i18nText("BI-Basic_Field_Cannot_Find");break;case BICst.FORMULA_STATE.NOT_SUPPORT_STRING_OR_DATE:e=BI.i18nText("BI-Design_Not_Support_Date_Or_String");break;case BICst.FORMULA_STATE.RAPID_INVALID:e=BI.i18nText("BI-Design_Detail_Table_Not_Support_Rapid");break;default:e=BI.i18nText("BI-Basic_Formula_Invalid")}return e},showTip:function(){this.formulaedit.showTip(this.getErrorText())},hideTip:function(){this.formulaedit.hideTip()},refresh:function(){this.formulaedit.refresh()},setValue:function(e){this.formulaedit.refresh(),this.formulaedit.setValue(e),this._checkValidation()},getFormulaString:function(){return this.formulaedit.getFormulaString()},getUsedFields:function(){return this.formulaedit.getUsedFields()},setFormulaFieldType:function(e){return this.symbolgroup.setValue(e)},getFormulaFieldType:function(){return this.symbolgroup.getValue()},getValue:function(){return this.formulaedit.getValue()},populate:function(e){this.options.fieldItems=e,this.fieldTextValueMap=this._createFieldTextValueMap(e),this.fieldValueTextMap=this._createFieldValueTextMap(e),this.fieldErrorTextValueMap=this._createErrorTextValueMap(),this.fieldErrorValueTextMap=this._createErrorValueTextMap(),this.fieldsDetailMap=this._createFieldDetailMap(e),this.fieldPane.populate(e),this._bindFieldDragEvent()}}),BI.FormulaInsert.EVENT_VALID="EVENT_VALID",BI.FormulaInsert.EVENT_ERROR="EVENT_ERROR",BI.FormulaInsert.EVENT_CHANGE="EVENT_CHANGE",BI.FormulaInsert.EVENT_TYPE_CHANGE="EVENT_TYPE_CHANGE",BI.shortcut("bi.formula_insert",BI.FormulaInsert)},function(e,t,n){"use strict";var i;i=BI.inherit(Fix.Model,{childContext:["fieldKeyword","functionKeyword","functionTypes"],state:function(){var e=this.options;return{fieldItems:e.fieldItems,fieldKeyword:"",functionKeyword:"",functionTypes:e.functionTypes,lastCheckId:null}},computed:{allFieldItems:function(){return BI.flatten(this.options.fieldItems)},numberFieldItems:function(){return BI.filter(this.model.allFieldItems,function(e,t){return t.fieldType===BICst.COLUMN.NUMBER})},numberFieldIds:function(){return BI.map(this.model.numberFieldItems,"value")},stringFieldItems:function(){return BI.filter(this.model.allFieldItems,function(e,t){return t.fieldType===BICst.COLUMN.STRING})},stringFieldIds:function(){return BI.map(this.model.stringFieldItems,"value")},dateFieldItems:function(){return BI.filter(this.model.allFieldItems,function(e,t){return t.fieldType===BICst.COLUMN.DATE})},dateFieldIds:function(){return BI.map(this.model.dateFieldItems,"value")},functionItems:function r(){var n=this,e=this.options.formulaJSONGetter(),r=[],i=BI.Services.getService("bi.service.material.formula_insert");return BI.each(e,function(e,t){n.model.functionTypes.includes(t.type)&&r.push({text:t.name,value:t.name,fieldType:i.getFunctionValueByType(t.type),description:t.def})}),r},availableFunctions:function(){return BI.map(this.model.functionItems,"value")}},actions:{insertOperator:function(e){},inputOperator:function(e){},insertField:function(e){},insertFunction:function(e){},insertDragFunction:function(e){},insertDragField:function(e){},addFunctionType:function(e){this.model.functionTypes.push(e)},setLastCheckId:function(e){this.model.lastCheckId=e}}}),BI.model("bi.model.material.formula_insert",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.OB,{getFunctionValueByType:function(e){switch(e){case"MATH":return BICst.FUNCTION.MATH;case"TEXT":return BICst.FUNCTION.TEXT;case"DATETIME":return BICst.FUNCTION.DATE;case"ARRAY":return BICst.FUNCTION.ARRAY;case"LOGIC":return BICst.FUNCTION.LOGIC;case"AGG":return BICst.FUNCTION.AGG;case"COMMON":return BICst.FUNCTION.COMMON;case"TABLE_CAL":return BICst.FUNCTION.TABLE_CAL;case"ANALYSIS":return BICst.FUNCTION.ANALYSIS;case"OTHER":return BICst.FUNCTION.OTHER;case"FIXED_CAL":return BICst.FUNCTION.FIXED_CAL;default:return}}}),BI.service("bi.service.material.formula_insert",i)},function(e,t,n){"use strict";var i;i=BI.inherit(BI.BasicButton,{props:{baseCls:"bi-components-formula-text-func-button cursor-pointer",$testId:"bi-components-formula-text-func-button"},render:function(){return{type:"bi.horizontal_adapt",items:[{type:"bi.text_button",textWidth:13,textHeight:18,whiteSpace:"normal",text:BI.i18nText("BI-Basic_Function")}]}}}),BI.shortcut("bi.components.formula.text_func_button",i)},function(e,t,n){"use strict";n(208)(n(543))},function(e,t,n){"use strict";BI.Svg=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.Svg.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-svg"})},_init:function(){BI.Svg.superclass._init.apply(this,arguments),this.paper=Raphael(this.element[0]),this.element.css("overflow","hidden"),BI.$(this.paper.canvas).width("100%").height("100%").css({left:"0",top:"0"}).appendTo(this.element),this.top=this.paper.top,this.bottom=this.paper.bottom,this.customAttributes=this.paper.customAttributes,this.ca=this.paper.ca,this.raphael=this.paper.raphael},add:function(){return this.paper.add.apply(this.paper,arguments)},path:function(){return this.paper.path.apply(this.paper,arguments)},image:function(){return this.paper.image.apply(this.paper,arguments)},rect:function(){return this.paper.rect.apply(this.paper,arguments)},circle:function(){return this.paper.circle.apply(this.paper,arguments)},ellipse:function(){return this.paper.ellipse.apply(this.paper,arguments)},text:function(){return this.paper.text.apply(this.paper,arguments)},print:function(){return this.paper.print.apply(this.paper,arguments)},setStart:function(){return this.paper.setStart.apply(this.paper,arguments)},setFinish:function(){return this.paper.setFinish.apply(this.paper,arguments)},setSize:function(){return this.paper.setSize.apply(this.paper,arguments)},setViewBox:function(){return this.paper.setViewBox.apply(this.paper,arguments)},getById:function(){return this.paper.getById.apply(this.paper,arguments)},getElementByPoint:function(){return this.paper.getElementByPoint.apply(this.paper,arguments)},getElementsByPoint:function(){return this.paper.getElementsByPoint.apply(this.paper,arguments)},getFont:function(){return this.paper.getFont.apply(this.paper,arguments)},set:function(){return this.paper.set.apply(this.paper,arguments)},remove:function(){return this.paper.remove.apply(this.paper,arguments)},clear:function(){return this.paper.clear.apply(this.paper,arguments)}}),BI.shortcut("bi.svg",BI.Svg)},function(e,n,t){"use strict";!function(e){var t;function y(e,t){var n,i,r,o,a,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return i=!(n=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return n=e.done,e},e:function(e){i=!0,r=e},f:function(){try{n||null==s["return"]||s["return"]()}finally{if(i)throw r}}};if(Array.isArray(e)||(s=l(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),o=0,{s:a=function a(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function c(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window,t=function(){return n=[function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(64),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(60),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(51),r=(Object.defineProperty(t,"closest",{enumerable:!0,get:function(){return o(i)["default"]}}),n(49));function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"requestNextAnimationFrame",{enumerable:!0,get:function(){return o(r)["default"]}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(44);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(47),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),r=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(13)),o=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(12)),a=(Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}),n(6)),n=(Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}),n(37)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=(Object.defineProperty(t,"Sensor",{enumerable:!0,get:function(){return c(i)["default"]}}),n(46)),o=(Object.defineProperty(t,"MouseSensor",{enumerable:!0,get:function(){return c(r)["default"]}}),n(43)),a=(Object.defineProperty(t,"TouchSensor",{enumerable:!0,get:function(){return c(o)["default"]}}),n(41)),s=(Object.defineProperty(t,"DragSensor",{enumerable:!0,get:function(){return c(a)["default"]}}),n(39)),l=(Object.defineProperty(t,"ForceTouchSensor",{enumerable:!0,get:function(){return c(s)["default"]}}),n(3));function c(e){return e&&e.__esModule?e:{"default":e}}Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(18);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(23);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(27);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(30);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(33);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(62),r=(Object.defineProperty(t,"Announcement",{enumerable:!0,get:function(){return s(i)["default"]}}),Object.defineProperty(t,"defaultAnnouncementOptions",{enumerable:!0,get:function(){return i.defaultOptions}}),n(59)),o=(Object.defineProperty(t,"Focusable",{enumerable:!0,get:function(){return s(r)["default"]}}),n(57)),a=(Object.defineProperty(t,"Mirror",{enumerable:!0,get:function(){return s(o)["default"]}}),Object.defineProperty(t,"defaultMirrorOptions",{enumerable:!0,get:function(){return o.defaultOptions}}),n(53));function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"Scrollable",{enumerable:!0,get:function(){return s(a)["default"]}}),Object.defineProperty(t,"defaultScrollableOptions",{enumerable:!0,get:function(){return a.defaultOptions}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(63);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(65);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},n=n(1),n=(n=n)&&n.__esModule?n:{"default":n};var r=Symbol("onSortableSorted"),o=t.defaultOptions={duration:150,easingFunction:"ease-in-out",horizontal:!1},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=i({},o,e.getOptions()),e.lastAnimationFrame=null,e[r]=e[r].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("sortable:sorted",this[r])},n.detach=function(){this.draggable.off("sortable:sorted",this[r])},n.getOptions=function(){return this.draggable.options.swapAnimation||{}},n[r]=function(e){var t=this,n=e.oldIndex,i=e.newIndex,e=e.dragEvent,r=e.source,o=e.over;cancelAnimationFrame(this.lastAnimationFrame),this.lastAnimationFrame=requestAnimationFrame(function(){i<=n?a(r,o,t.options):a(o,r,t.options)})},e}(n["default"]);function a(i,r,e){for(var o=e.duration,a=e.easingFunction,e=e.horizontal,t=0,n=[i,r];t<n.length;t++)n[t].style.pointerEvents="none";e?(e=i.offsetWidth,i.style.transform="translate3d(".concat(e,"px, 0, 0)"),r.style.transform="translate3d(-".concat(e,"px, 0, 0)")):(e=i.offsetHeight,i.style.transform="translate3d(0, ".concat(e,"px, 0)"),r.style.transform="translate3d(0, -".concat(e,"px, 0)")),requestAnimationFrame(function(){for(var e=0,t=[i,r];e<t.length;e++){var n=t[e];n.addEventListener("transitionend",s),n.style.transition="transform ".concat(o,"ms ").concat(a),n.style.transform=""}})}function s(e){e.target.style.transition="",e.target.style.pointerEvents="",e.target.removeEventListener("transitionend",s)}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(15),i=(i=n)&&i.__esModule?i:{"default":i};t["default"]=i["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),i=(i=i)&&i.__esModule?i:{"default":i},r=n(7);var o=Symbol("onDragStart"),a=Symbol("onDragStop"),s=Symbol("onDragOver"),l=Symbol("onDragOut"),c=Symbol("onMirrorCreated"),u=Symbol("onMirrorDestroy"),n=function(t){function e(e){e=t.call(this,e)||this;return e.firstSource=null,e.mirror=null,e[o]=e[o].bind(S(e)),e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e[u]=e[u].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:start",this[o]).on("drag:stop",this[a]).on("drag:over",this[s]).on("drag:out",this[l]).on("droppable:over",this[s]).on("droppable:out",this[l]).on("mirror:created",this[c]).on("mirror:destroy",this[u])},n.detach=function(){this.draggable.off("drag:start",this[o]).off("drag:stop",this[a]).off("drag:over",this[s]).off("drag:out",this[l]).off("droppable:over",this[s]).off("droppable:out",this[l]).off("mirror:created",this[c]).off("mirror:destroy",this[u])},n[o]=function(e){e.canceled()||(this.firstSource=e.source)},n[a]=function(){this.firstSource=null},n[s]=function(e){var t,n=this;e.canceled()||((t=e.source||e.dragEvent.source)===this.firstSource?this.firstSource=null:(e=new r.SnapInEvent({dragEvent:e,snappable:e.over||e.droppable}),this.draggable.trigger(e),e.canceled()||(this.mirror&&(this.mirror.style.display="none"),t.classList.remove(this.draggable.getClassNameFor("source:dragging")),t.classList.add(this.draggable.getClassNameFor("source:placed")),setTimeout(function(){t.classList.remove(n.draggable.getClassNameFor("source:placed"))},this.draggable.options.placedTimeout))))},n[l]=function(e){var t;e.canceled()||(t=e.source||e.dragEvent.source,e=new r.SnapOutEvent({dragEvent:e,snappable:e.over||e.droppable}),this.draggable.trigger(e),e.canceled())||(this.mirror&&(this.mirror.style.display=""),t.classList.add(this.draggable.getClassNameFor("source:dragging")))},n[c]=function(e){e=e.mirror;this.mirror=e},n[u]=function(){this.mirror=null},e}(i["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SnapOutEvent=t.SnapInEvent=t.SnapEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}},{key:"snappable",get:function(){return this.data.snappable}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.SnapEvent=n).type="snap",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.SnapInEvent=i).type="snap:in",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n));(t.SnapOutEvent=i).type="snap:out",i.cancelable=!0},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),n=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(17)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=n(1),r=(r=r)&&r.__esModule?r:{"default":r},o=n(2);var a=Symbol("onMirrorCreated"),s=Symbol("onMirrorDestroy"),l=Symbol("onDragOver"),c=Symbol("resize"),u=t.defaultOptions={},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=i({},u,e.getOptions()),e.lastWidth=0,e.lastHeight=0,e.mirror=null,e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("mirror:created",this[a]).on("drag:over",this[l]).on("drag:over:container",this[l])},n.detach=function(){this.draggable.off("mirror:created",this[a]).off("mirror:destroy",this[s]).off("drag:over",this[l]).off("drag:over:container",this[l])},n.getOptions=function(){return this.draggable.options.resizeMirror||{}},n[a]=function(e){e=e.mirror;this.mirror=e},n[s]=function(){this.mirror=null},n[l]=function(e){this[c](e)},n[c]=function(e){var n=this,i=e.overContainer,r=e.over;requestAnimationFrame(function(){n.mirror.parentNode!==i&&i.appendChild(n.mirror);var t=r||n.draggable.getDraggableElementsForContainer(i)[0];t&&(0,o.requestNextAnimationFrame)(function(){var e=t.getBoundingClientRect();n.lastHeight===e.height&&n.lastWidth===e.width||(n.mirror.style.width="".concat(e.width,"px"),n.mirror.style.height="".concat(e.height,"px"),n.lastWidth=e.width,n.lastHeight=e.height)})})},e}(r["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(20),i=(i=n)&&i.__esModule?i:{"default":i};t["default"]=i["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),i=(i=i)&&i.__esModule?i:{"default":i},r=n(2),o=n(8);var a=Symbol("onDragMove"),s=Symbol("onDragStop"),l=Symbol("onRequestAnimationFrame"),n=function(t){function e(e){e=t.call(this,e)||this;return e.currentlyCollidingElement=null,e.lastCollidingElement=null,e.currentAnimationFrame=null,e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:move",this[a]).on("drag:stop",this[s])},n.detach=function(){this.draggable.off("drag:move",this[a]).off("drag:stop",this[s])},n.getCollidables=function(){var e=this.draggable.options.collidables;return"string"==typeof e?Array.prototype.slice.call(document.querySelectorAll(e)):e instanceof NodeList||e instanceof Array?Array.prototype.slice.call(e):e instanceof HTMLElement?[e]:"function"==typeof e?e():[]},n[a]=function(e){var t=e.sensorEvent.target,t=(this.currentAnimationFrame=requestAnimationFrame(this[l](t)),this.currentlyCollidingElement&&e.cancel(),new o.CollidableInEvent({dragEvent:e,collidingElement:this.currentlyCollidingElement})),e=new o.CollidableOutEvent({dragEvent:e,collidingElement:this.lastCollidingElement}),n=Boolean(this.currentlyCollidingElement&&this.lastCollidingElement!==this.currentlyCollidingElement),i=Boolean(!this.currentlyCollidingElement&&this.lastCollidingElement);n?(this.lastCollidingElement&&this.draggable.trigger(e),this.draggable.trigger(t)):i&&this.draggable.trigger(e),this.lastCollidingElement=this.currentlyCollidingElement},n[s]=function(e){var t=this.currentlyCollidingElement||this.lastCollidingElement,e=new o.CollidableOutEvent({dragEvent:e,collidingElement:t});t&&this.draggable.trigger(e),this.lastCollidingElement=null,this.currentlyCollidingElement=null},n[l]=function(e){var n=this;return function(){var t=n.getCollidables();n.currentlyCollidingElement=(0,r.closest)(e,function(e){return t.includes(e)})}},e}(i["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.CollidableOutEvent=t.CollidableInEvent=t.CollidableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.CollidableEvent=n).type="collidable",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"collidingElement",get:function(){return this.data.collidingElement}}]),t}(n)),i=((t.CollidableInEvent=i).type="collidable:in",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"collidingElement",get:function(){return this.data.collidingElement}}]),t}(n));(t.CollidableOutEvent=i).type="collidable:out"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),n=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(22)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),r=(Object.defineProperty(t,"Collidable",{enumerable:!0,get:function(){return s(i)["default"]}}),n(21)),o=(Object.defineProperty(t,"ResizeMirror",{enumerable:!0,get:function(){return s(r)["default"]}}),Object.defineProperty(t,"defaultResizeMirrorOptions",{enumerable:!0,get:function(){return r.defaultOptions}}),n(19)),a=(Object.defineProperty(t,"Snappable",{enumerable:!0,get:function(){return s(o)["default"]}}),n(16));function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"SwapAnimation",{enumerable:!0,get:function(){return s(a)["default"]}}),Object.defineProperty(t,"defaultSwapAnimationOptions",{enumerable:!0,get:function(){return a.defaultOptions}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=n(5),r=(r=r)&&r.__esModule?r:{"default":r},a=n(9);var o=Symbol("onDragStart"),s=Symbol("onDragOverContainer"),l=Symbol("onDragOver"),c=Symbol("onDragStop");var u={"sortable:sorted":function(e){var t,n=(e=e.dragEvent).source.textContent.trim()||e.source.id||"sortable element";return e.over?(t=e.over.textContent.trim()||e.over.id||"sortable element",e=e.source.compareDocumentPosition(e.over)&Node.DOCUMENT_POSITION_FOLLOWING,"Placed ".concat(n,e?" after ":" before ").concat(t)):"Placed ".concat(n," into a different container")}},n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,i({},t,{announcements:i({},u,t.announcements||{})}))||this;return e.startIndex=null,e.startContainer=null,e[o]=e[o].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e.on("drag:start",e[o]).on("drag:over:container",e[s]).on("drag:over",e[l]).on("drag:stop",e[c]),e}_(e,n);var t=e.prototype;return t.destroy=function(){n.prototype.destroy.call(this),this.off("drag:start",this[o]).off("drag:over:container",this[s]).off("drag:over",this[l]).off("drag:stop",this[c])},t.index=function h(e){return this.getDraggableElementsForContainer(e.parentNode).indexOf(e)},t[o]=function(e){this.startContainer=e.source.parentNode,this.startIndex=this.index(e.source);var t=new a.SortableStartEvent({dragEvent:e,startIndex:this.startIndex,startContainer:this.startContainer});this.trigger(t),t.canceled()&&e.cancel()},t[s]=function(e){var t,n,i,r,o;e.canceled()||(n=e.source,i=e.over,r=e.overContainer,t=this.index(n),o=new a.SortableSortEvent({dragEvent:e,currentIndex:t,source:n,over:i}),this.trigger(o),o.canceled())||(o=d({source:n,over:i,overContainer:r,children:this.getDraggableElementsForContainer(r)}))&&(n=o.oldContainer,i=o.newContainer,r=this.index(e.source),o=new a.SortableSortedEvent({dragEvent:e,oldIndex:t,newIndex:r,oldContainer:n,newContainer:i}),this.trigger(o))},t[l]=function(e){var t,n,i,r,o;e.over===e.originalSource||e.over===e.source||(o=e.source,n=e.over,i=e.overContainer,t=this.index(o),r=new a.SortableSortEvent({dragEvent:e,currentIndex:t,source:o,over:n}),this.trigger(r),r.canceled())||(r=d({source:o,over:n,overContainer:i,children:this.getDraggableElementsForContainer(i)}))&&(n=r.oldContainer,i=r.newContainer,r=this.index(o),o=new a.SortableSortedEvent({dragEvent:e,oldIndex:t,newIndex:r,oldContainer:n,newContainer:i}),this.trigger(o))},t[c]=function(e){e=new a.SortableStopEvent({dragEvent:e,oldIndex:this.startIndex,newIndex:this.index(e.source),oldContainer:this.startContainer,newContainer:e.source.parentNode});this.trigger(e),this.startIndex=null,this.startContainer=null},e}(r["default"]);function h(e){return Array.prototype.indexOf.call(e.parentNode.children,e)}function d(e){var t,n,i=e.source,r=e.over,o=e.overContainer,e=!e.children.length,a=i.parentNode!==o,s=r&&!a;return e?(e=o,n=i.parentNode,e.appendChild(i),{oldContainer:n,newContainer:e}):s?(n=r,s=h(e=i),t=h(n),s<t?e.parentNode.insertBefore(e,n.nextElementSibling):e.parentNode.insertBefore(e,n),{oldContainer:e.parentNode,newContainer:e.parentNode}):a?(s=r,t=o,a=(e=i).parentNode,s?s.parentNode.insertBefore(e,s):t.appendChild(e),{oldContainer:a,newContainer:e.parentNode}):null}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SortableStopEvent=t.SortableSortedEvent=t.SortableSortEvent=t.SortableStartEvent=t.SortableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.SortableEvent=n).type="sortable",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"startIndex",get:function(){return this.data.startIndex}},{key:"startContainer",get:function(){return this.data.startContainer}}]),t}(n)),i=((t.SortableStartEvent=i).type="sortable:start",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"currentIndex",get:function(){return this.data.currentIndex}},{key:"over",get:function(){return this.data.oldIndex}},{key:"overContainer",get:function(){return this.data.newIndex}}]),t}(n)),i=((t.SortableSortEvent=i).type="sortable:sort",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"oldIndex",get:function(){return this.data.oldIndex}},{key:"newIndex",get:function(){return this.data.newIndex}},{key:"oldContainer",get:function(){return this.data.oldContainer}},{key:"newContainer",get:function(){return this.data.newContainer}}]),t}(n)),i=((t.SortableSortedEvent=i).type="sortable:sorted",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"oldIndex",get:function(){return this.data.oldIndex}},{key:"newIndex",get:function(){return this.data.newIndex}},{key:"oldContainer",get:function(){return this.data.oldContainer}},{key:"newContainer",get:function(){return this.data.newContainer}}]),t}(n));(t.SortableStopEvent=i).type="sortable:stop"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),n=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(26)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=n(5),r=(r=r)&&r.__esModule?r:{"default":r},o=n(10);var a=Symbol("onDragStart"),s=Symbol("onDragOver"),l=Symbol("onDragStop");var c={"swappabled:swapped":function(e){var t=e.dragEvent,e=e.swappedElement,t=t.source.textContent.trim()||t.source.id||"swappable element",e=e.textContent.trim()||e.id||"swappable element";return"Swapped ".concat(t," with ").concat(e)}},n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,i({},t,{announcements:i({},c,t.announcements||{})}))||this;return e.lastOver=null,e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e.on("drag:start",e[a]).on("drag:over",e[s]).on("drag:stop",e[l]),e}_(e,n);var t=e.prototype;return t.destroy=function(){n.prototype.destroy.call(this),this.off("drag:start",this._onDragStart).off("drag:over",this._onDragOver).off("drag:stop",this._onDragStop)},t[a]=function(e){var t=new o.SwappableStartEvent({dragEvent:e});this.trigger(t),t.canceled()&&e.cancel()},t[s]=function(e){var t;e.over===e.originalSource||e.over===e.source||e.canceled()||(t=new o.SwappableSwapEvent({dragEvent:e,over:e.over,overContainer:e.overContainer}),this.trigger(t),t.canceled())||(this.lastOver&&this.lastOver!==e.over&&u(this.lastOver,e.source),this.lastOver===e.over?this.lastOver=null:this.lastOver=e.over,u(e.source,e.over),t=new o.SwappableSwappedEvent({dragEvent:e,swappedElement:e.over}),this.trigger(t))},t[l]=function(e){e=new o.SwappableStopEvent({dragEvent:e});this.trigger(e),this.lastOver=null},e}(r["default"]);function u(t,n){var e,i,r=n.parentNode,o=t.parentNode;e=function(e){o.insertBefore(e,t),r.insertBefore(t,n),o.insertBefore(n,e)},i=document.createElement("div"),e(i),i.parentNode.removeChild(i)}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SwappableStopEvent=t.SwappableSwappedEvent=t.SwappableSwapEvent=t.SwappableStartEvent=t.SwappableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.SwappableEvent=n).type="swappable",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.SwappableStartEvent=i).type="swappable:start",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"over",get:function(){return this.data.over}},{key:"overContainer",get:function(){return this.data.overContainer}}]),t}(n)),i=((t.SwappableSwapEvent=i).type="swappable:swap",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"swappedElement",get:function(){return this.data.swappedElement}}]),t}(n)),i=((t.SwappableSwappedEvent=i).type="swappable:swapped",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n));(t.SwappableStopEvent=i).type="swappable:stop"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),n=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(29)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},s=n(2),r=n(5),r=(r=r)&&r.__esModule?r:{"default":r},l=n(11);var o=Symbol("onDragStart"),a=Symbol("onDragMove"),c=Symbol("onDragStop"),u=Symbol("dropInDropZone"),h=Symbol("returnToOriginalDropzone"),d=Symbol("closestDropzone"),p=Symbol("getDropzones");var f={"droppable:dropped":function(e){var t=e.dragEvent,e=e.dropzone,t=t.source.textContent.trim()||t.source.id||"draggable element",e=e.textContent.trim()||e.id||"droppable element";return"Dropped ".concat(t," into ").concat(e)},"droppable:returned":function(e){var t=e.dragEvent,e=e.dropzone,t=t.source.textContent.trim()||t.source.id||"draggable element",e=e.textContent.trim()||e.id||"droppable element";return"Returned ".concat(t," from ").concat(e)}},m={"droppable:active":"draggable-dropzone--active","droppable:occupied":"draggable-dropzone--occupied"},g={dropzone:".draggable-droppable"},n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,i({},g,t,{classes:i({},m,t.classes||{}),announcements:i({},f,t.announcements||{})}))||this;return e.dropzones=null,e.lastDropzone=null,e.initialDropzone=null,e[o]=e[o].bind(S(e)),e[a]=e[a].bind(S(e)),e[c]=e[c].bind(S(e)),e.on("drag:start",e[o]).on("drag:move",e[a]).on("drag:stop",e[c]),e}_(e,n);var t=e.prototype;return t.destroy=function(){n.prototype.destroy.call(this),this.off("drag:start",this[o]).off("drag:move",this[a]).off("drag:stop",this[c])},t[o]=function(e){if(!e.canceled()){this.dropzones=x(this[p]());var t=(0,s.closest)(e.sensorEvent.target,this.options.dropzone);if(t){var n=new l.DroppableStartEvent({dragEvent:e,dropzone:t});if(this.trigger(n),n.canceled())e.cancel();else{this.initialDropzone=t;var i,r=y(this.dropzones);try{for(r.s();!(i=r.n()).done;){var o=i.value;o.classList.contains(this.getClassNameFor("droppable:occupied"))||o.classList.add(this.getClassNameFor("droppable:active"))}}catch(a){r.e(a)}finally{r.f()}}}else e.cancel()}},t[a]=function(e){var t;e.canceled()||((t=this[d](e.sensorEvent.target))&&!t.classList.contains(this.getClassNameFor("droppable:occupied"))&&this[u](e,t)?this.lastDropzone=t:t&&t!==this.initialDropzone||!this.lastDropzone||(this[h](e),this.lastDropzone=null))},t[c]=function(e){var t,e=new l.DroppableStopEvent({dragEvent:e,dropzone:this.lastDropzone||this.initialDropzone}),e=(this.trigger(e),this.getClassNameFor("droppable:occupied")),n=y(this.dropzones);try{for(n.s();!(t=n.n()).done;)t.value.classList.remove(this.getClassNameFor("droppable:active"))}catch(i){n.e(i)}finally{n.f()}this.lastDropzone&&this.lastDropzone!==this.initialDropzone&&this.initialDropzone.classList.remove(e),this.dropzones=null,this.lastDropzone=null,this.initialDropzone=null},t[u]=function(e,t){var n=new l.DroppableDroppedEvent({dragEvent:e,dropzone:t});return this.trigger(n),!n.canceled()&&(n=this.getClassNameFor("droppable:occupied"),this.lastDropzone&&this.lastDropzone.classList.remove(n),t.appendChild(e.source),t.classList.add(n),!0)},t[h]=function(e){var t=new l.DroppableReturnedEvent({dragEvent:e,dropzone:this.lastDropzone});this.trigger(t),t.canceled()||(this.initialDropzone.appendChild(e.source),this.lastDropzone.classList.remove(this.getClassNameFor("droppable:occupied")))},t[d]=function(e){return this.dropzones?(0,s.closest)(e,this.dropzones):null},t[p]=function(){var e=this.options.dropzone;return"string"==typeof e?document.querySelectorAll(e):e instanceof NodeList||e instanceof Array?e:"function"==typeof e?e():[]},e}(r["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DroppableStopEvent=t.DroppableReturnedEvent=t.DroppableDroppedEvent=t.DroppableStartEvent=t.DroppableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.DroppableEvent=n).type="droppable",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n)),i=((t.DroppableStartEvent=i).type="droppable:start",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n)),i=((t.DroppableDroppedEvent=i).type="droppable:dropped",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n)),i=((t.DroppableReturnedEvent=i).type="droppable:returned",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n));(t.DroppableStopEvent=i).type="droppable:stop",i.cancelable=!0},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),n=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(32)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){function e(){this.callbacks={}}var t=e.prototype;return t.on=function(e){this.callbacks[e]||(this.callbacks[e]=[]);for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return(e=this.callbacks[e]).push.apply(e,n),this},t.off=function(e,t){if(!this.callbacks[e])return null;for(var n=this.callbacks[e].slice(0),i=0;i<n.length;i++)t===n[i]&&this.callbacks[e].splice(i,1);return this},t.trigger=function(e){if(!this.callbacks[e.type])return null;for(var t=x(this.callbacks[e.type]),n=[],i=t.length-1;0<=i;i--){var r=t[i];try{r(e)}catch(o){n.push(o)}}return n.length&&console.error("Draggable caught errors while triggering '".concat(e.type,"'"),n),this},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(35),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},l=n(2),i=n(12),r=n(36),a=(r=r)&&r.__esModule?r:{"default":r},s=n(6),c=n(13),u=n(14);var h=Symbol("onDragStart"),d=Symbol("onDragMove"),p=Symbol("onDragStop"),f=Symbol("onDragPressure"),m={"drag:start":function(e){return"Picked up ".concat(e.source.textContent.trim()||e.source.id||"draggable element")},"drag:stop":function(e){return"Released ".concat(e.source.textContent.trim()||e.source.id||"draggable element")}},g={"container:dragging":"draggable-container--is-dragging","source:dragging":"draggable-source--is-dragging","source:placed":"draggable-source--placed","container:placed":"draggable-container--placed","body:dragging":"draggable--is-dragging","draggable:over":"draggable--over","container:over":"draggable-container--over","source:original":"draggable--original",mirror:"draggable-mirror"},y=t.defaultOptions={draggable:".draggable-source",handle:null,delay:100,placedTimeout:800,plugins:[],sensors:[]},r=function(){function i(){var t=this,e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[document.body],n=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{};if(e instanceof NodeList||e instanceof Array)this.containers=x(e);else{if(!(e instanceof HTMLElement))throw new Error("Draggable containers are expected to be of type `NodeList`, `HTMLElement[]` or `HTMLElement`");this.containers=[e]}this.options=o({},y,n,{classes:o({},g,n.classes||{}),announcements:o({},m,n.announcements||{})}),this.emitter=new a["default"],this.dragging=!1,this.plugins=[],this.sensors=[],this[h]=this[h].bind(this),this[d]=this[d].bind(this),this[p]=this[p].bind(this),this[f]=this[f].bind(this),document.addEventListener("drag:start",this[h],!0),document.addEventListener("drag:move",this[d],!0),document.addEventListener("drag:stop",this[p],!0),document.addEventListener("drag:pressure",this[f],!0);e=Object.values(i.Plugins).map(function(e){return e}),n=[s.MouseSensor,s.TouchSensor],this.addPlugin.apply(this,[].concat(x(e),x(this.options.plugins))),this.addSensor.apply(this,[].concat(n,x(this.options.sensors))),e=new c.DraggableInitializedEvent({draggable:this});this.on("mirror:created",function(e){e=e.mirror;return t.mirror=e}),this.on("mirror:destroy",function(){return t.mirror=null}),this.trigger(e)}var e=i.prototype;return e.destroy=function(){document.removeEventListener("drag:start",this[h],!0),document.removeEventListener("drag:move",this[d],!0),document.removeEventListener("drag:stop",this[p],!0),document.removeEventListener("drag:pressure",this[f],!0);var e=new c.DraggableDestroyEvent({draggable:this});this.trigger(e),this.removePlugin.apply(this,x(this.plugins.map(function(e){return e.constructor}))),this.removeSensor.apply(this,x(this.sensors.map(function(e){return e.constructor})))},e.addPlugin=function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=n.map(function(e){return new e(t)});return r.forEach(function(e){return e.attach()}),this.plugins=[].concat(x(this.plugins),x(r)),this},e.removePlugin=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.plugins.filter(function(e){return t.includes(e.constructor)}).forEach(function(e){return e.detach()}),this.plugins=this.plugins.filter(function(e){return!t.includes(e.constructor)}),this},e.addSensor=function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=n.map(function(e){return new e(t.containers,t.options)});return r.forEach(function(e){return e.attach()}),this.sensors=[].concat(x(this.sensors),x(r)),this},e.removeSensor=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sensors.filter(function(e){return t.includes(e.constructor)}).forEach(function(e){return e.detach()}),this.sensors=this.sensors.filter(function(e){return!t.includes(e.constructor)}),this},e.addContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.containers=[].concat(x(this.containers),t),this.sensors.forEach(function(e){return e.addContainer.apply(e,t)}),this},e.removeContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.containers=this.containers.filter(function(e){return!t.includes(e)}),this.sensors.forEach(function(e){return e.removeContainer.apply(e,t)}),this},e.on=function(e){for(var t,n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(t=this.emitter).on.apply(t,[e].concat(i)),this},e.off=function(e,t){return this.emitter.off(e,t),this},e.trigger=function(e){return this.emitter.trigger(e),this},e.getClassNameFor=function(e){return this.options.classes[e]},e.isDragging=function(){return Boolean(this.dragging)},e.getDraggableElements=function(){var n=this;return this.containers.reduce(function(e,t){return[].concat(x(e),x(n.getDraggableElementsForContainer(t)))},[])},e.getDraggableElementsForContainer=function(e){var t=this;return x(e.querySelectorAll(this.options.draggable)).filter(function(e){return e!==t.originalSource&&e!==t.mirror})},e[h]=function(t){var n=this,e=b(t),i=e.target,r=e.container;this.containers.includes(r)&&((!this.options.handle||!i||(0,l.closest)(i,this.options.handle))&&(this.originalSource=(0,l.closest)(i,this.options.draggable),this.sourceContainer=r,this.originalSource)?(this.lastPlacedSource&&this.lastPlacedContainer&&(clearTimeout(this.placedTimeoutID),this.lastPlacedSource.classList.remove(this.getClassNameFor("source:placed")),this.lastPlacedContainer.classList.remove(this.getClassNameFor("container:placed"))),this.source=this.originalSource.cloneNode(!0),this.originalSource.parentNode.insertBefore(this.source,this.originalSource),this.originalSource.style.display="none",i=new u.DragStartEvent({source:this.source,originalSource:this.originalSource,sourceContainer:r,sensorEvent:e}),this.trigger(i),this.dragging=!i.canceled(),i.canceled()?(this.source.parentNode.removeChild(this.source),this.originalSource.style.display=null):(this.originalSource.classList.add(this.getClassNameFor("source:original")),this.source.classList.add(this.getClassNameFor("source:dragging")),this.sourceContainer.classList.add(this.getClassNameFor("container:dragging")),document.body.classList.add(this.getClassNameFor("body:dragging")),v(document.body,"none"),requestAnimationFrame(function(){var e=b(t).clone({target:n.source});n[d](o({},t,{detail:e}))}))):e.cancel())},e[d]=function(e){var t,n,i,r,o,a,s;this.dragging&&(t=(e=b(e)).container,n=e.target,o=new u.DragMoveEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e}),this.trigger(o),o.canceled()&&e.cancel(),n=(0,l.closest)(n,this.options.draggable),o=(0,l.closest)(e.target,this.containers),i=e.overContainer||o,a=this.currentOverContainer&&i!==this.currentOverContainer,s=this.currentOver&&n!==this.currentOver,r=i&&this.currentOverContainer!==i,o=o&&n&&this.currentOver!==n,s&&(s=new u.DragOutEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,over:this.currentOver}),this.currentOver.classList.remove(this.getClassNameFor("draggable:over")),this.currentOver=null,this.trigger(s)),a&&(s=new u.DragOutContainerEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,overContainer:this.currentOverContainer}),this.currentOverContainer.classList.remove(this.getClassNameFor("container:over")),this.currentOverContainer=null,this.trigger(s)),r&&(i.classList.add(this.getClassNameFor("container:over")),a=new u.DragOverContainerEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,overContainer:i}),this.currentOverContainer=i,this.trigger(a)),o)&&(n.classList.add(this.getClassNameFor("draggable:over")),s=new u.DragOverEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,overContainer:i,over:n}),this.currentOver=n,this.trigger(s))},e[p]=function(e){var t=this;this.dragging&&(this.dragging=!1,e=new u.DragStopEvent({source:this.source,originalSource:this.originalSource,sensorEvent:e.sensorEvent,sourceContainer:this.sourceContainer}),this.trigger(e),this.source.parentNode.insertBefore(this.originalSource,this.source),this.source.parentNode.removeChild(this.source),this.originalSource.style.display="",this.source.classList.remove(this.getClassNameFor("source:dragging")),this.originalSource.classList.remove(this.getClassNameFor("source:original")),this.originalSource.classList.add(this.getClassNameFor("source:placed")),this.sourceContainer.classList.add(this.getClassNameFor("container:placed")),this.sourceContainer.classList.remove(this.getClassNameFor("container:dragging")),document.body.classList.remove(this.getClassNameFor("body:dragging")),v(document.body,""),this.currentOver&&this.currentOver.classList.remove(this.getClassNameFor("draggable:over")),this.currentOverContainer&&this.currentOverContainer.classList.remove(this.getClassNameFor("container:over")),this.lastPlacedSource=this.originalSource,this.lastPlacedContainer=this.sourceContainer,this.placedTimeoutID=setTimeout(function(){t.lastPlacedSource&&t.lastPlacedSource.classList.remove(t.getClassNameFor("source:placed")),t.lastPlacedContainer&&t.lastPlacedContainer.classList.remove(t.getClassNameFor("container:placed")),t.lastPlacedSource=null,t.lastPlacedContainer=null},this.options.placedTimeout),this.source=null,this.originalSource=null,this.currentOverContainer=null,this.currentOver=null,this.sourceContainer=null)},e[f]=function(e){var t;this.dragging&&(e=b(e),t=this.source||(0,l.closest)(e.originalEvent.target,this.options.draggable),t=new u.DragPressureEvent({sensorEvent:e,source:t,pressure:e.pressure}),this.trigger(t))},i}();function b(e){return e.detail}function v(e,t){e.style.webkitUserSelect=t,e.style.mozUserSelect=t,e.style.msUserSelect=t,e.style.oUserSelect=t,e.style.userSelect=t}(t["default"]=r).Plugins={Announcement:i.Announcement,Focusable:i.Focusable,Mirror:i.Mirror,Scrollable:i.Scrollable}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),i=(i=i)&&i.__esModule?i:{"default":i},r=n(3);var o=Symbol("onMouseForceWillBegin"),a=Symbol("onMouseForceDown"),s=Symbol("onMouseDown"),l=Symbol("onMouseForceChange"),c=Symbol("onMouseMove"),u=Symbol("onMouseUp"),h=Symbol("onMouseForceGlobalChange"),n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.mightDrag=!1,e[o]=e[o].bind(S(e)),e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e[u]=e[u].bind(S(e)),e}_(e,n);var t=e.prototype;return t.attach=function(){var e,t=y(this.containers);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.addEventListener("webkitmouseforcewillbegin",this[o],!1),n.addEventListener("webkitmouseforcedown",this[a],!1),n.addEventListener("mousedown",this[s],!0),n.addEventListener("webkitmouseforcechanged",this[l],!1)}}catch(i){t.e(i)}finally{t.f()}document.addEventListener("mousemove",this[c]),document.addEventListener("mouseup",this[u])},t.detach=function(){var e,t=y(this.containers);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.removeEventListener("webkitmouseforcewillbegin",this[o],!1),n.removeEventListener("webkitmouseforcedown",this[a],!1),n.removeEventListener("mousedown",this[s],!0),n.removeEventListener("webkitmouseforcechanged",this[l],!1)}}catch(i){t.e(i)}finally{t.f()}document.removeEventListener("mousemove",this[c]),document.removeEventListener("mouseup",this[u])},t[o]=function(e){e.preventDefault(),this.mightDrag=!0},t[a]=function(e){var t,n;this.dragging||(n=document.elementFromPoint(e.clientX,e.clientY),t=e.currentTarget,n=new r.DragStartSensorEvent({clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n),this.currentContainer=t,this.dragging=!n.canceled(),this.mightDrag=!1)},t[u]=function(e){this.dragging&&(e=new r.DragStopSensorEvent({clientX:e.clientX,clientY:e.clientY,target:null,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,e),this.currentContainer=null,this.dragging=!1,this.mightDrag=!1)},t[s]=function(e){this.mightDrag&&(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault())},t[c]=function(e){var t;this.dragging&&(t=document.elementFromPoint(e.clientX,e.clientY),t=new r.DragMoveSensorEvent({clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t))},t[l]=function(e){var t,n;this.dragging||(n=e.target,t=e.currentTarget,n=new r.DragPressureSensorEvent({pressure:e.webkitForce,clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n))},t[h]=function(e){var t;this.dragging&&(t=e.target,t=new r.DragPressureSensorEvent({pressure:e.webkitForce,clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t))},e}(i["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(38),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(4),i=(i=i)&&i.__esModule?i:{"default":i},o=n(3);var a=Symbol("onMouseDown"),s=Symbol("onMouseUp"),l=Symbol("onDragStart"),c=Symbol("onDragOver"),u=Symbol("onDragEnd"),h=Symbol("onDrop"),d=Symbol("reset"),n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.mouseDownTimeout=null,e.draggableElement=null,e.nativeDraggableElement=null,e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e[u]=e[u].bind(S(e)),e[h]=e[h].bind(S(e)),e}_(e,n);var t=e.prototype;return t.attach=function(){document.addEventListener("mousedown",this[a],!0)},t.detach=function(){document.removeEventListener("mousedown",this[a],!0)},t[l]=function(e){var t,n=this,i=(e.dataTransfer.setData("text",""),e.dataTransfer.effectAllowed=this.options.type,document.elementFromPoint(e.clientX,e.clientY));this.currentContainer=(0,r.closest)(e.target,this.containers),this.currentContainer&&(t=new o.DragStartSensorEvent({clientX:e.clientX,clientY:e.clientY,target:i,container:this.currentContainer,originalEvent:e}),setTimeout(function(){n.trigger(n.currentContainer,t),t.canceled()?n.dragging=!1:n.dragging=!0},0))},t[c]=function(e){var t,n;this.dragging&&(n=document.elementFromPoint(e.clientX,e.clientY),t=this.currentContainer,n=new o.DragMoveSensorEvent({clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n),n.canceled()||(e.preventDefault(),e.dataTransfer.dropEffect=this.options.type))},t[u]=function(e){var t,n;this.dragging&&(document.removeEventListener("mouseup",this[s],!0),n=document.elementFromPoint(e.clientX,e.clientY),t=this.currentContainer,n=new o.DragStopSensorEvent({clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n),this.dragging=!1,this[d]())},t[h]=function(e){e.preventDefault()},t[a]=function(e){var t,n,i=this;e.target&&(e.target.form||e.target.contenteditable)||((t=(0,r.closest)(e.target,function(e){return e.draggable}))&&(t.draggable=!1,this.nativeDraggableElement=t),document.addEventListener("mouseup",this[s],!0),document.addEventListener("dragstart",this[l],!1),document.addEventListener("dragover",this[c],!1),document.addEventListener("dragend",this[u],!1),document.addEventListener("drop",this[h],!1),(n=(0,r.closest)(e.target,this.options.draggable))&&(this.mouseDownTimeout=setTimeout(function(){n.draggable=!0,i.draggableElement=n},this.options.delay)))},t[s]=function(){this[d]()},t[d]=function(){clearTimeout(this.mouseDownTimeout),document.removeEventListener("mouseup",this[s],!0),document.removeEventListener("dragstart",this[l],!1),document.removeEventListener("dragover",this[c],!1),document.removeEventListener("dragend",this[u],!1),document.removeEventListener("drop",this[h],!1),this.nativeDraggableElement&&(this.nativeDraggableElement.draggable=!0,this.nativeDraggableElement=null),this.draggableElement&&(this.draggableElement.draggable=!1,this.draggableElement=null)},e}(i["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(40),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(4),r=(r=r)&&r.__esModule?r:{"default":r},o=n(3);var a=Symbol("onTouchStart"),s=Symbol("onTouchHold"),l=Symbol("onTouchEnd"),c=Symbol("onTouchMove"),u=!1,n=(window.addEventListener("touchmove",function(e){u&&e.preventDefault()},{passive:!1}),function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.currentScrollableParent=null,e.tapTimeout=null,e.touchMoved=!1,e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e}_(e,n);var t=e.prototype;return t.attach=function(){document.addEventListener("touchstart",this[a])},t.detach=function(){document.removeEventListener("touchstart",this[a])},t[a]=function(e){var t=(0,i.closest)(e.target,this.containers);t&&(document.addEventListener("touchmove",this[c]),document.addEventListener("touchend",this[l]),document.addEventListener("touchcancel",this[l]),t.addEventListener("contextmenu",h),this.currentContainer=t,this.tapTimeout=setTimeout(this[s](e,t),this.options.delay))},t[s]=function(n,i){var r=this;return function(){var e,t;r.touchMoved||(t=n.touches[0]||n.changedTouches[0],e=n.target,t=new o.DragStartSensorEvent({clientX:t.pageX,clientY:t.pageY,target:e,container:i,originalEvent:n}),r.trigger(i,t),r.dragging=!t.canceled(),u=r.dragging)}},t[c]=function(e){var t,n;this.touchMoved=!0,this.dragging&&(n=e.touches[0]||e.changedTouches[0],t=document.elementFromPoint(n.pageX-window.scrollX,n.pageY-window.scrollY),n=new o.DragMoveSensorEvent({clientX:n.pageX,clientY:n.pageY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,n))},t[l]=function(e){var t,n;this.touchMoved=!1,u=!1,document.removeEventListener("touchend",this[l]),document.removeEventListener("touchcancel",this[l]),document.removeEventListener("touchmove",this[c]),this.currentContainer&&this.currentContainer.removeEventListener("contextmenu",h),clearTimeout(this.tapTimeout),this.dragging&&(n=e.touches[0]||e.changedTouches[0],t=document.elementFromPoint(n.pageX-window.scrollX,n.pageY-window.scrollY),e.preventDefault(),n=new o.DragStopSensorEvent({clientX:n.pageX,clientY:n.pageY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,n),this.currentContainer=null,this.dragging=!1)},e}(r["default"]));function h(e){e.preventDefault(),e.stopPropagation()}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(42),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DragPressureSensorEvent=t.DragStopSensorEvent=t.DragMoveSensorEvent=t.DragStartSensorEvent=t.SensorEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"originalEvent",get:function(){return this.data.originalEvent}},{key:"clientX",get:function(){return this.data.clientX}},{key:"clientY",get:function(){return this.data.clientY}},{key:"target",get:function(){return this.data.target}},{key:"container",get:function(){return this.data.container}},{key:"pressure",get:function(){return this.data.pressure}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(t.SensorEvent=n),i=((t.DragStartSensorEvent=i).type="drag:start",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.DragMoveSensorEvent=i).type="drag:move",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.DragStopSensorEvent=i).type="drag:stop",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n));(t.DragPressureSensorEvent=i).type="drag:pressure"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(4),i=(i=i)&&i.__esModule?i:{"default":i},a=n(3);var s=Symbol("onContextMenuWhileDragging"),r=Symbol("onMouseDown"),l=Symbol("onMouseMove"),c=Symbol("onMouseUp"),n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.mouseDown=!1,e.mouseDownTimeout=null,e.openedContextMenu=!1,e[s]=e[s].bind(S(e)),e[r]=e[r].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e}_(e,n);var t=e.prototype;return t.attach=function(){document.addEventListener("mousedown",this[r],!0)},t.detach=function(){document.removeEventListener("mousedown",this[r],!0)},t[r]=function(t){var n,i,r=this;0===t.button&&!t.ctrlKey&&!t.metaKey&&(document.addEventListener("mouseup",this[c]),n=document.elementFromPoint(t.clientX,t.clientY),i=(0,o.closest)(n,this.containers))&&(document.addEventListener("dragstart",u),this.mouseDown=!0,clearTimeout(this.mouseDownTimeout),this.mouseDownTimeout=setTimeout(function(){var e;r.mouseDown&&(e=new a.DragStartSensorEvent({clientX:t.clientX,clientY:t.clientY,target:n,container:i,originalEvent:t}),r.trigger(i,e),r.currentContainer=i,r.dragging=!e.canceled(),r.dragging)&&(document.addEventListener("contextmenu",r[s]),document.addEventListener("mousemove",r[l]))},this.options.delay))},t[l]=function(e){var t;this.dragging&&(t=document.elementFromPoint(e.clientX,e.clientY),t=new a.DragMoveSensorEvent({clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t))},t[c]=function(e){var t;this.mouseDown=Boolean(this.openedContextMenu),this.openedContextMenu?this.openedContextMenu=!1:(document.removeEventListener("mouseup",this[c]),document.removeEventListener("dragstart",u),this.dragging&&(t=document.elementFromPoint(e.clientX,e.clientY),t=new a.DragStopSensorEvent({clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t),document.removeEventListener("contextmenu",this[s]),document.removeEventListener("mousemove",this[l]),this.currentContainer=null,this.dragging=!1))},t[s]=function(e){e.preventDefault(),this.openedContextMenu=!0},e}(i["default"]);function u(e){e.preventDefault()}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(45),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};t["default"]=function(){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{};this.containers=x(e),this.options=i({},t),this.dragging=!1,this.currentContainer=null}var t=e.prototype;return t.attach=function(){return this},t.detach=function(){return this},t.addContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.containers=[].concat(x(this.containers),t)},t.removeContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.containers=this.containers.filter(function(e){return!t.includes(e)})},t.trigger=function(e,t){var n=document.createEvent("Event");return n.detail=t,n.initEvent(t.type,!0,!0),e.dispatchEvent(n),this.lastEvent=t},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return requestAnimationFrame(function(){requestAnimationFrame(e)})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(48),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){if(e){var n=t,i=t,r=t,o=t,a=Boolean("string"==typeof t),s=Boolean("function"==typeof t),l=Boolean(t instanceof NodeList||t instanceof Array),c=Boolean(t instanceof HTMLElement),u=e;do{if(function(e){return e&&(a?h.call(e,n):l?x(r).includes(e):c?o===e:s&&i(e))}(u=u.correspondingUseElement||u.correspondingElement||u))return u}while((u=u.parentNode)&&u!==document.body&&u!==document)}return null};var h=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(50),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=t.scroll=t.onDragStop=t.onDragMove=t.onDragStart=undefined;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=n(1),r=(r=r)&&r.__esModule?r:{"default":r},o=n(2);var a=t.onDragStart=Symbol("onDragStart"),s=t.onDragMove=Symbol("onDragMove"),l=t.onDragStop=Symbol("onDragStop"),c=t.scroll=Symbol("scroll"),u=t.defaultOptions={speed:6,sensitivity:50,scrollableElements:[]},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=i({},u,e.getOptions()),e.currentMousePosition=null,e.scrollAnimationFrame=null,e.scrollableElement=null,e.findScrollableElementFrame=null,e[a]=e[a].bind(S(e)),e[s]=e[s].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:start",this[a]).on("drag:move",this[s]).on("drag:stop",this[l])},n.detach=function(){this.draggable.off("drag:start",this[a]).off("drag:move",this[s]).off("drag:stop",this[l])},n.getOptions=function(){return this.draggable.options.scrollable||{}},n.getScrollableElement=function(e){var t,n;return this.hasDefinedScrollableElements()?(0,o.closest)(e,this.options.scrollableElements)||document.documentElement:(e=e)&&(t=getComputedStyle(e).getPropertyValue("position"),n="absolute"===t,e=(0,o.closest)(e,function(e){return(!n||"static"!==getComputedStyle(e).getPropertyValue("position"))&&(e=e,e=(e=getComputedStyle(e,null)).getPropertyValue("overflow")+e.getPropertyValue("overflow-y")+e.getPropertyValue("overflow-x"),/(auto|scroll)/.test(e))}),"fixed"!==t)&&e?e:h()},n.hasDefinedScrollableElements=function(){return Boolean(0!==this.options.scrollableElements.length)},n[a]=function(e){var t=this;this.findScrollableElementFrame=requestAnimationFrame(function(){t.scrollableElement=t.getScrollableElement(e.source)})},n[s]=function(e){var t,n,i=this;this.findScrollableElementFrame=requestAnimationFrame(function(){i.scrollableElement=i.getScrollableElement(e.sensorEvent.target)}),this.scrollableElement&&(t=e.sensorEvent,n={x:0,y:0},"ontouchstart"in window&&(n.y=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n.x=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),this.currentMousePosition={clientX:t.clientX-n.x,clientY:t.clientY-n.y},this.scrollAnimationFrame=requestAnimationFrame(this[c]))},n[l]=function(){cancelAnimationFrame(this.scrollAnimationFrame),cancelAnimationFrame(this.findScrollableElementFrame),this.scrollableElement=null,this.scrollAnimationFrame=null,this.findScrollableElementFrame=null,this.currentMousePosition=null},n[c]=function(){var e,t,n,i,r,o,a,s,l;this.scrollableElement&&this.currentMousePosition&&(cancelAnimationFrame(this.scrollAnimationFrame),e=(t=this.options).speed,t=t.sensitivity,s=(n=this.scrollableElement.getBoundingClientRect()).bottom>window.innerHeight,l=n.top<0,i=h(),r=this.scrollableElement,o=this.currentMousePosition.clientX,a=this.currentMousePosition.clientY,r===document.body||r===document.documentElement||(l||s)?(s=(l=window).innerHeight,l=l.innerWidth,a<t?i.scrollTop-=e:s-a<t&&(i.scrollTop+=e),o<t?i.scrollLeft-=e:l-o<t&&(i.scrollLeft+=e)):(s=r.offsetHeight,l=r.offsetWidth,n.top+s-a<t?r.scrollTop+=e:a-n.top<t&&(r.scrollTop-=e),n.left+l-o<t?r.scrollLeft+=e:o-n.left<t&&(r.scrollLeft-=e)),this.scrollAnimationFrame=requestAnimationFrame(this[c]))},e}(r["default"]);function h(){return document.scrollingElement||document.documentElement}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(52),i=(i=n)&&i.__esModule?i:{"default":i};t["default"]=i["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MirrorDestroyEvent=t.MirrorMoveEvent=t.MirrorAttachedEvent=t.MirrorCreatedEvent=t.MirrorCreateEvent=t.MirrorEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"source",get:function(){return this.data.source}},{key:"originalSource",get:function(){return this.data.originalSource}},{key:"sourceContainer",get:function(){return this.data.sourceContainer}},{key:"sensorEvent",get:function(){return this.data.sensorEvent}},{key:"dragEvent",get:function(){return this.data.dragEvent}},{key:"originalEvent",get:function(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(t.MirrorEvent=n),i=((t.MirrorCreateEvent=i).type="mirror:create",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n)),i=((t.MirrorCreatedEvent=i).type="mirror:created",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n)),i=((t.MirrorAttachedEvent=i).type="mirror:attached",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n)),i=((t.MirrorMoveEvent=i).type="mirror:move",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n));(t.MirrorDestroyEvent=i).type="mirror:destroy",i.cancelable=!0},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(54);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=t.getAppendableContainer=t.onScroll=t.onMirrorMove=t.onMirrorCreated=t.onDragStop=t.onDragMove=t.onDragStart=undefined;var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i=n(1),i=(i=i)&&i.__esModule?i:{"default":i},s=n(55);function f(e,t){var n,i={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);return i}var r=t.onDragStart=Symbol("onDragStart"),o=t.onDragMove=Symbol("onDragMove"),a=t.onDragStop=Symbol("onDragStop"),l=t.onMirrorCreated=Symbol("onMirrorCreated"),c=t.onMirrorMove=Symbol("onMirrorMove"),u=t.onScroll=Symbol("onScroll"),h=t.getAppendableContainer=Symbol("getAppendableContainer"),d=t.defaultOptions={constrainDimensions:!1,xAxis:!0,yAxis:!0,cursorOffsetX:null,cursorOffsetY:null},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=p({},d,e.getOptions()),e.scrollOffset={x:0,y:0},e.initialScrollOffset={x:window.scrollX,y:window.scrollY},e[r]=e[r].bind(S(e)),e[o]=e[o].bind(S(e)),e[a]=e[a].bind(S(e)),e[l]=e[l].bind(S(e)),e[c]=e[c].bind(S(e)),e[u]=e[u].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:start",this[r]).on("drag:move",this[o]).on("drag:stop",this[a]).on("mirror:created",this[l]).on("mirror:move",this[c])},n.detach=function(){this.draggable.off("drag:start",this[r]).off("drag:move",this[o]).off("drag:stop",this[a]).off("mirror:created",this[l]).off("mirror:move",this[c])},n.getOptions=function(){return this.draggable.options.mirror||{}},n[r]=function(e){var t,n,i,r,o,a;e.canceled()||("ontouchstart"in window&&document.addEventListener("scroll",this[u],!0),this.initialScrollOffset={x:window.scrollX,y:window.scrollY},a=e.source,t=e.originalSource,n=e.sourceContainer,i=e.sensorEvent,r=new s.MirrorCreateEvent({source:a,originalSource:t,sourceContainer:n,sensorEvent:i,dragEvent:e}),this.draggable.trigger(r),/^drag/.test(i.originalEvent.type))||r.canceled()||(r=this[h](a)||n,this.mirror=a.cloneNode(!0),o=new s.MirrorCreatedEvent({source:a,originalSource:t,sourceContainer:n,sensorEvent:i,dragEvent:e,mirror:this.mirror}),a=new s.MirrorAttachedEvent({source:a,originalSource:t,sourceContainer:n,sensorEvent:i,dragEvent:e,mirror:this.mirror}),this.draggable.trigger(o),r.appendChild(this.mirror),this.draggable.trigger(a))},n[o]=function(e){var t,n,i,r;this.mirror&&!e.canceled()&&(r=e.source,t=e.originalSource,n=e.sourceContainer,i=e.sensorEvent,r=new s.MirrorMoveEvent({source:r,originalSource:t,sourceContainer:n,sensorEvent:i,dragEvent:e,mirror:this.mirror}),this.draggable.trigger(r))},n[a]=function(e){var t,n,i;"ontouchstart"in window&&document.removeEventListener("scroll",this[u],!0),this.initialScrollOffset={x:0,y:0},this.scrollOffset={x:0,y:0},this.mirror&&(i=e.source,t=e.sourceContainer,n=e.sensorEvent,i=new s.MirrorDestroyEvent({source:i,mirror:this.mirror,sourceContainer:t,sensorEvent:n,dragEvent:e}),this.draggable.trigger(i),i.canceled()||this.mirror.parentNode.removeChild(this.mirror))},n[u]=function(){this.scrollOffset={x:window.scrollX-this.initialScrollOffset.x,y:window.scrollY-this.initialScrollOffset.y}},n[l]=function(e){var r=this,o=function o(e){var t=e.mirrorOffset,n=e.initialX,i=e.initialY,e=f(e,["mirrorOffset","initialX","initialY"]);return r.mirrorOffset=t,r.initialX=n,r.initialY=i,p({mirrorOffset:t,initialX:n,initialY:i},e)},e={mirror:e.mirror,source:e.source,sensorEvent:e.sensorEvent,mirrorClass:this.draggable.getClassNameFor("mirror"),scrollOffset:this.scrollOffset,options:this.options};return Promise.resolve(e).then(m).then(g).then(y).then(b).then(x({initial:!0})).then(v).then(o)},n[c]=function(e){return e.canceled()?null:(e={mirror:e.mirror,sensorEvent:e.sensorEvent,mirrorOffset:this.mirrorOffset,options:this.options,initialX:this.initialX,initialY:this.initialY,scrollOffset:this.scrollOffset},Promise.resolve(e).then(x({raf:!0})))},n[h]=function(e){var t=this.options.appendTo;return"string"==typeof t?document.querySelector(t):t instanceof HTMLElement?t:"function"==typeof t?t(e):e.parentNode},e}(i["default"]);function m(e){var n=e.source,i=f(e,["source"]);return I(function(e){var t=n.getBoundingClientRect();e(p({source:n,sourceRect:t},i))})}function g(e){var i=e.sensorEvent,r=e.sourceRect,o=e.options,a=f(e,["sensorEvent","sourceRect","options"]);return I(function(e){var t=null===o.cursorOffsetY?i.clientY-r.top:o.cursorOffsetY,n=null===o.cursorOffsetX?i.clientX-r.left:o.cursorOffsetX;e(p({sensorEvent:i,sourceRect:r,mirrorOffset:{top:t,left:n},options:o},a))})}function y(e){var i=e.mirror,r=e.source,o=e.options,a=f(e,["mirror","source","options"]);return I(function(e){var t,n;o.constrainDimensions&&(t=(n=getComputedStyle(r)).getPropertyValue("height"),n=n.getPropertyValue("width")),i.style.position="fixed",i.style.pointerEvents="none",i.style.top=0,i.style.left=0,i.style.margin=0,o.constrainDimensions&&(i.style.height=t,i.style.width=n),e(p({mirror:i,source:r,options:o},a))})}function b(e){var t=e.mirror,n=e.mirrorClass,i=f(e,["mirror","mirrorClass"]);return I(function(e){t.classList.add(n),e(p({mirror:t,mirrorClass:n},i))})}function v(e){var t=e.mirror,n=f(e,["mirror"]);return I(function(e){t.removeAttribute("id"),delete t.id,e(p({mirror:t},n))})}function x(e){var e=0<arguments.length&&e!==undefined?e:{},t=e.withFrame,n=void 0!==t&&t,t=e.initial,d=void 0!==t&&t;return function(e){var r=e.mirror,o=e.sensorEvent,a=e.mirrorOffset,s=e.initialY,l=e.initialX,c=e.scrollOffset,u=e.options,h=f(e,["mirror","sensorEvent","mirrorOffset","initialY","initialX","scrollOffset","options"]);return I(function(e){var t,n,i=p({mirror:r,sensorEvent:o,mirrorOffset:a,options:u},h);a&&(t=o.clientX-a.left-c.x,n=o.clientY-a.top-c.y,u.xAxis&&u.yAxis||d?r.style.transform="translate3d(".concat(t,"px, ").concat(n,"px, 0)"):u.xAxis&&!u.yAxis?r.style.transform="translate3d(".concat(t,"px, ").concat(s,"px, 0)"):u.yAxis&&!u.xAxis&&(r.style.transform="translate3d(".concat(l,"px, ").concat(n,"px, 0)")),d)&&(i.initialX=t,i.initialY=n),e(i)},{frame:n})}}function I(n,e){var e=(1<arguments.length&&e!==undefined?e:{}).raf,i=void 0!==e&&e;return new Promise(function(e,t){i?requestAnimationFrame(function(){n(e,t)}):n(e,t)})}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(56),i=(i=n)&&i.__esModule?i:{"default":i};t["default"]=i["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},n=n(1),n=(n=n)&&n.__esModule?n:{"default":n};var r=Symbol("onInitialize"),o=Symbol("onDestroy"),a={},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=i({},a,e.getOptions()),e[r]=e[r].bind(S(e)),e[o]=e[o].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("draggable:initialize",this[r]).on("draggable:destroy",this[o])},n.detach=function(){this.draggable.off("draggable:initialize",this[r]).off("draggable:destroy",this[o])},n.getOptions=function(){return this.draggable.options.focusable||{}},n.getElements=function(){return[].concat(x(this.draggable.containers),x(this.draggable.getDraggableElements()))},n[r]=function(){var e=this;requestAnimationFrame(function(){e.getElements().forEach(function(e){e=e,Boolean(!e.getAttribute("tabindex")&&-1===e.tabIndex)&&(s.push(e),e.tabIndex=0)})})},n[o]=function(){var e=this;requestAnimationFrame(function(){e.getElements().forEach(function(e){var t;e=e,-1!==(t=s.indexOf(e))&&(e.tabIndex=-1,s.splice(t,1))})})},e}(n["default"]),s=(t["default"]=n,[])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(58),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){function e(e){this.draggable=e}var t=e.prototype;return t.attach=function(){throw new Error("Not Implemented")},t.detach=function(){throw new Error("Not Implemented")},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},n=n(1),n=(n=n)&&n.__esModule?n:{"default":n};var r=Symbol("onInitialize"),o=Symbol("onDestroy"),a=Symbol("announceEvent"),s=Symbol("announceMessage"),l=t.defaultOptions={expire:7e3},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=i({},l,e.getOptions()),e.originalTriggerMethod=e.draggable.trigger,e[r]=e[r].bind(S(e)),e[o]=e[o].bind(S(e)),e}_(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("draggable:initialize",this[r])},n.detach=function(){this.draggable.off("draggable:destroy",this[o])},n.getOptions=function(){return this.draggable.options.announcements||{}},n[a]=function(e){var t=this.options[e.type];t&&"string"==typeof t&&this[s](t),t&&"function"==typeof t&&this[s](t(e))},n[s]=function(e){var t,n;e=e,t=(t={expire:this.options.expire}).expire,(n=document.createElement("div")).textContent=e,c.appendChild(n),setTimeout(function(){c.removeChild(n)},t)},n[r]=function(){var t=this;this.draggable.trigger=function(e){try{t[a](e)}finally{t.originalTriggerMethod.call(t.draggable,e)}}},n[o]=function(){this.draggable.trigger=this.originalTriggerMethod},e}(n["default"]),c=(t["default"]=n,(t=document.createElement("div")).setAttribute("id","draggable-live-region"),t.setAttribute("aria-relevant","additions"),t.setAttribute("aria-atomic","true"),t.setAttribute("aria-live","assertive"),t.setAttribute("role","log"),t.style.position="fixed",t.style.width="1px",t.style.height="1px",t.style.top="-1px",t.style.overflow="hidden",t);document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(c)})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(61),i=(i=n)&&i.__esModule?i:{"default":i};t["default"]=i["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DraggableDestroyEvent=t.DraggableInitializedEvent=t.DraggableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"draggable",get:function(){return this.data.draggable}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.DraggableEvent=n).type="draggable",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.DraggableInitializedEvent=i).type="draggable:initialize",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n));(t.DraggableDestroyEvent=i).type="draggable:destroy"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=Symbol("canceled"),o=function(){function e(e){this[r]=!1,this.data=e}var t=e.prototype;return t.cancel=function(){this[r]=!0},t.canceled=function(){return Boolean(this[r])},t.clone=function(e){return new this.constructor(i({},this.data,e))},a(e,[{key:"type",get:function(){return this.constructor.type}},{key:"cancelable",get:function(){return this.constructor.cancelable}}]),e}();(t["default"]=o).type="event",o.cancelable=!1},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DragStopEvent=t.DragPressureEvent=t.DragOutContainerEvent=t.DragOverContainerEvent=t.DragOutEvent=t.DragOverEvent=t.DragMoveEvent=t.DragStartEvent=t.DragEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"source",get:function(){return this.data.source}},{key:"originalSource",get:function(){return this.data.originalSource}},{key:"mirror",get:function(){return this.data.mirror}},{key:"sourceContainer",get:function(){return this.data.sourceContainer}},{key:"sensorEvent",get:function(){return this.data.sensorEvent}},{key:"originalEvent",get:function(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),i=((t.DragEvent=n).type="drag",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.DragStartEvent=i).type="drag:start",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n)),i=((t.DragMoveEvent=i).type="drag:move",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}},{key:"over",get:function(){return this.data.over}}]),t}(n)),i=((t.DragOverEvent=i).type="drag:over",i.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}},{key:"over",get:function(){return this.data.over}}]),t}(n)),i=((t.DragOutEvent=i).type="drag:out",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}}]),t}(n)),i=((t.DragOverContainerEvent=i).type="drag:over:container",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}}]),t}(n)),i=((t.DragOutContainerEvent=i).type="drag:out:container",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),a(t,[{key:"pressure",get:function(){return this.data.pressure}}]),t}(n)),i=((t.DragPressureEvent=i).type="drag:pressure",function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t}(n));(t.DragStopEvent=i).type="drag:stop"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Plugins=t.Sensors=t.Sortable=t.Swappable=t.Droppable=t.Draggable=t.BasePlugin=t.BaseEvent=undefined;var i=n(5),r=(Object.defineProperty(t,"Draggable",{enumerable:!0,get:function(){return h(i)["default"]}}),n(34)),o=(Object.defineProperty(t,"Droppable",{enumerable:!0,get:function(){return h(r)["default"]}}),n(31)),a=(Object.defineProperty(t,"Swappable",{enumerable:!0,get:function(){return h(o)["default"]}}),n(28)),s=(Object.defineProperty(t,"Sortable",{enumerable:!0,get:function(){return h(a)["default"]}}),n(0)),s=h(s),l=h(n(1)),c=u(n(6)),n=u(n(25));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function h(e){return e&&e.__esModule?e:{"default":e}}t.BaseEvent=s["default"],t.BasePlugin=l["default"],t.Sensors=c,t.Plugins=n}],i={},r.m=n,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===o(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=66);function r(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var n,i},"object"===o(n)&&"object"===o(e)?e.exports=t():(t="function"==typeof(t=t)?t.apply(n,[]):t)!==undefined&&(e.exports=t)}.call(this,t(46)(e))},function(e,t,n){"use strict";var i=n(28),r=n(307),o=n(308),a=n(309),s=n(311),n=n(324);BI.extend(BI,{FormulaInserter:i.FormulaInserter,ComplexFormulaInserter:r.ComplexFormulaInserter,RegularFormulaInserter:o.RegularFormulaInserter,FormulaOpeartingPanel:a.FormulaOpeartingPanel,ParameterEditor:s.ParameterEditor,initSocket:n.initSocket})},function(e,t){e.exports=BI.CodeMirror},function(e,t,n){"use strict";function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function o(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}Object.defineProperty(t,"__esModule",{value:!0});n=(t.FormulaFunctionItem=void 0,n(1).shortcut)()((n=function(r){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return o(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e=r.call.apply(r,[this].concat(n))||this),"props",{baseCls:"bi-list-item-select",text:"",title:"",value:""}),e}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var i=this;return{type:BI.TextButton.xtype,text:this.options.text,value:this.options.value,trigger:"dblclick",textAlign:"left",hgap:5,handler:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.fireEvent.apply(i,[BI.Controller.EVENT_CHANGE,BI.Events.CLICK].concat(t))}}},n}(BI.BasicButton),o(n,"xtype","bi.formula.function_item"),n=n))||n;t.FormulaFunctionItem=n},function(e,t,n){"use strict";function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}Object.defineProperty(t,"__esModule",{value:!0});n=(t.FormulaVarItem=void 0,n(1).shortcut)()((n=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"leaf",void 0),a(o(e),"props",{text:"",title:"",value:"",layoutType:BI.MidTreeLeafItem.xtype}),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var i=this;return{type:BI.HTapeLayout.xtype,items:[{type:BI.Label.xtype,width:16},{type:this.options.layoutType,cls:"bi-list-item-select",ref:function(e){i.leaf=e},text:this.options.text,value:this.options.value,trigger:"dblclick",textAlign:"left",handler:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.fireEvent.apply(i,[BI.Controller.EVENT_CHANGE,BI.Events.CLICK].concat(t))}}]}},n.setSelected=function(e){r.prototype.setSelected.call(this,e),this.leaf.setSelected(e)},t}(BI.BasicButton),a(n,"xtype","bi.formula.var_item"),n=n))||n;t.FormulaVarItem=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComplexFormulaInserter=void 0;var i=n(28);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,n(1).shortcut)()((n=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:{formula:"",keepFormulaWhenExportOrEdit:!1,keepFormulaWhenReportOrAnalyze:!0}}),a(o(e),"exportOrEditCheckbox",void 0),a(o(e),"reportOrAnalyzeCheckbox",void 0),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.getToolbarLayout=function(){var t=this;return{type:BI.VerticalAdaptLayout.xtype,items:[{type:BI.MultiSelectItem.xtype,ref:function(e){t.exportOrEditCheckbox=e},width:180,lgap:10,text:BI.i18nText("BI-Basic_Export_Or_Edit_Keep_Formula"),selected:this.options.value.keepFormulaWhenExportOrEdit,listeners:[{eventName:BI.MultiSelectItem.EVENT_CHANGE,action:function(){t.exportOrEditCheckbox.isSelected()?(t.reportOrAnalyzeCheckbox.setEnable(!1),t.reportOrAnalyzeCheckbox.setSelected(!0)):t.reportOrAnalyzeCheckbox.setEnable(!0)}}]},{type:BI.MultiSelectItem.xtype,ref:function(e){t.reportOrAnalyzeCheckbox=e},width:220,lgap:10,text:BI.i18nText("BI-Basic_Report_Or_Analyze_Keep_Formula"),disabled:this.options.value.keepFormulaWhenExportOrEdit,selected:this.options.value.keepFormulaWhenReportOrAnalyze},{type:BI.Button.xtype,text:BI.i18nText("BI-Basic_Check_Validation"),handler:function(){t.validate()}}]}},n.getValue=function(){return{formula:this.formulaEditor.getValue(),keepFormulaWhenExportOrEdit:this.exportOrEditCheckbox.isSelected(),keepFormulaWhenReportOrAnalyze:this.reportOrAnalyzeCheckbox.isSelected()}},t}(i.FormulaInserter),a(n,"xtype","bi.formula_operating_panel.complex.inserter"),i=n))||i;t.ComplexFormulaInserter=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegularFormulaInserter=void 0;var i=n(28);function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}var r,o=(0,n(1).shortcut)()((n=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),i.prototype.getToolbarLayout=function(){var e=this;return{type:BI.AbsoluteLayout.xtype,items:[{el:{type:BI.Button.xtype,text:BI.i18nText("BI-Basic_Check_Validation"),handler:function(){e.validate()}},right:93,top:12}]}},i}(i.FormulaInserter),i="bi.formula_operating_panel.regular.inserter",(r="xtype")in(o=n)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,r=n))||r;t.RegularFormulaInserter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaOpeartingPanel=void 0;var i=n(1),a=n(47),r=n(310),s=n(28),l=n(48);function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function u(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function h(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,i.shortcut)()(i=(0,i.store)(r.FormulaModel)((n=function(o){var e;function t(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return h(c(t=o.call.apply(o,[this].concat(n))||this),"functionTypeGroup",void 0),h(c(t),"functionNameGroup",void 0),h(c(t),"model",void 0),h(c(t),"store",void 0),h(c(t),"descriptionLabel",void 0),h(c(t),"searchEditor",void 0),h(c(t),"relatedFunctionNameGroup",void 0),h(c(t),"formulaEditor",void 0),h(c(t),"varTree",void 0),h(c(t),"props",{inserterType:s.FormulaInserter.xtype,value:{formula:""},configLoader:function(){return new Promise(function(e){e({vars:[],JSONs:[]})})}}),h(c(t),"watch",{functionNames:function(){t.functionNameGroup.populate(t.model.functionNames),t.scrollFunctionName2View()},selectedFunctionNameOrVarName:function(){(0,a.isBelong2FormulaFunction)(t.model.selectedFunctionNameOrVarName)&&(t.functionNameGroup.setValue(t.model.selectedFunctionNameOrVarName),t.scrollFunctionName2View())},selectedFunctionType:function(){t.functionTypeGroup.setValue(t.model.selectedFunctionType),t.functionNameGroup.setValue(t.model.selectedFunctionNameOrVarName)},functionDescription:function(){t.descriptionLabel.setText(t.model.functionDescription)},relatedFunctionNames:function r(){var r=t.model.relatedFunctionNames,e=(t.relatedFunctionNameGroup.populate(r),BI.isEmptyArray(r)?null:BI.first(r).value);t.relatedFunctionNameGroup.setValue(e),e&&t.store.setSelectedFunctionName(e)},isCached:function(){t.functionTypeGroup.populate((0,a.transformFormulaJSONs2FunctionTypes)()),t.functionTypeGroup.setValue(t.model.selectedFunctionType),t.functionNameGroup.setValue(t.model.selectedFunctionNameOrVarName),t.varTree.populate((0,a.transformFormulaVarItems)())}}),t}e=o,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,u(n,e);var n=t.prototype;return n.render=function(){var r=this;return{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.LeftRightVerticalAdaptLayout.xtype,items:{left:[{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Please_Input_Formula")}],right:[{type:BI.SearchEditor.xtype,ref:function(e){r.searchEditor=e},width:194,listeners:[{eventName:BI.SearchEditor.EVENT_ENTER,action:function(){r.store.setKeyword(r.searchEditor.getValue())}},{eventName:BI.SearchEditor.EVENT_EMPTY,action:function(){r.store.setKeyword("")}}]},{lgap:5,el:{type:BI.Button.xtype,text:BI.i18nText("BI-Basic_Search"),minWidth:0,width:54,handler:function(){r.store.setKeyword(r.searchEditor.getValue())}}}]}},height:24},{el:{type:BI.HTapeLayout.xtype,items:[{type:this.options.inserterType,ref:function(e){r.formulaEditor=e},value:this.options.value,rgap:10,listeners:[{eventName:"EVENT_SHOW_HINT",action:function(e){r.store.setSelectedFunctionName(e),r.scrollFunctionName2View()}},{eventName:"EVENT_SELECT_HINT",action:function(e){r.store.setSelectedFunctionName(e),r.scrollFunctionName2View()}}]},{el:{type:BI.ButtonGroup.xtype,ref:function(e){r.relatedFunctionNameGroup=e},cls:"bi-border",items:this.model.relatedFunctionNames,layouts:[{type:BI.VerticalLayout.xtype}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){r.store.setSelectedFunctionName(e)}}]},width:253}]},height:200,tgap:10},{type:BI.HTapeLayout.xtype,items:[{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Function_Type"),textAlign:"left"},height:24},{type:BI.ButtonGroup.xtype,ref:function(e){r.functionTypeGroup=e},value:this.model.selectedFunctionType,cls:"bi-border",items:(0,a.transformFormulaJSONs2FunctionTypes)(),layouts:[{type:BI.VerticalLayout.xtype}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){r.store.setSelectedFunctionType(e)}}]}]},width:135},{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Function_Name"),textAlign:"left"},height:24},{type:BI.ButtonGroup.xtype,ref:function(e){r.functionNameGroup=e},value:this.model.selectedFunctionNameOrVarName,cls:"bi-border",items:this.model.functionNames,layouts:[{type:BI.VerticalLayout.xtype}],listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(e,t,n,i){r.store.setSelectedFunctionName(t,!1),"dblclick"===i.type&&r.formulaEditor.insertFunction(t)}}]}]},lgap:5,width:135},{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Vars"),textAlign:"left"},height:24},{type:BI.CustomTree.xtype,cls:"bi-border",chooseType:BI.Selection.Single,ref:function(e){r.varTree=e},el:{type:BI.ButtonTree.xtype,layouts:[{type:BI.VerticalLayout.xtype}]},items:(0,a.transformFormulaVarItems)(),listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(e,t,n,i){e===BI.Events.CLICK&&(r.store.setSelectedVarName(t),i)&&"dblclick"===i.type&&r.formulaEditor.insertField(t)}}]}]},lgap:5,width:300},{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Function_Description"),textAlign:"left"},height:24},{type:BI.VerticalLayout.xtype,cls:"bi-border",items:[{el:{type:BI.Text.xtype,ref:function(e){r.descriptionLabel=e},text:this.model.functionDescription,whiteSpace:"normal",hgap:5}}]}]},lgap:5}]}]}},n.beforeRender=function(t){var n=this;(0,a.isFormulaConfigCached)()?t():(this.loading(),this.options.configLoader().then(function(e){n.loaded(),(0,a.setFormulaConfigCache)(e),n.store.setSelectedFunctionName(l.DEFAULT_FUNCTION_NAME),t()}))},n.scrollFunctionName2View=function(){var e,t=this;this.model.needScrollToView&&(e=this.functionNameGroup.getAllButtons().find(function(e){return e.getValue()===t.model.selectedFunctionNameOrVarName}),BI.isNull(e)||e.element[0].scrollIntoView())},n.getValue=function(){return this.formulaEditor.getValue()},n.loadConfigData=function(e){(0,a.isFormulaConfigCached)()||((0,a.setFormulaConfigCache)(e),this.store.setSelectedFunctionName(l.DEFAULT_FUNCTION_NAME))},t}(BI.Pane),h(n,"xtype","bi.formula_operating_panel"),i=n))||i)||i;t.FormulaOpeartingPanel=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaModel=void 0;var i=n(1),o=n(47),a=n(48);function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function c(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,i.model)()((n=function(r){var e,t;function n(){for(var i,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c(s(i=r.call.apply(r,[this].concat(t))||this),"computed",{functionNames:function(){return(0,o.transformFormulaJSONs2FunctionNames)(i.model.selectedFunctionType)},functionDescription:function(){return(0,o.getFunctionDescriptionByFunctionName)(i.model.selectedFunctionNameOrVarName)||(0,o.getVarDescriptionByVarName)(i.model.selectedFunctionNameOrVarName)},relatedFunctionNames:function(){return(0,o.getSearchedFunctionNames)(i.model.keyword)}}),c(s(i),"actions",{setSelectedFunctionType:function(e){i.model.selectedFunctionType=e,i.model.selectedFunctionNameOrVarName=(BI.first((0,o.transformFormulaJSONs2FunctionNames)(i.model.selectedFunctionType))||{}).value},setSelectedFunctionName:function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],e=e.toUpperCase(),n=(0,o.getFunctionTypeByFunctionName)(e);BI.isNull(n)||(i.model.selectedFunctionType=n,i.model.selectedFunctionNameOrVarName=e,i.model.needScrollToView=t)},setKeyword:function(e){i.model.keyword=e},setSelectedVarName:function(e){i.model.selectedFunctionNameOrVarName=e}}),i}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.state=function(){return{selectedFunctionType:(0,o.getFunctionTypeByFunctionName)(a.DEFAULT_FUNCTION_NAME)||a.DEFAULT_FUNCTION_TYPE,selectedFunctionNameOrVarName:a.DEFAULT_FUNCTION_NAME,keyword:"",needScrollToView:!0}},n}(i.Model),c(n,"xtype","bi.model.formula_operating_panel"),i=n))||i;t.FormulaModel=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterEditor=void 0;var i=n(1),r=n(312),o=n(313),a=n(323),s=n(111);function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?c(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function u(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach(function(e){f(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function p(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function f(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,i.shortcut)()(i=(0,i.store)(r.ParameterModel)((n=function(r){var e;function t(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return f(d(t=r.call.apply(r,[this].concat(n))||this),"props",{height:200,title:"",headers:s.defaultHeaderItems,value:[]}),f(d(t),"parameterInputs",void 0),f(d(t),"model",void 0),f(d(t),"store",void 0),f(d(t),"watch",{parameters:function(){t.parameterInputs.populate(t.renderParameterInputs())},selectedId:function(e){t.parameterInputs.setValue(e)}}),t}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,p(n,e);var n=t.prototype;return n.render=function(){var t=this;return this.setDefaultValue(),{type:BI.VTapeLayout.xtype,items:[{el:this.renderHeader(),height:25},{el:{type:BI.CenterLayout.xtype,cls:"bi-border",items:[{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Parameter_Name")},{type:BI.Label.xtype,cls:"bi-border-left",text:BI.i18nText("BI-Basic_Parameter_Value")}]},height:25},{type:BI.ButtonGroup.xtype,cls:"bi-border",layouts:[{type:BI.VerticalLayout.xtype}],items:this.renderParameterInputs(),ref:function(e){t.parameterInputs=e}}]}},n.renderHeader=function(){var e=this,t=this.options,n=t.title,t=t.headers;return{type:a.ParameterHeader.xtype,title:n,headers:t,listeners:[{eventName:"EVENT_INSERT",action:function(){e.addItem({name:"",value:"",id:BI.UUID(),type:"String"})}},{eventName:"EVENT_DELETE",action:function(){e.removeSelectedItem()}},{eventName:"EVENT_MOVE_UP",action:function(){e.moveUp()}},{eventName:"EVENT_MOVE_DOWN",action:function(){e.moveDown()}},{eventName:"EVENT_REFRESH",action:function(){e.refresh(),e.fireEvent("EVENT_REFRESH")}}]}},n.getValue=function(){return this.model.parameters.map(function(e){return{name:e.name,value:e.value,type:e.type}})},n.setValue=function(e){this.store.setParameters(e.map(function(e){return h(h({},e),{},{id:BI.UUID()})}))},n.addItem=function(e){var t=e.name,t=void 0===t?"":t,n=e.value,n=void 0===n?"":n,e=e.type,e=void 0===e?"String":e;this.store.setParameters([].concat(l(this.model.parameters),[{name:t,value:n,type:e,id:BI.UUID()}]))},n.removeSelectedItem=function(){var t=this;this.model.selectedId?BI.Msg.confirm(BI.i18nText("BI-Basic_Prompt"),BI.i18nText("BI-Basic_Parameter_Delete_Confirm"),function(e){e&&t.store.removeSelectedParameter()}):BI.Msg.alert(BI.i18nText("BI-Basic_Prompt"),BI.i18nText("BI-Basic_Parameter_Delete_Alert"))},n.moveUp=function(){this.store.move("up")},n.moveDown=function(){this.store.move("down")},n.refresh=function(){this.setDefaultValue()},n.setDefaultValue=function(){var e=this.options.value;this.setValue(void 0===e?[]:e)},n.renderParameterInputs=function(){var t=this;return this.model.parameters.map(function(e){return{type:o.ParameterInput.xtype,inputName:e.name,inputValue:e.value,inputType:e.type,id:e.id,value:e.id,selected:e.id===t.model.selectedId,listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent("EVENT_CHANGE")}}]}})},t}(BI.Widget),f(n,"xtype","bi.parameter_editor"),i=n))||i)||i;t.ParameterEditor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterModel=void 0;var n=n(1);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,n.model)()((n=function(r){var e,t;function n(){for(var i,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a(o(i=r.call.apply(r,[this].concat(t))||this),"childContext",["selectedId","parameters"]),a(o(i),"actions",{setParameters:function(e){i.model.parameters=e},removeSelectedParameter:function(){i.setParameters(i.model.parameters.filter(function(e){return e.id!==i.model.selectedId}))},move:function(e){var t,n;i.model.selectedId&&(t=i.model.parameters.findIndex(function(e){return e.id===i.model.selectedId}),"up"===e&&0<t&&(n=i.model.parameters.splice(t,1)[0],i.model.parameters.splice(t-1,0,n)),"down"===e)&&t<i.model.parameters.length-1&&(n=i.model.parameters.splice(t,1)[0],i.model.parameters.splice(t+1,0,n))}}),i}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.state=function(){return{parameters:[],selectedId:""}},n}(n.Model),a(n,"xtype","bi.model.parameter_editor"),n=n))||n;t.ParameterModel=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterInput=void 0;var i=n(1),o=(n(314),n(14)),n=(n(321),n(322));function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function s(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,i.store)(n.ParameterInputModel)((i=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return s(a(e=r.call.apply(r,[this].concat(n))||this),"props",{inputName:"",inputValue:"",inputType:"String",height:22,id:"",baseCls:"parameter-editor-input",value:""}),s(a(e),"store",void 0),s(a(e),"model",void 0),s(a(e),"tab",void 0),s(a(e),"parameterName",void 0),s(a(e),"parameterValue",void 0),s(a(e),"iconCombo",void 0),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var t=this,e=this.options,n=e.inputName,i=(e.inputValue,this.options.inputType),r=this.options.id;return{type:BI.CenterLayout.xtype,cls:"bi-border",items:[{type:BI.Editor.xtype,height:22,allowBlank:!0,value:n,ref:function(e){t.parameterName=e},listeners:[{eventName:BI.TextEditor.EVENT_CHANGE,action:function(){n=t.parameterName.getValue(),t.tab.setSelect(n?i:"tip"),t.store.setParameterName(r,n),t.fireEvent(BI.TextEditor.EVENT_CHANGE)}},{eventName:BI.TextEditor.EVENT_FOCUS,action:function(){t.store.setSelectedId(r)}}]},{type:BI.HTapeLayout.xtype,items:[{type:BI.Tab.xtype,single:!0,showIndex:n?i:"tip",ref:function(e){t.tab=e},cardCreator:function(e){return t.renderInputs(e)}}]}]}},n.renderInputs=function(e){var n=this,t=this.options,i=t.inputValue,r=t.id;return"tip"===e?{type:BI.TextButton.xtype,cls:"bi-error bi-border-left",text:BI.i18nText("BI-Basic_Parameter_Please_Set_Parameter_Name"),handler:function(){n.parameterName.focus()}}:(t=(0,o.getInput)(e),{type:BI.HTapeLayout.xtype,items:[{el:{type:BI.IconCombo.xtype,cls:"bi-border-left bi-border-right",height:22,width:25,value:e,items:this.renderDownList(),ref:function(e){n.iconCombo=e},listeners:[{eventName:"EVENT_CHANGE",action:function(){n.tab.setSelect("tip");var e=n.iconCombo.getValue()[0];e&&n.tab.setSelect(e),n.store.setParameterValue(r,"",e),n.fireEvent("EVENT_CHANGE")}}]},width:25},{type:t,value:i,listeners:[{eventName:"EVENT_CHANGE",action:function(e){var t=n.iconCombo.getValue()[0];n.store.setParameterValue(r,e,t),n.fireEvent("EVENT_CHANGE")}},{eventName:"EVENT_FOCUS",action:function(){n.store.setSelectedId(r)}}]}]})},n.renderDownList=function(){return[{text:BI.i18nText("BI-Basic_Parameter_Type_String"),value:"String",iconCls:"parameter-string-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Int"),value:"Integer",iconCls:"parameter-int-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Number"),value:"Double",iconCls:"parameter-double-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Date"),value:"Date",iconCls:"parameter-date-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Boolean"),value:"Boolean",iconCls:"parameter-boolean-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Formula"),value:"Formula",iconCls:"parameter-formula-font"}]},t}(BI.BasicButton),s(i,"xtype","bi.parameter_editor.parameter_input"),n=i))||n)||n;t.ParameterInput=i},function(e,t,n){"use strict";n(315),n(316),n(317),n(318),n(319),n(320)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputBoolean=void 0;var i=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,n.input)("Boolean")((i=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),a(o(e),"hasSelected",void 0),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var t=this,e=this.options.value;return this.hasSelected="true"===e,{type:BI.MultiSelectItem.xtype,width:80,selected:this.hasSelected,text:"true",ref:function(e){t.input=e},listeners:[{eventName:BI.MultiSelectItem.EVENT_CHANGE,action:function(){t.hasSelected=!t.hasSelected,t.fireEvent("EVENT_CHANGE",t.hasSelected)}}]}},n.doClick=function(){this.fireEvent("EVENT_FOCUS")},t}(BI.BasicButton),a(i,"xtype","bi.parameter_editor.parameter_input.boolean"),n=i))||n)||n;t.InputBoolean=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputDate=void 0;var i=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,n.input)("Date")((i=function(r){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var i=this,e=this.options.value.split("-");return{type:BI.DynamicDateCombo.xtype,height:22,allowBlank:!0,value:3===e.length?{year:e[0],month:e[1],day:e[2]}:"",ref:function(e){i.input=e},listeners:[{eventName:BI.DynamicDateCombo.EVENT_CONFIRM,action:function(){var e=i.input.getValue().value,t=e.day,n=e.month,e=e.year;i.fireEvent("EVENT_CHANGE","".concat(e,"-").concat(n,"-").concat(t))}},{eventName:BI.DynamicDateCombo.EVENT_FOCUS,action:function(){i.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(i,"xtype","bi.parameter_editor.parameter_input.date"),n=i))||n)||n;t.InputDate=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputInt=void 0;var i=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,n.input)("Integer")((i=function(r){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},validationChecker:function(e){return BI.isInteger(e)},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(i,"xtype","bi.parameter_editor.parameter_input.int"),n=i))||n)||n;t.InputInt=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputDouble=void 0;var i=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,n.input)("Double")((i=function(r){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},validationChecker:function(e){return BI.isNumeric(e)},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(i,"xtype","bi.parameter_editor.parameter_input.double"),n=i))||n)||n;t.InputDouble=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputString=void 0;var i=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,n.input)("String")((i=function(r){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(i,"xtype","bi.parameter_editor.parameter_input.string"),n=i))||n)||n;t.InputString=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputFormula=void 0;var i=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,i.shortcut)()(n=(0,n.input)("Formula")((i=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(o(e=r.call.apply(r,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.mounted=function(){},n.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},t}(BI.Widget),a(i,"xtype","bi.parameter_editor.parameter_input.formula"),n=i))||n)||n;t.InputFormula=i},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterInputModel=void 0;var n=n(1);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,n.model)()((n=function(r){var e,t;function n(){for(var i,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a(o(i=r.call.apply(r,[this].concat(t))||this),"context",["selectedId","parameters"]),a(o(i),"actions",{setSelectedId:function(e){i.model.selectedId=e},setParameterName:function(e,t){e=i.getParameter(e);e&&(e.name=t)},setParameterValue:function(e,t,n){e=i.getParameter(e);e&&(e.value=t,e.type=n)}}),i}return t=r,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.getParameter=function(t){return this.model.parameters.find(function(e){return e.id===t})},n}(n.Model),a(n,"xtype","bi.model.parameter_editor.parameter_input"),n=n))||n;t.ParameterInputModel=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterHeader=void 0;var i=n(1),o=n(111);function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,i.shortcut)()((n=function(r){var e;function t(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e=r.call.apply(r,[this].concat(n))||this),"props",{title:"",headers:o.defaultHeaderItems}),e}e=r,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var e=this.options.title;return{type:BI.LeftRightVerticalAdaptLayout.xtype,items:{left:[{type:BI.Label.xtype,lgap:2,text:e,textAlign:"left"}],right:this.renderItem()}}},n.renderItem=function(){var n=this;return this.options.headers.map(function(t){var e;return BI.isString(t)?(e=o.headerItemsData.find(function(e){return e.type===t}))?{type:BI.IconButton.xtype,cls:e.cls,width:25,title:BI.i18nText(e.title),handler:function(){n.fireEvent(e.event)}}:{type:"bi.default"}:t})},t}(BI.Widget),a(n,"xtype","bi.parameter_editor.header"),i=n))||i;t.ParameterHeader=n},function(e,t,n){"use strict";function i(e,t){var n=e.requestUrl,i=e.contextPath,r=e.webSocketNameSpace,o=e.query,a=e.options,i="".concat("/"===i?"":i,"/websocket");try{var s=io("".concat(n).concat(location.port?":".concat(location.port):"").concat(r),BI.extend({query:o,path:i,transports:["websocket","polling"],timeout:15e3},a)),l=!0;return s.on("connect_error",function(){s.off("connect_error"),s.off("connect"),l&&u(s,e,t)}),s.on("connect",function(){l=!1,t("success")}),s}catch(c){throw new Error(c)}}function u(t,e,n){var i=e.webSocketPort,r=e.requestUrl,o=e.webSocketNameSpace,a=e.query,s=e.webSocketContextName,e=e.options;try{return BI.isNull(t)?t=io("".concat(r,":").concat(i.shift()).concat(o),BI.extend({query:a,path:s,transports:["polling","websocket"],timeout:5e3},e)):(t.io.opts.path=s,t.io.opts.query=a,t.io.opts.transports=["polling","websocket"],t.io.uri="".concat(r,":").concat(i.shift()).concat(o),t.io.connect(function(){})),t.on("connect_error",function(){var e;e=t.io,BI.isEmptyArray(i)?n("fail"):(e.uri="".concat(r,":").concat(i.shift()).concat(o),e.connect(function(){}))}),t.on("connect",function(){n("success")}),t}catch(l){throw new Error(l)}}Object.defineProperty(t,"__esModule",{value:!0}),t.initSocket=function(e,t){t=BI.isFunction(t)?t:BI.emptyFn;if(e.useJavaxWebSocket)return i(e,t);return u(null,e,t)}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n(208)(n(390))},function(e,t){e.exports='// version 5.42.2\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n// This is CodeMirror (https://codemirror.net), a code editor\n// implemented in JavaScript on top of the browser\'s DOM.\n//\n// You can find some technical background for some of the code below\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\n\n(function (global, factory) {\n    typeof exports === \'object\' && typeof module !== \'undefined\' ? module.exports = factory() :\n        typeof define === \'function\' && define.amd ? define(factory) :\n            (BI.CodeMirror = BI.CodeMirror || factory());\n}(this, (function () { \'use strict\';\n\n    // Kludges for bugs and behavior differences that can\'t be feature\n    // detected are enabled based on userAgent etc sniffing.\n    var userAgent = navigator.userAgent;\n    var platform = navigator.platform;\n\n    var gecko = /gecko\\/\\d/i.test(userAgent);\n    var ie_upto10 = /MSIE \\d/.test(userAgent);\n    var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(userAgent);\n    var edge = /Edge\\/(\\d+)/.exec(userAgent);\n    var ie = ie_upto10 || ie_11up || edge;\n    var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : +(edge || ie_11up)[1]);\n    var webkit = !edge && /WebKit\\//.test(userAgent);\n    var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(userAgent);\n    var chrome = !edge && /Chrome\\//.test(userAgent);\n    var presto = /Opera\\//.test(userAgent);\n    var safari = /Apple Computer/.test(navigator.vendor);\n    var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(userAgent);\n    var phantom = /PhantomJS/.test(userAgent);\n\n    var ios = !edge && /AppleWebKit/.test(userAgent) && /Mobile\\/\\w+/.test(userAgent);\n    var android = /Android/.test(userAgent);\n    // This is woefully incomplete. Suggestions for alternative methods welcome.\n    var mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);\n    var mac = ios || /Mac/.test(platform);\n    var chromeOS = /\\bCrOS\\b/.test(userAgent);\n    var windows = /win/i.test(platform);\n\n    var presto_version = presto && userAgent.match(/Version\\/(\\d*\\.\\d*)/);\n    if (presto_version) { presto_version = Number(presto_version[1]); }\n    if (presto_version && presto_version >= 15) { presto = false; webkit = true; }\n    // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\n    var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\n    var captureRightClick = gecko || (ie && ie_version >= 9);\n\n    function classTest(cls) { return new RegExp("(^|\\\\s)" + cls + "(?:$|\\\\s)\\\\s*") }\n\n    var rmClass = function(node, cls) {\n        var current = node.className;\n        var match = classTest(cls).exec(current);\n        if (match) {\n            var after = current.slice(match.index + match[0].length);\n            node.className = current.slice(0, match.index) + (after ? match[1] + after : "");\n        }\n    };\n\n    function removeChildren(e) {\n        for (var count = e.childNodes.length; count > 0; --count)\n        { e.removeChild(e.firstChild); }\n        return e\n    }\n\n    function removeChildrenAndAdd(parent, e) {\n        return removeChildren(parent).appendChild(e)\n    }\n\n    function elt(tag, content, className, style) {\n        var e = document.createElement(tag);\n        if (className) { e.className = className; }\n        if (style) { e.style.cssText = style; }\n        if (typeof content == "string") { e.appendChild(document.createTextNode(content)); }\n        else if (content) { for (var i = 0; i < content.length; ++i) { e.appendChild(content[i]); } }\n        return e\n    }\n    // wrapper for elt, which removes the elt from the accessibility tree\n    function eltP(tag, content, className, style) {\n        var e = elt(tag, content, className, style);\n        e.setAttribute("role", "presentation");\n        return e\n    }\n\n    var range;\n    if (document.createRange) { range = function(node, start, end, endNode) {\n        var r = document.createRange();\n        r.setEnd(endNode || node, end);\n        r.setStart(node, start);\n        return r\n    }; }\n    else { range = function(node, start, end) {\n        var r = document.body.createTextRange();\n        try { r.moveToElementText(node.parentNode); }\n        catch(e) { return r }\n        r.collapse(true);\n        r.moveEnd("character", end);\n        r.moveStart("character", start);\n        return r\n    }; }\n\n    function contains(parent, child) {\n        if (child.nodeType == 3) // Android browser always returns false when child is a textnode\n        { child = child.parentNode; }\n        if (parent.contains)\n        { return parent.contains(child) }\n        do {\n            if (child.nodeType == 11) { child = child.host; }\n            if (child == parent) { return true }\n        } while (child = child.parentNode)\n    }\n\n    function activeElt() {\n        // IE and Edge may throw an "Unspecified Error" when accessing document.activeElement.\n        // IE < 10 will throw when accessed while the page is loading or in an iframe.\n        // IE > 9 and Edge will throw when accessed in an iframe if document.body is unavailable.\n        var activeElement;\n        try {\n            activeElement = document.activeElement;\n        } catch(e) {\n            activeElement = document.body || null;\n        }\n        while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)\n        { activeElement = activeElement.shadowRoot.activeElement; }\n        return activeElement\n    }\n\n    function addClass(node, cls) {\n        var current = node.className;\n        if (!classTest(cls).test(current)) { node.className += (current ? " " : "") + cls; }\n    }\n    function joinClasses(a, b) {\n        var as = a.split(" ");\n        for (var i = 0; i < as.length; i++)\n        { if (as[i] && !classTest(as[i]).test(b)) { b += " " + as[i]; } }\n        return b\n    }\n\n    var selectInput = function(node) { node.select(); };\n    if (ios) // Mobile Safari apparently has a bug where select() is broken.\n    { selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; }; }\n    else if (ie) // Suppress mysterious IE10 errors\n    { selectInput = function(node) { try { node.select(); } catch(_e) {} }; }\n\n    function bind(f) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return function(){return f.apply(null, args)}\n    }\n\n    function copyObj(obj, target, overwrite) {\n        if (!target) { target = {}; }\n        for (var prop in obj)\n        { if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\n        { target[prop] = obj[prop]; } }\n        return target\n    }\n\n    // Counts the column offset in a string, taking tabs into account.\n    // Used mostly to find indentation.\n    function countColumn(string, end, tabSize, startIndex, startValue) {\n        if (end == null) {\n            end = string.search(/[^\\s\\u00a0]/);\n            if (end == -1) { end = string.length; }\n        }\n        for (var i = startIndex || 0, n = startValue || 0;;) {\n            var nextTab = string.indexOf("\\t", i);\n            if (nextTab < 0 || nextTab >= end)\n            { return n + (end - i) }\n            n += nextTab - i;\n            n += tabSize - (n % tabSize);\n            i = nextTab + 1;\n        }\n    }\n\n    var Delayed = function() {this.id = null;};\n    Delayed.prototype.set = function (ms, f) {\n        clearTimeout(this.id);\n        this.id = setTimeout(f, ms);\n    };\n\n    function indexOf(array, elt) {\n        for (var i = 0; i < array.length; ++i)\n        { if (array[i] == elt) { return i } }\n        return -1\n    }\n\n    // Number of pixels added to scroller and sizer to hide scrollbar\n    var scrollerGap = 30;\n\n    // Returned or thrown by various protocols to signal \'I\'m not\n    // handling this\'.\n    var Pass = {toString: function(){return "CodeMirror.Pass"}};\n\n    // Reused option objects for setSelection & friends\n    var sel_dontScroll = {scroll: false}, sel_mouse = {origin: "*mouse"}, sel_move = {origin: "+move"};\n\n    // The inverse of countColumn -- find the offset that corresponds to\n    // a particular column.\n    function findColumn(string, goal, tabSize) {\n        for (var pos = 0, col = 0;;) {\n            var nextTab = string.indexOf("\\t", pos);\n            if (nextTab == -1) { nextTab = string.length; }\n            var skipped = nextTab - pos;\n            if (nextTab == string.length || col + skipped >= goal)\n            { return pos + Math.min(skipped, goal - col) }\n            col += nextTab - pos;\n            col += tabSize - (col % tabSize);\n            pos = nextTab + 1;\n            if (col >= goal) { return pos }\n        }\n    }\n\n    var spaceStrs = [""];\n    function spaceStr(n) {\n        while (spaceStrs.length <= n)\n        { spaceStrs.push(lst(spaceStrs) + " "); }\n        return spaceStrs[n]\n    }\n\n    function lst(arr) { return arr[arr.length-1] }\n\n    function map(array, f) {\n        var out = [];\n        for (var i = 0; i < array.length; i++) { out[i] = f(array[i], i); }\n        return out\n    }\n\n    function insertSorted(array, value, score) {\n        var pos = 0, priority = score(value);\n        while (pos < array.length && score(array[pos]) <= priority) { pos++; }\n        array.splice(pos, 0, value);\n    }\n\n    function nothing() {}\n\n    function createObj(base, props) {\n        var inst;\n        if (Object.create) {\n            inst = Object.create(base);\n        } else {\n            nothing.prototype = base;\n            inst = new nothing();\n        }\n        if (props) { copyObj(props, inst); }\n        return inst\n    }\n\n    var nonASCIISingleCaseWordChar = /[\\u00df\\u0587\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\n    function isWordCharBasic(ch) {\n        return /\\w/.test(ch) || ch > "\\x80" &&\n            (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch))\n    }\n    function isWordChar(ch, helper) {\n        if (!helper) { return isWordCharBasic(ch) }\n        if (helper.source.indexOf("\\\\w") > -1 && isWordCharBasic(ch)) { return true }\n        return helper.test(ch)\n    }\n\n    function isEmpty(obj) {\n        for (var n in obj) { if (obj.hasOwnProperty(n) && obj[n]) { return false } }\n        return true\n    }\n\n    // Extending unicode characters. A series of a non-extending char +\n    // any number of extending chars is treated as a single unit as far\n    // as editing and measuring is concerned. This is not fully correct,\n    // since some scripts/fonts/browsers also treat other configurations\n    // of code points as a group.\n    var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\n    function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch) }\n\n    // Returns a number from the range [`0`; `str.length`] unless `pos` is outside that range.\n    function skipExtendingChars(str, pos, dir) {\n        while ((dir < 0 ? pos > 0 : pos < str.length) && isExtendingChar(str.charAt(pos))) { pos += dir; }\n        return pos\n    }\n\n    // Returns the value from the range [`from`; `to`] that satisfies\n    // `pred` and is closest to `from`. Assumes that at least `to`\n    // satisfies `pred`. Supports `from` being greater than `to`.\n    function findFirst(pred, from, to) {\n        // At any point we are certain `to` satisfies `pred`, don\'t know\n        // whether `from` does.\n        var dir = from > to ? -1 : 1;\n        for (;;) {\n            if (from == to) { return from }\n            var midF = (from + to) / 2, mid = dir < 0 ? Math.ceil(midF) : Math.floor(midF);\n            if (mid == from) { return pred(mid) ? from : to }\n            if (pred(mid)) { to = mid; }\n            else { from = mid + dir; }\n        }\n    }\n\n    // The display handles the DOM integration, both for input reading\n    // and content drawing. It holds references to DOM nodes and\n    // display-related state.\n\n    function Display(place, doc, input) {\n        var d = this;\n        this.input = input;\n\n        // Covers bottom-right square when both scrollbars are present.\n        d.scrollbarFiller = elt("div", null, "CodeMirror-scrollbar-filler");\n        d.scrollbarFiller.setAttribute("cm-not-content", "true");\n        // Covers bottom of gutter when coverGutterNextToScrollbar is on\n        // and h scrollbar is present.\n        d.gutterFiller = elt("div", null, "CodeMirror-gutter-filler");\n        d.gutterFiller.setAttribute("cm-not-content", "true");\n        // Will contain the actual code, positioned to cover the viewport.\n        d.lineDiv = eltP("div", null, "CodeMirror-code");\n        // Elements are added to these to represent selection and cursors.\n        d.selectionDiv = elt("div", null, null, "position: relative; z-index: 1");\n        d.cursorDiv = elt("div", null, "CodeMirror-cursors");\n        // A visibility: hidden element used to find the size of things.\n        d.measure = elt("div", null, "CodeMirror-measure");\n        // When lines outside of the viewport are measured, they are drawn in this.\n        d.lineMeasure = elt("div", null, "CodeMirror-measure");\n        // Wraps everything that needs to exist inside the vertically-padded coordinate system\n        d.lineSpace = eltP("div", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\n            null, "position: relative; outline: none");\n        var lines = eltP("div", [d.lineSpace], "CodeMirror-lines");\n        // Moved around its parent to cover visible view.\n        d.mover = elt("div", [lines], null, "position: relative");\n        // Set to the height of the document, allowing scrolling.\n        d.sizer = elt("div", [d.mover], "CodeMirror-sizer");\n        d.sizerWidth = null;\n        // Behavior of elts with overflow: auto and padding is\n        // inconsistent across browsers. This is used to ensure the\n        // scrollable area is big enough.\n        d.heightForcer = elt("div", null, null, "position: absolute; height: " + scrollerGap + "px; width: 1px;");\n        // Will contain the gutters, if any.\n        d.gutters = elt("div", null, "CodeMirror-gutters");\n        d.lineGutter = null;\n        // Actual scrollable element.\n        d.scroller = elt("div", [d.sizer, d.heightForcer, d.gutters], "CodeMirror-scroll");\n        d.scroller.setAttribute("tabIndex", "-1");\n        // The element in which the editor lives.\n        d.wrapper = elt("div", [d.scrollbarFiller, d.gutterFiller, d.scroller], "CodeMirror");\n\n        // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\n        if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\n        if (!webkit && !(gecko && mobile)) { d.scroller.draggable = true; }\n\n        if (place) {\n            if (place.appendChild) { place.appendChild(d.wrapper); }\n            else { place(d.wrapper); }\n        }\n\n        // Current rendered range (may be bigger than the view window).\n        d.viewFrom = d.viewTo = doc.first;\n        d.reportedViewFrom = d.reportedViewTo = doc.first;\n        // Information about the rendered lines.\n        d.view = [];\n        d.renderedView = null;\n        // Holds info about a single rendered line when it was rendered\n        // for measurement, while not in view.\n        d.externalMeasured = null;\n        // Empty space (in pixels) above the view\n        d.viewOffset = 0;\n        d.lastWrapHeight = d.lastWrapWidth = 0;\n        d.updateLineNumbers = null;\n\n        d.nativeBarWidth = d.barHeight = d.barWidth = 0;\n        d.scrollbarsClipped = false;\n\n        // Used to only resize the line number gutter when necessary (when\n        // the amount of lines crosses a boundary that makes its width change)\n        d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\n        // Set to true when a non-horizontal-scrolling line widget is\n        // added. As an optimization, line widget aligning is skipped when\n        // this is false.\n        d.alignWidgets = false;\n\n        d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n\n        // Tracks the maximum line length so that the horizontal scrollbar\n        // can be kept static when scrolling.\n        d.maxLine = null;\n        d.maxLineLength = 0;\n        d.maxLineChanged = false;\n\n        // Used for measuring wheel scrolling granularity\n        d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\n\n        // True when shift is held down.\n        d.shift = false;\n\n        // Used to track whether anything happened since the context menu\n        // was opened.\n        d.selForContextMenu = null;\n\n        d.activeTouch = null;\n\n        input.init(d);\n    }\n\n    // Find the line object corresponding to the given line number.\n    function getLine(doc, n) {\n        n -= doc.first;\n        if (n < 0 || n >= doc.size) { throw new Error("There is no line " + (n + doc.first) + " in the document.") }\n        var chunk = doc;\n        while (!chunk.lines) {\n            for (var i = 0;; ++i) {\n                var child = chunk.children[i], sz = child.chunkSize();\n                if (n < sz) { chunk = child; break }\n                n -= sz;\n            }\n        }\n        return chunk.lines[n]\n    }\n\n    // Get the part of a document between two positions, as an array of\n    // strings.\n    function getBetween(doc, start, end) {\n        var out = [], n = start.line;\n        doc.iter(start.line, end.line + 1, function (line) {\n            var text = line.text;\n            if (n == end.line) { text = text.slice(0, end.ch); }\n            if (n == start.line) { text = text.slice(start.ch); }\n            out.push(text);\n            ++n;\n        });\n        return out\n    }\n\n    function getLines(doc, from, to, lineFilter) {\n        var out = [];\n        doc.iter(from, to, function (line) {\n            var text = line.text;\n            if (lineFilter) {\n                text = lineFilter(line);\n            }\n            out.push(text);\n        });\n        return out;\n    }\n\n    // Update the height of a line, propagating the height change\n    // upwards to parent nodes.\n    function updateLineHeight(line, height) {\n        var diff = height - line.height;\n        if (diff) { for (var n = line; n; n = n.parent) { n.height += diff; } }\n    }\n\n    // Given a line object, find its line number by walking up through\n    // its parent links.\n    function lineNo(line) {\n        if (line.parent == null) { return null }\n        var cur = line.parent, no = indexOf(cur.lines, line);\n        for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\n            for (var i = 0;; ++i) {\n                if (chunk.children[i] == cur) { break }\n                no += chunk.children[i].chunkSize();\n            }\n        }\n        return no + cur.first\n    }\n\n    // Find the line at the given vertical position, using the height\n    // information in the document tree.\n    function lineAtHeight(chunk, h) {\n        var n = chunk.first;\n        outer: do {\n            for (var i$1 = 0; i$1 < chunk.children.length; ++i$1) {\n                var child = chunk.children[i$1], ch = child.height;\n                if (h < ch) { chunk = child; continue outer }\n                h -= ch;\n                n += child.chunkSize();\n            }\n            return n\n        } while (!chunk.lines)\n        var i = 0;\n        for (; i < chunk.lines.length; ++i) {\n            var line = chunk.lines[i], lh = line.height;\n            if (h < lh) { break }\n            h -= lh;\n        }\n        return n + i\n    }\n\n    function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size}\n\n    function lineNumberFor(options, i) {\n        return String(options.lineNumberFormatter(i + options.firstLineNumber))\n    }\n\n    // A Pos instance represents a position within the text.\n    function Pos(line, ch, sticky) {\n        if ( sticky === void 0 ) sticky = null;\n\n        if (!(this instanceof Pos)) { return new Pos(line, ch, sticky) }\n        this.line = line;\n        this.ch = ch;\n        this.sticky = sticky;\n    }\n\n    // Compare two positions, return 0 if they are the same, a negative\n    // number when a is less, and a positive number otherwise.\n    function cmp(a, b) { return a.line - b.line || a.ch - b.ch }\n\n    function equalCursorPos(a, b) { return a.sticky == b.sticky && cmp(a, b) == 0 }\n\n    function copyPos(x) {return Pos(x.line, x.ch)}\n    function maxPos(a, b) { return cmp(a, b) < 0 ? b : a }\n    function minPos(a, b) { return cmp(a, b) < 0 ? a : b }\n\n    // Most of the external API clips given positions to make sure they\n    // actually exist within the document.\n    function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1))}\n    function clipPos(doc, pos) {\n        if (pos.line < doc.first) { return Pos(doc.first, 0) }\n        var last = doc.first + doc.size - 1;\n        if (pos.line > last) { return Pos(last, getLine(doc, last).text.length) }\n        return clipToLen(pos, getLine(doc, pos.line).text.length)\n    }\n    function clipToLen(pos, linelen) {\n        var ch = pos.ch;\n        if (ch == null || ch > linelen) { return Pos(pos.line, linelen) }\n        else if (ch < 0) { return Pos(pos.line, 0) }\n        else { return pos }\n    }\n    function clipPosArray(doc, array) {\n        var out = [];\n        for (var i = 0; i < array.length; i++) { out[i] = clipPos(doc, array[i]); }\n        return out\n    }\n\n    // Optimize some code when these features are not used.\n    var sawReadOnlySpans = false, sawCollapsedSpans = false;\n\n    function seeReadOnlySpans() {\n        sawReadOnlySpans = true;\n    }\n\n    function seeCollapsedSpans() {\n        sawCollapsedSpans = true;\n    }\n\n    // TEXTMARKER SPANS\n\n    function MarkedSpan(marker, from, to) {\n        this.marker = marker;\n        this.from = from; this.to = to;\n    }\n\n    // Search an array of spans for a span matching the given marker.\n    function getMarkedSpanFor(spans, marker) {\n        if (spans) { for (var i = 0; i < spans.length; ++i) {\n            var span = spans[i];\n            if (span.marker == marker) { return span }\n        } }\n    }\n    // Remove a span from an array, returning undefined if no spans are\n    // left (we don\'t store arrays for lines without spans).\n    function removeMarkedSpan(spans, span) {\n        var r;\n        for (var i = 0; i < spans.length; ++i)\n        { if (spans[i] != span) { (r || (r = [])).push(spans[i]); } }\n        return r\n    }\n    // Add a span to a line.\n    function addMarkedSpan(line, span) {\n        line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\n        span.marker.attachLine(line);\n    }\n\n    // Used for the algorithm that adjusts markers for a change in the\n    // document. These functions cut an array of spans at a given\n    // character position, returning an array of remaining chunks (or\n    // undefined if nothing remains).\n    function markedSpansBefore(old, startCh, isInsert) {\n        var nw;\n        if (old) { for (var i = 0; i < old.length; ++i) {\n            var span = old[i], marker = span.marker;\n            var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\n            if (startsBefore || span.from == startCh && marker.type == "bookmark" && (!isInsert || !span.marker.insertLeft)) {\n                var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh)\n                ;(nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\n            }\n        } }\n        return nw\n    }\n    function markedSpansAfter(old, endCh, isInsert) {\n        var nw;\n        if (old) { for (var i = 0; i < old.length; ++i) {\n            var span = old[i], marker = span.marker;\n            var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\n            if (endsAfter || span.from == endCh && marker.type == "bookmark" && (!isInsert || span.marker.insertLeft)) {\n                var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh)\n                ;(nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\n                    span.to == null ? null : span.to - endCh));\n            }\n        } }\n        return nw\n    }\n\n    // Given a change object, compute the new set of marker spans that\n    // cover the line in which the change took place. Removes spans\n    // entirely within the change, reconnects spans belonging to the\n    // same marker that appear on both sides of the change, and cuts off\n    // spans partially within the change. Returns an array of span\n    // arrays with one element for each line in (after) the change.\n    function stretchSpansOverChange(doc, change) {\n        if (change.full) { return null }\n        var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\n        var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\n        if (!oldFirst && !oldLast) { return null }\n\n        var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\n        // Get the spans that \'stick out\' on both sides\n        var first = markedSpansBefore(oldFirst, startCh, isInsert);\n        var last = markedSpansAfter(oldLast, endCh, isInsert);\n\n        // Next, merge those two ends\n        var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\n        if (first) {\n            // Fix up .to properties of first\n            for (var i = 0; i < first.length; ++i) {\n                var span = first[i];\n                if (span.to == null) {\n                    var found = getMarkedSpanFor(last, span.marker);\n                    if (!found) { span.to = startCh; }\n                    else if (sameLine) { span.to = found.to == null ? null : found.to + offset; }\n                }\n            }\n        }\n        if (last) {\n            // Fix up .from in last (or move them into first in case of sameLine)\n            for (var i$1 = 0; i$1 < last.length; ++i$1) {\n                var span$1 = last[i$1];\n                if (span$1.to != null) { span$1.to += offset; }\n                if (span$1.from == null) {\n                    var found$1 = getMarkedSpanFor(first, span$1.marker);\n                    if (!found$1) {\n                        span$1.from = offset;\n                        if (sameLine) { (first || (first = [])).push(span$1); }\n                    }\n                } else {\n                    span$1.from += offset;\n                    if (sameLine) { (first || (first = [])).push(span$1); }\n                }\n            }\n        }\n        // Make sure we didn\'t create any zero-length spans\n        if (first) { first = clearEmptySpans(first); }\n        if (last && last != first) { last = clearEmptySpans(last); }\n\n        var newMarkers = [first];\n        if (!sameLine) {\n            // Fill gap with whole-line-spans\n            var gap = change.text.length - 2, gapMarkers;\n            if (gap > 0 && first)\n            { for (var i$2 = 0; i$2 < first.length; ++i$2)\n            { if (first[i$2].to == null)\n            { (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i$2].marker, null, null)); } } }\n            for (var i$3 = 0; i$3 < gap; ++i$3)\n            { newMarkers.push(gapMarkers); }\n            newMarkers.push(last);\n        }\n        return newMarkers\n    }\n\n    // Remove spans that are empty and don\'t have a clearWhenEmpty\n    // option of false.\n    function clearEmptySpans(spans) {\n        for (var i = 0; i < spans.length; ++i) {\n            var span = spans[i];\n            if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\n            { spans.splice(i--, 1); }\n        }\n        if (!spans.length) { return null }\n        return spans\n    }\n\n    // Used to \'clip\' out readOnly ranges when making a change.\n    function removeReadOnlyRanges(doc, from, to) {\n        var markers = null;\n        doc.iter(from.line, to.line + 1, function (line) {\n            if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {\n                var mark = line.markedSpans[i].marker;\n                if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\n                { (markers || (markers = [])).push(mark); }\n            } }\n        });\n        if (!markers) { return null }\n        var parts = [{from: from, to: to}];\n        for (var i = 0; i < markers.length; ++i) {\n            var mk = markers[i], m = mk.find(0);\n            for (var j = 0; j < parts.length; ++j) {\n                var p = parts[j];\n                if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) { continue }\n                var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\n                if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\n                { newParts.push({from: p.from, to: m.from}); }\n                if (dto > 0 || !mk.inclusiveRight && !dto)\n                { newParts.push({from: m.to, to: p.to}); }\n                parts.splice.apply(parts, newParts);\n                j += newParts.length - 3;\n            }\n        }\n        return parts\n    }\n\n    // Connect or disconnect spans from a line.\n    function detachMarkedSpans(line) {\n        var spans = line.markedSpans;\n        if (!spans) { return }\n        for (var i = 0; i < spans.length; ++i)\n        { spans[i].marker.detachLine(line); }\n        line.markedSpans = null;\n    }\n    function attachMarkedSpans(line, spans) {\n        if (!spans) { return }\n        for (var i = 0; i < spans.length; ++i)\n        { spans[i].marker.attachLine(line); }\n        line.markedSpans = spans;\n    }\n\n    // Helpers used when computing which overlapping collapsed span\n    // counts as the larger one.\n    function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0 }\n    function extraRight(marker) { return marker.inclusiveRight ? 1 : 0 }\n\n    // Returns a number indicating which of two overlapping collapsed\n    // spans is larger (and thus includes the other). Falls back to\n    // comparing ids when the spans cover exactly the same range.\n    function compareCollapsedMarkers(a, b) {\n        var lenDiff = a.lines.length - b.lines.length;\n        if (lenDiff != 0) { return lenDiff }\n        var aPos = a.find(), bPos = b.find();\n        var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\n        if (fromCmp) { return -fromCmp }\n        var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\n        if (toCmp) { return toCmp }\n        return b.id - a.id\n    }\n\n    // Find out whether a line ends or starts in a collapsed span. If\n    // so, return the marker for that span.\n    function collapsedSpanAtSide(line, start) {\n        var sps = sawCollapsedSpans && line.markedSpans, found;\n        if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {\n            sp = sps[i];\n            if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\n                (!found || compareCollapsedMarkers(found, sp.marker) < 0))\n            { found = sp.marker; }\n        } }\n        return found\n    }\n    function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true) }\n    function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false) }\n\n    function collapsedSpanAround(line, ch) {\n        var sps = sawCollapsedSpans && line.markedSpans, found;\n        if (sps) { for (var i = 0; i < sps.length; ++i) {\n            var sp = sps[i];\n            if (sp.marker.collapsed && (sp.from == null || sp.from < ch) && (sp.to == null || sp.to > ch) &&\n                (!found || compareCollapsedMarkers(found, sp.marker) < 0)) { found = sp.marker; }\n        } }\n        return found\n    }\n\n    // Test whether there exists a collapsed span that partially\n    // overlaps (covers the start or end, but not both) of a new span.\n    // Such overlap is not allowed.\n    function conflictingCollapsedRange(doc, lineNo$$1, from, to, marker) {\n        var line = getLine(doc, lineNo$$1);\n        var sps = sawCollapsedSpans && line.markedSpans;\n        if (sps) { for (var i = 0; i < sps.length; ++i) {\n            var sp = sps[i];\n            if (!sp.marker.collapsed) { continue }\n            var found = sp.marker.find(0);\n            var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\n            var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\n            if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) { continue }\n            if (fromCmp <= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.to, from) >= 0 : cmp(found.to, from) > 0) ||\n                fromCmp >= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.from, to) <= 0 : cmp(found.from, to) < 0))\n            { return true }\n        } }\n    }\n\n    // A visual line is a line as drawn on the screen. Folding, for\n    // example, can cause multiple logical lines to appear on the same\n    // visual line. This finds the start of the visual line that the\n    // given line is part of (usually that is the line itself).\n    function visualLine(line) {\n        var merged;\n        while (merged = collapsedSpanAtStart(line))\n        { line = merged.find(-1, true).line; }\n        return line\n    }\n\n    function visualLineEnd(line) {\n        var merged;\n        while (merged = collapsedSpanAtEnd(line))\n        { line = merged.find(1, true).line; }\n        return line\n    }\n\n    // Returns an array of logical lines that continue the visual line\n    // started by the argument, or undefined if there are no such lines.\n    function visualLineContinued(line) {\n        var merged, lines;\n        while (merged = collapsedSpanAtEnd(line)) {\n            line = merged.find(1, true).line\n            ;(lines || (lines = [])).push(line);\n        }\n        return lines\n    }\n\n    // Get the line number of the start of the visual line that the\n    // given line number is part of.\n    function visualLineNo(doc, lineN) {\n        var line = getLine(doc, lineN), vis = visualLine(line);\n        if (line == vis) { return lineN }\n        return lineNo(vis)\n    }\n\n    // Get the line number of the start of the next visual line after\n    // the given line.\n    function visualLineEndNo(doc, lineN) {\n        if (lineN > doc.lastLine()) { return lineN }\n        var line = getLine(doc, lineN), merged;\n        if (!lineIsHidden(doc, line)) { return lineN }\n        while (merged = collapsedSpanAtEnd(line))\n        { line = merged.find(1, true).line; }\n        return lineNo(line) + 1\n    }\n\n    // Compute whether a line is hidden. Lines count as hidden when they\n    // are part of a visual line that starts with another line, or when\n    // they are entirely covered by collapsed, non-widget span.\n    function lineIsHidden(doc, line) {\n        var sps = sawCollapsedSpans && line.markedSpans;\n        if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {\n            sp = sps[i];\n            if (!sp.marker.collapsed) { continue }\n            if (sp.from == null) { return true }\n            if (sp.marker.widgetNode) { continue }\n            if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\n            { return true }\n        } }\n    }\n    function lineIsHiddenInner(doc, line, span) {\n        if (span.to == null) {\n            var end = span.marker.find(1, true);\n            return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker))\n        }\n        if (span.marker.inclusiveRight && span.to == line.text.length)\n        { return true }\n        for (var sp = (void 0), i = 0; i < line.markedSpans.length; ++i) {\n            sp = line.markedSpans[i];\n            if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\n                (sp.to == null || sp.to != span.from) &&\n                (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\n                lineIsHiddenInner(doc, line, sp)) { return true }\n        }\n    }\n\n    // Find the height above the given line.\n    function heightAtLine(lineObj) {\n        lineObj = visualLine(lineObj);\n\n        var h = 0, chunk = lineObj.parent;\n        for (var i = 0; i < chunk.lines.length; ++i) {\n            var line = chunk.lines[i];\n            if (line == lineObj) { break }\n            else { h += line.height; }\n        }\n        for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\n            for (var i$1 = 0; i$1 < p.children.length; ++i$1) {\n                var cur = p.children[i$1];\n                if (cur == chunk) { break }\n                else { h += cur.height; }\n            }\n        }\n        return h\n    }\n\n    // Compute the character length of a line, taking into account\n    // collapsed ranges (see markText) that might hide parts, and join\n    // other lines onto it.\n    function lineLength(line) {\n        if (line.height == 0) { return 0 }\n        var len = line.text.length, merged, cur = line;\n        while (merged = collapsedSpanAtStart(cur)) {\n            var found = merged.find(0, true);\n            cur = found.from.line;\n            len += found.from.ch - found.to.ch;\n        }\n        cur = line;\n        while (merged = collapsedSpanAtEnd(cur)) {\n            var found$1 = merged.find(0, true);\n            len -= cur.text.length - found$1.from.ch;\n            cur = found$1.to.line;\n            len += cur.text.length - found$1.to.ch;\n        }\n        return len\n    }\n\n    // Find the longest line in the document.\n    function findMaxLine(cm) {\n        var d = cm.display, doc = cm.doc;\n        d.maxLine = getLine(doc, doc.first);\n        d.maxLineLength = lineLength(d.maxLine);\n        d.maxLineChanged = true;\n        doc.iter(function (line) {\n            var len = lineLength(line);\n            if (len > d.maxLineLength) {\n                d.maxLineLength = len;\n                d.maxLine = line;\n            }\n        });\n    }\n\n    // BIDI HELPERS\n\n    function iterateBidiSections(order, from, to, f) {\n        if (!order) { return f(from, to, "ltr", 0) }\n        var found = false;\n        for (var i = 0; i < order.length; ++i) {\n            var part = order[i];\n            if (part.from < to && part.to > from || from == to && part.to == from) {\n                f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? "rtl" : "ltr", i);\n                found = true;\n            }\n        }\n        if (!found) { f(from, to, "ltr"); }\n    }\n\n    var bidiOther = null;\n    function getBidiPartAt(order, ch, sticky) {\n        var found;\n        bidiOther = null;\n        for (var i = 0; i < order.length; ++i) {\n            var cur = order[i];\n            if (cur.from < ch && cur.to > ch) { return i }\n            if (cur.to == ch) {\n                if (cur.from != cur.to && sticky == "before") { found = i; }\n                else { bidiOther = i; }\n            }\n            if (cur.from == ch) {\n                if (cur.from != cur.to && sticky != "before") { found = i; }\n                else { bidiOther = i; }\n            }\n        }\n        return found != null ? found : bidiOther\n    }\n\n    // Bidirectional ordering algorithm\n    // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\n    // that this (partially) implements.\n\n    // One-char codes used for character types:\n    // L (L):   Left-to-Right\n    // R (R):   Right-to-Left\n    // r (AL):  Right-to-Left Arabic\n    // 1 (EN):  European Number\n    // + (ES):  European Number Separator\n    // % (ET):  European Number Terminator\n    // n (AN):  Arabic Number\n    // , (CS):  Common Number Separator\n    // m (NSM): Non-Spacing Mark\n    // b (BN):  Boundary Neutral\n    // s (B):   Paragraph Separator\n    // t (S):   Segment Separator\n    // w (WS):  Whitespace\n    // N (ON):  Other Neutrals\n\n    // Returns null if characters are ordered as they appear\n    // (left-to-right), or an array of sections ({from, to, level}\n    // objects) in the order in which they occur visually.\n    var bidiOrdering = (function() {\n        // Character types for codepoints 0 to 0xff\n        var lowTypes = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";\n        // Character types for codepoints 0x600 to 0x6f9\n        var arabicTypes = "nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";\n        function charType(code) {\n            if (code <= 0xf7) { return lowTypes.charAt(code) }\n            else if (0x590 <= code && code <= 0x5f4) { return "R" }\n            else if (0x600 <= code && code <= 0x6f9) { return arabicTypes.charAt(code - 0x600) }\n            else if (0x6ee <= code && code <= 0x8ac) { return "r" }\n            else if (0x2000 <= code && code <= 0x200b) { return "w" }\n            else if (code == 0x200c) { return "b" }\n            else { return "L" }\n        }\n\n        var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\n        var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\n\n        function BidiSpan(level, from, to) {\n            this.level = level;\n            this.from = from; this.to = to;\n        }\n\n        return function(str, direction) {\n            var outerType = direction == "ltr" ? "L" : "R";\n\n            if (str.length == 0 || direction == "ltr" && !bidiRE.test(str)) { return false }\n            var len = str.length, types = [];\n            for (var i = 0; i < len; ++i)\n            { types.push(charType(str.charCodeAt(i))); }\n\n            // W1. Examine each non-spacing mark (NSM) in the level run, and\n            // change the type of the NSM to the type of the previous\n            // character. If the NSM is at the start of the level run, it will\n            // get the type of sor.\n            for (var i$1 = 0, prev = outerType; i$1 < len; ++i$1) {\n                var type = types[i$1];\n                if (type == "m") { types[i$1] = prev; }\n                else { prev = type; }\n            }\n\n            // W2. Search backwards from each instance of a European number\n            // until the first strong type (R, L, AL, or sor) is found. If an\n            // AL is found, change the type of the European number to Arabic\n            // number.\n            // W3. Change all ALs to R.\n            for (var i$2 = 0, cur = outerType; i$2 < len; ++i$2) {\n                var type$1 = types[i$2];\n                if (type$1 == "1" && cur == "r") { types[i$2] = "n"; }\n                else if (isStrong.test(type$1)) { cur = type$1; if (type$1 == "r") { types[i$2] = "R"; } }\n            }\n\n            // W4. A single European separator between two European numbers\n            // changes to a European number. A single common separator between\n            // two numbers of the same type changes to that type.\n            for (var i$3 = 1, prev$1 = types[0]; i$3 < len - 1; ++i$3) {\n                var type$2 = types[i$3];\n                if (type$2 == "+" && prev$1 == "1" && types[i$3+1] == "1") { types[i$3] = "1"; }\n                else if (type$2 == "," && prev$1 == types[i$3+1] &&\n                    (prev$1 == "1" || prev$1 == "n")) { types[i$3] = prev$1; }\n                prev$1 = type$2;\n            }\n\n            // W5. A sequence of European terminators adjacent to European\n            // numbers changes to all European numbers.\n            // W6. Otherwise, separators and terminators change to Other\n            // Neutral.\n            for (var i$4 = 0; i$4 < len; ++i$4) {\n                var type$3 = types[i$4];\n                if (type$3 == ",") { types[i$4] = "N"; }\n                else if (type$3 == "%") {\n                    var end = (void 0);\n                    for (end = i$4 + 1; end < len && types[end] == "%"; ++end) {}\n                    var replace = (i$4 && types[i$4-1] == "!") || (end < len && types[end] == "1") ? "1" : "N";\n                    for (var j = i$4; j < end; ++j) { types[j] = replace; }\n                    i$4 = end - 1;\n                }\n            }\n\n            // W7. Search backwards from each instance of a European number\n            // until the first strong type (R, L, or sor) is found. If an L is\n            // found, then change the type of the European number to L.\n            for (var i$5 = 0, cur$1 = outerType; i$5 < len; ++i$5) {\n                var type$4 = types[i$5];\n                if (cur$1 == "L" && type$4 == "1") { types[i$5] = "L"; }\n                else if (isStrong.test(type$4)) { cur$1 = type$4; }\n            }\n\n            // N1. A sequence of neutrals takes the direction of the\n            // surrounding strong text if the text on both sides has the same\n            // direction. European and Arabic numbers act as if they were R in\n            // terms of their influence on neutrals. Start-of-level-run (sor)\n            // and end-of-level-run (eor) are used at level run boundaries.\n            // N2. Any remaining neutrals take the embedding direction.\n            for (var i$6 = 0; i$6 < len; ++i$6) {\n                if (isNeutral.test(types[i$6])) {\n                    var end$1 = (void 0);\n                    for (end$1 = i$6 + 1; end$1 < len && isNeutral.test(types[end$1]); ++end$1) {}\n                    var before = (i$6 ? types[i$6-1] : outerType) == "L";\n                    var after = (end$1 < len ? types[end$1] : outerType) == "L";\n                    var replace$1 = before == after ? (before ? "L" : "R") : outerType;\n                    for (var j$1 = i$6; j$1 < end$1; ++j$1) { types[j$1] = replace$1; }\n                    i$6 = end$1 - 1;\n                }\n            }\n\n            // Here we depart from the documented algorithm, in order to avoid\n            // building up an actual levels array. Since there are only three\n            // levels (0, 1, 2) in an implementation that doesn\'t take\n            // explicit embedding into account, we can build up the order on\n            // the fly, without following the level-based algorithm.\n            var order = [], m;\n            for (var i$7 = 0; i$7 < len;) {\n                if (countsAsLeft.test(types[i$7])) {\n                    var start = i$7;\n                    for (++i$7; i$7 < len && countsAsLeft.test(types[i$7]); ++i$7) {}\n                    order.push(new BidiSpan(0, start, i$7));\n                } else {\n                    var pos = i$7, at = order.length;\n                    for (++i$7; i$7 < len && types[i$7] != "L"; ++i$7) {}\n                    for (var j$2 = pos; j$2 < i$7;) {\n                        if (countsAsNum.test(types[j$2])) {\n                            if (pos < j$2) { order.splice(at, 0, new BidiSpan(1, pos, j$2)); }\n                            var nstart = j$2;\n                            for (++j$2; j$2 < i$7 && countsAsNum.test(types[j$2]); ++j$2) {}\n                            order.splice(at, 0, new BidiSpan(2, nstart, j$2));\n                            pos = j$2;\n                        } else { ++j$2; }\n                    }\n                    if (pos < i$7) { order.splice(at, 0, new BidiSpan(1, pos, i$7)); }\n                }\n            }\n            if (direction == "ltr") {\n                if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\n                    order[0].from = m[0].length;\n                    order.unshift(new BidiSpan(0, 0, m[0].length));\n                }\n                if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\n                    lst(order).to -= m[0].length;\n                    order.push(new BidiSpan(0, len - m[0].length, len));\n                }\n            }\n\n            return direction == "rtl" ? order.reverse() : order\n        }\n    })();\n\n    // Get the bidi ordering for the given line (and cache it). Returns\n    // false for lines that are fully left-to-right, and an array of\n    // BidiSpan objects otherwise.\n    function getOrder(line, direction) {\n        var order = line.order;\n        if (order == null) { order = line.order = bidiOrdering(line.text, direction); }\n        return order\n    }\n\n    // EVENT HANDLING\n\n    // Lightweight event framework. on/off also work on DOM nodes,\n    // registering native DOM handlers.\n\n    var noHandlers = [];\n\n    var on = function(emitter, type, f) {\n        if (emitter.addEventListener) {\n            emitter.addEventListener(type, f, false);\n        } else if (emitter.attachEvent) {\n            emitter.attachEvent("on" + type, f);\n        } else {\n            var map$$1 = emitter._handlers || (emitter._handlers = {});\n            map$$1[type] = (map$$1[type] || noHandlers).concat(f);\n        }\n    };\n\n    function getHandlers(emitter, type) {\n        return emitter._handlers && emitter._handlers[type] || noHandlers\n    }\n\n    function off(emitter, type, f) {\n        if (emitter.removeEventListener) {\n            emitter.removeEventListener(type, f, false);\n        } else if (emitter.detachEvent) {\n            emitter.detachEvent("on" + type, f);\n        } else {\n            var map$$1 = emitter._handlers, arr = map$$1 && map$$1[type];\n            if (arr) {\n                var index = indexOf(arr, f);\n                if (index > -1)\n                { map$$1[type] = arr.slice(0, index).concat(arr.slice(index + 1)); }\n            }\n        }\n    }\n\n    function signal(emitter, type /*, values...*/) {\n        var handlers = getHandlers(emitter, type);\n        if (!handlers.length) { return }\n        var args = Array.prototype.slice.call(arguments, 2);\n        for (var i = 0; i < handlers.length; ++i) { handlers[i].apply(null, args); }\n    }\n\n    // The DOM events that CodeMirror handles can be overridden by\n    // registering a (non-DOM) handler on the editor for the event name,\n    // and preventDefault-ing the event in that handler.\n    function signalDOMEvent(cm, e, override) {\n        if (typeof e == "string")\n        { e = {type: e, preventDefault: function() { this.defaultPrevented = true; }}; }\n        signal(cm, override || e.type, cm, e);\n        return e_defaultPrevented(e) || e.codemirrorIgnore\n    }\n\n    function signalCursorActivity(cm) {\n        var arr = cm._handlers && cm._handlers.cursorActivity;\n        if (!arr) { return }\n        var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\n        for (var i = 0; i < arr.length; ++i) { if (indexOf(set, arr[i]) == -1)\n        { set.push(arr[i]); } }\n    }\n\n    function hasHandler(emitter, type) {\n        return getHandlers(emitter, type).length > 0\n    }\n\n    // Add on and off methods to a constructor\'s prototype, to make\n    // registering events on such objects more convenient.\n    function eventMixin(ctor) {\n        ctor.prototype.on = function(type, f) {on(this, type, f);};\n        ctor.prototype.off = function(type, f) {off(this, type, f);};\n    }\n\n    // Due to the fact that we still support jurassic IE versions, some\n    // compatibility wrappers are needed.\n\n    function e_preventDefault(e) {\n        if (e.preventDefault) { e.preventDefault(); }\n        else { e.returnValue = false; }\n    }\n    function e_stopPropagation(e) {\n        if (e.stopPropagation) { e.stopPropagation(); }\n        else { e.cancelBubble = true; }\n    }\n    function e_defaultPrevented(e) {\n        return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false\n    }\n    function e_stop(e) {e_preventDefault(e); e_stopPropagation(e);}\n\n    function e_target(e) {return e.target || e.srcElement}\n    function e_button(e) {\n        var b = e.which;\n        if (b == null) {\n            if (e.button & 1) { b = 1; }\n            else if (e.button & 2) { b = 3; }\n            else if (e.button & 4) { b = 2; }\n        }\n        if (mac && e.ctrlKey && b == 1) { b = 3; }\n        return b\n    }\n\n    // Detect drag-and-drop\n    var dragAndDrop = function() {\n        // There is *some* kind of drag-and-drop support in IE6-8, but I\n        // couldn\'t get it to work yet.\n        if (ie && ie_version < 9) { return false }\n        var div = elt(\'div\');\n        return "draggable" in div || "dragDrop" in div\n    }();\n\n    var zwspSupported;\n    function zeroWidthElement(measure) {\n        if (zwspSupported == null) {\n            var test = elt("span", "\\u200b");\n            removeChildrenAndAdd(measure, elt("span", [test, document.createTextNode("x")]));\n            if (measure.firstChild.offsetHeight != 0)\n            { zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8); }\n        }\n        var node = zwspSupported ? elt("span", "\\u200b") :\n            elt("span", "\\u00a0", null, "display: inline-block; width: 1px; margin-right: -1px");\n        node.setAttribute("cm-text", "");\n        return node\n    }\n\n    // Feature-detect IE\'s crummy client rect reporting for bidi text\n    var badBidiRects;\n    function hasBadBidiRects(measure) {\n        if (badBidiRects != null) { return badBidiRects }\n        var txt = removeChildrenAndAdd(measure, document.createTextNode("A\\u062eA"));\n        var r0 = range(txt, 0, 1).getBoundingClientRect();\n        var r1 = range(txt, 1, 2).getBoundingClientRect();\n        removeChildren(measure);\n        if (!r0 || r0.left == r0.right) { return false } // Safari returns null in some cases (#2780)\n        return badBidiRects = (r1.right - r0.right < 3)\n    }\n\n    // See if "".split is the broken IE version, if so, provide an\n    // alternative way to split lines.\n    var splitLinesAuto = "\\n\\nb".split(/\\n/).length != 3 ? function (string) {\n        var pos = 0, result = [], l = string.length;\n        while (pos <= l) {\n            var nl = string.indexOf("\\n", pos);\n            if (nl == -1) { nl = string.length; }\n            var line = string.slice(pos, string.charAt(nl - 1) == "\\r" ? nl - 1 : nl);\n            var rt = line.indexOf("\\r");\n            if (rt != -1) {\n                result.push(line.slice(0, rt));\n                pos += rt + 1;\n            } else {\n                result.push(line);\n                pos = nl + 1;\n            }\n        }\n        return result\n    } : function (string) { return string.split(/\\r\\n?|\\n/); };\n\n    var hasSelection = window.getSelection ? function (te) {\n        try { return te.selectionStart != te.selectionEnd }\n        catch(e) { return false }\n    } : function (te) {\n        var range$$1;\n        try {range$$1 = te.ownerDocument.selection.createRange();}\n        catch(e) {}\n        if (!range$$1 || range$$1.parentElement() != te) { return false }\n        return range$$1.compareEndPoints("StartToEnd", range$$1) != 0\n    };\n\n    var hasCopyEvent = (function () {\n        var e = elt("div");\n        if ("oncopy" in e) { return true }\n        e.setAttribute("oncopy", "return;");\n        return typeof e.oncopy == "function"\n    })();\n\n    var badZoomedRects = null;\n    function hasBadZoomedRects(measure) {\n        if (badZoomedRects != null) { return badZoomedRects }\n        var node = removeChildrenAndAdd(measure, elt("span", "x"));\n        var normal = node.getBoundingClientRect();\n        var fromRange = range(node, 0, 1).getBoundingClientRect();\n        return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1\n    }\n\n    // Known modes, by name and by MIME\n    var modes = {}, mimeModes = {};\n\n    // Extra arguments are stored as the mode\'s dependencies, which is\n    // used by (legacy) mechanisms like loadmode.js to automatically\n    // load a mode. (Preferred mechanism is the require/define calls.)\n    function defineMode(name, mode) {\n        if (arguments.length > 2)\n        { mode.dependencies = Array.prototype.slice.call(arguments, 2); }\n        modes[name] = mode;\n    }\n\n    function defineMIME(mime, spec) {\n        mimeModes[mime] = spec;\n    }\n\n    // Given a MIME type, a {name, ...options} config object, or a name\n    // string, return a mode config object.\n    function resolveMode(spec) {\n        if (typeof spec == "string" && mimeModes.hasOwnProperty(spec)) {\n            spec = mimeModes[spec];\n        } else if (spec && typeof spec.name == "string" && mimeModes.hasOwnProperty(spec.name)) {\n            var found = mimeModes[spec.name];\n            if (typeof found == "string") { found = {name: found}; }\n            spec = createObj(found, spec);\n            spec.name = found.name;\n        } else if (typeof spec == "string" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\n            return resolveMode("application/xml")\n        } else if (typeof spec == "string" && /^[\\w\\-]+\\/[\\w\\-]+\\+json$/.test(spec)) {\n            return resolveMode("application/json")\n        }\n        if (typeof spec == "string") { return {name: spec} }\n        else { return spec || {name: "null"} }\n    }\n\n    // Given a mode spec (anything that resolveMode accepts), find and\n    // initialize an actual mode object.\n    function getMode(options, spec) {\n        spec = resolveMode(spec);\n        var mfactory = modes[spec.name];\n        if (!mfactory) { return getMode(options, "text/plain") }\n        var modeObj = mfactory(options, spec);\n        if (modeExtensions.hasOwnProperty(spec.name)) {\n            var exts = modeExtensions[spec.name];\n            for (var prop in exts) {\n                if (!exts.hasOwnProperty(prop)) { continue }\n                if (modeObj.hasOwnProperty(prop)) { modeObj["_" + prop] = modeObj[prop]; }\n                modeObj[prop] = exts[prop];\n            }\n        }\n        modeObj.name = spec.name;\n        if (spec.helperType) { modeObj.helperType = spec.helperType; }\n        if (spec.modeProps) { for (var prop$1 in spec.modeProps)\n        { modeObj[prop$1] = spec.modeProps[prop$1]; } }\n\n        return modeObj\n    }\n\n    // This can be used to attach properties to mode objects from\n    // outside the actual mode definition.\n    var modeExtensions = {};\n    function extendMode(mode, properties) {\n        var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\n        copyObj(properties, exts);\n    }\n\n    function copyState(mode, state) {\n        if (state === true) { return state }\n        if (mode.copyState) { return mode.copyState(state) }\n        var nstate = {};\n        for (var n in state) {\n            var val = state[n];\n            if (val instanceof Array) { val = val.concat([]); }\n            nstate[n] = val;\n        }\n        return nstate\n    }\n\n    // Given a mode and a state (for that mode), find the inner mode and\n    // state at the position that the state refers to.\n    function innerMode(mode, state) {\n        var info;\n        while (mode.innerMode) {\n            info = mode.innerMode(state);\n            if (!info || info.mode == mode) { break }\n            state = info.state;\n            mode = info.mode;\n        }\n        return info || {mode: mode, state: state}\n    }\n\n    function startState(mode, a1, a2) {\n        return mode.startState ? mode.startState(a1, a2) : true\n    }\n\n    // STRING STREAM\n\n    // Fed to the mode parsers, provides helper functions to make\n    // parsers more succinct.\n\n    var StringStream = function(string, tabSize, lineOracle) {\n        this.pos = this.start = 0;\n        this.string = string;\n        this.tabSize = tabSize || 8;\n        this.lastColumnPos = this.lastColumnValue = 0;\n        this.lineStart = 0;\n        this.lineOracle = lineOracle;\n    };\n\n    StringStream.prototype.eol = function () {return this.pos >= this.string.length};\n    StringStream.prototype.sol = function () {return this.pos == this.lineStart};\n    StringStream.prototype.peek = function () {return this.string.charAt(this.pos) || undefined};\n    StringStream.prototype.next = function () {\n        if (this.pos < this.string.length)\n        { return this.string.charAt(this.pos++) }\n    };\n    StringStream.prototype.eat = function (match) {\n        var ch = this.string.charAt(this.pos);\n        var ok;\n        if (typeof match == "string") { ok = ch == match; }\n        else { ok = ch && (match.test ? match.test(ch) : match(ch)); }\n        if (ok) {++this.pos; return ch}\n    };\n    StringStream.prototype.eatWhile = function (match) {\n        var start = this.pos;\n        while (this.eat(match)){}\n        return this.pos > start\n    };\n    StringStream.prototype.eatSpace = function () {\n        var start = this.pos;\n        while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) { ++this.pos; }\n        return this.pos > start\n    };\n    StringStream.prototype.skipToEnd = function () {this.pos = this.string.length;};\n    StringStream.prototype.skipTo = function (ch) {\n        var found = this.string.indexOf(ch, this.pos);\n        if (found > -1) {this.pos = found; return true}\n    };\n    StringStream.prototype.backUp = function (n) {this.pos -= n;};\n    StringStream.prototype.column = function () {\n        if (this.lastColumnPos < this.start) {\n            this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n            this.lastColumnPos = this.start;\n        }\n        return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)\n    };\n    StringStream.prototype.indentation = function () {\n        return countColumn(this.string, null, this.tabSize) -\n            (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)\n    };\n    StringStream.prototype.match = function (pattern, consume, caseInsensitive) {\n        if (typeof pattern == "string") {\n            var cased = function (str) { return caseInsensitive ? str.toLowerCase() : str; };\n            var substr = this.string.substr(this.pos, pattern.length);\n            if (cased(substr) == cased(pattern)) {\n                if (consume !== false) { this.pos += pattern.length; }\n                return true\n            }\n        } else {\n            var match = this.string.slice(this.pos).match(pattern);\n            if (match && match.index > 0) { return null }\n            if (match && consume !== false) { this.pos += match[0].length; }\n            return match\n        }\n    };\n    StringStream.prototype.current = function (){return this.string.slice(this.start, this.pos)};\n    StringStream.prototype.hideFirstChars = function (n, inner) {\n        this.lineStart += n;\n        try { return inner() }\n        finally { this.lineStart -= n; }\n    };\n    StringStream.prototype.lookAhead = function (n) {\n        var oracle = this.lineOracle;\n        return oracle && oracle.lookAhead(n)\n    };\n    StringStream.prototype.baseToken = function () {\n        var oracle = this.lineOracle;\n        return oracle && oracle.baseToken(this.pos)\n    };\n\n    var SavedContext = function(state, lookAhead) {\n        this.state = state;\n        this.lookAhead = lookAhead;\n    };\n\n    var Context = function(doc, state, line, lookAhead) {\n        this.state = state;\n        this.doc = doc;\n        this.line = line;\n        this.maxLookAhead = lookAhead || 0;\n        this.baseTokens = null;\n        this.baseTokenPos = 1;\n    };\n\n    Context.prototype.lookAhead = function (n) {\n        var line = this.doc.getLine(this.line + n);\n        if (line != null && n > this.maxLookAhead) { this.maxLookAhead = n; }\n        return line\n    };\n\n    Context.prototype.baseToken = function (n) {\n        if (!this.baseTokens) { return null }\n        while (this.baseTokens[this.baseTokenPos] <= n)\n        { this.baseTokenPos += 2; }\n        var type = this.baseTokens[this.baseTokenPos + 1];\n        return {type: type && type.replace(/( |^)overlay .*/, ""),\n            size: this.baseTokens[this.baseTokenPos] - n}\n    };\n\n    Context.prototype.nextLine = function () {\n        this.line++;\n        if (this.maxLookAhead > 0) { this.maxLookAhead--; }\n    };\n\n    Context.fromSaved = function (doc, saved, line) {\n        if (saved instanceof SavedContext)\n        { return new Context(doc, copyState(doc.mode, saved.state), line, saved.lookAhead) }\n        else\n        { return new Context(doc, copyState(doc.mode, saved), line) }\n    };\n\n    Context.prototype.save = function (copy) {\n        var state = copy !== false ? copyState(this.doc.mode, this.state) : this.state;\n        return this.maxLookAhead > 0 ? new SavedContext(state, this.maxLookAhead) : state\n    };\n\n\n    // Compute a style array (an array starting with a mode generation\n    // -- for invalidation -- followed by pairs of end positions and\n    // style strings), which is used to highlight the tokens on the\n    // line.\n    function highlightLine(cm, line, context, forceToEnd) {\n        // A styles array always starts with a number identifying the\n        // mode/overlays that it is based on (for easy invalidation).\n        var st = [cm.state.modeGen], lineClasses = {};\n        // Compute the base array of styles\n        runMode(cm, line.text, cm.doc.mode, context, function (end, style) { return st.push(end, style); },\n            lineClasses, forceToEnd);\n        var state = context.state;\n\n        // Run overlays, adjust style array.\n        var loop = function ( o ) {\n            context.baseTokens = st;\n            var overlay = cm.state.overlays[o], i = 1, at = 0;\n            context.state = true;\n            runMode(cm, line.text, overlay.mode, context, function (end, style) {\n                var start = i;\n                // Ensure there\'s a token end at the current position, and that i points at it\n                while (at < end) {\n                    var i_end = st[i];\n                    if (i_end > end)\n                    { st.splice(i, 1, end, st[i+1], i_end); }\n                    i += 2;\n                    at = Math.min(end, i_end);\n                }\n                if (!style) { return }\n                if (overlay.opaque) {\n                    st.splice(start, i - start, end, "overlay " + style);\n                    i = start + 2;\n                } else {\n                    for (; start < i; start += 2) {\n                        var cur = st[start+1];\n                        st[start+1] = (cur ? cur + " " : "") + "overlay " + style;\n                    }\n                }\n            }, lineClasses);\n            context.state = state;\n            context.baseTokens = null;\n            context.baseTokenPos = 1;\n        };\n\n        for (var o = 0; o < cm.state.overlays.length; ++o) loop( o );\n\n        return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null}\n    }\n\n    function getLineStyles(cm, line, updateFrontier) {\n        if (!line.styles || line.styles[0] != cm.state.modeGen) {\n            var context = getContextBefore(cm, lineNo(line));\n            var resetState = line.text.length > cm.options.maxHighlightLength && copyState(cm.doc.mode, context.state);\n            var result = highlightLine(cm, line, context);\n            if (resetState) { context.state = resetState; }\n            line.stateAfter = context.save(!resetState);\n            line.styles = result.styles;\n            if (result.classes) { line.styleClasses = result.classes; }\n            else if (line.styleClasses) { line.styleClasses = null; }\n            if (updateFrontier === cm.doc.highlightFrontier)\n            { cm.doc.modeFrontier = Math.max(cm.doc.modeFrontier, ++cm.doc.highlightFrontier); }\n        }\n        return line.styles\n    }\n\n    function getContextBefore(cm, n, precise) {\n        var doc = cm.doc, display = cm.display;\n        if (!doc.mode.startState) { return new Context(doc, true, n) }\n        var start = findStartLine(cm, n, precise);\n        var saved = start > doc.first && getLine(doc, start - 1).stateAfter;\n        var context = saved ? Context.fromSaved(doc, saved, start) : new Context(doc, startState(doc.mode), start);\n\n        doc.iter(start, n, function (line) {\n            processLine(cm, line.text, context);\n            var pos = context.line;\n            line.stateAfter = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo ? context.save() : null;\n            context.nextLine();\n        });\n        if (precise) { doc.modeFrontier = context.line; }\n        return context\n    }\n\n    // Lightweight form of highlight -- proceed over this line and\n    // update state, but don\'t save a style array. Used for lines that\n    // aren\'t currently visible.\n    function processLine(cm, text, context, startAt) {\n        var mode = cm.doc.mode;\n        var stream = new StringStream(text, cm.options.tabSize, context);\n        stream.start = stream.pos = startAt || 0;\n        if (text == "") { callBlankLine(mode, context.state); }\n        while (!stream.eol()) {\n            readToken(mode, stream, context.state);\n            stream.start = stream.pos;\n        }\n    }\n\n    function callBlankLine(mode, state) {\n        if (mode.blankLine) { return mode.blankLine(state) }\n        if (!mode.innerMode) { return }\n        var inner = innerMode(mode, state);\n        if (inner.mode.blankLine) { return inner.mode.blankLine(inner.state) }\n    }\n\n    function readToken(mode, stream, state, inner) {\n        for (var i = 0; i < 10; i++) {\n            if (inner) { inner[0] = innerMode(mode, state).mode; }\n            var style = mode.token(stream, state);\n            if (stream.pos > stream.start) { return style }\n        }\n        throw new Error("Mode " + mode.name + " failed to advance stream.")\n    }\n\n    var Token = function(stream, type, state) {\n        this.start = stream.start; this.end = stream.pos;\n        this.string = stream.current();\n        this.type = type || null;\n        this.state = state;\n    };\n\n    // Utility for getTokenAt and getLineTokens\n    function takeToken(cm, pos, precise, asArray) {\n        var doc = cm.doc, mode = doc.mode, style;\n        pos = clipPos(doc, pos);\n        var line = getLine(doc, pos.line), context = getContextBefore(cm, pos.line, precise);\n        var stream = new StringStream(line.text, cm.options.tabSize, context), tokens;\n        if (asArray) { tokens = []; }\n        while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\n            stream.start = stream.pos;\n            style = readToken(mode, stream, context.state);\n            if (asArray) { tokens.push(new Token(stream, style, copyState(doc.mode, context.state))); }\n        }\n        return asArray ? tokens : new Token(stream, style, context.state)\n    }\n\n    function extractLineClasses(type, output) {\n        if (type) { for (;;) {\n            var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\n            if (!lineClass) { break }\n            type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\n            var prop = lineClass[1] ? "bgClass" : "textClass";\n            if (output[prop] == null)\n            { output[prop] = lineClass[2]; }\n            else if (!(new RegExp("(?:^|\\s)" + lineClass[2] + "(?:$|\\s)")).test(output[prop]))\n            { output[prop] += " " + lineClass[2]; }\n        } }\n        return type\n    }\n\n    // Run the given mode\'s parser over a line, calling f for each token.\n    function runMode(cm, text, mode, context, f, lineClasses, forceToEnd) {\n        var flattenSpans = mode.flattenSpans;\n        if (flattenSpans == null) { flattenSpans = cm.options.flattenSpans; }\n        var curStart = 0, curStyle = null;\n        var stream = new StringStream(text, cm.options.tabSize, context), style;\n        var inner = cm.options.addModeClass && [null];\n        if (text == "") { extractLineClasses(callBlankLine(mode, context.state), lineClasses); }\n        while (!stream.eol()) {\n            if (stream.pos > cm.options.maxHighlightLength) {\n                flattenSpans = false;\n                if (forceToEnd) { processLine(cm, text, context, stream.pos); }\n                stream.pos = text.length;\n                style = null;\n            } else {\n                style = extractLineClasses(readToken(mode, stream, context.state, inner), lineClasses);\n            }\n            if (inner) {\n                var mName = inner[0].name;\n                if (mName) { style = "m-" + (style ? mName + " " + style : mName); }\n            }\n            if (!flattenSpans || curStyle != style) {\n                while (curStart < stream.start) {\n                    curStart = Math.min(stream.start, curStart + 5000);\n                    f(curStart, curStyle);\n                }\n                curStyle = style;\n            }\n            stream.start = stream.pos;\n        }\n        while (curStart < stream.pos) {\n            // Webkit seems to refuse to render text nodes longer than 57444\n            // characters, and returns inaccurate measurements in nodes\n            // starting around 5000 chars.\n            var pos = Math.min(stream.pos, curStart + 5000);\n            f(pos, curStyle);\n            curStart = pos;\n        }\n    }\n\n    // Finds the line to start with when starting a parse. Tries to\n    // find a line with a stateAfter, so that it can start with a\n    // valid state. If that fails, it returns the line with the\n    // smallest indentation, which tends to need the least context to\n    // parse correctly.\n    function findStartLine(cm, n, precise) {\n        var minindent, minline, doc = cm.doc;\n        var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\n        for (var search = n; search > lim; --search) {\n            if (search <= doc.first) { return doc.first }\n            var line = getLine(doc, search - 1), after = line.stateAfter;\n            if (after && (!precise || search + (after instanceof SavedContext ? after.lookAhead : 0) <= doc.modeFrontier))\n            { return search }\n            var indented = countColumn(line.text, null, cm.options.tabSize);\n            if (minline == null || minindent > indented) {\n                minline = search - 1;\n                minindent = indented;\n            }\n        }\n        return minline\n    }\n\n    function retreatFrontier(doc, n) {\n        doc.modeFrontier = Math.min(doc.modeFrontier, n);\n        if (doc.highlightFrontier < n - 10) { return }\n        var start = doc.first;\n        for (var line = n - 1; line > start; line--) {\n            var saved = getLine(doc, line).stateAfter;\n            // change is on 3\n            // state on line 1 looked ahead 2 -- so saw 3\n            // test 1 + 2 < 3 should cover this\n            if (saved && (!(saved instanceof SavedContext) || line + saved.lookAhead < n)) {\n                start = line + 1;\n                break\n            }\n        }\n        doc.highlightFrontier = Math.min(doc.highlightFrontier, start);\n    }\n\n    // LINE DATA STRUCTURE\n\n    // Line objects. These hold state related to a line, including\n    // highlighting info (the styles array).\n    var Line = function(text, markedSpans, estimateHeight) {\n        this.text = text;\n        attachMarkedSpans(this, markedSpans);\n        this.height = estimateHeight ? estimateHeight(this) : 1;\n    };\n\n    Line.prototype.lineNo = function () { return lineNo(this) };\n    eventMixin(Line);\n\n    // Change the content (text, markers) of a line. Automatically\n    // invalidates cached information and tries to re-estimate the\n    // line\'s height.\n    function updateLine(line, text, markedSpans, estimateHeight) {\n        line.text = text;\n        if (line.stateAfter) { line.stateAfter = null; }\n        if (line.styles) { line.styles = null; }\n        if (line.order != null) { line.order = null; }\n        detachMarkedSpans(line);\n        attachMarkedSpans(line, markedSpans);\n        var estHeight = estimateHeight ? estimateHeight(line) : 1;\n        if (estHeight != line.height) { updateLineHeight(line, estHeight); }\n    }\n\n    // Detach a line from the document tree and its markers.\n    function cleanUpLine(line) {\n        line.parent = null;\n        detachMarkedSpans(line);\n    }\n\n    // Convert a style as returned by a mode (either null, or a string\n    // containing one or more styles) to a CSS style. This is cached,\n    // and also looks for line-wide styles.\n    var styleToClassCache = {}, styleToClassCacheWithMode = {};\n    function interpretTokenStyle(style, options) {\n        if (!style || /^\\s*$/.test(style)) { return null }\n        var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\n        return cache[style] ||\n            (cache[style] = style.replace(/\\S+/g, "cm-$&"))\n    }\n\n    // Render the DOM representation of the text of a line. Also builds\n    // up a \'line map\', which points at the DOM nodes that represent\n    // specific stretches of text, and is used by the measuring code.\n    // The returned object contains the DOM node, this map, and\n    // information about line-wide styles that were set by the mode.\n    function buildLineContent(cm, lineView) {\n        // The padding-right forces the element to have a \'border\', which\n        // is needed on Webkit to be able to get line-level bounding\n        // rectangles for it (in measureChar).\n        var content = eltP("span", null, null, webkit ? "padding-right: .1px" : null);\n        var builder = {pre: eltP("pre", [content], "CodeMirror-line"), content: content,\n            col: 0, pos: 0, cm: cm,\n            trailingSpace: false,\n            splitSpaces: cm.getOption("lineWrapping")};\n        lineView.measure = {};\n\n        // Iterate over the logical lines that make up this visual line.\n        for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\n            var line = i ? lineView.rest[i - 1] : lineView.line, order = (void 0);\n            builder.pos = 0;\n            builder.addToken = buildToken;\n            // Optionally wire in some hacks into the token-rendering\n            // algorithm, to deal with browser quirks.\n            if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line, cm.doc.direction)))\n            { builder.addToken = buildTokenBadBidi(builder.addToken, order); }\n            builder.map = [];\n            var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\n            insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\n            if (line.styleClasses) {\n                if (line.styleClasses.bgClass)\n                { builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || ""); }\n                if (line.styleClasses.textClass)\n                { builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || ""); }\n            }\n\n            // Ensure at least a single node is present, for measuring.\n            if (builder.map.length == 0)\n            { builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure))); }\n\n            // Store the map and a cache object for the current logical line\n            if (i == 0) {\n                lineView.measure.map = builder.map;\n                lineView.measure.cache = {};\n            } else {\n                (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map)\n                ;(lineView.measure.caches || (lineView.measure.caches = [])).push({});\n            }\n        }\n\n        // See issue #2901\n        if (webkit) {\n            var last = builder.content.lastChild;\n            if (/\\bcm-tab\\b/.test(last.className) || (last.querySelector && last.querySelector(".cm-tab")))\n            { builder.content.className = "cm-tab-wrap-hack"; }\n        }\n\n        signal(cm, "renderLine", cm, lineView.line, builder.pre);\n        if (builder.pre.className)\n        { builder.textClass = joinClasses(builder.pre.className, builder.textClass || ""); }\n\n        return builder\n    }\n\n    function defaultSpecialCharPlaceholder(ch) {\n        var token = elt("span", "\\u2022", "cm-invalidchar");\n        token.title = "\\\\u" + ch.charCodeAt(0).toString(16);\n        token.setAttribute("aria-label", token.title);\n        return token\n    }\n\n    // Build up the DOM representation for a single token, and add it to\n    // the line map. Takes care to render special characters separately.\n    function buildToken(builder, text, style, startStyle, endStyle, css, attributes) {\n        if (!text) { return }\n        var displayText = builder.splitSpaces ? splitSpaces(text, builder.trailingSpace) : text;\n        var special = builder.cm.state.specialChars, mustWrap = false;\n        var content;\n        if (!special.test(text)) {\n            builder.col += text.length;\n            content = document.createTextNode(displayText);\n            builder.map.push(builder.pos, builder.pos + text.length, content);\n            if (ie && ie_version < 9) { mustWrap = true; }\n            builder.pos += text.length;\n        } else {\n            content = document.createDocumentFragment();\n            var pos = 0;\n            while (true) {\n                special.lastIndex = pos;\n                var m = special.exec(text);\n                var skipped = m ? m.index - pos : text.length - pos;\n                if (skipped) {\n                    var txt = document.createTextNode(displayText.slice(pos, pos + skipped));\n                    if (ie && ie_version < 9) { content.appendChild(elt("span", [txt])); }\n                    else { content.appendChild(txt); }\n                    builder.map.push(builder.pos, builder.pos + skipped, txt);\n                    builder.col += skipped;\n                    builder.pos += skipped;\n                }\n                if (!m) { break }\n                pos += skipped + 1;\n                var txt$1 = (void 0);\n                if (m[0] == "\\t") {\n                    var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\n                    txt$1 = content.appendChild(elt("span", spaceStr(tabWidth), "cm-tab"));\n                    txt$1.setAttribute("role", "presentation");\n                    txt$1.setAttribute("cm-text", "\\t");\n                    builder.col += tabWidth;\n                } else if (m[0] == "\\r" || m[0] == "\\n") {\n                    txt$1 = content.appendChild(elt("span", m[0] == "\\r" ? "\\u240d" : "\\u2424", "cm-invalidchar"));\n                    txt$1.setAttribute("cm-text", m[0]);\n                    builder.col += 1;\n                } else {\n                    txt$1 = builder.cm.options.specialCharPlaceholder(m[0]);\n                    txt$1.setAttribute("cm-text", m[0]);\n                    if (ie && ie_version < 9) { content.appendChild(elt("span", [txt$1])); }\n                    else { content.appendChild(txt$1); }\n                    builder.col += 1;\n                }\n                builder.map.push(builder.pos, builder.pos + 1, txt$1);\n                builder.pos++;\n            }\n        }\n        builder.trailingSpace = displayText.charCodeAt(text.length - 1) == 32;\n        if (style || startStyle || endStyle || mustWrap || css) {\n            var fullStyle = style || "";\n            if (startStyle) { fullStyle += startStyle; }\n            if (endStyle) { fullStyle += endStyle; }\n            var token = elt("span", [content], fullStyle, css);\n            if (attributes) {\n                for (var attr in attributes) { if (attributes.hasOwnProperty(attr) && attr != "style" && attr != "class")\n                { token.setAttribute(attr, attributes[attr]); } }\n            }\n            return builder.content.appendChild(token)\n        }\n        builder.content.appendChild(content);\n    }\n\n    // Change some spaces to NBSP to prevent the browser from collapsing\n    // trailing spaces at the end of a line when rendering text (issue #1362).\n    function splitSpaces(text, trailingBefore) {\n        if (text.length > 1 && !/  /.test(text)) { return text }\n        var spaceBefore = trailingBefore, result = "";\n        for (var i = 0; i < text.length; i++) {\n            var ch = text.charAt(i);\n            if (ch == " " && spaceBefore && (i == text.length - 1 || text.charCodeAt(i + 1) == 32))\n            { ch = "\\u00a0"; }\n            result += ch;\n            spaceBefore = ch == " ";\n        }\n        return result\n    }\n\n    // Work around nonsense dimensions being reported for stretches of\n    // right-to-left text.\n    function buildTokenBadBidi(inner, order) {\n        return function (builder, text, style, startStyle, endStyle, css, attributes) {\n            style = style ? style + " cm-force-border" : "cm-force-border";\n            var start = builder.pos, end = start + text.length;\n            for (;;) {\n                // Find the part that overlaps with the start of this text\n                var part = (void 0);\n                for (var i = 0; i < order.length; i++) {\n                    part = order[i];\n                    if (part.to > start && part.from <= start) { break }\n                }\n                if (part.to >= end) { return inner(builder, text, style, startStyle, endStyle, css, attributes) }\n                inner(builder, text.slice(0, part.to - start), style, startStyle, null, css, attributes);\n                startStyle = null;\n                text = text.slice(part.to - start);\n                start = part.to;\n            }\n        }\n    }\n\n    function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\n        var widget = !ignoreWidget && marker.widgetNode;\n        if (widget) { builder.map.push(builder.pos, builder.pos + size, widget); }\n        if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {\n            if (!widget)\n            { widget = builder.content.appendChild(document.createElement("span")); }\n            widget.setAttribute("cm-marker", marker.id);\n        }\n        if (widget) {\n            builder.cm.display.input.setUneditable(widget);\n            builder.content.appendChild(widget);\n        }\n        builder.pos += size;\n        builder.trailingSpace = false;\n    }\n\n    // Outputs a number of spans to make up a line, taking highlighting\n    // and marked text into account.\n    function insertLineContent(line, builder, styles) {\n        var spans = line.markedSpans, allText = line.text, at = 0;\n        if (!spans) {\n            for (var i$1 = 1; i$1 < styles.length; i$1+=2)\n            { builder.addToken(builder, allText.slice(at, at = styles[i$1]), interpretTokenStyle(styles[i$1+1], builder.cm.options)); }\n            return\n        }\n\n        var len = allText.length, pos = 0, i = 1, text = "", style, css;\n        var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, collapsed, attributes;\n        for (;;) {\n            if (nextChange == pos) { // Update current marker set\n                spanStyle = spanEndStyle = spanStartStyle = css = "";\n                attributes = null;\n                collapsed = null; nextChange = Infinity;\n                var foundBookmarks = [], endStyles = (void 0);\n                for (var j = 0; j < spans.length; ++j) {\n                    var sp = spans[j], m = sp.marker;\n                    if (m.type == "bookmark" && sp.from == pos && m.widgetNode) {\n                        foundBookmarks.push(m);\n                    } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {\n                        if (sp.to != null && sp.to != pos && nextChange > sp.to) {\n                            nextChange = sp.to;\n                            spanEndStyle = "";\n                        }\n                        if (m.className) { spanStyle += " " + m.className; }\n                        if (m.css) { css = (css ? css + ";" : "") + m.css; }\n                        if (m.startStyle && sp.from == pos) { spanStartStyle += " " + m.startStyle; }\n                        if (m.endStyle && sp.to == nextChange) { (endStyles || (endStyles = [])).push(m.endStyle, sp.to); }\n                        // support for the old title property\n                        // https://github.com/codemirror/CodeMirror/pull/5673\n                        if (m.title) { (attributes || (attributes = {})).title = m.title; }\n                        if (m.attributes) {\n                            for (var attr in m.attributes)\n                            { (attributes || (attributes = {}))[attr] = m.attributes[attr]; }\n                        }\n                        if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\n                        { collapsed = sp; }\n                    } else if (sp.from > pos && nextChange > sp.from) {\n                        nextChange = sp.from;\n                    }\n                }\n                if (endStyles) { for (var j$1 = 0; j$1 < endStyles.length; j$1 += 2)\n                { if (endStyles[j$1 + 1] == nextChange) { spanEndStyle += " " + endStyles[j$1]; } } }\n\n                if (!collapsed || collapsed.from == pos) { for (var j$2 = 0; j$2 < foundBookmarks.length; ++j$2)\n                { buildCollapsedSpan(builder, 0, foundBookmarks[j$2]); } }\n                if (collapsed && (collapsed.from || 0) == pos) {\n                    buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\n                        collapsed.marker, collapsed.from == null);\n                    if (collapsed.to == null) { return }\n                    if (collapsed.to == pos) { collapsed = false; }\n                }\n            }\n            if (pos >= len) { break }\n\n            var upto = Math.min(len, nextChange);\n            while (true) {\n                if (text) {\n                    var end = pos + text.length;\n                    if (!collapsed) {\n                        var tokenText = end > upto ? text.slice(0, upto - pos) : text;\n                        builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\n                            spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : "", css, attributes);\n                    }\n                    if (end >= upto) {text = text.slice(upto - pos); pos = upto; break}\n                    pos = end;\n                    spanStartStyle = "";\n                }\n                text = allText.slice(at, at = styles[i++]);\n                style = interpretTokenStyle(styles[i++], builder.cm.options);\n            }\n        }\n    }\n\n\n    // These objects are used to represent the visible (currently drawn)\n    // part of the document. A LineView may correspond to multiple\n    // logical lines, if those are connected by collapsed ranges.\n    function LineView(doc, line, lineN) {\n        // The starting line\n        this.line = line;\n        // Continuing lines, if any\n        this.rest = visualLineContinued(line);\n        // Number of logical lines in this visual line\n        this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\n        this.node = this.text = null;\n        this.hidden = lineIsHidden(doc, line);\n    }\n\n    // Create a range of LineView objects for the given lines.\n    function buildViewArray(cm, from, to) {\n        var array = [], nextPos;\n        for (var pos = from; pos < to; pos = nextPos) {\n            var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\n            nextPos = pos + view.size;\n            array.push(view);\n        }\n        return array\n    }\n\n    var operationGroup = null;\n\n    function pushOperation(op) {\n        if (operationGroup) {\n            operationGroup.ops.push(op);\n        } else {\n            op.ownsGroup = operationGroup = {\n                ops: [op],\n                delayedCallbacks: []\n            };\n        }\n    }\n\n    function fireCallbacksForOps(group) {\n        // Calls delayed callbacks and cursorActivity handlers until no\n        // new ones appear\n        var callbacks = group.delayedCallbacks, i = 0;\n        do {\n            for (; i < callbacks.length; i++)\n            { callbacks[i].call(null); }\n            for (var j = 0; j < group.ops.length; j++) {\n                var op = group.ops[j];\n                if (op.cursorActivityHandlers)\n                { while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\n                { op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm); } }\n            }\n        } while (i < callbacks.length)\n    }\n\n    function finishOperation(op, endCb) {\n        var group = op.ownsGroup;\n        if (!group) { return }\n\n        try { fireCallbacksForOps(group); }\n        finally {\n            operationGroup = null;\n            endCb(group);\n        }\n    }\n\n    var orphanDelayedCallbacks = null;\n\n    // Often, we want to signal events at a point where we are in the\n    // middle of some work, but don\'t want the handler to start calling\n    // other methods on the editor, which might be in an inconsistent\n    // state or simply not expect any other events to happen.\n    // signalLater looks whether there are any handlers, and schedules\n    // them to be executed when the last operation ends, or, if no\n    // operation is active, when a timeout fires.\n    function signalLater(emitter, type /*, values...*/) {\n        var arr = getHandlers(emitter, type);\n        if (!arr.length) { return }\n        var args = Array.prototype.slice.call(arguments, 2), list;\n        if (operationGroup) {\n            list = operationGroup.delayedCallbacks;\n        } else if (orphanDelayedCallbacks) {\n            list = orphanDelayedCallbacks;\n        } else {\n            list = orphanDelayedCallbacks = [];\n            setTimeout(fireOrphanDelayed, 0);\n        }\n        var loop = function ( i ) {\n            list.push(function () { return arr[i].apply(null, args); });\n        };\n\n        for (var i = 0; i < arr.length; ++i)\n            loop( i );\n    }\n\n    function fireOrphanDelayed() {\n        var delayed = orphanDelayedCallbacks;\n        orphanDelayedCallbacks = null;\n        for (var i = 0; i < delayed.length; ++i) { delayed[i](); }\n    }\n\n    // When an aspect of a line changes, a string is added to\n    // lineView.changes. This updates the relevant part of the line\'s\n    // DOM structure.\n    function updateLineForChanges(cm, lineView, lineN, dims) {\n        for (var j = 0; j < lineView.changes.length; j++) {\n            var type = lineView.changes[j];\n            if (type == "text") { updateLineText(cm, lineView); }\n            else if (type == "gutter") { updateLineGutter(cm, lineView, lineN, dims); }\n            else if (type == "class") { updateLineClasses(cm, lineView); }\n            else if (type == "widget") { updateLineWidgets(cm, lineView, dims); }\n        }\n        lineView.changes = null;\n    }\n\n    // Lines with gutter elements, widgets or a background class need to\n    // be wrapped, and have the extra elements added to the wrapper div\n    function ensureLineWrapped(lineView) {\n        if (lineView.node == lineView.text) {\n            lineView.node = elt("div", null, null, "position: relative");\n            if (lineView.text.parentNode)\n            { lineView.text.parentNode.replaceChild(lineView.node, lineView.text); }\n            lineView.node.appendChild(lineView.text);\n            if (ie && ie_version < 8) { lineView.node.style.zIndex = 2; }\n        }\n        return lineView.node\n    }\n\n    function updateLineBackground(cm, lineView) {\n        var cls = lineView.bgClass ? lineView.bgClass + " " + (lineView.line.bgClass || "") : lineView.line.bgClass;\n        if (cls) { cls += " CodeMirror-linebackground"; }\n        if (lineView.background) {\n            if (cls) { lineView.background.className = cls; }\n            else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\n        } else if (cls) {\n            var wrap = ensureLineWrapped(lineView);\n            lineView.background = wrap.insertBefore(elt("div", null, cls), wrap.firstChild);\n            cm.display.input.setUneditable(lineView.background);\n        }\n    }\n\n    // Wrapper around buildLineContent which will reuse the structure\n    // in display.externalMeasured when possible.\n    function getLineContent(cm, lineView) {\n        var ext = cm.display.externalMeasured;\n        if (ext && ext.line == lineView.line) {\n            cm.display.externalMeasured = null;\n            lineView.measure = ext.measure;\n            return ext.built\n        }\n        return buildLineContent(cm, lineView)\n    }\n\n    // Redraw the line\'s text. Interacts with the background and text\n    // classes because the mode may output tokens that influence these\n    // classes.\n    function updateLineText(cm, lineView) {\n        var cls = lineView.text.className;\n        var built = getLineContent(cm, lineView);\n        if (lineView.text == lineView.node) { lineView.node = built.pre; }\n        lineView.text.parentNode.replaceChild(built.pre, lineView.text);\n        lineView.text = built.pre;\n        if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\n            lineView.bgClass = built.bgClass;\n            lineView.textClass = built.textClass;\n            updateLineClasses(cm, lineView);\n        } else if (cls) {\n            lineView.text.className = cls;\n        }\n    }\n\n    function updateLineClasses(cm, lineView) {\n        updateLineBackground(cm, lineView);\n        if (lineView.line.wrapClass)\n        { ensureLineWrapped(lineView).className = lineView.line.wrapClass; }\n        else if (lineView.node != lineView.text)\n        { lineView.node.className = ""; }\n        var textClass = lineView.textClass ? lineView.textClass + " " + (lineView.line.textClass || "") : lineView.line.textClass;\n        lineView.text.className = textClass || "";\n    }\n\n    function updateLineGutter(cm, lineView, lineN, dims) {\n        if (lineView.gutter) {\n            lineView.node.removeChild(lineView.gutter);\n            lineView.gutter = null;\n        }\n        if (lineView.gutterBackground) {\n            lineView.node.removeChild(lineView.gutterBackground);\n            lineView.gutterBackground = null;\n        }\n        if (lineView.line.gutterClass) {\n            var wrap = ensureLineWrapped(lineView);\n            lineView.gutterBackground = elt("div", null, "CodeMirror-gutter-background " + lineView.line.gutterClass,\n                ("left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px; width: " + (dims.gutterTotalWidth) + "px"));\n            cm.display.input.setUneditable(lineView.gutterBackground);\n            wrap.insertBefore(lineView.gutterBackground, lineView.text);\n        }\n        var markers = lineView.line.gutterMarkers;\n        if (cm.options.lineNumbers || markers) {\n            var wrap$1 = ensureLineWrapped(lineView);\n            var gutterWrap = lineView.gutter = elt("div", null, "CodeMirror-gutter-wrapper", ("left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px"));\n            cm.display.input.setUneditable(gutterWrap);\n            wrap$1.insertBefore(gutterWrap, lineView.text);\n            if (lineView.line.gutterClass)\n            { gutterWrap.className += " " + lineView.line.gutterClass; }\n            if (cm.options.lineNumbers && (!markers || !markers["CodeMirror-linenumbers"]))\n            { lineView.lineNumber = gutterWrap.appendChild(\n                elt("div", lineNumberFor(cm.options, lineN),\n                    "CodeMirror-linenumber CodeMirror-gutter-elt",\n                    ("left: " + (dims.gutterLeft["CodeMirror-linenumbers"]) + "px; width: " + (cm.display.lineNumInnerWidth) + "px"))); }\n            if (markers) { for (var k = 0; k < cm.options.gutters.length; ++k) {\n                var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\n                if (found)\n                { gutterWrap.appendChild(elt("div", [found], "CodeMirror-gutter-elt",\n                    ("left: " + (dims.gutterLeft[id]) + "px; width: " + (dims.gutterWidth[id]) + "px"))); }\n            } }\n        }\n    }\n\n    function updateLineWidgets(cm, lineView, dims) {\n        if (lineView.alignable) { lineView.alignable = null; }\n        for (var node = lineView.node.firstChild, next = (void 0); node; node = next) {\n            next = node.nextSibling;\n            if (node.className == "CodeMirror-linewidget")\n            { lineView.node.removeChild(node); }\n        }\n        insertLineWidgets(cm, lineView, dims);\n    }\n\n    // Build a line\'s DOM representation from scratch\n    function buildLineElement(cm, lineView, lineN, dims) {\n        var built = getLineContent(cm, lineView);\n        lineView.text = lineView.node = built.pre;\n        if (built.bgClass) { lineView.bgClass = built.bgClass; }\n        if (built.textClass) { lineView.textClass = built.textClass; }\n\n        updateLineClasses(cm, lineView);\n        updateLineGutter(cm, lineView, lineN, dims);\n        insertLineWidgets(cm, lineView, dims);\n        return lineView.node\n    }\n\n    // A lineView may contain multiple logical lines (when merged by\n    // collapsed spans). The widgets for all of them need to be drawn.\n    function insertLineWidgets(cm, lineView, dims) {\n        insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);\n        if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)\n        { insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false); } }\n    }\n\n    function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {\n        if (!line.widgets) { return }\n        var wrap = ensureLineWrapped(lineView);\n        for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\n            var widget = ws[i], node = elt("div", [widget.node], "CodeMirror-linewidget");\n            if (!widget.handleMouseEvents) { node.setAttribute("cm-ignore-events", "true"); }\n            positionLineWidget(widget, node, lineView, dims);\n            cm.display.input.setUneditable(node);\n            if (allowAbove && widget.above)\n            { wrap.insertBefore(node, lineView.gutter || lineView.text); }\n            else\n            { wrap.appendChild(node); }\n            signalLater(widget, "redraw");\n        }\n    }\n\n    function positionLineWidget(widget, node, lineView, dims) {\n        if (widget.noHScroll) {\n            (lineView.alignable || (lineView.alignable = [])).push(node);\n            var width = dims.wrapperWidth;\n            node.style.left = dims.fixedPos + "px";\n            if (!widget.coverGutter) {\n                width -= dims.gutterTotalWidth;\n                node.style.paddingLeft = dims.gutterTotalWidth + "px";\n            }\n            node.style.width = width + "px";\n        }\n        if (widget.coverGutter) {\n            node.style.zIndex = 5;\n            node.style.position = "relative";\n            if (!widget.noHScroll) { node.style.marginLeft = -dims.gutterTotalWidth + "px"; }\n        }\n    }\n\n    function widgetHeight(widget) {\n        if (widget.height != null) { return widget.height }\n        var cm = widget.doc.cm;\n        if (!cm) { return 0 }\n        if (!contains(document.body, widget.node)) {\n            var parentStyle = "position: relative;";\n            if (widget.coverGutter)\n            { parentStyle += "margin-left: -" + cm.display.gutters.offsetWidth + "px;"; }\n            if (widget.noHScroll)\n            { parentStyle += "width: " + cm.display.wrapper.clientWidth + "px;"; }\n            removeChildrenAndAdd(cm.display.measure, elt("div", [widget.node], null, parentStyle));\n        }\n        return widget.height = widget.node.parentNode.offsetHeight\n    }\n\n    // Return true when the given mouse event happened in a widget\n    function eventInWidget(display, e) {\n        for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\n            if (!n || (n.nodeType == 1 && n.getAttribute("cm-ignore-events") == "true") ||\n                (n.parentNode == display.sizer && n != display.mover))\n            { return true }\n        }\n    }\n\n    // POSITION MEASUREMENT\n\n    function paddingTop(display) {return display.lineSpace.offsetTop}\n    function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight}\n    function paddingH(display) {\n        if (display.cachedPaddingH) { return display.cachedPaddingH }\n        var e = removeChildrenAndAdd(display.measure, elt("pre", "x"));\n        var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\n        var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\n        if (!isNaN(data.left) && !isNaN(data.right)) { display.cachedPaddingH = data; }\n        return data\n    }\n\n    function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth }\n    function displayWidth(cm) {\n        return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth\n    }\n    function displayHeight(cm) {\n        return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight\n    }\n\n    // Ensure the lineView.wrapping.heights array is populated. This is\n    // an array of bottom offsets for the lines that make up a drawn\n    // line. When lineWrapping is on, there might be more than one\n    // height.\n    function ensureLineHeights(cm, lineView, rect) {\n        var wrapping = cm.options.lineWrapping;\n        var curWidth = wrapping && displayWidth(cm);\n        if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\n            var heights = lineView.measure.heights = [];\n            if (wrapping) {\n                lineView.measure.width = curWidth;\n                var rects = lineView.text.firstChild.getClientRects();\n                for (var i = 0; i < rects.length - 1; i++) {\n                    var cur = rects[i], next = rects[i + 1];\n                    if (Math.abs(cur.bottom - next.bottom) > 2)\n                    { heights.push((cur.bottom + next.top) / 2 - rect.top); }\n                }\n            }\n            heights.push(rect.bottom - rect.top);\n        }\n    }\n\n    // Find a line map (mapping character offsets to text nodes) and a\n    // measurement cache for the given line number. (A line view might\n    // contain multiple lines when collapsed ranges are present.)\n    function mapFromLineView(lineView, line, lineN) {\n        if (lineView.line == line)\n        { return {map: lineView.measure.map, cache: lineView.measure.cache} }\n        for (var i = 0; i < lineView.rest.length; i++)\n        { if (lineView.rest[i] == line)\n        { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }\n        for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)\n        { if (lineNo(lineView.rest[i$1]) > lineN)\n        { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }\n    }\n\n    // Render a line into the hidden node display.externalMeasured. Used\n    // when measurement is needed for a line that\'s not in the viewport.\n    function updateExternalMeasurement(cm, line) {\n        line = visualLine(line);\n        var lineN = lineNo(line);\n        var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\n        view.lineN = lineN;\n        var built = view.built = buildLineContent(cm, view);\n        view.text = built.pre;\n        removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\n        return view\n    }\n\n    // Get a {top, bottom, left, right} box (in line-local coordinates)\n    // for a given character.\n    function measureChar(cm, line, ch, bias) {\n        return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias)\n    }\n\n    // Find a line view that corresponds to the given line number.\n    function findViewForLine(cm, lineN) {\n        if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\n        { return cm.display.view[findViewIndex(cm, lineN)] }\n        var ext = cm.display.externalMeasured;\n        if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\n        { return ext }\n    }\n\n    // Measurement can be split in two steps, the set-up work that\n    // applies to the whole line, and the measurement of the actual\n    // character. Functions like coordsChar, that need to do a lot of\n    // measurements in a row, can thus ensure that the set-up work is\n    // only done once.\n    function prepareMeasureForLine(cm, line) {\n        var lineN = lineNo(line);\n        var view = findViewForLine(cm, lineN);\n        if (view && !view.text) {\n            view = null;\n        } else if (view && view.changes) {\n            updateLineForChanges(cm, view, lineN, getDimensions(cm));\n            cm.curOp.forceUpdate = true;\n        }\n        if (!view)\n        { view = updateExternalMeasurement(cm, line); }\n\n        var info = mapFromLineView(view, line, lineN);\n        return {\n            line: line, view: view, rect: null,\n            map: info.map, cache: info.cache, before: info.before,\n            hasHeights: false\n        }\n    }\n\n    // Given a prepared measurement object, measures the position of an\n    // actual character (or fetches it from the cache).\n    function measureCharPrepared(cm, prepared, ch, bias, varHeight) {\n        if (prepared.before) { ch = -1; }\n        var key = ch + (bias || ""), found;\n        if (prepared.cache.hasOwnProperty(key)) {\n            found = prepared.cache[key];\n        } else {\n            if (!prepared.rect)\n            { prepared.rect = prepared.view.text.getBoundingClientRect(); }\n            if (!prepared.hasHeights) {\n                ensureLineHeights(cm, prepared.view, prepared.rect);\n                prepared.hasHeights = true;\n            }\n            found = measureCharInner(cm, prepared, ch, bias);\n            if (!found.bogus) { prepared.cache[key] = found; }\n        }\n        return {left: found.left, right: found.right,\n            top: varHeight ? found.rtop : found.top,\n            bottom: varHeight ? found.rbottom : found.bottom}\n    }\n\n    var nullRect = {left: 0, right: 0, top: 0, bottom: 0};\n\n    function nodeAndOffsetInLineMap(map$$1, ch, bias) {\n        var node, start, end, collapse, mStart, mEnd;\n        // First, search the line map for the text node corresponding to,\n        // or closest to, the target character.\n        for (var i = 0; i < map$$1.length; i += 3) {\n            mStart = map$$1[i];\n            mEnd = map$$1[i + 1];\n            if (ch < mStart) {\n                start = 0; end = 1;\n                collapse = "left";\n            } else if (ch < mEnd) {\n                start = ch - mStart;\n                end = start + 1;\n            } else if (i == map$$1.length - 3 || ch == mEnd && map$$1[i + 3] > ch) {\n                end = mEnd - mStart;\n                start = end - 1;\n                if (ch >= mEnd) { collapse = "right"; }\n            }\n            if (start != null) {\n                node = map$$1[i + 2];\n                if (mStart == mEnd && bias == (node.insertLeft ? "left" : "right"))\n                { collapse = bias; }\n                if (bias == "left" && start == 0)\n                { while (i && map$$1[i - 2] == map$$1[i - 3] && map$$1[i - 1].insertLeft) {\n                    node = map$$1[(i -= 3) + 2];\n                    collapse = "left";\n                } }\n                if (bias == "right" && start == mEnd - mStart)\n                { while (i < map$$1.length - 3 && map$$1[i + 3] == map$$1[i + 4] && !map$$1[i + 5].insertLeft) {\n                    node = map$$1[(i += 3) + 2];\n                    collapse = "right";\n                } }\n                break\n            }\n        }\n        return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd}\n    }\n\n    function getUsefulRect(rects, bias) {\n        var rect = nullRect;\n        if (bias == "left") { for (var i = 0; i < rects.length; i++) {\n            if ((rect = rects[i]).left != rect.right) { break }\n        } } else { for (var i$1 = rects.length - 1; i$1 >= 0; i$1--) {\n            if ((rect = rects[i$1]).left != rect.right) { break }\n        } }\n        return rect\n    }\n\n    function measureCharInner(cm, prepared, ch, bias) {\n        var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);\n        var node = place.node, start = place.start, end = place.end, collapse = place.collapse;\n\n        var rect;\n        if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\n            for (var i$1 = 0; i$1 < 4; i$1++) { // Retry a maximum of 4 times when nonsense rectangles are returned\n                while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) { --start; }\n                while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) { ++end; }\n                if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart)\n                { rect = node.parentNode.getBoundingClientRect(); }\n                else\n                { rect = getUsefulRect(range(node, start, end).getClientRects(), bias); }\n                if (rect.left || rect.right || start == 0) { break }\n                end = start;\n                start = start - 1;\n                collapse = "right";\n            }\n            if (ie && ie_version < 11) { rect = maybeUpdateRectForZooming(cm.display.measure, rect); }\n        } else { // If it is a widget, simply get the box for the whole widget.\n            if (start > 0) { collapse = bias = "right"; }\n            var rects;\n            if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\n            { rect = rects[bias == "right" ? rects.length - 1 : 0]; }\n            else\n            { rect = node.getBoundingClientRect(); }\n        }\n        if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\n            var rSpan = node.parentNode.getClientRects()[0];\n            if (rSpan)\n            { rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom}; }\n            else\n            { rect = nullRect; }\n        }\n\n        var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\n        var mid = (rtop + rbot) / 2;\n        var heights = prepared.view.measure.heights;\n        var i = 0;\n        for (; i < heights.length - 1; i++)\n        { if (mid < heights[i]) { break } }\n        var top = i ? heights[i - 1] : 0, bot = heights[i];\n        var result = {left: (collapse == "right" ? rect.right : rect.left) - prepared.rect.left,\n            right: (collapse == "left" ? rect.left : rect.right) - prepared.rect.left,\n            top: top, bottom: bot};\n        if (!rect.left && !rect.right) { result.bogus = true; }\n        if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\n\n        return result\n    }\n\n    // Work around problem with bounding client rects on ranges being\n    // returned incorrectly when zoomed on IE10 and below.\n    function maybeUpdateRectForZooming(measure, rect) {\n        if (!window.screen || screen.logicalXDPI == null ||\n            screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\n        { return rect }\n        var scaleX = screen.logicalXDPI / screen.deviceXDPI;\n        var scaleY = screen.logicalYDPI / screen.deviceYDPI;\n        return {left: rect.left * scaleX, right: rect.right * scaleX,\n            top: rect.top * scaleY, bottom: rect.bottom * scaleY}\n    }\n\n    function clearLineMeasurementCacheFor(lineView) {\n        if (lineView.measure) {\n            lineView.measure.cache = {};\n            lineView.measure.heights = null;\n            if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)\n            { lineView.measure.caches[i] = {}; } }\n        }\n    }\n\n    function clearLineMeasurementCache(cm) {\n        cm.display.externalMeasure = null;\n        removeChildren(cm.display.lineMeasure);\n        for (var i = 0; i < cm.display.view.length; i++)\n        { clearLineMeasurementCacheFor(cm.display.view[i]); }\n    }\n\n    function clearCaches(cm) {\n        clearLineMeasurementCache(cm);\n        cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\n        if (!cm.options.lineWrapping) { cm.display.maxLineChanged = true; }\n        cm.display.lineNumChars = null;\n    }\n\n    function pageScrollX() {\n        // Work around https://bugs.chromium.org/p/chromium/issues/detail?id=489206\n        // which causes page_Offset and bounding client rects to use\n        // different reference viewports and invalidate our calculations.\n        if (chrome && android) { return -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) }\n        return window.pageXOffset || (document.documentElement || document.body).scrollLeft\n    }\n    function pageScrollY() {\n        if (chrome && android) { return -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) }\n        return window.pageYOffset || (document.documentElement || document.body).scrollTop\n    }\n\n    function widgetTopHeight(lineObj) {\n        var height = 0;\n        if (lineObj.widgets) { for (var i = 0; i < lineObj.widgets.length; ++i) { if (lineObj.widgets[i].above)\n        { height += widgetHeight(lineObj.widgets[i]); } } }\n        return height\n    }\n\n    // Converts a {top, bottom, left, right} box from line-local\n    // coordinates into another coordinate system. Context may be one of\n    // "line", "div" (display.lineDiv), "local"./null (editor), "window",\n    // or "page".\n    function intoCoordSystem(cm, lineObj, rect, context, includeWidgets) {\n        if (!includeWidgets) {\n            var height = widgetTopHeight(lineObj);\n            rect.top += height; rect.bottom += height;\n        }\n        if (context == "line") { return rect }\n        if (!context) { context = "local"; }\n        var yOff = heightAtLine(lineObj);\n        if (context == "local") { yOff += paddingTop(cm.display); }\n        else { yOff -= cm.display.viewOffset; }\n        if (context == "page" || context == "window") {\n            var lOff = cm.display.lineSpace.getBoundingClientRect();\n            yOff += lOff.top + (context == "window" ? 0 : pageScrollY());\n            var xOff = lOff.left + (context == "window" ? 0 : pageScrollX());\n            rect.left += xOff; rect.right += xOff;\n        }\n        rect.top += yOff; rect.bottom += yOff;\n        return rect\n    }\n\n    // Coverts a box from "div" coords to another coordinate system.\n    // Context may be "window", "page", "div", or "local"./null.\n    function fromCoordSystem(cm, coords, context) {\n        if (context == "div") { return coords }\n        var left = coords.left, top = coords.top;\n        // First move into "page" coordinate system\n        if (context == "page") {\n            left -= pageScrollX();\n            top -= pageScrollY();\n        } else if (context == "local" || !context) {\n            var localBox = cm.display.sizer.getBoundingClientRect();\n            left += localBox.left;\n            top += localBox.top;\n        }\n\n        var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\n        return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top}\n    }\n\n    function charCoords(cm, pos, context, lineObj, bias) {\n        if (!lineObj) { lineObj = getLine(cm.doc, pos.line); }\n        return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context)\n    }\n\n    // Returns a box for a given cursor position, which may have an\n    // \'other\' property containing the position of the secondary cursor\n    // on a bidi boundary.\n    // A cursor Pos(line, char, "before") is on the same visual line as `char - 1`\n    // and after `char - 1` in writing order of `char - 1`\n    // A cursor Pos(line, char, "after") is on the same visual line as `char`\n    // and before `char` in writing order of `char`\n    // Examples (upper-case letters are RTL, lower-case are LTR):\n    //     Pos(0, 1, ...)\n    //     before   after\n    // ab     a|b     a|b\n    // aB     a|B     aB|\n    // Ab     |Ab     A|b\n    // AB     B|A     B|A\n    // Every position after the last character on a line is considered to stick\n    // to the last character on the line.\n    function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\n        lineObj = lineObj || getLine(cm.doc, pos.line);\n        if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }\n        function get(ch, right) {\n            var m = measureCharPrepared(cm, preparedMeasure, ch, right ? "right" : "left", varHeight);\n            if (right) { m.left = m.right; } else { m.right = m.left; }\n            return intoCoordSystem(cm, lineObj, m, context)\n        }\n        var order = getOrder(lineObj, cm.doc.direction), ch = pos.ch, sticky = pos.sticky;\n        if (ch >= lineObj.text.length) {\n            ch = lineObj.text.length;\n            sticky = "before";\n        } else if (ch <= 0) {\n            ch = 0;\n            sticky = "after";\n        }\n        if (!order) { return get(sticky == "before" ? ch - 1 : ch, sticky == "before") }\n\n        function getBidi(ch, partPos, invert) {\n            var part = order[partPos], right = part.level == 1;\n            return get(invert ? ch - 1 : ch, right != invert)\n        }\n        var partPos = getBidiPartAt(order, ch, sticky);\n        var other = bidiOther;\n        var val = getBidi(ch, partPos, sticky == "before");\n        if (other != null) { val.other = getBidi(ch, other, sticky != "before"); }\n        return val\n    }\n\n    // Used to cheaply estimate the coordinates for a position. Used for\n    // intermediate scroll updates.\n    function estimateCoords(cm, pos) {\n        var left = 0;\n        pos = clipPos(cm.doc, pos);\n        if (!cm.options.lineWrapping) { left = charWidth(cm.display) * pos.ch; }\n        var lineObj = getLine(cm.doc, pos.line);\n        var top = heightAtLine(lineObj) + paddingTop(cm.display);\n        return {left: left, right: left, top: top, bottom: top + lineObj.height}\n    }\n\n    // Positions returned by coordsChar contain some extra information.\n    // xRel is the relative x position of the input coordinates compared\n    // to the found position (so xRel > 0 means the coordinates are to\n    // the right of the character position, for example). When outside\n    // is true, that means the coordinates lie outside the line\'s\n    // vertical range.\n    function PosWithInfo(line, ch, sticky, outside, xRel) {\n        var pos = Pos(line, ch, sticky);\n        pos.xRel = xRel;\n        if (outside) { pos.outside = true; }\n        return pos\n    }\n\n    // Compute the character position closest to the given coordinates.\n    // Input must be lineSpace-local ("div" coordinate system).\n    function coordsChar(cm, x, y) {\n        var doc = cm.doc;\n        y += cm.display.viewOffset;\n        if (y < 0) { return PosWithInfo(doc.first, 0, null, true, -1) }\n        var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\n        if (lineN > last)\n        { return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, null, true, 1) }\n        if (x < 0) { x = 0; }\n\n        var lineObj = getLine(doc, lineN);\n        for (;;) {\n            var found = coordsCharInner(cm, lineObj, lineN, x, y);\n            var collapsed = collapsedSpanAround(lineObj, found.ch + (found.xRel > 0 ? 1 : 0));\n            if (!collapsed) { return found }\n            var rangeEnd = collapsed.find(1);\n            if (rangeEnd.line == lineN) { return rangeEnd }\n            lineObj = getLine(doc, lineN = rangeEnd.line);\n        }\n    }\n\n    function wrappedLineExtent(cm, lineObj, preparedMeasure, y) {\n        y -= widgetTopHeight(lineObj);\n        var end = lineObj.text.length;\n        var begin = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch - 1).bottom <= y; }, end, 0);\n        end = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch).top > y; }, begin, end);\n        return {begin: begin, end: end}\n    }\n\n    function wrappedLineExtentChar(cm, lineObj, preparedMeasure, target) {\n        if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }\n        var targetTop = intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, target), "line").top;\n        return wrappedLineExtent(cm, lineObj, preparedMeasure, targetTop)\n    }\n\n    // Returns true if the given side of a box is after the given\n    // coordinates, in top-to-bottom, left-to-right order.\n    function boxIsAfter(box, x, y, left) {\n        return box.bottom <= y ? false : box.top > y ? true : (left ? box.left : box.right) > x\n    }\n\n    function coordsCharInner(cm, lineObj, lineNo$$1, x, y) {\n        // Move y into line-local coordinate space\n        y -= heightAtLine(lineObj);\n        var preparedMeasure = prepareMeasureForLine(cm, lineObj);\n        // When directly calling `measureCharPrepared`, we have to adjust\n        // for the widgets at this line.\n        var widgetHeight$$1 = widgetTopHeight(lineObj);\n        var begin = 0, end = lineObj.text.length, ltr = true;\n\n        var order = getOrder(lineObj, cm.doc.direction);\n        // If the line isn\'t plain left-to-right text, first figure out\n        // which bidi section the coordinates fall into.\n        if (order) {\n            var part = (cm.options.lineWrapping ? coordsBidiPartWrapped : coordsBidiPart)\n            (cm, lineObj, lineNo$$1, preparedMeasure, order, x, y);\n            ltr = part.level != 1;\n            // The awkward -1 offsets are needed because findFirst (called\n            // on these below) will treat its first bound as inclusive,\n            // second as exclusive, but we want to actually address the\n            // characters in the part\'s range\n            begin = ltr ? part.from : part.to - 1;\n            end = ltr ? part.to : part.from - 1;\n        }\n\n        // A binary search to find the first character whose bounding box\n        // starts after the coordinates. If we run across any whose box wrap\n        // the coordinates, store that.\n        var chAround = null, boxAround = null;\n        var ch = findFirst(function (ch) {\n            var box = measureCharPrepared(cm, preparedMeasure, ch);\n            box.top += widgetHeight$$1; box.bottom += widgetHeight$$1;\n            if (!boxIsAfter(box, x, y, false)) { return false }\n            if (box.top <= y && box.left <= x) {\n                chAround = ch;\n                boxAround = box;\n            }\n            return true\n        }, begin, end);\n\n        var baseX, sticky, outside = false;\n        // If a box around the coordinates was found, use that\n        if (boxAround) {\n            // Distinguish coordinates nearer to the left or right side of the box\n            var atLeft = x - boxAround.left < boxAround.right - x, atStart = atLeft == ltr;\n            ch = chAround + (atStart ? 0 : 1);\n            sticky = atStart ? "after" : "before";\n            baseX = atLeft ? boxAround.left : boxAround.right;\n        } else {\n            // (Adjust for extended bound, if necessary.)\n            if (!ltr && (ch == end || ch == begin)) { ch++; }\n            // To determine which side to associate with, get the box to the\n            // left of the character and compare it\'s vertical position to the\n            // coordinates\n            sticky = ch == 0 ? "after" : ch == lineObj.text.length ? "before" :\n                (measureCharPrepared(cm, preparedMeasure, ch - (ltr ? 1 : 0)).bottom + widgetHeight$$1 <= y) == ltr ?\n                    "after" : "before";\n            // Now get accurate coordinates for this place, in order to get a\n            // base X position\n            var coords = cursorCoords(cm, Pos(lineNo$$1, ch, sticky), "line", lineObj, preparedMeasure);\n            baseX = coords.left;\n            outside = y < coords.top || y >= coords.bottom;\n        }\n\n        ch = skipExtendingChars(lineObj.text, ch, 1);\n        return PosWithInfo(lineNo$$1, ch, sticky, outside, x - baseX)\n    }\n\n    function coordsBidiPart(cm, lineObj, lineNo$$1, preparedMeasure, order, x, y) {\n        // Bidi parts are sorted left-to-right, and in a non-line-wrapping\n        // situation, we can take this ordering to correspond to the visual\n        // ordering. This finds the first part whose end is after the given\n        // coordinates.\n        var index = findFirst(function (i) {\n            var part = order[i], ltr = part.level != 1;\n            return boxIsAfter(cursorCoords(cm, Pos(lineNo$$1, ltr ? part.to : part.from, ltr ? "before" : "after"),\n                "line", lineObj, preparedMeasure), x, y, true)\n        }, 0, order.length - 1);\n        var part = order[index];\n        // If this isn\'t the first part, the part\'s start is also after\n        // the coordinates, and the coordinates aren\'t on the same line as\n        // that start, move one part back.\n        if (index > 0) {\n            var ltr = part.level != 1;\n            var start = cursorCoords(cm, Pos(lineNo$$1, ltr ? part.from : part.to, ltr ? "after" : "before"),\n                "line", lineObj, preparedMeasure);\n            if (boxIsAfter(start, x, y, true) && start.top > y)\n            { part = order[index - 1]; }\n        }\n        return part\n    }\n\n    function coordsBidiPartWrapped(cm, lineObj, _lineNo, preparedMeasure, order, x, y) {\n        // In a wrapped line, rtl text on wrapping boundaries can do things\n        // that don\'t correspond to the ordering in our `order` array at\n        // all, so a binary search doesn\'t work, and we want to return a\n        // part that only spans one line so that the binary search in\n        // coordsCharInner is safe. As such, we first find the extent of the\n        // wrapped line, and then do a flat search in which we discard any\n        // spans that aren\'t on the line.\n        var ref = wrappedLineExtent(cm, lineObj, preparedMeasure, y);\n        var begin = ref.begin;\n        var end = ref.end;\n        if (/\\s/.test(lineObj.text.charAt(end - 1))) { end--; }\n        var part = null, closestDist = null;\n        for (var i = 0; i < order.length; i++) {\n            var p = order[i];\n            if (p.from >= end || p.to <= begin) { continue }\n            var ltr = p.level != 1;\n            var endX = measureCharPrepared(cm, preparedMeasure, ltr ? Math.min(end, p.to) - 1 : Math.max(begin, p.from)).right;\n            // Weigh against spans ending before this, so that they are only\n            // picked if nothing ends after\n            var dist = endX < x ? x - endX + 1e9 : endX - x;\n            if (!part || closestDist > dist) {\n                part = p;\n                closestDist = dist;\n            }\n        }\n        if (!part) { part = order[order.length - 1]; }\n        // Clip the part to the wrapped line.\n        if (part.from < begin) { part = {from: begin, to: part.to, level: part.level}; }\n        if (part.to > end) { part = {from: part.from, to: end, level: part.level}; }\n        return part\n    }\n\n    var measureText;\n    // Compute the default text height.\n    function textHeight(display) {\n        if (display.cachedTextHeight != null) { return display.cachedTextHeight }\n        if (measureText == null) {\n            measureText = elt("pre");\n            // Measure a bunch of lines, for browsers that compute\n            // fractional heights.\n            for (var i = 0; i < 49; ++i) {\n                measureText.appendChild(document.createTextNode("x"));\n                measureText.appendChild(elt("br"));\n            }\n            measureText.appendChild(document.createTextNode("x"));\n        }\n        removeChildrenAndAdd(display.measure, measureText);\n        var height = measureText.offsetHeight / 50;\n        if (height > 3) { display.cachedTextHeight = height; }\n        removeChildren(display.measure);\n        return height || 1\n    }\n\n    // Compute the default character width.\n    function charWidth(display) {\n        if (display.cachedCharWidth != null) { return display.cachedCharWidth }\n        var anchor = elt("span", "xxxxxxxxxx");\n        var pre = elt("pre", [anchor]);\n        removeChildrenAndAdd(display.measure, pre);\n        var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\n        if (width > 2) { display.cachedCharWidth = width; }\n        return width || 10\n    }\n\n    // Do a bulk-read of the DOM positions and sizes needed to draw the\n    // view, so that we don\'t interleave reading and writing to the DOM.\n    function getDimensions(cm) {\n        var d = cm.display, left = {}, width = {};\n        var gutterLeft = d.gutters.clientLeft;\n        for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\n            left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\n            width[cm.options.gutters[i]] = n.clientWidth;\n        }\n        return {fixedPos: compensateForHScroll(d),\n            gutterTotalWidth: d.gutters.offsetWidth,\n            gutterLeft: left,\n            gutterWidth: width,\n            wrapperWidth: d.wrapper.clientWidth}\n    }\n\n    // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\n    // but using getBoundingClientRect to get a sub-pixel-accurate\n    // result.\n    function compensateForHScroll(display) {\n        return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left\n    }\n\n    // Returns a function that estimates the height of a line, to use as\n    // first approximation until the line becomes visible (and is thus\n    // properly measurable).\n    function estimateHeight(cm) {\n        var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\n        var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\n        return function (line) {\n            if (lineIsHidden(cm.doc, line)) { return 0 }\n\n            var widgetsHeight = 0;\n            if (line.widgets) { for (var i = 0; i < line.widgets.length; i++) {\n                if (line.widgets[i].height) { widgetsHeight += line.widgets[i].height; }\n            } }\n\n            if (wrapping)\n            { return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th }\n            else\n            { return widgetsHeight + th }\n        }\n    }\n\n    function estimateLineHeights(cm) {\n        var doc = cm.doc, est = estimateHeight(cm);\n        doc.iter(function (line) {\n            var estHeight = est(line);\n            if (estHeight != line.height) { updateLineHeight(line, estHeight); }\n        });\n    }\n\n    // Given a mouse event, find the corresponding position. If liberal\n    // is false, it checks whether a gutter or scrollbar was clicked,\n    // and returns null if it was. forRect is used by rectangular\n    // selections, and tries to estimate a character position even for\n    // coordinates beyond the right of the text.\n    function posFromMouse(cm, e, liberal, forRect) {\n        var display = cm.display;\n        if (!liberal && e_target(e).getAttribute("cm-not-content") == "true") { return null }\n\n        var x, y, space = display.lineSpace.getBoundingClientRect();\n        // Fails unpredictably on IE[67] when mouse is dragged around quickly.\n        try { x = e.clientX - space.left; y = e.clientY - space.top; }\n        catch (e) { return null }\n        var coords = coordsChar(cm, x, y), line;\n        if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\n            var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\n            coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\n        }\n        return coords\n    }\n\n    // Find the view element corresponding to a given line. Return null\n    // when the line isn\'t visible.\n    function findViewIndex(cm, n) {\n        if (n >= cm.display.viewTo) { return null }\n        n -= cm.display.viewFrom;\n        if (n < 0) { return null }\n        var view = cm.display.view;\n        for (var i = 0; i < view.length; i++) {\n            n -= view[i].size;\n            if (n < 0) { return i }\n        }\n    }\n\n    function updateSelection(cm) {\n        cm.display.input.showSelection(cm.display.input.prepareSelection());\n    }\n\n    function prepareSelection(cm, primary) {\n        if ( primary === void 0 ) primary = true;\n\n        var doc = cm.doc, result = {};\n        var curFragment = result.cursors = document.createDocumentFragment();\n        var selFragment = result.selection = document.createDocumentFragment();\n\n        for (var i = 0; i < doc.sel.ranges.length; i++) {\n            if (!primary && i == doc.sel.primIndex) { continue }\n            var range$$1 = doc.sel.ranges[i];\n            if (range$$1.from().line >= cm.display.viewTo || range$$1.to().line < cm.display.viewFrom) { continue }\n            var collapsed = range$$1.empty();\n            if (collapsed || cm.options.showCursorWhenSelecting)\n            { drawSelectionCursor(cm, range$$1.head, curFragment); }\n            if (!collapsed)\n            { drawSelectionRange(cm, range$$1, selFragment); }\n        }\n        return result\n    }\n\n    // Draws a cursor for the given range\n    function drawSelectionCursor(cm, head, output) {\n        var pos = cursorCoords(cm, head, "div", null, null, !cm.options.singleCursorHeightPerLine);\n\n        var cursor = output.appendChild(elt("div", "\\u00a0", "CodeMirror-cursor"));\n        cursor.style.left = pos.left + "px";\n        cursor.style.top = pos.top + "px";\n        cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + "px";\n\n        if (pos.other) {\n            // Secondary cursor, shown when on a \'jump\' in bi-directional text\n            var otherCursor = output.appendChild(elt("div", "\\u00a0", "CodeMirror-cursor CodeMirror-secondarycursor"));\n            otherCursor.style.display = "";\n            otherCursor.style.left = pos.other.left + "px";\n            otherCursor.style.top = pos.other.top + "px";\n            otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + "px";\n        }\n    }\n\n    function cmpCoords(a, b) { return a.top - b.top || a.left - b.left }\n\n    // Draws the given range as a highlighted selection\n    function drawSelectionRange(cm, range$$1, output) {\n        var display = cm.display, doc = cm.doc;\n        var fragment = document.createDocumentFragment();\n        var padding = paddingH(cm.display), leftSide = padding.left;\n        var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;\n        var docLTR = doc.direction == "ltr";\n\n        function add(left, top, width, bottom) {\n            if (top < 0) { top = 0; }\n            top = Math.round(top);\n            bottom = Math.round(bottom);\n            fragment.appendChild(elt("div", null, "CodeMirror-selected", ("position: absolute; left: " + left + "px;\\n                             top: " + top + "px; width: " + (width == null ? rightSide - left : width) + "px;\\n                             height: " + (bottom - top) + "px")));\n        }\n\n        function drawForLine(line, fromArg, toArg) {\n            var lineObj = getLine(doc, line);\n            var lineLen = lineObj.text.length;\n            var start, end;\n            function coords(ch, bias) {\n                return charCoords(cm, Pos(line, ch), "div", lineObj, bias)\n            }\n\n            function wrapX(pos, dir, side) {\n                var extent = wrappedLineExtentChar(cm, lineObj, null, pos);\n                var prop = (dir == "ltr") == (side == "after") ? "left" : "right";\n                var ch = side == "after" ? extent.begin : extent.end - (/\\s/.test(lineObj.text.charAt(extent.end - 1)) ? 2 : 1);\n                return coords(ch, prop)[prop]\n            }\n\n            var order = getOrder(lineObj, doc.direction);\n            iterateBidiSections(order, fromArg || 0, toArg == null ? lineLen : toArg, function (from, to, dir, i) {\n                var ltr = dir == "ltr";\n                var fromPos = coords(from, ltr ? "left" : "right");\n                var toPos = coords(to - 1, ltr ? "right" : "left");\n\n                var openStart = fromArg == null && from == 0, openEnd = toArg == null && to == lineLen;\n                var first = i == 0, last = !order || i == order.length - 1;\n                if (toPos.top - fromPos.top <= 3) { // Single line\n                    var openLeft = (docLTR ? openStart : openEnd) && first;\n                    var openRight = (docLTR ? openEnd : openStart) && last;\n                    var left = openLeft ? leftSide : (ltr ? fromPos : toPos).left;\n                    var right = openRight ? rightSide : (ltr ? toPos : fromPos).right;\n                    add(left, fromPos.top, right - left, fromPos.bottom);\n                } else { // Multiple lines\n                    var topLeft, topRight, botLeft, botRight;\n                    if (ltr) {\n                        topLeft = docLTR && openStart && first ? leftSide : fromPos.left;\n                        topRight = docLTR ? rightSide : wrapX(from, dir, "before");\n                        botLeft = docLTR ? leftSide : wrapX(to, dir, "after");\n                        botRight = docLTR && openEnd && last ? rightSide : toPos.right;\n                    } else {\n                        topLeft = !docLTR ? leftSide : wrapX(from, dir, "before");\n                        topRight = !docLTR && openStart && first ? rightSide : fromPos.right;\n                        botLeft = !docLTR && openEnd && last ? leftSide : toPos.left;\n                        botRight = !docLTR ? rightSide : wrapX(to, dir, "after");\n                    }\n                    add(topLeft, fromPos.top, topRight - topLeft, fromPos.bottom);\n                    if (fromPos.bottom < toPos.top) { add(leftSide, fromPos.bottom, null, toPos.top); }\n                    add(botLeft, toPos.top, botRight - botLeft, toPos.bottom);\n                }\n\n                if (!start || cmpCoords(fromPos, start) < 0) { start = fromPos; }\n                if (cmpCoords(toPos, start) < 0) { start = toPos; }\n                if (!end || cmpCoords(fromPos, end) < 0) { end = fromPos; }\n                if (cmpCoords(toPos, end) < 0) { end = toPos; }\n            });\n            return {start: start, end: end}\n        }\n\n        var sFrom = range$$1.from(), sTo = range$$1.to();\n        if (sFrom.line == sTo.line) {\n            drawForLine(sFrom.line, sFrom.ch, sTo.ch);\n        } else {\n            var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\n            var singleVLine = visualLine(fromLine) == visualLine(toLine);\n            var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\n            var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\n            if (singleVLine) {\n                if (leftEnd.top < rightStart.top - 2) {\n                    add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\n                    add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\n                } else {\n                    add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\n                }\n            }\n            if (leftEnd.bottom < rightStart.top)\n            { add(leftSide, leftEnd.bottom, null, rightStart.top); }\n        }\n\n        output.appendChild(fragment);\n    }\n\n    // Cursor-blinking\n    function restartBlink(cm) {\n        if (!cm.state.focused) { return }\n        var display = cm.display;\n        clearInterval(display.blinker);\n        var on = true;\n        display.cursorDiv.style.visibility = "";\n        if (cm.options.cursorBlinkRate > 0)\n        { display.blinker = setInterval(function () { return display.cursorDiv.style.visibility = (on = !on) ? "" : "hidden"; },\n            cm.options.cursorBlinkRate); }\n        else if (cm.options.cursorBlinkRate < 0)\n        { display.cursorDiv.style.visibility = "hidden"; }\n    }\n\n    function ensureFocus(cm) {\n        if (!cm.state.focused) { cm.display.input.focus(); onFocus(cm); }\n    }\n\n    function delayBlurEvent(cm) {\n        cm.state.delayingBlurEvent = true;\n        setTimeout(function () { if (cm.state.delayingBlurEvent) {\n            cm.state.delayingBlurEvent = false;\n            onBlur(cm);\n        } }, 100);\n    }\n\n    function onFocus(cm, e) {\n        if (cm.state.delayingBlurEvent) { cm.state.delayingBlurEvent = false; }\n\n        if (cm.options.readOnly == "nocursor") { return }\n        if (!cm.state.focused) {\n            signal(cm, "focus", cm, e);\n            cm.state.focused = true;\n            addClass(cm.display.wrapper, "CodeMirror-focused");\n            // This test prevents this from firing when a context\n            // menu is closed (since the input reset would kill the\n            // select-all detection hack)\n            if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\n                cm.display.input.reset();\n                if (webkit) { setTimeout(function () { return cm.display.input.reset(true); }, 20); } // Issue #1730\n            }\n            cm.display.input.receivedFocus();\n        }\n        restartBlink(cm);\n    }\n    function onBlur(cm, e) {\n        if (cm.state.delayingBlurEvent) { return }\n\n        if (cm.state.focused) {\n            signal(cm, "blur", cm, e);\n            cm.state.focused = false;\n            rmClass(cm.display.wrapper, "CodeMirror-focused");\n        }\n        clearInterval(cm.display.blinker);\n        setTimeout(function () { if (!cm.state.focused) { cm.display.shift = false; } }, 150);\n    }\n\n    // Read the actual heights of the rendered lines, and update their\n    // stored heights to match.\n    function updateHeightsInViewport(cm) {\n        var display = cm.display;\n        var prevBottom = display.lineDiv.offsetTop;\n        for (var i = 0; i < display.view.length; i++) {\n            var cur = display.view[i], wrapping = cm.options.lineWrapping;\n            var height = (void 0), width = 0;\n            if (cur.hidden) { continue }\n            if (ie && ie_version < 8) {\n                var bot = cur.node.offsetTop + cur.node.offsetHeight;\n                height = bot - prevBottom;\n                prevBottom = bot;\n            } else {\n                var box = cur.node.getBoundingClientRect();\n                height = box.bottom - box.top;\n                // Check that lines don\'t extend past the right of the current\n                // editor width\n                if (!wrapping && cur.text.firstChild)\n                { width = cur.text.firstChild.getBoundingClientRect().right - box.left - 1; }\n            }\n            var diff = cur.line.height - height;\n            if (height < 2) { height = textHeight(display); }\n            if (diff > .005 || diff < -.005) {\n                updateLineHeight(cur.line, height);\n                updateWidgetHeight(cur.line);\n                if (cur.rest) { for (var j = 0; j < cur.rest.length; j++)\n                { updateWidgetHeight(cur.rest[j]); } }\n            }\n            if (width > cm.display.sizerWidth) {\n                var chWidth = Math.ceil(width / charWidth(cm.display));\n                if (chWidth > cm.display.maxLineLength) {\n                    cm.display.maxLineLength = chWidth;\n                    cm.display.maxLine = cur.line;\n                    cm.display.maxLineChanged = true;\n                }\n            }\n        }\n    }\n\n    // Read and store the height of line widgets associated with the\n    // given line.\n    function updateWidgetHeight(line) {\n        if (line.widgets) { for (var i = 0; i < line.widgets.length; ++i) {\n            var w = line.widgets[i], parent = w.node.parentNode;\n            if (parent) { w.height = parent.offsetHeight; }\n        } }\n    }\n\n    // Compute the lines that are visible in a given viewport (defaults\n    // the the current scroll position). viewport may contain top,\n    // height, and ensure (see op.scrollToPos) properties.\n    function visibleLines(display, doc, viewport) {\n        var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\n        top = Math.floor(top - paddingTop(display));\n        var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\n\n        var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\n        // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\n        // forces those lines into the viewport (if possible).\n        if (viewport && viewport.ensure) {\n            var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\n            if (ensureFrom < from) {\n                from = ensureFrom;\n                to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);\n            } else if (Math.min(ensureTo, doc.lastLine()) >= to) {\n                from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);\n                to = ensureTo;\n            }\n        }\n        return {from: from, to: Math.max(to, from + 1)}\n    }\n\n    // Re-align line numbers and gutter marks to compensate for\n    // horizontal scrolling.\n    function alignHorizontally(cm) {\n        var display = cm.display, view = display.view;\n        if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) { return }\n        var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\n        var gutterW = display.gutters.offsetWidth, left = comp + "px";\n        for (var i = 0; i < view.length; i++) { if (!view[i].hidden) {\n            if (cm.options.fixedGutter) {\n                if (view[i].gutter)\n                { view[i].gutter.style.left = left; }\n                if (view[i].gutterBackground)\n                { view[i].gutterBackground.style.left = left; }\n            }\n            var align = view[i].alignable;\n            if (align) { for (var j = 0; j < align.length; j++)\n            { align[j].style.left = left; } }\n        } }\n        if (cm.options.fixedGutter)\n        { display.gutters.style.left = (comp + gutterW) + "px"; }\n    }\n\n    // Used to ensure that the line number gutter is still the right\n    // size for the current document size. Returns true when an update\n    // is needed.\n    function maybeUpdateLineNumberWidth(cm) {\n        if (!cm.options.lineNumbers) { return false }\n        var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\n        if (last.length != display.lineNumChars) {\n            var test = display.measure.appendChild(elt("div", [elt("div", last)],\n                "CodeMirror-linenumber CodeMirror-gutter-elt"));\n            var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\n            display.lineGutter.style.width = "";\n            display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;\n            display.lineNumWidth = display.lineNumInnerWidth + padding;\n            display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\n            display.lineGutter.style.width = display.lineNumWidth + "px";\n            updateGutterSpace(cm);\n            return true\n        }\n        return false\n    }\n\n    // SCROLLING THINGS INTO VIEW\n\n    // If an editor sits on the top or bottom of the window, partially\n    // scrolled out of view, this ensures that the cursor is visible.\n    function maybeScrollWindow(cm, rect) {\n        if (signalDOMEvent(cm, "scrollCursorIntoView")) { return }\n\n        var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\n        if (rect.top + box.top < 0) { doScroll = true; }\n        else if (rect.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) { doScroll = false; }\n        if (doScroll != null && !phantom) {\n            var scrollNode = elt("div", "\\u200b", null, ("position: absolute;\\n                         top: " + (rect.top - display.viewOffset - paddingTop(cm.display)) + "px;\\n                         height: " + (rect.bottom - rect.top + scrollGap(cm) + display.barHeight) + "px;\\n                         left: " + (rect.left) + "px; width: " + (Math.max(2, rect.right - rect.left)) + "px;"));\n            cm.display.lineSpace.appendChild(scrollNode);\n            scrollNode.scrollIntoView(doScroll);\n            cm.display.lineSpace.removeChild(scrollNode);\n        }\n    }\n\n    // Scroll a given position into view (immediately), verifying that\n    // it actually became visible (as line heights are accurately\n    // measured, the position of something may \'drift\' during drawing).\n    function scrollPosIntoView(cm, pos, end, margin) {\n        if (margin == null) { margin = 0; }\n        var rect;\n        if (!cm.options.lineWrapping && pos == end) {\n            // Set pos and end to the cursor positions around the character pos sticks to\n            // If pos.sticky == "before", that is around pos.ch - 1, otherwise around pos.ch\n            // If pos == Pos(_, 0, "before"), pos and end are unchanged\n            pos = pos.ch ? Pos(pos.line, pos.sticky == "before" ? pos.ch - 1 : pos.ch, "after") : pos;\n            end = pos.sticky == "before" ? Pos(pos.line, pos.ch + 1, "before") : pos;\n        }\n        for (var limit = 0; limit < 5; limit++) {\n            var changed = false;\n            var coords = cursorCoords(cm, pos);\n            var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\n            rect = {left: Math.min(coords.left, endCoords.left),\n                top: Math.min(coords.top, endCoords.top) - margin,\n                right: Math.max(coords.left, endCoords.left),\n                bottom: Math.max(coords.bottom, endCoords.bottom) + margin};\n            var scrollPos = calculateScrollPos(cm, rect);\n            var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\n            if (scrollPos.scrollTop != null) {\n                updateScrollTop(cm, scrollPos.scrollTop);\n                if (Math.abs(cm.doc.scrollTop - startTop) > 1) { changed = true; }\n            }\n            if (scrollPos.scrollLeft != null) {\n                setScrollLeft(cm, scrollPos.scrollLeft);\n                if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) { changed = true; }\n            }\n            if (!changed) { break }\n        }\n        return rect\n    }\n\n    // Scroll a given set of coordinates into view (immediately).\n    function scrollIntoView(cm, rect) {\n        var scrollPos = calculateScrollPos(cm, rect);\n        if (scrollPos.scrollTop != null) { updateScrollTop(cm, scrollPos.scrollTop); }\n        if (scrollPos.scrollLeft != null) { setScrollLeft(cm, scrollPos.scrollLeft); }\n    }\n\n    // Calculate a new scroll position needed to scroll the given\n    // rectangle into view. Returns an object with scrollTop and\n    // scrollLeft properties. When these are undefined, the\n    // vertical/horizontal position does not need to be adjusted.\n    function calculateScrollPos(cm, rect) {\n        var display = cm.display, snapMargin = textHeight(cm.display);\n        if (rect.top < 0) { rect.top = 0; }\n        var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\n        var screen = displayHeight(cm), result = {};\n        if (rect.bottom - rect.top > screen) { rect.bottom = rect.top + screen; }\n        var docBottom = cm.doc.height + paddingVert(display);\n        var atTop = rect.top < snapMargin, atBottom = rect.bottom > docBottom - snapMargin;\n        if (rect.top < screentop) {\n            result.scrollTop = atTop ? 0 : rect.top;\n        } else if (rect.bottom > screentop + screen) {\n            var newTop = Math.min(rect.top, (atBottom ? docBottom : rect.bottom) - screen);\n            if (newTop != screentop) { result.scrollTop = newTop; }\n        }\n\n        var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\n        var screenw = displayWidth(cm) - (cm.options.fixedGutter ? display.gutters.offsetWidth : 0);\n        var tooWide = rect.right - rect.left > screenw;\n        if (tooWide) { rect.right = rect.left + screenw; }\n        if (rect.left < 10)\n        { result.scrollLeft = 0; }\n        else if (rect.left < screenleft)\n        { result.scrollLeft = Math.max(0, rect.left - (tooWide ? 0 : 10)); }\n        else if (rect.right > screenw + screenleft - 3)\n        { result.scrollLeft = rect.right + (tooWide ? 0 : 10) - screenw; }\n        return result\n    }\n\n    // Store a relative adjustment to the scroll position in the current\n    // operation (to be applied when the operation finishes).\n    function addToScrollTop(cm, top) {\n        if (top == null) { return }\n        resolveScrollToPos(cm);\n        cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\n    }\n\n    // Make sure that at the end of the operation the current cursor is\n    // shown.\n    function ensureCursorVisible(cm) {\n        resolveScrollToPos(cm);\n        var cur = cm.getCursor();\n        cm.curOp.scrollToPos = {from: cur, to: cur, margin: cm.options.cursorScrollMargin};\n    }\n\n    function scrollToCoords(cm, x, y) {\n        if (x != null || y != null) { resolveScrollToPos(cm); }\n        if (x != null) { cm.curOp.scrollLeft = x; }\n        if (y != null) { cm.curOp.scrollTop = y; }\n    }\n\n    function scrollToRange(cm, range$$1) {\n        resolveScrollToPos(cm);\n        cm.curOp.scrollToPos = range$$1;\n    }\n\n    // When an operation has its scrollToPos property set, and another\n    // scroll action is applied before the end of the operation, this\n    // \'simulates\' scrolling that position into view in a cheap way, so\n    // that the effect of intermediate scroll commands is not ignored.\n    function resolveScrollToPos(cm) {\n        var range$$1 = cm.curOp.scrollToPos;\n        if (range$$1) {\n            cm.curOp.scrollToPos = null;\n            var from = estimateCoords(cm, range$$1.from), to = estimateCoords(cm, range$$1.to);\n            scrollToCoordsRange(cm, from, to, range$$1.margin);\n        }\n    }\n\n    function scrollToCoordsRange(cm, from, to, margin) {\n        var sPos = calculateScrollPos(cm, {\n            left: Math.min(from.left, to.left),\n            top: Math.min(from.top, to.top) - margin,\n            right: Math.max(from.right, to.right),\n            bottom: Math.max(from.bottom, to.bottom) + margin\n        });\n        scrollToCoords(cm, sPos.scrollLeft, sPos.scrollTop);\n    }\n\n    // Sync the scrollable area and scrollbars, ensure the viewport\n    // covers the visible area.\n    function updateScrollTop(cm, val) {\n        if (Math.abs(cm.doc.scrollTop - val) < 2) { return }\n        if (!gecko) { updateDisplaySimple(cm, {top: val}); }\n        setScrollTop(cm, val, true);\n        if (gecko) { updateDisplaySimple(cm); }\n        startWorker(cm, 100);\n    }\n\n    function setScrollTop(cm, val, forceScroll) {\n        val = Math.min(cm.display.scroller.scrollHeight - cm.display.scroller.clientHeight, val);\n        if (cm.display.scroller.scrollTop == val && !forceScroll) { return }\n        cm.doc.scrollTop = val;\n        cm.display.scrollbars.setScrollTop(val);\n        if (cm.display.scroller.scrollTop != val) { cm.display.scroller.scrollTop = val; }\n    }\n\n    // Sync scroller and scrollbar, ensure the gutter elements are\n    // aligned.\n    function setScrollLeft(cm, val, isScroller, forceScroll) {\n        val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\n        if ((isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) && !forceScroll) { return }\n        cm.doc.scrollLeft = val;\n        alignHorizontally(cm);\n        if (cm.display.scroller.scrollLeft != val) { cm.display.scroller.scrollLeft = val; }\n        cm.display.scrollbars.setScrollLeft(val);\n    }\n\n    // SCROLLBARS\n\n    // Prepare DOM reads needed to update the scrollbars. Done in one\n    // shot to minimize update/measure roundtrips.\n    function measureForScrollbars(cm) {\n        var d = cm.display, gutterW = d.gutters.offsetWidth;\n        var docH = Math.round(cm.doc.height + paddingVert(cm.display));\n        return {\n            clientHeight: d.scroller.clientHeight,\n            viewHeight: d.wrapper.clientHeight,\n            scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,\n            viewWidth: d.wrapper.clientWidth,\n            barLeft: cm.options.fixedGutter ? gutterW : 0,\n            docHeight: docH,\n            scrollHeight: docH + scrollGap(cm) + d.barHeight,\n            nativeBarWidth: d.nativeBarWidth,\n            gutterWidth: gutterW\n        }\n    }\n\n    var NativeScrollbars = function(place, scroll, cm) {\n        this.cm = cm;\n        var vert = this.vert = elt("div", [elt("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");\n        var horiz = this.horiz = elt("div", [elt("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");\n        vert.tabIndex = horiz.tabIndex = -1;\n        place(vert); place(horiz);\n\n        on(vert, "scroll", function () {\n            if (vert.clientHeight) { scroll(vert.scrollTop, "vertical"); }\n        });\n        on(horiz, "scroll", function () {\n            if (horiz.clientWidth) { scroll(horiz.scrollLeft, "horizontal"); }\n        });\n\n        this.checkedZeroWidth = false;\n        // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\n        if (ie && ie_version < 8) { this.horiz.style.minHeight = this.vert.style.minWidth = "18px"; }\n    };\n\n    NativeScrollbars.prototype.update = function (measure) {\n        var needsH = measure.scrollWidth > measure.clientWidth + 1;\n        var needsV = measure.scrollHeight > measure.clientHeight + 1;\n        var sWidth = measure.nativeBarWidth;\n\n        if (needsV) {\n            this.vert.style.display = "block";\n            this.vert.style.bottom = needsH ? sWidth + "px" : "0";\n            var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);\n            // A bug in IE8 can cause this value to be negative, so guard it.\n            this.vert.firstChild.style.height =\n                Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + "px";\n        } else {\n            this.vert.style.display = "";\n            this.vert.firstChild.style.height = "0";\n        }\n\n        if (needsH) {\n            this.horiz.style.display = "block";\n            this.horiz.style.right = needsV ? sWidth + "px" : "0";\n            this.horiz.style.left = measure.barLeft + "px";\n            var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);\n            this.horiz.firstChild.style.width =\n                Math.max(0, measure.scrollWidth - measure.clientWidth + totalWidth) + "px";\n        } else {\n            this.horiz.style.display = "";\n            this.horiz.firstChild.style.width = "0";\n        }\n\n        if (!this.checkedZeroWidth && measure.clientHeight > 0) {\n            if (sWidth == 0) { this.zeroWidthHack(); }\n            this.checkedZeroWidth = true;\n        }\n\n        return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0}\n    };\n\n    NativeScrollbars.prototype.setScrollLeft = function (pos) {\n        if (this.horiz.scrollLeft != pos) { this.horiz.scrollLeft = pos; }\n        if (this.disableHoriz) { this.enableZeroWidthBar(this.horiz, this.disableHoriz, "horiz"); }\n    };\n\n    NativeScrollbars.prototype.setScrollTop = function (pos) {\n        if (this.vert.scrollTop != pos) { this.vert.scrollTop = pos; }\n        if (this.disableVert) { this.enableZeroWidthBar(this.vert, this.disableVert, "vert"); }\n    };\n\n    NativeScrollbars.prototype.zeroWidthHack = function () {\n        var w = mac && !mac_geMountainLion ? "12px" : "18px";\n        this.horiz.style.height = this.vert.style.width = w;\n        this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none";\n        this.disableHoriz = new Delayed;\n        this.disableVert = new Delayed;\n    };\n\n    NativeScrollbars.prototype.enableZeroWidthBar = function (bar, delay, type) {\n        bar.style.pointerEvents = "auto";\n        function maybeDisable() {\n            // To find out whether the scrollbar is still visible, we\n            // check whether the element under the pixel in the bottom\n            // right corner of the scrollbar box is the scrollbar box\n            // itself (when the bar is still visible) or its filler child\n            // (when the bar is hidden). If it is still visible, we keep\n            // it enabled, if it\'s hidden, we disable pointer events.\n            var box = bar.getBoundingClientRect();\n            var elt$$1 = type == "vert" ? document.elementFromPoint(box.right - 1, (box.top + box.bottom) / 2)\n                : document.elementFromPoint((box.right + box.left) / 2, box.bottom - 1);\n            if (elt$$1 != bar) { bar.style.pointerEvents = "none"; }\n            else { delay.set(1000, maybeDisable); }\n        }\n        delay.set(1000, maybeDisable);\n    };\n\n    NativeScrollbars.prototype.clear = function () {\n        var parent = this.horiz.parentNode;\n        parent.removeChild(this.horiz);\n        parent.removeChild(this.vert);\n    };\n\n    var NullScrollbars = function () {};\n\n    NullScrollbars.prototype.update = function () { return {bottom: 0, right: 0} };\n    NullScrollbars.prototype.setScrollLeft = function () {};\n    NullScrollbars.prototype.setScrollTop = function () {};\n    NullScrollbars.prototype.clear = function () {};\n\n    function updateScrollbars(cm, measure) {\n        if (!measure) { measure = measureForScrollbars(cm); }\n        var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;\n        updateScrollbarsInner(cm, measure);\n        for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {\n            if (startWidth != cm.display.barWidth && cm.options.lineWrapping)\n            { updateHeightsInViewport(cm); }\n            updateScrollbarsInner(cm, measureForScrollbars(cm));\n            startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;\n        }\n    }\n\n    // Re-synchronize the fake scrollbars with the actual size of the\n    // content.\n    function updateScrollbarsInner(cm, measure) {\n        var d = cm.display;\n        var sizes = d.scrollbars.update(measure);\n\n        d.sizer.style.paddingRight = (d.barWidth = sizes.right) + "px";\n        d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + "px";\n        d.heightForcer.style.borderBottom = sizes.bottom + "px solid transparent";\n\n        if (sizes.right && sizes.bottom) {\n            d.scrollbarFiller.style.display = "block";\n            d.scrollbarFiller.style.height = sizes.bottom + "px";\n            d.scrollbarFiller.style.width = sizes.right + "px";\n        } else { d.scrollbarFiller.style.display = ""; }\n        if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\n            d.gutterFiller.style.display = "block";\n            d.gutterFiller.style.height = sizes.bottom + "px";\n            d.gutterFiller.style.width = measure.gutterWidth + "px";\n        } else { d.gutterFiller.style.display = ""; }\n    }\n\n    var scrollbarModel = {"native": NativeScrollbars, "null": NullScrollbars};\n\n    function initScrollbars(cm) {\n        if (cm.display.scrollbars) {\n            cm.display.scrollbars.clear();\n            if (cm.display.scrollbars.addClass)\n            { rmClass(cm.display.wrapper, cm.display.scrollbars.addClass); }\n        }\n\n        cm.display.scrollbars = new scrollbarModel[cm.options.scrollbarStyle](function (node) {\n            cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);\n            // Prevent clicks in the scrollbars from killing focus\n            on(node, "mousedown", function () {\n                if (cm.state.focused) { setTimeout(function () { return cm.display.input.focus(); }, 0); }\n            });\n            node.setAttribute("cm-not-content", "true");\n        }, function (pos, axis) {\n            if (axis == "horizontal") { setScrollLeft(cm, pos); }\n            else { updateScrollTop(cm, pos); }\n        }, cm);\n        if (cm.display.scrollbars.addClass)\n        { addClass(cm.display.wrapper, cm.display.scrollbars.addClass); }\n    }\n\n    // Operations are used to wrap a series of changes to the editor\n    // state in such a way that each change won\'t have to update the\n    // cursor and display (which would be awkward, slow, and\n    // error-prone). Instead, display updates are batched and then all\n    // combined and executed at once.\n\n    var nextOpId = 0;\n    // Start a new operation.\n    function startOperation(cm) {\n        cm.curOp = {\n            cm: cm,\n            viewChanged: false,      // Flag that indicates that lines might need to be redrawn\n            startHeight: cm.doc.height, // Used to detect need to update scrollbar\n            forceUpdate: false,      // Used to force a redraw\n            updateInput: 0,       // Whether to reset the input textarea\n            typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\n            changeObjs: null,        // Accumulated changes, for firing change events\n            cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\n            cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\n            selectionChanged: false, // Whether the selection needs to be redrawn\n            updateMaxLine: false,    // Set when the widest line needs to be determined anew\n            scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\n            scrollToPos: null,       // Used to scroll to a specific position\n            focus: false,\n            id: ++nextOpId           // Unique ID\n        };\n        pushOperation(cm.curOp);\n    }\n\n    // Finish an operation, updating the display and signalling delayed events\n    function endOperation(cm) {\n        var op = cm.curOp;\n        if (op) { finishOperation(op, function (group) {\n            for (var i = 0; i < group.ops.length; i++)\n            { group.ops[i].cm.curOp = null; }\n            endOperations(group);\n        }); }\n    }\n\n    // The DOM updates done when an operation finishes are batched so\n    // that the minimum number of relayouts are required.\n    function endOperations(group) {\n        var ops = group.ops;\n        for (var i = 0; i < ops.length; i++) // Read DOM\n        { endOperation_R1(ops[i]); }\n        for (var i$1 = 0; i$1 < ops.length; i$1++) // Write DOM (maybe)\n        { endOperation_W1(ops[i$1]); }\n        for (var i$2 = 0; i$2 < ops.length; i$2++) // Read DOM\n        { endOperation_R2(ops[i$2]); }\n        for (var i$3 = 0; i$3 < ops.length; i$3++) // Write DOM (maybe)\n        { endOperation_W2(ops[i$3]); }\n        for (var i$4 = 0; i$4 < ops.length; i$4++) // Read DOM\n        { endOperation_finish(ops[i$4]); }\n    }\n\n    function endOperation_R1(op) {\n        var cm = op.cm, display = cm.display;\n        maybeClipScrollbars(cm);\n        if (op.updateMaxLine) { findMaxLine(cm); }\n\n        op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\n            op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\n                op.scrollToPos.to.line >= display.viewTo) ||\n            display.maxLineChanged && cm.options.lineWrapping;\n        op.update = op.mustUpdate &&\n            new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\n    }\n\n    function endOperation_W1(op) {\n        op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\n    }\n\n    function endOperation_R2(op) {\n        var cm = op.cm, display = cm.display;\n        if (op.updatedDisplay) { updateHeightsInViewport(cm); }\n\n        op.barMeasure = measureForScrollbars(cm);\n\n        // If the max line changed since it was last measured, measure it,\n        // and ensure the document\'s width matches it.\n        // updateDisplay_W2 will use these properties to do the actual resizing\n        if (display.maxLineChanged && !cm.options.lineWrapping) {\n            op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\n            cm.display.sizerWidth = op.adjustWidthTo;\n            op.barMeasure.scrollWidth =\n                Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);\n            op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));\n        }\n\n        if (op.updatedDisplay || op.selectionChanged)\n        { op.preparedSelection = display.input.prepareSelection(); }\n    }\n\n    function endOperation_W2(op) {\n        var cm = op.cm;\n\n        if (op.adjustWidthTo != null) {\n            cm.display.sizer.style.minWidth = op.adjustWidthTo + "px";\n            if (op.maxScrollLeft < cm.doc.scrollLeft)\n            { setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true); }\n            cm.display.maxLineChanged = false;\n        }\n\n        var takeFocus = op.focus && op.focus == activeElt();\n        if (op.preparedSelection)\n        { cm.display.input.showSelection(op.preparedSelection, takeFocus); }\n        if (op.updatedDisplay || op.startHeight != cm.doc.height)\n        { updateScrollbars(cm, op.barMeasure); }\n        if (op.updatedDisplay)\n        { setDocumentHeight(cm, op.barMeasure); }\n\n        if (op.selectionChanged) { restartBlink(cm); }\n\n        if (cm.state.focused && op.updateInput)\n        { cm.display.input.reset(op.typing); }\n        if (takeFocus) { ensureFocus(op.cm); }\n    }\n\n    function endOperation_finish(op) {\n        var cm = op.cm, display = cm.display, doc = cm.doc;\n\n        if (op.updatedDisplay) { postUpdateDisplay(cm, op.update); }\n\n        // Abort mouse wheel delta measurement, when scrolling explicitly\n        if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\n        { display.wheelStartX = display.wheelStartY = null; }\n\n        // Propagate the scroll position to the actual DOM scroller\n        if (op.scrollTop != null) { setScrollTop(cm, op.scrollTop, op.forceScroll); }\n\n        if (op.scrollLeft != null) { setScrollLeft(cm, op.scrollLeft, true, true); }\n        // If we need to scroll a specific position into view, do so.\n        if (op.scrollToPos) {\n            var rect = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\n                clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\n            maybeScrollWindow(cm, rect);\n        }\n\n        // Fire events for markers that are hidden/unidden by editing or\n        // undoing\n        var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\n        if (hidden) { for (var i = 0; i < hidden.length; ++i)\n        { if (!hidden[i].lines.length) { signal(hidden[i], "hide"); } } }\n        if (unhidden) { for (var i$1 = 0; i$1 < unhidden.length; ++i$1)\n        { if (unhidden[i$1].lines.length) { signal(unhidden[i$1], "unhide"); } } }\n\n        if (display.wrapper.offsetHeight)\n        { doc.scrollTop = cm.display.scroller.scrollTop; }\n\n        // Fire change events, and delayed event handlers\n        if (op.changeObjs)\n        { signal(cm, "changes", cm, op.changeObjs); }\n        if (op.update)\n        { op.update.finish(); }\n    }\n\n    // Run the given function in an operation\n    function runInOp(cm, f) {\n        if (cm.curOp) { return f() }\n        startOperation(cm);\n        try { return f() }\n        finally { endOperation(cm); }\n    }\n    // Wraps a function in an operation. Returns the wrapped function.\n    function operation(cm, f) {\n        return function() {\n            if (cm.curOp) { return f.apply(cm, arguments) }\n            startOperation(cm);\n            try { return f.apply(cm, arguments) }\n            finally { endOperation(cm); }\n        }\n    }\n    // Used to add methods to editor and doc instances, wrapping them in\n    // operations.\n    function methodOp(f) {\n        return function() {\n            if (this.curOp) { return f.apply(this, arguments) }\n            startOperation(this);\n            try { return f.apply(this, arguments) }\n            finally { endOperation(this); }\n        }\n    }\n    function docMethodOp(f) {\n        return function() {\n            var cm = this.cm;\n            if (!cm || cm.curOp) { return f.apply(this, arguments) }\n            startOperation(cm);\n            try { return f.apply(this, arguments) }\n            finally { endOperation(cm); }\n        }\n    }\n\n    // Updates the display.view data structure for a given change to the\n    // document. From and to are in pre-change coordinates. Lendiff is\n    // the amount of lines added or subtracted by the change. This is\n    // used for changes that span multiple lines, or change the way\n    // lines are divided into visual lines. regLineChange (below)\n    // registers single-line changes.\n    function regChange(cm, from, to, lendiff) {\n        if (from == null) { from = cm.doc.first; }\n        if (to == null) { to = cm.doc.first + cm.doc.size; }\n        if (!lendiff) { lendiff = 0; }\n\n        var display = cm.display;\n        if (lendiff && to < display.viewTo &&\n            (display.updateLineNumbers == null || display.updateLineNumbers > from))\n        { display.updateLineNumbers = from; }\n\n        cm.curOp.viewChanged = true;\n\n        if (from >= display.viewTo) { // Change after\n            if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\n            { resetView(cm); }\n        } else if (to <= display.viewFrom) { // Change before\n            if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\n                resetView(cm);\n            } else {\n                display.viewFrom += lendiff;\n                display.viewTo += lendiff;\n            }\n        } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\n            resetView(cm);\n        } else if (from <= display.viewFrom) { // Top overlap\n            var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\n            if (cut) {\n                display.view = display.view.slice(cut.index);\n                display.viewFrom = cut.lineN;\n                display.viewTo += lendiff;\n            } else {\n                resetView(cm);\n            }\n        } else if (to >= display.viewTo) { // Bottom overlap\n            var cut$1 = viewCuttingPoint(cm, from, from, -1);\n            if (cut$1) {\n                display.view = display.view.slice(0, cut$1.index);\n                display.viewTo = cut$1.lineN;\n            } else {\n                resetView(cm);\n            }\n        } else { // Gap in the middle\n            var cutTop = viewCuttingPoint(cm, from, from, -1);\n            var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\n            if (cutTop && cutBot) {\n                display.view = display.view.slice(0, cutTop.index)\n                    .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\n                    .concat(display.view.slice(cutBot.index));\n                display.viewTo += lendiff;\n            } else {\n                resetView(cm);\n            }\n        }\n\n        var ext = display.externalMeasured;\n        if (ext) {\n            if (to < ext.lineN)\n            { ext.lineN += lendiff; }\n            else if (from < ext.lineN + ext.size)\n            { display.externalMeasured = null; }\n        }\n    }\n\n    // Register a change to a single line. Type must be one of "text",\n    // "gutter", "class", "widget"\n    function regLineChange(cm, line, type) {\n        cm.curOp.viewChanged = true;\n        var display = cm.display, ext = cm.display.externalMeasured;\n        if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\n        { display.externalMeasured = null; }\n\n        if (line < display.viewFrom || line >= display.viewTo) { return }\n        var lineView = display.view[findViewIndex(cm, line)];\n        if (lineView.node == null) { return }\n        var arr = lineView.changes || (lineView.changes = []);\n        if (indexOf(arr, type) == -1) { arr.push(type); }\n    }\n\n    // Clear the view.\n    function resetView(cm) {\n        cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\n        cm.display.view = [];\n        cm.display.viewOffset = 0;\n    }\n\n    function viewCuttingPoint(cm, oldN, newN, dir) {\n        var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\n        if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\n        { return {index: index, lineN: newN} }\n        var n = cm.display.viewFrom;\n        for (var i = 0; i < index; i++)\n        { n += view[i].size; }\n        if (n != oldN) {\n            if (dir > 0) {\n                if (index == view.length - 1) { return null }\n                diff = (n + view[index].size) - oldN;\n                index++;\n            } else {\n                diff = n - oldN;\n            }\n            oldN += diff; newN += diff;\n        }\n        while (visualLineNo(cm.doc, newN) != newN) {\n            if (index == (dir < 0 ? 0 : view.length - 1)) { return null }\n            newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\n            index += dir;\n        }\n        return {index: index, lineN: newN}\n    }\n\n    // Force the view to cover a given range, adding empty view element\n    // or clipping off existing ones as needed.\n    function adjustView(cm, from, to) {\n        var display = cm.display, view = display.view;\n        if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\n            display.view = buildViewArray(cm, from, to);\n            display.viewFrom = from;\n        } else {\n            if (display.viewFrom > from)\n            { display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view); }\n            else if (display.viewFrom < from)\n            { display.view = display.view.slice(findViewIndex(cm, from)); }\n            display.viewFrom = from;\n            if (display.viewTo < to)\n            { display.view = display.view.concat(buildViewArray(cm, display.viewTo, to)); }\n            else if (display.viewTo > to)\n            { display.view = display.view.slice(0, findViewIndex(cm, to)); }\n        }\n        display.viewTo = to;\n    }\n\n    // Count the number of lines in the view whose DOM representation is\n    // out of date (or nonexistent).\n    function countDirtyView(cm) {\n        var view = cm.display.view, dirty = 0;\n        for (var i = 0; i < view.length; i++) {\n            var lineView = view[i];\n            if (!lineView.hidden && (!lineView.node || lineView.changes)) { ++dirty; }\n        }\n        return dirty\n    }\n\n    // HIGHLIGHT WORKER\n\n    function startWorker(cm, time) {\n        if (cm.doc.highlightFrontier < cm.display.viewTo)\n        { cm.state.highlight.set(time, bind(highlightWorker, cm)); }\n    }\n\n    function highlightWorker(cm) {\n        var doc = cm.doc;\n        if (doc.highlightFrontier >= cm.display.viewTo) { return }\n        var end = +new Date + cm.options.workTime;\n        var context = getContextBefore(cm, doc.highlightFrontier);\n        var changedLines = [];\n\n        doc.iter(context.line, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function (line) {\n            if (context.line >= cm.display.viewFrom) { // Visible\n                var oldStyles = line.styles;\n                var resetState = line.text.length > cm.options.maxHighlightLength ? copyState(doc.mode, context.state) : null;\n                var highlighted = highlightLine(cm, line, context, true);\n                if (resetState) { context.state = resetState; }\n                line.styles = highlighted.styles;\n                var oldCls = line.styleClasses, newCls = highlighted.classes;\n                if (newCls) { line.styleClasses = newCls; }\n                else if (oldCls) { line.styleClasses = null; }\n                var ischange = !oldStyles || oldStyles.length != line.styles.length ||\n                    oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\n                for (var i = 0; !ischange && i < oldStyles.length; ++i) { ischange = oldStyles[i] != line.styles[i]; }\n                if (ischange) { changedLines.push(context.line); }\n                line.stateAfter = context.save();\n                context.nextLine();\n            } else {\n                if (line.text.length <= cm.options.maxHighlightLength)\n                { processLine(cm, line.text, context); }\n                line.stateAfter = context.line % 5 == 0 ? context.save() : null;\n                context.nextLine();\n            }\n            if (+new Date > end) {\n                startWorker(cm, cm.options.workDelay);\n                return true\n            }\n        });\n        doc.highlightFrontier = context.line;\n        doc.modeFrontier = Math.max(doc.modeFrontier, context.line);\n        if (changedLines.length) { runInOp(cm, function () {\n            for (var i = 0; i < changedLines.length; i++)\n            { regLineChange(cm, changedLines[i], "text"); }\n        }); }\n    }\n\n    // DISPLAY DRAWING\n\n    var DisplayUpdate = function(cm, viewport, force) {\n        var display = cm.display;\n\n        this.viewport = viewport;\n        // Store some values that we\'ll need later (but don\'t want to force a relayout for)\n        this.visible = visibleLines(display, cm.doc, viewport);\n        this.editorIsHidden = !display.wrapper.offsetWidth;\n        this.wrapperHeight = display.wrapper.clientHeight;\n        this.wrapperWidth = display.wrapper.clientWidth;\n        this.oldDisplayWidth = displayWidth(cm);\n        this.force = force;\n        this.dims = getDimensions(cm);\n        this.events = [];\n    };\n\n    DisplayUpdate.prototype.signal = function (emitter, type) {\n        if (hasHandler(emitter, type))\n        { this.events.push(arguments); }\n    };\n    DisplayUpdate.prototype.finish = function () {\n        for (var i = 0; i < this.events.length; i++)\n        { signal.apply(null, this.events[i]); }\n    };\n\n    function maybeClipScrollbars(cm) {\n        var display = cm.display;\n        if (!display.scrollbarsClipped && display.scroller.offsetWidth) {\n            display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;\n            display.heightForcer.style.height = scrollGap(cm) + "px";\n            display.sizer.style.marginBottom = -display.nativeBarWidth + "px";\n            display.sizer.style.borderRightWidth = scrollGap(cm) + "px";\n            display.scrollbarsClipped = true;\n        }\n    }\n\n    function selectionSnapshot(cm) {\n        if (cm.hasFocus()) { return null }\n        var active = activeElt();\n        if (!active || !contains(cm.display.lineDiv, active)) { return null }\n        var result = {activeElt: active};\n        if (window.getSelection) {\n            var sel = window.getSelection();\n            if (sel.anchorNode && sel.extend && contains(cm.display.lineDiv, sel.anchorNode)) {\n                result.anchorNode = sel.anchorNode;\n                result.anchorOffset = sel.anchorOffset;\n                result.focusNode = sel.focusNode;\n                result.focusOffset = sel.focusOffset;\n            }\n        }\n        return result\n    }\n\n    function restoreSelection(snapshot) {\n        if (!snapshot || !snapshot.activeElt || snapshot.activeElt == activeElt()) { return }\n        snapshot.activeElt.focus();\n        if (snapshot.anchorNode && contains(document.body, snapshot.anchorNode) && contains(document.body, snapshot.focusNode)) {\n            var sel = window.getSelection(), range$$1 = document.createRange();\n            range$$1.setEnd(snapshot.anchorNode, snapshot.anchorOffset);\n            range$$1.collapse(false);\n            sel.removeAllRanges();\n            sel.addRange(range$$1);\n            sel.extend(snapshot.focusNode, snapshot.focusOffset);\n        }\n    }\n\n    // Does the actual updating of the line display. Bails out\n    // (returning false) when there is nothing to be done and forced is\n    // false.\n    function updateDisplayIfNeeded(cm, update) {\n        var display = cm.display, doc = cm.doc;\n\n        if (update.editorIsHidden) {\n            resetView(cm);\n            return false\n        }\n\n        // Bail out if the visible area is already rendered and nothing changed.\n        if (!update.force &&\n            update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\n            (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\n            display.renderedView == display.view && countDirtyView(cm) == 0)\n        { return false }\n\n        if (maybeUpdateLineNumberWidth(cm)) {\n            resetView(cm);\n            update.dims = getDimensions(cm);\n        }\n\n        // Compute a suitable new viewport (from & to)\n        var end = doc.first + doc.size;\n        var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\n        var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\n        if (display.viewFrom < from && from - display.viewFrom < 20) { from = Math.max(doc.first, display.viewFrom); }\n        if (display.viewTo > to && display.viewTo - to < 20) { to = Math.min(end, display.viewTo); }\n        if (sawCollapsedSpans) {\n            from = visualLineNo(cm.doc, from);\n            to = visualLineEndNo(cm.doc, to);\n        }\n\n        var different = from != display.viewFrom || to != display.viewTo ||\n            display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\n        adjustView(cm, from, to);\n\n        display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\n        // Position the mover div to align with the current scroll position\n        cm.display.mover.style.top = display.viewOffset + "px";\n\n        var toUpdate = countDirtyView(cm);\n        if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&\n            (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\n        { return false }\n\n        // For big changes, we hide the enclosing element during the\n        // update, since that speeds up the operations on most browsers.\n        var selSnapshot = selectionSnapshot(cm);\n        if (toUpdate > 4) { display.lineDiv.style.display = "none"; }\n        patchDisplay(cm, display.updateLineNumbers, update.dims);\n        if (toUpdate > 4) { display.lineDiv.style.display = ""; }\n        display.renderedView = display.view;\n        // There might have been a widget with a focused element that got\n        // hidden or updated, if so re-focus it.\n        restoreSelection(selSnapshot);\n\n        // Prevent selection and cursors from interfering with the scroll\n        // width and height.\n        removeChildren(display.cursorDiv);\n        removeChildren(display.selectionDiv);\n        display.gutters.style.height = display.sizer.style.minHeight = 0;\n\n        if (different) {\n            display.lastWrapHeight = update.wrapperHeight;\n            display.lastWrapWidth = update.wrapperWidth;\n            startWorker(cm, 400);\n        }\n\n        display.updateLineNumbers = null;\n\n        return true\n    }\n\n    function postUpdateDisplay(cm, update) {\n        var viewport = update.viewport;\n\n        for (var first = true;; first = false) {\n            if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {\n                // Clip forced viewport to actual scrollable area.\n                if (viewport && viewport.top != null)\n                { viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)}; }\n                // Updated line heights might result in the drawn area not\n                // actually covering the viewport. Keep looping until it does.\n                update.visible = visibleLines(cm.display, cm.doc, viewport);\n                if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\n                { break }\n            }\n            if (!updateDisplayIfNeeded(cm, update)) { break }\n            updateHeightsInViewport(cm);\n            var barMeasure = measureForScrollbars(cm);\n            updateSelection(cm);\n            updateScrollbars(cm, barMeasure);\n            setDocumentHeight(cm, barMeasure);\n            update.force = false;\n        }\n\n        update.signal(cm, "update", cm);\n        if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {\n            update.signal(cm, "viewportChange", cm, cm.display.viewFrom, cm.display.viewTo);\n            cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;\n        }\n    }\n\n    function updateDisplaySimple(cm, viewport) {\n        var update = new DisplayUpdate(cm, viewport);\n        if (updateDisplayIfNeeded(cm, update)) {\n            updateHeightsInViewport(cm);\n            postUpdateDisplay(cm, update);\n            var barMeasure = measureForScrollbars(cm);\n            updateSelection(cm);\n            updateScrollbars(cm, barMeasure);\n            setDocumentHeight(cm, barMeasure);\n            update.finish();\n        }\n    }\n\n    // Sync the actual display DOM structure with display.view, removing\n    // nodes for lines that are no longer in view, and creating the ones\n    // that are not there yet, and updating the ones that are out of\n    // date.\n    function patchDisplay(cm, updateNumbersFrom, dims) {\n        var display = cm.display, lineNumbers = cm.options.lineNumbers;\n        var container = display.lineDiv, cur = container.firstChild;\n\n        function rm(node) {\n            var next = node.nextSibling;\n            // Works around a throw-scroll bug in OS X Webkit\n            if (webkit && mac && cm.display.currentWheelTarget == node)\n            { node.style.display = "none"; }\n            else\n            { node.parentNode.removeChild(node); }\n            return next\n        }\n\n        var view = display.view, lineN = display.viewFrom;\n        // Loop over the elements in the view, syncing cur (the DOM nodes\n        // in display.lineDiv) with the view as we go.\n        for (var i = 0; i < view.length; i++) {\n            var lineView = view[i];\n            if (lineView.hidden) ; else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet\n                var node = buildLineElement(cm, lineView, lineN, dims);\n                container.insertBefore(node, cur);\n            } else { // Already drawn\n                while (cur != lineView.node) { cur = rm(cur); }\n                var updateNumber = lineNumbers && updateNumbersFrom != null &&\n                    updateNumbersFrom <= lineN && lineView.lineNumber;\n                if (lineView.changes) {\n                    if (indexOf(lineView.changes, "gutter") > -1) { updateNumber = false; }\n                    updateLineForChanges(cm, lineView, lineN, dims);\n                }\n                if (updateNumber) {\n                    removeChildren(lineView.lineNumber);\n                    lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\n                }\n                cur = lineView.node.nextSibling;\n            }\n            lineN += lineView.size;\n        }\n        while (cur) { cur = rm(cur); }\n    }\n\n    function updateGutterSpace(cm) {\n        var width = cm.display.gutters.offsetWidth;\n        cm.display.sizer.style.marginLeft = width + "px";\n    }\n\n    function setDocumentHeight(cm, measure) {\n        cm.display.sizer.style.minHeight = measure.docHeight + "px";\n        cm.display.heightForcer.style.top = measure.docHeight + "px";\n        cm.display.gutters.style.height = (measure.docHeight + cm.display.barHeight + scrollGap(cm)) + "px";\n    }\n\n    // Rebuild the gutter elements, ensure the margin to the left of the\n    // code matches their width.\n    function updateGutters(cm) {\n        var gutters = cm.display.gutters, specs = cm.options.gutters;\n        removeChildren(gutters);\n        var i = 0;\n        for (; i < specs.length; ++i) {\n            var gutterClass = specs[i];\n            var gElt = gutters.appendChild(elt("div", null, "CodeMirror-gutter " + gutterClass));\n            if (gutterClass == "CodeMirror-linenumbers") {\n                cm.display.lineGutter = gElt;\n                gElt.style.width = (cm.display.lineNumWidth || 1) + "px";\n            }\n        }\n        gutters.style.display = i ? "" : "none";\n        updateGutterSpace(cm);\n    }\n\n    // Make sure the gutters options contains the element\n    // "CodeMirror-linenumbers" when the lineNumbers option is true.\n    function setGuttersForLineNumbers(options) {\n        var found = indexOf(options.gutters, "CodeMirror-linenumbers");\n        if (found == -1 && options.lineNumbers) {\n            options.gutters = options.gutters.concat(["CodeMirror-linenumbers"]);\n        } else if (found > -1 && !options.lineNumbers) {\n            options.gutters = options.gutters.slice(0);\n            options.gutters.splice(found, 1);\n        }\n    }\n\n    // Since the delta values reported on mouse wheel events are\n    // unstandardized between browsers and even browser versions, and\n    // generally horribly unpredictable, this code starts by measuring\n    // the scroll effect that the first few mouse wheel events have,\n    // and, from that, detects the way it can convert deltas to pixel\n    // offsets afterwards.\n    //\n    // The reason we want to know the amount a wheel event will scroll\n    // is that it gives us a chance to update the display before the\n    // actual scrolling happens, reducing flickering.\n\n    var wheelSamples = 0, wheelPixelsPerUnit = null;\n    // Fill in a browser-detected starting value on browsers where we\n    // know one. These don\'t have to be accurate -- the result of them\n    // being wrong would just be a slight flicker on the first wheel\n    // scroll (if it is large enough).\n    if (ie) { wheelPixelsPerUnit = -.53; }\n    else if (gecko) { wheelPixelsPerUnit = 15; }\n    else if (chrome) { wheelPixelsPerUnit = -.7; }\n    else if (safari) { wheelPixelsPerUnit = -1/3; }\n\n    function wheelEventDelta(e) {\n        var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\n        if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) { dx = e.detail; }\n        if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) { dy = e.detail; }\n        else if (dy == null) { dy = e.wheelDelta; }\n        return {x: dx, y: dy}\n    }\n    function wheelEventPixels(e) {\n        var delta = wheelEventDelta(e);\n        delta.x *= wheelPixelsPerUnit;\n        delta.y *= wheelPixelsPerUnit;\n        return delta\n    }\n\n    function onScrollWheel(cm, e) {\n        var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;\n\n        var display = cm.display, scroll = display.scroller;\n        // Quit if there\'s nothing to scroll here\n        var canScrollX = scroll.scrollWidth > scroll.clientWidth;\n        var canScrollY = scroll.scrollHeight > scroll.clientHeight;\n        if (!(dx && canScrollX || dy && canScrollY)) { return }\n\n        // Webkit browsers on OS X abort momentum scrolls when the target\n        // of the scroll event is removed from the scrollable element.\n        // This hack (see related code in patchDisplay) makes sure the\n        // element is kept around.\n        if (dy && mac && webkit) {\n            outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\n                for (var i = 0; i < view.length; i++) {\n                    if (view[i].node == cur) {\n                        cm.display.currentWheelTarget = cur;\n                        break outer\n                    }\n                }\n            }\n        }\n\n        // On some browsers, horizontal scrolling will cause redraws to\n        // happen before the gutter has been realigned, causing it to\n        // wriggle around in a most unseemly way. When we have an\n        // estimated pixels/delta value, we just handle horizontal\n        // scrolling entirely here. It\'ll be slightly off from native, but\n        // better than glitching out.\n        if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\n            if (dy && canScrollY)\n            { updateScrollTop(cm, Math.max(0, scroll.scrollTop + dy * wheelPixelsPerUnit)); }\n            setScrollLeft(cm, Math.max(0, scroll.scrollLeft + dx * wheelPixelsPerUnit));\n            // Only prevent default scrolling if vertical scrolling is\n            // actually possible. Otherwise, it causes vertical scroll\n            // jitter on OSX trackpads when deltaX is small and deltaY\n            // is large (issue #3579)\n            if (!dy || (dy && canScrollY))\n            { e_preventDefault(e); }\n            display.wheelStartX = null; // Abort measurement, if in progress\n            return\n        }\n\n        // \'Project\' the visible viewport to cover the area that is being\n        // scrolled into view (if we know enough to estimate it).\n        if (dy && wheelPixelsPerUnit != null) {\n            var pixels = dy * wheelPixelsPerUnit;\n            var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\n            if (pixels < 0) { top = Math.max(0, top + pixels - 50); }\n            else { bot = Math.min(cm.doc.height, bot + pixels + 50); }\n            updateDisplaySimple(cm, {top: top, bottom: bot});\n        }\n\n        if (wheelSamples < 20) {\n            if (display.wheelStartX == null) {\n                display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\n                display.wheelDX = dx; display.wheelDY = dy;\n                setTimeout(function () {\n                    if (display.wheelStartX == null) { return }\n                    var movedX = scroll.scrollLeft - display.wheelStartX;\n                    var movedY = scroll.scrollTop - display.wheelStartY;\n                    var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\n                        (movedX && display.wheelDX && movedX / display.wheelDX);\n                    display.wheelStartX = display.wheelStartY = null;\n                    if (!sample) { return }\n                    wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\n                    ++wheelSamples;\n                }, 200);\n            } else {\n                display.wheelDX += dx; display.wheelDY += dy;\n            }\n        }\n    }\n\n    // Selection objects are immutable. A new one is created every time\n    // the selection changes. A selection is one or more non-overlapping\n    // (and non-touching) ranges, sorted, and an integer that indicates\n    // which one is the primary selection (the one that\'s scrolled into\n    // view, that getCursor returns, etc).\n    var Selection = function(ranges, primIndex) {\n        this.ranges = ranges;\n        this.primIndex = primIndex;\n    };\n\n    Selection.prototype.primary = function () { return this.ranges[this.primIndex] };\n\n    Selection.prototype.equals = function (other) {\n        if (other == this) { return true }\n        if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) { return false }\n        for (var i = 0; i < this.ranges.length; i++) {\n            var here = this.ranges[i], there = other.ranges[i];\n            if (!equalCursorPos(here.anchor, there.anchor) || !equalCursorPos(here.head, there.head)) { return false }\n        }\n        return true\n    };\n\n    Selection.prototype.deepCopy = function () {\n        var out = [];\n        for (var i = 0; i < this.ranges.length; i++)\n        { out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head)); }\n        return new Selection(out, this.primIndex)\n    };\n\n    Selection.prototype.somethingSelected = function () {\n        for (var i = 0; i < this.ranges.length; i++)\n        { if (!this.ranges[i].empty()) { return true } }\n        return false\n    };\n\n    Selection.prototype.contains = function (pos, end) {\n        if (!end) { end = pos; }\n        for (var i = 0; i < this.ranges.length; i++) {\n            var range = this.ranges[i];\n            if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\n            { return i }\n        }\n        return -1\n    };\n\n    var Range = function(anchor, head) {\n        this.anchor = anchor; this.head = head;\n    };\n\n    Range.prototype.from = function () { return minPos(this.anchor, this.head) };\n    Range.prototype.to = function () { return maxPos(this.anchor, this.head) };\n    Range.prototype.empty = function () { return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch };\n\n    // Take an unsorted, potentially overlapping set of ranges, and\n    // build a selection out of it. \'Consumes\' ranges array (modifying\n    // it).\n    function normalizeSelection(cm, ranges, primIndex) {\n        var mayTouch = cm && cm.options.selectionsMayTouch;\n        var prim = ranges[primIndex];\n        ranges.sort(function (a, b) { return cmp(a.from(), b.from()); });\n        primIndex = indexOf(ranges, prim);\n        for (var i = 1; i < ranges.length; i++) {\n            var cur = ranges[i], prev = ranges[i - 1];\n            var diff = cmp(prev.to(), cur.from());\n            if (mayTouch && !cur.empty() ? diff > 0 : diff >= 0) {\n                var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\n                var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\n                if (i <= primIndex) { --primIndex; }\n                ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\n            }\n        }\n        return new Selection(ranges, primIndex)\n    }\n\n    function simpleSelection(anchor, head) {\n        return new Selection([new Range(anchor, head || anchor)], 0)\n    }\n\n    // Compute the position of the end of a change (its \'to\' property\n    // refers to the pre-change end).\n    function changeEnd(change) {\n        if (!change.text) { return change.to }\n        return Pos(change.from.line + change.text.length - 1,\n            lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0))\n    }\n\n    // Adjust a position to refer to the post-change position of the\n    // same text, or the end of the change if the change covers it.\n    function adjustForChange(pos, change) {\n        if (cmp(pos, change.from) < 0) { return pos }\n        if (cmp(pos, change.to) <= 0) { return changeEnd(change) }\n\n        var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\n        if (pos.line == change.to.line) { ch += changeEnd(change).ch - change.to.ch; }\n        return Pos(line, ch)\n    }\n\n    function computeSelAfterChange(doc, change) {\n        var out = [];\n        for (var i = 0; i < doc.sel.ranges.length; i++) {\n            var range = doc.sel.ranges[i];\n            out.push(new Range(adjustForChange(range.anchor, change),\n                adjustForChange(range.head, change)));\n        }\n        return normalizeSelection(doc.cm, out, doc.sel.primIndex)\n    }\n\n    function offsetPos(pos, old, nw) {\n        if (pos.line == old.line)\n        { return Pos(nw.line, pos.ch - old.ch + nw.ch) }\n        else\n        { return Pos(nw.line + (pos.line - old.line), pos.ch) }\n    }\n\n    // Used by replaceSelections to allow moving the selection to the\n    // start or around the replaced test. Hint may be "start" or "around".\n    function computeReplacedSel(doc, changes, hint) {\n        var out = [];\n        var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\n        for (var i = 0; i < changes.length; i++) {\n            var change = changes[i];\n            var from = offsetPos(change.from, oldPrev, newPrev);\n            var to = offsetPos(changeEnd(change), oldPrev, newPrev);\n            oldPrev = change.to;\n            newPrev = to;\n            if (hint == "around") {\n                var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\n                out[i] = new Range(inv ? to : from, inv ? from : to);\n            } else {\n                out[i] = new Range(from, from);\n            }\n        }\n        return new Selection(out, doc.sel.primIndex)\n    }\n\n    // Used to get the editor into a consistent state again when options change.\n\n    function loadMode(cm) {\n        cm.doc.mode = getMode(cm.options, cm.doc.modeOption);\n        resetModeState(cm);\n    }\n\n    function resetModeState(cm) {\n        cm.doc.iter(function (line) {\n            if (line.stateAfter) { line.stateAfter = null; }\n            if (line.styles) { line.styles = null; }\n        });\n        cm.doc.modeFrontier = cm.doc.highlightFrontier = cm.doc.first;\n        startWorker(cm, 100);\n        cm.state.modeGen++;\n        if (cm.curOp) { regChange(cm); }\n    }\n\n    // DOCUMENT DATA STRUCTURE\n\n    // By default, updates that start and end at the beginning of a line\n    // are treated specially, in order to make the association of line\n    // widgets and marker elements with the text behave more intuitive.\n    function isWholeLineUpdate(doc, change) {\n        return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == "" &&\n            (!doc.cm || doc.cm.options.wholeLineUpdateBefore)\n    }\n\n    // Perform a change on the document data structure.\n    function updateDoc(doc, change, markedSpans, estimateHeight$$1) {\n        function spansFor(n) {return markedSpans ? markedSpans[n] : null}\n        function update(line, text, spans) {\n            updateLine(line, text, spans, estimateHeight$$1);\n            signalLater(line, "change", line, change);\n        }\n        function linesFor(start, end) {\n            var result = [];\n            for (var i = start; i < end; ++i)\n            { result.push(new Line(text[i], spansFor(i), estimateHeight$$1)); }\n            return result\n        }\n\n        var from = change.from, to = change.to, text = change.text;\n        var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\n        var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\n\n        // Adjust the line structure\n        if (change.full) {\n            doc.insert(0, linesFor(0, text.length));\n            doc.remove(text.length, doc.size - text.length);\n        } else if (isWholeLineUpdate(doc, change)) {\n            // This is a whole-line replace. Treated specially to make\n            // sure line objects move the way they are supposed to.\n            var added = linesFor(0, text.length - 1);\n            update(lastLine, lastLine.text, lastSpans);\n            if (nlines) { doc.remove(from.line, nlines); }\n            if (added.length) { doc.insert(from.line, added); }\n        } else if (firstLine == lastLine) {\n            if (text.length == 1) {\n                update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\n            } else {\n                var added$1 = linesFor(1, text.length - 1);\n                added$1.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight$$1));\n                update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n                doc.insert(from.line + 1, added$1);\n            }\n        } else if (text.length == 1) {\n            update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\n            doc.remove(from.line + 1, nlines);\n        } else {\n            update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n            update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\n            var added$2 = linesFor(1, text.length - 1);\n            if (nlines > 1) { doc.remove(from.line + 1, nlines - 1); }\n            doc.insert(from.line + 1, added$2);\n        }\n\n        signalLater(doc, "change", doc, change);\n    }\n\n    // Call f for all linked documents.\n    function linkedDocs(doc, f, sharedHistOnly) {\n        function propagate(doc, skip, sharedHist) {\n            if (doc.linked) { for (var i = 0; i < doc.linked.length; ++i) {\n                var rel = doc.linked[i];\n                if (rel.doc == skip) { continue }\n                var shared = sharedHist && rel.sharedHist;\n                if (sharedHistOnly && !shared) { continue }\n                f(rel.doc, shared);\n                propagate(rel.doc, doc, shared);\n            } }\n        }\n        propagate(doc, null, true);\n    }\n\n    // Attach a document to an editor.\n    function attachDoc(cm, doc) {\n        if (doc.cm) { throw new Error("This document is already in use.") }\n        cm.doc = doc;\n        doc.cm = cm;\n        estimateLineHeights(cm);\n        loadMode(cm);\n        setDirectionClass(cm);\n        if (!cm.options.lineWrapping) { findMaxLine(cm); }\n        cm.options.mode = doc.modeOption;\n        regChange(cm);\n    }\n\n    function setDirectionClass(cm) {\n        (cm.doc.direction == "rtl" ? addClass : rmClass)(cm.display.lineDiv, "CodeMirror-rtl");\n    }\n\n    function directionChanged(cm) {\n        runInOp(cm, function () {\n            setDirectionClass(cm);\n            regChange(cm);\n        });\n    }\n\n    function History(startGen) {\n        // Arrays of change events and selections. Doing something adds an\n        // event to done and clears undo. Undoing moves events from done\n        // to undone, redoing moves them in the other direction.\n        this.done = []; this.undone = [];\n        this.undoDepth = Infinity;\n        // Used to track when changes can be merged into a single undo\n        // event\n        this.lastModTime = this.lastSelTime = 0;\n        this.lastOp = this.lastSelOp = null;\n        this.lastOrigin = this.lastSelOrigin = null;\n        // Used by the isClean() method\n        this.generation = this.maxGeneration = startGen || 1;\n    }\n\n    // Create a history change event from an updateDoc-style change\n    // object.\n    function historyChangeFromChange(doc, change) {\n        var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\n        attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\n        linkedDocs(doc, function (doc) { return attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1); }, true);\n        return histChange\n    }\n\n    // Pop all selection events off the end of a history array. Stop at\n    // a change event.\n    function clearSelectionEvents(array) {\n        while (array.length) {\n            var last = lst(array);\n            if (last.ranges) { array.pop(); }\n            else { break }\n        }\n    }\n\n    // Find the top change event in the history. Pop off selection\n    // events that are in the way.\n    function lastChangeEvent(hist, force) {\n        if (force) {\n            clearSelectionEvents(hist.done);\n            return lst(hist.done)\n        } else if (hist.done.length && !lst(hist.done).ranges) {\n            return lst(hist.done)\n        } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\n            hist.done.pop();\n            return lst(hist.done)\n        }\n    }\n\n    // Register a change in the history. Merges changes that are within\n    // a single operation, or are close together with an origin that\n    // allows merging (starting with "+") into a single event.\n    function addChangeToHistory(doc, change, selAfter, opId) {\n        var hist = doc.history;\n        hist.undone.length = 0;\n        var time = +new Date, cur;\n        var last;\n\n        if ((hist.lastOp == opId ||\n            hist.lastOrigin == change.origin && change.origin &&\n            ((change.origin.charAt(0) == "+" && hist.lastModTime > time - (doc.cm ? doc.cm.options.historyEventDelay : 500)) ||\n                change.origin.charAt(0) == "*")) &&\n            (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\n            // Merge this change into the last event\n            last = lst(cur.changes);\n            if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\n                // Optimized case for simple insertion -- don\'t want to add\n                // new changesets for every character typed\n                last.to = changeEnd(change);\n            } else {\n                // Add new sub-event\n                cur.changes.push(historyChangeFromChange(doc, change));\n            }\n        } else {\n            // Can not be merged, start a new event.\n            var before = lst(hist.done);\n            if (!before || !before.ranges)\n            { pushSelectionToHistory(doc.sel, hist.done); }\n            cur = {changes: [historyChangeFromChange(doc, change)],\n                generation: hist.generation};\n            hist.done.push(cur);\n            while (hist.done.length > hist.undoDepth) {\n                hist.done.shift();\n                if (!hist.done[0].ranges) { hist.done.shift(); }\n            }\n        }\n        hist.done.push(selAfter);\n        hist.generation = ++hist.maxGeneration;\n        hist.lastModTime = hist.lastSelTime = time;\n        hist.lastOp = hist.lastSelOp = opId;\n        hist.lastOrigin = hist.lastSelOrigin = change.origin;\n\n        if (!last) { signal(doc, "historyAdded"); }\n    }\n\n    function selectionEventCanBeMerged(doc, origin, prev, sel) {\n        var ch = origin.charAt(0);\n        return ch == "*" ||\n            ch == "+" &&\n            prev.ranges.length == sel.ranges.length &&\n            prev.somethingSelected() == sel.somethingSelected() &&\n            new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500)\n    }\n\n    // Called whenever the selection changes, sets the new selection as\n    // the pending selection in the history, and pushes the old pending\n    // selection into the \'done\' array when it was significantly\n    // different (in number of selected ranges, emptiness, or time).\n    function addSelectionToHistory(doc, sel, opId, options) {\n        var hist = doc.history, origin = options && options.origin;\n\n        // A new event is started when the previous origin does not match\n        // the current, or the origins don\'t allow matching. Origins\n        // starting with * are always merged, those starting with + are\n        // merged when similar and close together in time.\n        if (opId == hist.lastSelOp ||\n            (origin && hist.lastSelOrigin == origin &&\n                (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\n                    selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\n        { hist.done[hist.done.length - 1] = sel; }\n        else\n        { pushSelectionToHistory(sel, hist.done); }\n\n        hist.lastSelTime = +new Date;\n        hist.lastSelOrigin = origin;\n        hist.lastSelOp = opId;\n        if (options && options.clearRedo !== false)\n        { clearSelectionEvents(hist.undone); }\n    }\n\n    function pushSelectionToHistory(sel, dest) {\n        var top = lst(dest);\n        if (!(top && top.ranges && top.equals(sel)))\n        { dest.push(sel); }\n    }\n\n    // Used to store marked span information in the history.\n    function attachLocalSpans(doc, change, from, to) {\n        var existing = change["spans_" + doc.id], n = 0;\n        doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function (line) {\n            if (line.markedSpans)\n            { (existing || (existing = change["spans_" + doc.id] = {}))[n] = line.markedSpans; }\n            ++n;\n        });\n    }\n\n    // When un/re-doing restores text containing marked spans, those\n    // that have been explicitly cleared should not be restored.\n    function removeClearedSpans(spans) {\n        if (!spans) { return null }\n        var out;\n        for (var i = 0; i < spans.length; ++i) {\n            if (spans[i].marker.explicitlyCleared) { if (!out) { out = spans.slice(0, i); } }\n            else if (out) { out.push(spans[i]); }\n        }\n        return !out ? spans : out.length ? out : null\n    }\n\n    // Retrieve and filter the old marked spans stored in a change event.\n    function getOldSpans(doc, change) {\n        var found = change["spans_" + doc.id];\n        if (!found) { return null }\n        var nw = [];\n        for (var i = 0; i < change.text.length; ++i)\n        { nw.push(removeClearedSpans(found[i])); }\n        return nw\n    }\n\n    // Used for un/re-doing changes from the history. Combines the\n    // result of computing the existing spans with the set of spans that\n    // existed in the history (so that deleting around a span and then\n    // undoing brings back the span).\n    function mergeOldSpans(doc, change) {\n        var old = getOldSpans(doc, change);\n        var stretched = stretchSpansOverChange(doc, change);\n        if (!old) { return stretched }\n        if (!stretched) { return old }\n\n        for (var i = 0; i < old.length; ++i) {\n            var oldCur = old[i], stretchCur = stretched[i];\n            if (oldCur && stretchCur) {\n                spans: for (var j = 0; j < stretchCur.length; ++j) {\n                    var span = stretchCur[j];\n                    for (var k = 0; k < oldCur.length; ++k)\n                    { if (oldCur[k].marker == span.marker) { continue spans } }\n                    oldCur.push(span);\n                }\n            } else if (stretchCur) {\n                old[i] = stretchCur;\n            }\n        }\n        return old\n    }\n\n    // Used both to provide a JSON-safe object in .getHistory, and, when\n    // detaching a document, to split the history in two\n    function copyHistoryArray(events, newGroup, instantiateSel) {\n        var copy = [];\n        for (var i = 0; i < events.length; ++i) {\n            var event = events[i];\n            if (event.ranges) {\n                copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\n                continue\n            }\n            var changes = event.changes, newChanges = [];\n            copy.push({changes: newChanges});\n            for (var j = 0; j < changes.length; ++j) {\n                var change = changes[j], m = (void 0);\n                newChanges.push({from: change.from, to: change.to, text: change.text});\n                if (newGroup) { for (var prop in change) { if (m = prop.match(/^spans_(\\d+)$/)) {\n                    if (indexOf(newGroup, Number(m[1])) > -1) {\n                        lst(newChanges)[prop] = change[prop];\n                        delete change[prop];\n                    }\n                } } }\n            }\n        }\n        return copy\n    }\n\n    // The \'scroll\' parameter given to many of these indicated whether\n    // the new cursor position should be scrolled into view after\n    // modifying the selection.\n\n    // If shift is held or the extend flag is set, extends a range to\n    // include a given position (and optionally a second position).\n    // Otherwise, simply returns the range between the given positions.\n    // Used for cursor motion and such.\n    function extendRange(range, head, other, extend) {\n        if (extend) {\n            var anchor = range.anchor;\n            if (other) {\n                var posBefore = cmp(head, anchor) < 0;\n                if (posBefore != (cmp(other, anchor) < 0)) {\n                    anchor = head;\n                    head = other;\n                } else if (posBefore != (cmp(head, other) < 0)) {\n                    head = other;\n                }\n            }\n            return new Range(anchor, head)\n        } else {\n            return new Range(other || head, head)\n        }\n    }\n\n    // Extend the primary selection range, discard the rest.\n    function extendSelection(doc, head, other, options, extend) {\n        if (extend == null) { extend = doc.cm && (doc.cm.display.shift || doc.extend); }\n        setSelection(doc, new Selection([extendRange(doc.sel.primary(), head, other, extend)], 0), options);\n    }\n\n    // Extend all selections (pos is an array of selections with length\n    // equal the number of selections)\n    function extendSelections(doc, heads, options) {\n        var out = [];\n        var extend = doc.cm && (doc.cm.display.shift || doc.extend);\n        for (var i = 0; i < doc.sel.ranges.length; i++)\n        { out[i] = extendRange(doc.sel.ranges[i], heads[i], null, extend); }\n        var newSel = normalizeSelection(doc.cm, out, doc.sel.primIndex);\n        setSelection(doc, newSel, options);\n    }\n\n    // Updates a single range in the selection.\n    function replaceOneSelection(doc, i, range, options) {\n        var ranges = doc.sel.ranges.slice(0);\n        ranges[i] = range;\n        setSelection(doc, normalizeSelection(doc.cm, ranges, doc.sel.primIndex), options);\n    }\n\n    // Reset the selection to a single range.\n    function setSimpleSelection(doc, anchor, head, options) {\n        setSelection(doc, simpleSelection(anchor, head), options);\n    }\n\n    // Give beforeSelectionChange handlers a change to influence a\n    // selection update.\n    function filterSelectionChange(doc, sel, options) {\n        var obj = {\n            ranges: sel.ranges,\n            update: function(ranges) {\n                this.ranges = [];\n                for (var i = 0; i < ranges.length; i++)\n                { this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\n                    clipPos(doc, ranges[i].head)); }\n            },\n            origin: options && options.origin\n        };\n        signal(doc, "beforeSelectionChange", doc, obj);\n        if (doc.cm) { signal(doc.cm, "beforeSelectionChange", doc.cm, obj); }\n        if (obj.ranges != sel.ranges) { return normalizeSelection(doc.cm, obj.ranges, obj.ranges.length - 1) }\n        else { return sel }\n    }\n\n    function setSelectionReplaceHistory(doc, sel, options) {\n        var done = doc.history.done, last = lst(done);\n        if (last && last.ranges) {\n            done[done.length - 1] = sel;\n            setSelectionNoUndo(doc, sel, options);\n        } else {\n            setSelection(doc, sel, options);\n        }\n    }\n\n    // Set a new selection.\n    function setSelection(doc, sel, options) {\n        setSelectionNoUndo(doc, sel, options);\n        addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\n    }\n\n    function setSelectionNoUndo(doc, sel, options) {\n        if (hasHandler(doc, "beforeSelectionChange") || doc.cm && hasHandler(doc.cm, "beforeSelectionChange"))\n        { sel = filterSelectionChange(doc, sel, options); }\n\n        var bias = options && options.bias ||\n            (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\n        setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\n\n        if (!(options && options.scroll === false) && doc.cm)\n        { ensureCursorVisible(doc.cm); }\n    }\n\n    function setSelectionInner(doc, sel) {\n        if (sel.equals(doc.sel)) { return }\n\n        doc.sel = sel;\n\n        if (doc.cm) {\n            doc.cm.curOp.updateInput = 1;\n            doc.cm.curOp.selectionChanged = true;\n            signalCursorActivity(doc.cm);\n        }\n        signalLater(doc, "cursorActivity", doc);\n    }\n\n    // Verify that the selection does not partially select any atomic\n    // marked ranges.\n    function reCheckSelection(doc) {\n        setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false));\n    }\n\n    // Return a selection that does not partially select any atomic\n    // ranges.\n    function skipAtomicInSelection(doc, sel, bias, mayClear) {\n        var out;\n        for (var i = 0; i < sel.ranges.length; i++) {\n            var range = sel.ranges[i];\n            var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];\n            var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);\n            var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);\n            if (out || newAnchor != range.anchor || newHead != range.head) {\n                if (!out) { out = sel.ranges.slice(0, i); }\n                out[i] = new Range(newAnchor, newHead);\n            }\n        }\n        return out ? normalizeSelection(doc.cm, out, sel.primIndex) : sel\n    }\n\n    function skipAtomicInner(doc, pos, oldPos, dir, mayClear) {\n        var line = getLine(doc, pos.line);\n        if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {\n            var sp = line.markedSpans[i], m = sp.marker;\n            if ((sp.from == null || (m.inclusiveLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&\n                (sp.to == null || (m.inclusiveRight ? sp.to >= pos.ch : sp.to > pos.ch))) {\n                if (mayClear) {\n                    signal(m, "beforeCursorEnter");\n                    if (m.explicitlyCleared) {\n                        if (!line.markedSpans) { break }\n                        else {--i; continue}\n                    }\n                }\n                if (!m.atomic) { continue }\n\n                if (oldPos) {\n                    var near = m.find(dir < 0 ? 1 : -1), diff = (void 0);\n                    if (dir < 0 ? m.inclusiveRight : m.inclusiveLeft)\n                    { near = movePos(doc, near, -dir, near && near.line == pos.line ? line : null); }\n                    if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))\n                    { return skipAtomicInner(doc, near, pos, dir, mayClear) }\n                }\n\n                var far = m.find(dir < 0 ? -1 : 1);\n                if (dir < 0 ? m.inclusiveLeft : m.inclusiveRight)\n                { far = movePos(doc, far, dir, far.line == pos.line ? line : null); }\n                return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null\n            }\n        } }\n        return pos\n    }\n\n    // Ensure a given position is not inside an atomic range.\n    function skipAtomic(doc, pos, oldPos, bias, mayClear) {\n        var dir = bias || 1;\n        var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||\n            (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||\n            skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||\n            (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));\n        if (!found) {\n            doc.cantEdit = true;\n            return Pos(doc.first, 0)\n        }\n        return found\n    }\n\n    function movePos(doc, pos, dir, line) {\n        if (dir < 0 && pos.ch == 0) {\n            if (pos.line > doc.first) { return clipPos(doc, Pos(pos.line - 1)) }\n            else { return null }\n        } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {\n            if (pos.line < doc.first + doc.size - 1) { return Pos(pos.line + 1, 0) }\n            else { return null }\n        } else {\n            return new Pos(pos.line, pos.ch + dir)\n        }\n    }\n\n    function selectAll(cm) {\n        cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);\n    }\n\n    // UPDATING\n\n    // Allow "beforeChange" event handlers to influence a change\n    function filterChange(doc, change, update) {\n        var obj = {\n            canceled: false,\n            from: change.from,\n            to: change.to,\n            text: change.text,\n            origin: change.origin,\n            cancel: function () { return obj.canceled = true; }\n        };\n        if (update) { obj.update = function (from, to, text, origin) {\n            if (from) { obj.from = clipPos(doc, from); }\n            if (to) { obj.to = clipPos(doc, to); }\n            if (text) { obj.text = text; }\n            if (origin !== undefined) { obj.origin = origin; }\n        }; }\n        signal(doc, "beforeChange", doc, obj);\n        if (doc.cm) { signal(doc.cm, "beforeChange", doc.cm, obj); }\n\n        if (obj.canceled) {\n            if (doc.cm) { doc.cm.curOp.updateInput = 2; }\n            return null\n        }\n        return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin}\n    }\n\n    // Apply a change to a document, and add it to the document\'s\n    // history, and propagating it to all linked documents.\n    function makeChange(doc, change, ignoreReadOnly) {\n        if (doc.cm) {\n            if (!doc.cm.curOp) { return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly) }\n            if (doc.cm.state.suppressEdits) { return }\n        }\n\n        if (hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange")) {\n            change = filterChange(doc, change, true);\n            if (!change) { return }\n        }\n\n        // Possibly split or suppress the update based on the presence\n        // of read-only spans in its range.\n        var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\n        if (split) {\n            for (var i = split.length - 1; i >= 0; --i)\n            { makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [""] : change.text, origin: change.origin}); }\n        } else {\n            makeChangeInner(doc, change);\n        }\n    }\n\n    function makeChangeInner(doc, change) {\n        if (change.text.length == 1 && change.text[0] == "" && cmp(change.from, change.to) == 0) { return }\n        var selAfter = computeSelAfterChange(doc, change);\n        addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n\n        makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\n        var rebased = [];\n\n        linkedDocs(doc, function (doc, sharedHist) {\n            if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n                rebaseHist(doc.history, change);\n                rebased.push(doc.history);\n            }\n            makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\n        });\n    }\n\n    // Revert a change stored in a document\'s history.\n    function makeChangeFromHistory(doc, type, allowSelectionOnly) {\n        var suppress = doc.cm && doc.cm.state.suppressEdits;\n        if (suppress && !allowSelectionOnly) { return }\n\n        var hist = doc.history, event, selAfter = doc.sel;\n        var source = type == "undo" ? hist.done : hist.undone, dest = type == "undo" ? hist.undone : hist.done;\n\n        // Verify that there is a useable event (so that ctrl-z won\'t\n        // needlessly clear selection events)\n        var i = 0;\n        for (; i < source.length; i++) {\n            event = source[i];\n            if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\n            { break }\n        }\n        if (i == source.length) { return }\n        hist.lastOrigin = hist.lastSelOrigin = null;\n\n        for (;;) {\n            event = source.pop();\n            if (event.ranges) {\n                pushSelectionToHistory(event, dest);\n                if (allowSelectionOnly && !event.equals(doc.sel)) {\n                    setSelection(doc, event, {clearRedo: false});\n                    return\n                }\n                selAfter = event;\n            } else if (suppress) {\n                source.push(event);\n                return\n            } else { break }\n        }\n\n        // Build up a reverse change object to add to the opposite history\n        // stack (redo when undoing, and vice versa).\n        var antiChanges = [];\n        pushSelectionToHistory(selAfter, dest);\n        dest.push({changes: antiChanges, generation: hist.generation});\n        hist.generation = event.generation || ++hist.maxGeneration;\n\n        var filter = hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange");\n\n        var loop = function ( i ) {\n            var change = event.changes[i];\n            change.origin = type;\n            if (filter && !filterChange(doc, change, false)) {\n                source.length = 0;\n                return {}\n            }\n\n            antiChanges.push(historyChangeFromChange(doc, change));\n\n            var after = i ? computeSelAfterChange(doc, change) : lst(source);\n            makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\n            if (!i && doc.cm) { doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)}); }\n            var rebased = [];\n\n            // Propagate to the linked documents\n            linkedDocs(doc, function (doc, sharedHist) {\n                if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n                    rebaseHist(doc.history, change);\n                    rebased.push(doc.history);\n                }\n                makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\n            });\n        };\n\n        for (var i$1 = event.changes.length - 1; i$1 >= 0; --i$1) {\n            var returned = loop( i$1 );\n\n            if ( returned ) return returned.v;\n        }\n    }\n\n    // Sub-views need their line numbers shifted when text is added\n    // above or below them in the parent document.\n    function shiftDoc(doc, distance) {\n        if (distance == 0) { return }\n        doc.first += distance;\n        doc.sel = new Selection(map(doc.sel.ranges, function (range) { return new Range(\n            Pos(range.anchor.line + distance, range.anchor.ch),\n            Pos(range.head.line + distance, range.head.ch)\n        ); }), doc.sel.primIndex);\n        if (doc.cm) {\n            regChange(doc.cm, doc.first, doc.first - distance, distance);\n            for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\n            { regLineChange(doc.cm, l, "gutter"); }\n        }\n    }\n\n    // More lower-level change function, handling only a single document\n    // (not linked ones).\n    function makeChangeSingleDoc(doc, change, selAfter, spans) {\n        if (doc.cm && !doc.cm.curOp)\n        { return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans) }\n\n        if (change.to.line < doc.first) {\n            shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\n            return\n        }\n        if (change.from.line > doc.lastLine()) { return }\n\n        // Clip the change to the size of this doc\n        if (change.from.line < doc.first) {\n            var shift = change.text.length - 1 - (doc.first - change.from.line);\n            shiftDoc(doc, shift);\n            change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\n                text: [lst(change.text)], origin: change.origin};\n        }\n        var last = doc.lastLine();\n        if (change.to.line > last) {\n            change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\n                text: [change.text[0]], origin: change.origin};\n        }\n\n        change.removed = getBetween(doc, change.from, change.to);\n\n        if (!selAfter) { selAfter = computeSelAfterChange(doc, change); }\n        if (doc.cm) { makeChangeSingleDocInEditor(doc.cm, change, spans); }\n        else { updateDoc(doc, change, spans); }\n        setSelectionNoUndo(doc, selAfter, sel_dontScroll);\n    }\n\n    // Handle the interaction of a change to a document with the editor\n    // that this document is part of.\n    function makeChangeSingleDocInEditor(cm, change, spans) {\n        var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\n\n        var recomputeMaxLength = false, checkWidthStart = from.line;\n        if (!cm.options.lineWrapping) {\n            checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\n            doc.iter(checkWidthStart, to.line + 1, function (line) {\n                if (line == display.maxLine) {\n                    recomputeMaxLength = true;\n                    return true\n                }\n            });\n        }\n\n        if (doc.sel.contains(change.from, change.to) > -1)\n        { signalCursorActivity(cm); }\n\n        updateDoc(doc, change, spans, estimateHeight(cm));\n\n        if (!cm.options.lineWrapping) {\n            doc.iter(checkWidthStart, from.line + change.text.length, function (line) {\n                var len = lineLength(line);\n                if (len > display.maxLineLength) {\n                    display.maxLine = line;\n                    display.maxLineLength = len;\n                    display.maxLineChanged = true;\n                    recomputeMaxLength = false;\n                }\n            });\n            if (recomputeMaxLength) { cm.curOp.updateMaxLine = true; }\n        }\n\n        retreatFrontier(doc, from.line);\n        startWorker(cm, 400);\n\n        var lendiff = change.text.length - (to.line - from.line) - 1;\n        // Remember that these lines changed, for updating the display\n        if (change.full)\n        { regChange(cm); }\n        else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\n        { regLineChange(cm, from.line, "text"); }\n        else\n        { regChange(cm, from.line, to.line + 1, lendiff); }\n\n        var changesHandler = hasHandler(cm, "changes"), changeHandler = hasHandler(cm, "change");\n        if (changeHandler || changesHandler) {\n            var obj = {\n                from: from, to: to,\n                text: change.text,\n                removed: change.removed,\n                origin: change.origin\n            };\n            if (changeHandler) { signalLater(cm, "change", cm, obj); }\n            if (changesHandler) { (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj); }\n        }\n        cm.display.selForContextMenu = null;\n    }\n\n    function replaceRange(doc, code, from, to, origin) {\n        var assign;\n\n        if (!to) { to = from; }\n        if (cmp(to, from) < 0) { (assign = [to, from], from = assign[0], to = assign[1]); }\n        if (typeof code == "string") { code = doc.splitLines(code); }\n        makeChange(doc, {from: from, to: to, text: code, origin: origin});\n    }\n\n    // Rebasing/resetting history to deal with externally-sourced changes\n\n    function rebaseHistSelSingle(pos, from, to, diff) {\n        if (to < pos.line) {\n            pos.line += diff;\n        } else if (from < pos.line) {\n            pos.line = from;\n            pos.ch = 0;\n        }\n    }\n\n    // Tries to rebase an array of history events given a change in the\n    // document. If the change touches the same lines as the event, the\n    // event, and everything \'behind\' it, is discarded. If the change is\n    // before the event, the event\'s positions are updated. Uses a\n    // copy-on-write scheme for the positions, to avoid having to\n    // reallocate them all on every rebase, but also avoid problems with\n    // shared position objects being unsafely updated.\n    function rebaseHistArray(array, from, to, diff) {\n        for (var i = 0; i < array.length; ++i) {\n            var sub = array[i], ok = true;\n            if (sub.ranges) {\n                if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\n                for (var j = 0; j < sub.ranges.length; j++) {\n                    rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\n                    rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\n                }\n                continue\n            }\n            for (var j$1 = 0; j$1 < sub.changes.length; ++j$1) {\n                var cur = sub.changes[j$1];\n                if (to < cur.from.line) {\n                    cur.from = Pos(cur.from.line + diff, cur.from.ch);\n                    cur.to = Pos(cur.to.line + diff, cur.to.ch);\n                } else if (from <= cur.to.line) {\n                    ok = false;\n                    break\n                }\n            }\n            if (!ok) {\n                array.splice(0, i + 1);\n                i = 0;\n            }\n        }\n    }\n\n    function rebaseHist(hist, change) {\n        var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\n        rebaseHistArray(hist.done, from, to, diff);\n        rebaseHistArray(hist.undone, from, to, diff);\n    }\n\n    // Utility for applying a change to a line by handle or number,\n    // returning the number and optionally registering the line as\n    // changed.\n    function changeLine(doc, handle, changeType, op) {\n        var no = handle, line = handle;\n        if (typeof handle == "number") { line = getLine(doc, clipLine(doc, handle)); }\n        else { no = lineNo(handle); }\n        if (no == null) { return null }\n        if (op(line, no) && doc.cm) { regLineChange(doc.cm, no, changeType); }\n        return line\n    }\n\n    // The document is represented as a BTree consisting of leaves, with\n    // chunk of lines in them, and branches, with up to ten leaves or\n    // other branch nodes below them. The top node is always a branch\n    // node, and is the document object itself (meaning it has\n    // additional methods and properties).\n    //\n    // All nodes have parent links. The tree is used both to go from\n    // line numbers to line objects, and to go from objects to numbers.\n    // It also indexes by height, and is used to convert between height\n    // and line object, and to find the total height of the document.\n    //\n    // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\n\n    function LeafChunk(lines) {\n        this.lines = lines;\n        this.parent = null;\n        var height = 0;\n        for (var i = 0; i < lines.length; ++i) {\n            lines[i].parent = this;\n            height += lines[i].height;\n        }\n        this.height = height;\n    }\n\n    LeafChunk.prototype = {\n        chunkSize: function() { return this.lines.length },\n\n        // Remove the n lines at offset \'at\'.\n        removeInner: function(at, n) {\n            for (var i = at, e = at + n; i < e; ++i) {\n                var line = this.lines[i];\n                this.height -= line.height;\n                cleanUpLine(line);\n                signalLater(line, "delete");\n            }\n            this.lines.splice(at, n);\n        },\n\n        // Helper used to collapse a small branch into a single leaf.\n        collapse: function(lines) {\n            lines.push.apply(lines, this.lines);\n        },\n\n        // Insert the given array of lines at offset \'at\', count them as\n        // having the given height.\n        insertInner: function(at, lines, height) {\n            this.height += height;\n            this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\n            for (var i = 0; i < lines.length; ++i) { lines[i].parent = this; }\n        },\n\n        // Used to iterate over a part of the tree.\n        iterN: function(at, n, op) {\n            for (var e = at + n; at < e; ++at)\n            { if (op(this.lines[at])) { return true } }\n        }\n    };\n\n    function BranchChunk(children) {\n        this.children = children;\n        var size = 0, height = 0;\n        for (var i = 0; i < children.length; ++i) {\n            var ch = children[i];\n            size += ch.chunkSize(); height += ch.height;\n            ch.parent = this;\n        }\n        this.size = size;\n        this.height = height;\n        this.parent = null;\n    }\n\n    BranchChunk.prototype = {\n        chunkSize: function() { return this.size },\n\n        removeInner: function(at, n) {\n            this.size -= n;\n            for (var i = 0; i < this.children.length; ++i) {\n                var child = this.children[i], sz = child.chunkSize();\n                if (at < sz) {\n                    var rm = Math.min(n, sz - at), oldHeight = child.height;\n                    child.removeInner(at, rm);\n                    this.height -= oldHeight - child.height;\n                    if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\n                    if ((n -= rm) == 0) { break }\n                    at = 0;\n                } else { at -= sz; }\n            }\n            // If the result is smaller than 25 lines, ensure that it is a\n            // single leaf node.\n            if (this.size - n < 25 &&\n                (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\n                var lines = [];\n                this.collapse(lines);\n                this.children = [new LeafChunk(lines)];\n                this.children[0].parent = this;\n            }\n        },\n\n        collapse: function(lines) {\n            for (var i = 0; i < this.children.length; ++i) { this.children[i].collapse(lines); }\n        },\n\n        insertInner: function(at, lines, height) {\n            this.size += lines.length;\n            this.height += height;\n            for (var i = 0; i < this.children.length; ++i) {\n                var child = this.children[i], sz = child.chunkSize();\n                if (at <= sz) {\n                    child.insertInner(at, lines, height);\n                    if (child.lines && child.lines.length > 50) {\n                        // To avoid memory thrashing when child.lines is huge (e.g. first view of a large file), it\'s never spliced.\n                        // Instead, small slices are taken. They\'re taken in order because sequential memory accesses are fastest.\n                        var remaining = child.lines.length % 25 + 25;\n                        for (var pos = remaining; pos < child.lines.length;) {\n                            var leaf = new LeafChunk(child.lines.slice(pos, pos += 25));\n                            child.height -= leaf.height;\n                            this.children.splice(++i, 0, leaf);\n                            leaf.parent = this;\n                        }\n                        child.lines = child.lines.slice(0, remaining);\n                        this.maybeSpill();\n                    }\n                    break\n                }\n                at -= sz;\n            }\n        },\n\n        // When a node has grown, check whether it should be split.\n        maybeSpill: function() {\n            if (this.children.length <= 10) { return }\n            var me = this;\n            do {\n                var spilled = me.children.splice(me.children.length - 5, 5);\n                var sibling = new BranchChunk(spilled);\n                if (!me.parent) { // Become the parent node\n                    var copy = new BranchChunk(me.children);\n                    copy.parent = me;\n                    me.children = [copy, sibling];\n                    me = copy;\n                } else {\n                    me.size -= sibling.size;\n                    me.height -= sibling.height;\n                    var myIndex = indexOf(me.parent.children, me);\n                    me.parent.children.splice(myIndex + 1, 0, sibling);\n                }\n                sibling.parent = me.parent;\n            } while (me.children.length > 10)\n            me.parent.maybeSpill();\n        },\n\n        iterN: function(at, n, op) {\n            for (var i = 0; i < this.children.length; ++i) {\n                var child = this.children[i], sz = child.chunkSize();\n                if (at < sz) {\n                    var used = Math.min(n, sz - at);\n                    if (child.iterN(at, used, op)) { return true }\n                    if ((n -= used) == 0) { break }\n                    at = 0;\n                } else { at -= sz; }\n            }\n        }\n    };\n\n    // Line widgets are block elements displayed above or below a line.\n\n    var LineWidget = function(doc, node, options) {\n        if (options) { for (var opt in options) { if (options.hasOwnProperty(opt))\n        { this[opt] = options[opt]; } } }\n        this.doc = doc;\n        this.node = node;\n    };\n\n    LineWidget.prototype.clear = function () {\n        var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\n        if (no == null || !ws) { return }\n        for (var i = 0; i < ws.length; ++i) { if (ws[i] == this) { ws.splice(i--, 1); } }\n        if (!ws.length) { line.widgets = null; }\n        var height = widgetHeight(this);\n        updateLineHeight(line, Math.max(0, line.height - height));\n        if (cm) {\n            runInOp(cm, function () {\n                adjustScrollWhenAboveVisible(cm, line, -height);\n                regLineChange(cm, no, "widget");\n            });\n            signalLater(cm, "lineWidgetCleared", cm, this, no);\n        }\n    };\n\n    LineWidget.prototype.changed = function () {\n        var this$1 = this;\n\n        var oldH = this.height, cm = this.doc.cm, line = this.line;\n        this.height = null;\n        var diff = widgetHeight(this) - oldH;\n        if (!diff) { return }\n        if (!lineIsHidden(this.doc, line)) { updateLineHeight(line, line.height + diff); }\n        if (cm) {\n            runInOp(cm, function () {\n                cm.curOp.forceUpdate = true;\n                adjustScrollWhenAboveVisible(cm, line, diff);\n                signalLater(cm, "lineWidgetChanged", cm, this$1, lineNo(line));\n            });\n        }\n    };\n    eventMixin(LineWidget);\n\n    function adjustScrollWhenAboveVisible(cm, line, diff) {\n        if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\n        { addToScrollTop(cm, diff); }\n    }\n\n    function addLineWidget(doc, handle, node, options) {\n        var widget = new LineWidget(doc, node, options);\n        var cm = doc.cm;\n        if (cm && widget.noHScroll) { cm.display.alignWidgets = true; }\n        changeLine(doc, handle, "widget", function (line) {\n            var widgets = line.widgets || (line.widgets = []);\n            if (widget.insertAt == null) { widgets.push(widget); }\n            else { widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget); }\n            widget.line = line;\n            if (cm && !lineIsHidden(doc, line)) {\n                var aboveVisible = heightAtLine(line) < doc.scrollTop;\n                updateLineHeight(line, line.height + widgetHeight(widget));\n                if (aboveVisible) { addToScrollTop(cm, widget.height); }\n                cm.curOp.forceUpdate = true;\n            }\n            return true\n        });\n        if (cm) { signalLater(cm, "lineWidgetAdded", cm, widget, typeof handle == "number" ? handle : lineNo(handle)); }\n        return widget\n    }\n\n    // TEXTMARKERS\n\n    // Created with markText and setBookmark methods. A TextMarker is a\n    // handle that can be used to clear or find a marked position in the\n    // document. Line objects hold arrays (markedSpans) containing\n    // {from, to, marker} object pointing to such marker objects, and\n    // indicating that such a marker is present on that line. Multiple\n    // lines may point to the same marker when it spans across lines.\n    // The spans will have null for their from/to properties when the\n    // marker continues beyond the start/end of the line. Markers have\n    // links back to the lines they currently touch.\n\n    // Collapsed markers have unique ids, in order to be able to order\n    // them, which is needed for uniquely determining an outer marker\n    // when they overlap (they may nest, but not partially overlap).\n    var nextMarkerId = 0;\n\n    var TextMarker = function(doc, type) {\n        this.lines = [];\n        this.type = type;\n        this.doc = doc;\n        this.id = ++nextMarkerId;\n    };\n\n    // Clear the marker.\n    TextMarker.prototype.clear = function () {\n        if (this.explicitlyCleared) { return }\n        var cm = this.doc.cm, withOp = cm && !cm.curOp;\n        if (withOp) { startOperation(cm); }\n        if (hasHandler(this, "clear")) {\n            var found = this.find();\n            if (found) { signalLater(this, "clear", found.from, found.to); }\n        }\n        var min = null, max = null;\n        for (var i = 0; i < this.lines.length; ++i) {\n            var line = this.lines[i];\n            var span = getMarkedSpanFor(line.markedSpans, this);\n            if (cm && !this.collapsed) { regLineChange(cm, lineNo(line), "text"); }\n            else if (cm) {\n                if (span.to != null) { max = lineNo(line); }\n                if (span.from != null) { min = lineNo(line); }\n            }\n            line.markedSpans = removeMarkedSpan(line.markedSpans, span);\n            if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)\n            { updateLineHeight(line, textHeight(cm.display)); }\n        }\n        if (cm && this.collapsed && !cm.options.lineWrapping) { for (var i$1 = 0; i$1 < this.lines.length; ++i$1) {\n            var visual = visualLine(this.lines[i$1]), len = lineLength(visual);\n            if (len > cm.display.maxLineLength) {\n                cm.display.maxLine = visual;\n                cm.display.maxLineLength = len;\n                cm.display.maxLineChanged = true;\n            }\n        } }\n\n        if (min != null && cm && this.collapsed) { regChange(cm, min, max + 1); }\n        this.lines.length = 0;\n        this.explicitlyCleared = true;\n        if (this.atomic && this.doc.cantEdit) {\n            this.doc.cantEdit = false;\n            if (cm) { reCheckSelection(cm.doc); }\n        }\n        if (cm) { signalLater(cm, "markerCleared", cm, this, min, max); }\n        if (withOp) { endOperation(cm); }\n        if (this.parent) { this.parent.clear(); }\n    };\n\n    // Find the position of the marker in the document. Returns a {from,\n    // to} object by default. Side can be passed to get a specific side\n    // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\n    // Pos objects returned contain a line object, rather than a line\n    // number (used to prevent looking up the same line twice).\n    TextMarker.prototype.find = function (side, lineObj) {\n        if (side == null && this.type == "bookmark") { side = 1; }\n        var from, to;\n        for (var i = 0; i < this.lines.length; ++i) {\n            var line = this.lines[i];\n            var span = getMarkedSpanFor(line.markedSpans, this);\n            if (span.from != null) {\n                from = Pos(lineObj ? line : lineNo(line), span.from);\n                if (side == -1) { return from }\n            }\n            if (span.to != null) {\n                to = Pos(lineObj ? line : lineNo(line), span.to);\n                if (side == 1) { return to }\n            }\n        }\n        return from && {from: from, to: to}\n    };\n\n    // Signals that the marker\'s widget changed, and surrounding layout\n    // should be recomputed.\n    TextMarker.prototype.changed = function () {\n        var this$1 = this;\n\n        var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\n        if (!pos || !cm) { return }\n        runInOp(cm, function () {\n            var line = pos.line, lineN = lineNo(pos.line);\n            var view = findViewForLine(cm, lineN);\n            if (view) {\n                clearLineMeasurementCacheFor(view);\n                cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\n            }\n            cm.curOp.updateMaxLine = true;\n            if (!lineIsHidden(widget.doc, line) && widget.height != null) {\n                var oldHeight = widget.height;\n                widget.height = null;\n                var dHeight = widgetHeight(widget) - oldHeight;\n                if (dHeight)\n                { updateLineHeight(line, line.height + dHeight); }\n            }\n            signalLater(cm, "markerChanged", cm, this$1);\n        });\n    };\n\n    TextMarker.prototype.attachLine = function (line) {\n        if (!this.lines.length && this.doc.cm) {\n            var op = this.doc.cm.curOp;\n            if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\n            { (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this); }\n        }\n        this.lines.push(line);\n    };\n\n    TextMarker.prototype.detachLine = function (line) {\n        this.lines.splice(indexOf(this.lines, line), 1);\n        if (!this.lines.length && this.doc.cm) {\n            var op = this.doc.cm.curOp\n            ;(op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\n        }\n    };\n    eventMixin(TextMarker);\n\n    // Create a marker, wire it up to the right lines, and\n    function markText(doc, from, to, options, type) {\n        // Shared markers (across linked documents) are handled separately\n        // (markTextShared will call out to this again, once per\n        // document).\n        if (options && options.shared) { return markTextShared(doc, from, to, options, type) }\n        // Ensure we are in an operation.\n        if (doc.cm && !doc.cm.curOp) { return operation(doc.cm, markText)(doc, from, to, options, type) }\n\n        var marker = new TextMarker(doc, type), diff = cmp(from, to);\n        if (options) { copyObj(options, marker, false); }\n        // Don\'t connect empty markers unless clearWhenEmpty is false\n        if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\n        { return marker }\n        if (marker.replacedWith) {\n            // Showing up as a widget implies collapsed (widget replaces text)\n            marker.collapsed = true;\n            marker.widgetNode = eltP("span", [marker.replacedWith], "CodeMirror-widget");\n            if (!options.handleMouseEvents) { marker.widgetNode.setAttribute("cm-ignore-events", "true"); }\n            if (options.insertLeft) { marker.widgetNode.insertLeft = true; }\n        }\n        if (marker.collapsed) {\n            if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\n                from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\n            { throw new Error("Inserting collapsed marker partially overlapping an existing one") }\n            seeCollapsedSpans();\n        }\n\n        if (marker.addToHistory)\n        { addChangeToHistory(doc, {from: from, to: to, origin: "markText"}, doc.sel, NaN); }\n\n        var curLine = from.line, cm = doc.cm, updateMaxLine;\n        doc.iter(curLine, to.line + 1, function (line) {\n            if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\n            { updateMaxLine = true; }\n            if (marker.collapsed && curLine != from.line) { updateLineHeight(line, 0); }\n            addMarkedSpan(line, new MarkedSpan(marker,\n                curLine == from.line ? from.ch : null,\n                curLine == to.line ? to.ch : null));\n            ++curLine;\n        });\n        // lineIsHidden depends on the presence of the spans, so needs a second pass\n        if (marker.collapsed) { doc.iter(from.line, to.line + 1, function (line) {\n            if (lineIsHidden(doc, line)) { updateLineHeight(line, 0); }\n        }); }\n\n        if (marker.clearOnEnter) { on(marker, "beforeCursorEnter", function () { return marker.clear(); }); }\n\n        if (marker.readOnly) {\n            seeReadOnlySpans();\n            if (doc.history.done.length || doc.history.undone.length)\n            { doc.clearHistory(); }\n        }\n        if (marker.collapsed) {\n            marker.id = ++nextMarkerId;\n            marker.atomic = true;\n        }\n        if (cm) {\n            // Sync editor state\n            if (updateMaxLine) { cm.curOp.updateMaxLine = true; }\n            if (marker.collapsed)\n            { regChange(cm, from.line, to.line + 1); }\n            else if (marker.className || marker.startStyle || marker.endStyle || marker.css ||\n                marker.attributes || marker.title)\n            { for (var i = from.line; i <= to.line; i++) { regLineChange(cm, i, "text"); } }\n            if (marker.atomic) { reCheckSelection(cm.doc); }\n            signalLater(cm, "markerAdded", cm, marker);\n        }\n        return marker\n    }\n\n    // SHARED TEXTMARKERS\n\n    // A shared marker spans multiple linked documents. It is\n    // implemented as a meta-marker-object controlling multiple normal\n    // markers.\n    var SharedTextMarker = function(markers, primary) {\n        this.markers = markers;\n        this.primary = primary;\n        for (var i = 0; i < markers.length; ++i)\n        { markers[i].parent = this; }\n    };\n\n    SharedTextMarker.prototype.clear = function () {\n        if (this.explicitlyCleared) { return }\n        this.explicitlyCleared = true;\n        for (var i = 0; i < this.markers.length; ++i)\n        { this.markers[i].clear(); }\n        signalLater(this, "clear");\n    };\n\n    SharedTextMarker.prototype.find = function (side, lineObj) {\n        return this.primary.find(side, lineObj)\n    };\n    eventMixin(SharedTextMarker);\n\n    function markTextShared(doc, from, to, options, type) {\n        options = copyObj(options);\n        options.shared = false;\n        var markers = [markText(doc, from, to, options, type)], primary = markers[0];\n        var widget = options.widgetNode;\n        linkedDocs(doc, function (doc) {\n            if (widget) { options.widgetNode = widget.cloneNode(true); }\n            markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\n            for (var i = 0; i < doc.linked.length; ++i)\n            { if (doc.linked[i].isParent) { return } }\n            primary = lst(markers);\n        });\n        return new SharedTextMarker(markers, primary)\n    }\n\n    function findSharedMarkers(doc) {\n        return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())), function (m) { return m.parent; })\n    }\n\n    function copySharedMarkers(doc, markers) {\n        for (var i = 0; i < markers.length; i++) {\n            var marker = markers[i], pos = marker.find();\n            var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\n            if (cmp(mFrom, mTo)) {\n                var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\n                marker.markers.push(subMark);\n                subMark.parent = marker;\n            }\n        }\n    }\n\n    function detachSharedMarkers(markers) {\n        var loop = function ( i ) {\n            var marker = markers[i], linked = [marker.primary.doc];\n            linkedDocs(marker.primary.doc, function (d) { return linked.push(d); });\n            for (var j = 0; j < marker.markers.length; j++) {\n                var subMarker = marker.markers[j];\n                if (indexOf(linked, subMarker.doc) == -1) {\n                    subMarker.parent = null;\n                    marker.markers.splice(j--, 1);\n                }\n            }\n        };\n\n        for (var i = 0; i < markers.length; i++) loop( i );\n    }\n\n    var nextDocId = 0;\n    var Doc = function(text, mode, firstLine, lineSep, direction) {\n        if (!(this instanceof Doc)) { return new Doc(text, mode, firstLine, lineSep, direction) }\n        if (firstLine == null) { firstLine = 0; }\n\n        BranchChunk.call(this, [new LeafChunk([new Line("", null)])]);\n        this.first = firstLine;\n        this.scrollTop = this.scrollLeft = 0;\n        this.cantEdit = false;\n        this.cleanGeneration = 1;\n        this.modeFrontier = this.highlightFrontier = firstLine;\n        var start = Pos(firstLine, 0);\n        this.sel = simpleSelection(start);\n        this.history = new History(null);\n        this.id = ++nextDocId;\n        this.modeOption = mode;\n        this.lineSep = lineSep;\n        this.direction = (direction == "rtl") ? "rtl" : "ltr";\n        this.extend = false;\n\n        if (typeof text == "string") { text = this.splitLines(text); }\n        updateDoc(this, {from: start, to: start, text: text});\n        setSelection(this, simpleSelection(start), sel_dontScroll);\n    };\n\n    Doc.prototype = createObj(BranchChunk.prototype, {\n        constructor: Doc,\n        // Iterate over the document. Supports two forms -- with only one\n        // argument, it calls that for each line in the document. With\n        // three, it iterates over the range given by the first two (with\n        // the second being non-inclusive).\n        iter: function(from, to, op) {\n            if (op) { this.iterN(from - this.first, to - from, op); }\n            else { this.iterN(this.first, this.first + this.size, from); }\n        },\n\n        // Non-public interface for adding and removing lines.\n        insert: function(at, lines) {\n            var height = 0;\n            for (var i = 0; i < lines.length; ++i) { height += lines[i].height; }\n            this.insertInner(at - this.first, lines, height);\n        },\n        remove: function(at, n) { this.removeInner(at - this.first, n); },\n\n        // From here, the methods are part of the public interface. Most\n        // are also available from CodeMirror (editor) instances.\n\n        getValue: function(lineSep, lineFilter) {\n            var lines = getLines(this, this.first, this.first + this.size, lineFilter);\n            if (lineSep === false) { return lines }\n            return lines.join(lineSep || this.lineSeparator())\n        },\n        setValue: docMethodOp(function(code) {\n            var top = Pos(this.first, 0), last = this.first + this.size - 1;\n            makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\n                text: this.splitLines(code), origin: "setValue", full: true}, true);\n            if (this.cm) { scrollToCoords(this.cm, 0, 0); }\n            setSelection(this, simpleSelection(top), sel_dontScroll);\n        }),\n        replaceRange: function(code, from, to, origin) {\n            from = clipPos(this, from);\n            to = to ? clipPos(this, to) : from;\n            replaceRange(this, code, from, to, origin);\n        },\n        getRange: function(from, to, lineSep) {\n            var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\n            if (lineSep === false) { return lines }\n            return lines.join(lineSep || this.lineSeparator())\n        },\n\n        getLine: function(line) {var l = this.getLineHandle(line); return l && l.text},\n\n        getLineHandle: function(line) {if (isLine(this, line)) { return getLine(this, line) }},\n        getLineNumber: function(line) {return lineNo(line)},\n\n        getLineHandleVisualStart: function(line) {\n            if (typeof line == "number") { line = getLine(this, line); }\n            return visualLine(line)\n        },\n\n        lineCount: function() {return this.size},\n        firstLine: function() {return this.first},\n        lastLine: function() {return this.first + this.size - 1},\n\n        clipPos: function(pos) {return clipPos(this, pos)},\n\n        getCursor: function(start) {\n            var range$$1 = this.sel.primary(), pos;\n            if (start == null || start == "head") { pos = range$$1.head; }\n            else if (start == "anchor") { pos = range$$1.anchor; }\n            else if (start == "end" || start == "to" || start === false) { pos = range$$1.to(); }\n            else { pos = range$$1.from(); }\n            return pos\n        },\n        listSelections: function() { return this.sel.ranges },\n        somethingSelected: function() {return this.sel.somethingSelected()},\n\n        setCursor: docMethodOp(function(line, ch, options) {\n            setSimpleSelection(this, clipPos(this, typeof line == "number" ? Pos(line, ch || 0) : line), null, options);\n        }),\n        setSelection: docMethodOp(function(anchor, head, options) {\n            setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\n        }),\n        extendSelection: docMethodOp(function(head, other, options) {\n            extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\n        }),\n        extendSelections: docMethodOp(function(heads, options) {\n            extendSelections(this, clipPosArray(this, heads), options);\n        }),\n        extendSelectionsBy: docMethodOp(function(f, options) {\n            var heads = map(this.sel.ranges, f);\n            extendSelections(this, clipPosArray(this, heads), options);\n        }),\n        setSelections: docMethodOp(function(ranges, primary, options) {\n            if (!ranges.length) { return }\n            var out = [];\n            for (var i = 0; i < ranges.length; i++)\n            { out[i] = new Range(clipPos(this, ranges[i].anchor),\n                clipPos(this, ranges[i].head)); }\n            if (primary == null) { primary = Math.min(ranges.length - 1, this.sel.primIndex); }\n            setSelection(this, normalizeSelection(this.cm, out, primary), options);\n        }),\n        addSelection: docMethodOp(function(anchor, head, options) {\n            var ranges = this.sel.ranges.slice(0);\n            ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\n            setSelection(this, normalizeSelection(this.cm, ranges, ranges.length - 1), options);\n        }),\n\n        getSelection: function(lineSep) {\n            var ranges = this.sel.ranges, lines;\n            for (var i = 0; i < ranges.length; i++) {\n                var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n                lines = lines ? lines.concat(sel) : sel;\n            }\n            if (lineSep === false) { return lines }\n            else { return lines.join(lineSep || this.lineSeparator()) }\n        },\n        getSelections: function(lineSep) {\n            var parts = [], ranges = this.sel.ranges;\n            for (var i = 0; i < ranges.length; i++) {\n                var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n                if (lineSep !== false) { sel = sel.join(lineSep || this.lineSeparator()); }\n                parts[i] = sel;\n            }\n            return parts\n        },\n        replaceSelection: function(code, collapse, origin) {\n            var dup = [];\n            for (var i = 0; i < this.sel.ranges.length; i++)\n            { dup[i] = code; }\n            this.replaceSelections(dup, collapse, origin || "+input");\n        },\n        replaceSelections: docMethodOp(function(code, collapse, origin) {\n            var changes = [], sel = this.sel;\n            for (var i = 0; i < sel.ranges.length; i++) {\n                var range$$1 = sel.ranges[i];\n                changes[i] = {from: range$$1.from(), to: range$$1.to(), text: this.splitLines(code[i]), origin: origin};\n            }\n            var newSel = collapse && collapse != "end" && computeReplacedSel(this, changes, collapse);\n            for (var i$1 = changes.length - 1; i$1 >= 0; i$1--)\n            { makeChange(this, changes[i$1]); }\n            if (newSel) { setSelectionReplaceHistory(this, newSel); }\n            else if (this.cm) { ensureCursorVisible(this.cm); }\n        }),\n        undo: docMethodOp(function() {makeChangeFromHistory(this, "undo");}),\n        redo: docMethodOp(function() {makeChangeFromHistory(this, "redo");}),\n        undoSelection: docMethodOp(function() {makeChangeFromHistory(this, "undo", true);}),\n        redoSelection: docMethodOp(function() {makeChangeFromHistory(this, "redo", true);}),\n\n        setExtending: function(val) {this.extend = val;},\n        getExtending: function() {return this.extend},\n\n        historySize: function() {\n            var hist = this.history, done = 0, undone = 0;\n            for (var i = 0; i < hist.done.length; i++) { if (!hist.done[i].ranges) { ++done; } }\n            for (var i$1 = 0; i$1 < hist.undone.length; i$1++) { if (!hist.undone[i$1].ranges) { ++undone; } }\n            return {undo: done, redo: undone}\n        },\n        clearHistory: function() {this.history = new History(this.history.maxGeneration);},\n\n        markClean: function() {\n            this.cleanGeneration = this.changeGeneration(true);\n        },\n        changeGeneration: function(forceSplit) {\n            if (forceSplit)\n            { this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null; }\n            return this.history.generation\n        },\n        isClean: function (gen) {\n            return this.history.generation == (gen || this.cleanGeneration)\n        },\n\n        getHistory: function() {\n            return {done: copyHistoryArray(this.history.done),\n                undone: copyHistoryArray(this.history.undone)}\n        },\n        setHistory: function(histData) {\n            var hist = this.history = new History(this.history.maxGeneration);\n            hist.done = copyHistoryArray(histData.done.slice(0), null, true);\n            hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\n        },\n\n        setGutterMarker: docMethodOp(function(line, gutterID, value) {\n            return changeLine(this, line, "gutter", function (line) {\n                var markers = line.gutterMarkers || (line.gutterMarkers = {});\n                markers[gutterID] = value;\n                if (!value && isEmpty(markers)) { line.gutterMarkers = null; }\n                return true\n            })\n        }),\n\n        clearGutter: docMethodOp(function(gutterID) {\n            var this$1 = this;\n\n            this.iter(function (line) {\n                if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\n                    changeLine(this$1, line, "gutter", function () {\n                        line.gutterMarkers[gutterID] = null;\n                        if (isEmpty(line.gutterMarkers)) { line.gutterMarkers = null; }\n                        return true\n                    });\n                }\n            });\n        }),\n\n        lineInfo: function(line) {\n            var n;\n            if (typeof line == "number") {\n                if (!isLine(this, line)) { return null }\n                n = line;\n                line = getLine(this, line);\n                if (!line) { return null }\n            } else {\n                n = lineNo(line);\n                if (n == null) { return null }\n            }\n            return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\n                textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\n                widgets: line.widgets}\n        },\n\n        addLineClass: docMethodOp(function(handle, where, cls) {\n            return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function (line) {\n                var prop = where == "text" ? "textClass"\n                    : where == "background" ? "bgClass"\n                        : where == "gutter" ? "gutterClass" : "wrapClass";\n                if (!line[prop]) { line[prop] = cls; }\n                else if (classTest(cls).test(line[prop])) { return false }\n                else { line[prop] += " " + cls; }\n                return true\n            })\n        }),\n        removeLineClass: docMethodOp(function(handle, where, cls) {\n            return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function (line) {\n                var prop = where == "text" ? "textClass"\n                    : where == "background" ? "bgClass"\n                        : where == "gutter" ? "gutterClass" : "wrapClass";\n                var cur = line[prop];\n                if (!cur) { return false }\n                else if (cls == null) { line[prop] = null; }\n                else {\n                    var found = cur.match(classTest(cls));\n                    if (!found) { return false }\n                    var end = found.index + found[0].length;\n                    line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? "" : " ") + cur.slice(end) || null;\n                }\n                return true\n            })\n        }),\n\n        addLineWidget: docMethodOp(function(handle, node, options) {\n            return addLineWidget(this, handle, node, options)\n        }),\n        removeLineWidget: function(widget) { widget.clear(); },\n\n        markText: function(from, to, options) {\n            return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || "range")\n        },\n        setBookmark: function(pos, options) {\n            var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\n                insertLeft: options && options.insertLeft,\n                clearWhenEmpty: false, shared: options && options.shared,\n                handleMouseEvents: options && options.handleMouseEvents};\n            pos = clipPos(this, pos);\n            return markText(this, pos, pos, realOpts, "bookmark")\n        },\n        findMarksAt: function(pos) {\n            pos = clipPos(this, pos);\n            var markers = [], spans = getLine(this, pos.line).markedSpans;\n            if (spans) { for (var i = 0; i < spans.length; ++i) {\n                var span = spans[i];\n                if ((span.from == null || span.from <= pos.ch) &&\n                    (span.to == null || span.to >= pos.ch))\n                { markers.push(span.marker.parent || span.marker); }\n            } }\n            return markers\n        },\n        findMarks: function(from, to, filter) {\n            from = clipPos(this, from); to = clipPos(this, to);\n            var found = [], lineNo$$1 = from.line;\n            this.iter(from.line, to.line + 1, function (line) {\n                var spans = line.markedSpans;\n                if (spans) { for (var i = 0; i < spans.length; i++) {\n                    var span = spans[i];\n                    if (!(span.to != null && lineNo$$1 == from.line && from.ch >= span.to ||\n                        span.from == null && lineNo$$1 != from.line ||\n                        span.from != null && lineNo$$1 == to.line && span.from >= to.ch) &&\n                        (!filter || filter(span.marker)))\n                    { found.push(span.marker.parent || span.marker); }\n                } }\n                ++lineNo$$1;\n            });\n            return found\n        },\n        getAllMarks: function() {\n            var markers = [];\n            this.iter(function (line) {\n                var sps = line.markedSpans;\n                if (sps) { for (var i = 0; i < sps.length; ++i)\n                { if (sps[i].from != null) { markers.push(sps[i].marker); } } }\n            });\n            return markers\n        },\n\n        posFromIndex: function(off) {\n            var ch, lineNo$$1 = this.first, sepSize = this.lineSeparator().length;\n            this.iter(function (line) {\n                var sz = line.text.length + sepSize;\n                if (sz > off) { ch = off; return true }\n                off -= sz;\n                ++lineNo$$1;\n            });\n            return clipPos(this, Pos(lineNo$$1, ch))\n        },\n        indexFromPos: function (coords) {\n            coords = clipPos(this, coords);\n            var index = coords.ch;\n            if (coords.line < this.first || coords.ch < 0) { return 0 }\n            var sepSize = this.lineSeparator().length;\n            this.iter(this.first, coords.line, function (line) { // iter aborts when callback returns a truthy value\n                index += line.text.length + sepSize;\n            });\n            return index\n        },\n\n        copy: function(copyHistory) {\n            var doc = new Doc(getLines(this, this.first, this.first + this.size),\n                this.modeOption, this.first, this.lineSep, this.direction);\n            doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\n            doc.sel = this.sel;\n            doc.extend = false;\n            if (copyHistory) {\n                doc.history.undoDepth = this.history.undoDepth;\n                doc.setHistory(this.getHistory());\n            }\n            return doc\n        },\n\n        linkedDoc: function(options) {\n            if (!options) { options = {}; }\n            var from = this.first, to = this.first + this.size;\n            if (options.from != null && options.from > from) { from = options.from; }\n            if (options.to != null && options.to < to) { to = options.to; }\n            var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep, this.direction);\n            if (options.sharedHist) { copy.history = this.history\n            ; }(this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\n            copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\n            copySharedMarkers(copy, findSharedMarkers(this));\n            return copy\n        },\n        unlinkDoc: function(other) {\n            if (other instanceof CodeMirror) { other = other.doc; }\n            if (this.linked) { for (var i = 0; i < this.linked.length; ++i) {\n                var link = this.linked[i];\n                if (link.doc != other) { continue }\n                this.linked.splice(i, 1);\n                other.unlinkDoc(this);\n                detachSharedMarkers(findSharedMarkers(this));\n                break\n            } }\n            // If the histories were shared, split them again\n            if (other.history == this.history) {\n                var splitIds = [other.id];\n                linkedDocs(other, function (doc) { return splitIds.push(doc.id); }, true);\n                other.history = new History(null);\n                other.history.done = copyHistoryArray(this.history.done, splitIds);\n                other.history.undone = copyHistoryArray(this.history.undone, splitIds);\n            }\n        },\n        iterLinkedDocs: function(f) {linkedDocs(this, f);},\n\n        getMode: function() {return this.mode},\n        getEditor: function() {return this.cm},\n\n        splitLines: function(str) {\n            if (this.lineSep) { return str.split(this.lineSep) }\n            return splitLinesAuto(str)\n        },\n        lineSeparator: function() { return this.lineSep || "\\n" },\n\n        setDirection: docMethodOp(function (dir) {\n            if (dir != "rtl") { dir = "ltr"; }\n            if (dir == this.direction) { return }\n            this.direction = dir;\n            this.iter(function (line) { return line.order = null; });\n            if (this.cm) { directionChanged(this.cm); }\n        })\n    });\n\n    // Public alias.\n    Doc.prototype.eachLine = Doc.prototype.iter;\n\n    // Kludge to work around strange IE behavior where it\'ll sometimes\n    // re-fire a series of drag-related events right after the drop (#1551)\n    var lastDrop = 0;\n\n    function onDrop(e) {\n        var cm = this;\n        clearDragCursor(cm);\n        if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\n        { return }\n        e_preventDefault(e);\n        if (ie) { lastDrop = +new Date; }\n        var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\n        if (!pos || cm.isReadOnly()) { return }\n        // Might be a file drop, in which case we simply extract the text\n        // and insert it.\n        if (files && files.length && window.FileReader && window.File) {\n            var n = files.length, text = Array(n), read = 0;\n            var loadFile = function (file, i) {\n                if (cm.options.allowDropFileTypes &&\n                    indexOf(cm.options.allowDropFileTypes, file.type) == -1)\n                { return }\n\n                var reader = new FileReader;\n                reader.onload = operation(cm, function () {\n                    var content = reader.result;\n                    if (/[\\x00-\\x08\\x0e-\\x1f]{2}/.test(content)) { content = ""; }\n                    text[i] = content;\n                    if (++read == n) {\n                        pos = clipPos(cm.doc, pos);\n                        var change = {from: pos, to: pos,\n                            text: cm.doc.splitLines(text.join(cm.doc.lineSeparator())),\n                            origin: "paste"};\n                        makeChange(cm.doc, change);\n                        setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\n                    }\n                });\n                reader.readAsText(file);\n            };\n            for (var i = 0; i < n; ++i) { loadFile(files[i], i); }\n        } else { // Normal drop\n            // Don\'t do a replace if the drop happened inside of the selected text.\n            if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\n                cm.state.draggingText(e);\n                // Ensure the editor is re-focused\n                setTimeout(function () { return cm.display.input.focus(); }, 20);\n                return\n            }\n            try {\n                var text$1 = e.dataTransfer.getData("Text");\n                if (text$1) {\n                    var selected;\n                    if (cm.state.draggingText && !cm.state.draggingText.copy)\n                    { selected = cm.listSelections(); }\n                    setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\n                    if (selected) { for (var i$1 = 0; i$1 < selected.length; ++i$1)\n                    { replaceRange(cm.doc, "", selected[i$1].anchor, selected[i$1].head, "drag"); } }\n                    cm.replaceSelection(text$1, "around", "paste");\n                    cm.display.input.focus();\n                }\n            }\n            catch(e){}\n        }\n    }\n\n    function onDragStart(cm, e) {\n        if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return }\n        if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) { return }\n\n        e.dataTransfer.setData("Text", cm.getSelection());\n        e.dataTransfer.effectAllowed = "copyMove";\n\n        // Use dummy image instead of default browsers image.\n        // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don\'t do it there.\n        if (e.dataTransfer.setDragImage && !safari) {\n            var img = elt("img", null, null, "position: fixed; left: 0; top: 0;");\n            img.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";\n            if (presto) {\n                img.width = img.height = 1;\n                cm.display.wrapper.appendChild(img);\n                // Force a relayout, or Opera won\'t use our image for some obscure reason\n                img._top = img.offsetTop;\n            }\n            e.dataTransfer.setDragImage(img, 0, 0);\n            if (presto) { img.parentNode.removeChild(img); }\n        }\n    }\n\n    function onDragOver(cm, e) {\n        var pos = posFromMouse(cm, e);\n        if (!pos) { return }\n        var frag = document.createDocumentFragment();\n        drawSelectionCursor(cm, pos, frag);\n        if (!cm.display.dragCursor) {\n            cm.display.dragCursor = elt("div", null, "CodeMirror-cursors CodeMirror-dragcursors");\n            cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);\n        }\n        removeChildrenAndAdd(cm.display.dragCursor, frag);\n    }\n\n    function clearDragCursor(cm) {\n        if (cm.display.dragCursor) {\n            cm.display.lineSpace.removeChild(cm.display.dragCursor);\n            cm.display.dragCursor = null;\n        }\n    }\n\n    // These must be handled carefully, because naively registering a\n    // handler for each editor will cause the editors to never be\n    // garbage collected.\n\n    function forEachCodeMirror(f) {\n        if (!document.getElementsByClassName) { return }\n        var byClass = document.getElementsByClassName("CodeMirror"), editors = [];\n        for (var i = 0; i < byClass.length; i++) {\n            var cm = byClass[i].CodeMirror;\n            if (cm) { editors.push(cm); }\n        }\n        if (editors.length) { editors[0].operation(function () {\n            for (var i = 0; i < editors.length; i++) { f(editors[i]); }\n        }); }\n    }\n\n    var globalsRegistered = false;\n    function ensureGlobalHandlers() {\n        if (globalsRegistered) { return }\n        registerGlobalHandlers();\n        globalsRegistered = true;\n    }\n    function registerGlobalHandlers() {\n        // When the window resizes, we need to refresh active editors.\n        var resizeTimer;\n        on(window, "resize", function () {\n            if (resizeTimer == null) { resizeTimer = setTimeout(function () {\n                resizeTimer = null;\n                forEachCodeMirror(onResize);\n            }, 100); }\n        });\n        // When the window loses focus, we want to show the editor as blurred\n        on(window, "blur", function () { return forEachCodeMirror(onBlur); });\n    }\n    // Called when the window resizes\n    function onResize(cm) {\n        var d = cm.display;\n        // Might be a text scaling operation, clear size caches.\n        d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n        d.scrollbarsClipped = false;\n        cm.setSize();\n    }\n\n    var keyNames = {\n        3: "Pause", 8: "Backspace", 9: "Tab", 13: "Enter", 16: "Shift", 17: "Ctrl", 18: "Alt",\n        19: "Pause", 20: "CapsLock", 27: "Esc", 32: "Space", 33: "PageUp", 34: "PageDown", 35: "End",\n        36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 44: "PrintScrn", 45: "Insert",\n        46: "Delete", 59: ";", 61: "=", 91: "Mod", 92: "Mod", 93: "Mod",\n        106: "*", 107: "=", 109: "-", 110: ".", 111: "/", 127: "Delete", 145: "ScrollLock",\n        173: "-", 186: ";", 187: "=", 188: ",", 189: "-", 190: ".", 191: "/", 192: "`", 219: "[", 220: "\\\\",\n        221: "]", 222: "\'", 63232: "Up", 63233: "Down", 63234: "Left", 63235: "Right", 63272: "Delete",\n        63273: "Home", 63275: "End", 63276: "PageUp", 63277: "PageDown", 63302: "Insert"\n    };\n\n    // Number keys\n    for (var i = 0; i < 10; i++) { keyNames[i + 48] = keyNames[i + 96] = String(i); }\n    // Alphabetic keys\n    for (var i$1 = 65; i$1 <= 90; i$1++) { keyNames[i$1] = String.fromCharCode(i$1); }\n    // Function keys\n    for (var i$2 = 1; i$2 <= 12; i$2++) { keyNames[i$2 + 111] = keyNames[i$2 + 63235] = "F" + i$2; }\n\n    var keyMap = {};\n\n    keyMap.basic = {\n        "Left": "goCharLeft", "Right": "goCharRight", "Up": "goLineUp", "Down": "goLineDown",\n        "End": "goLineEnd", "Home": "goLineStartSmart", "PageUp": "goPageUp", "PageDown": "goPageDown",\n        "Delete": "delCharAfter", "Backspace": "delCharBefore", "Shift-Backspace": "delCharBefore",\n        "Tab": "defaultTab", "Shift-Tab": "indentAuto",\n        "Enter": "newlineAndIndent", "Insert": "toggleOverwrite",\n        "Esc": "singleSelection"\n    };\n    // Note that the save and find-related commands aren\'t defined by\n    // default. User code or addons can define them. Unknown commands\n    // are simply ignored.\n    keyMap.pcDefault = {\n        "Ctrl-A": "selectAll", "Ctrl-D": "deleteLine", "Ctrl-Z": "undo", "Shift-Ctrl-Z": "redo", "Ctrl-Y": "redo",\n        "Ctrl-Home": "goDocStart", "Ctrl-End": "goDocEnd", "Ctrl-Up": "goLineUp", "Ctrl-Down": "goLineDown",\n        "Ctrl-Left": "goGroupLeft", "Ctrl-Right": "goGroupRight", "Alt-Left": "goLineStart", "Alt-Right": "goLineEnd",\n        "Ctrl-Backspace": "delGroupBefore", "Ctrl-Delete": "delGroupAfter", "Ctrl-S": "save", "Ctrl-F": "find",\n        "Ctrl-G": "findNext", "Shift-Ctrl-G": "findPrev", "Shift-Ctrl-F": "replace", "Shift-Ctrl-R": "replaceAll",\n        "Ctrl-[": "indentLess", "Ctrl-]": "indentMore",\n        "Ctrl-U": "undoSelection", "Shift-Ctrl-U": "redoSelection", "Alt-U": "redoSelection",\n        "fallthrough": "basic"\n    };\n    // Very basic readline/emacs-style bindings, which are standard on Mac.\n    keyMap.emacsy = {\n        "Ctrl-F": "goCharRight", "Ctrl-B": "goCharLeft", "Ctrl-P": "goLineUp", "Ctrl-N": "goLineDown",\n        "Alt-F": "goWordRight", "Alt-B": "goWordLeft", "Ctrl-A": "goLineStart", "Ctrl-E": "goLineEnd",\n        "Ctrl-V": "goPageDown", "Shift-Ctrl-V": "goPageUp", "Ctrl-D": "delCharAfter", "Ctrl-H": "delCharBefore",\n        "Alt-D": "delWordAfter", "Alt-Backspace": "delWordBefore", "Ctrl-K": "killLine", "Ctrl-T": "transposeChars",\n        "Ctrl-O": "openLine"\n    };\n    keyMap.macDefault = {\n        "Cmd-A": "selectAll", "Cmd-D": "deleteLine", "Cmd-Z": "undo", "Shift-Cmd-Z": "redo", "Cmd-Y": "redo",\n        "Cmd-Home": "goDocStart", "Cmd-Up": "goDocStart", "Cmd-End": "goDocEnd", "Cmd-Down": "goDocEnd", "Alt-Left": "goGroupLeft",\n        "Alt-Right": "goGroupRight", "Cmd-Left": "goLineLeft", "Cmd-Right": "goLineRight", "Alt-Backspace": "delGroupBefore",\n        "Ctrl-Alt-Backspace": "delGroupAfter", "Alt-Delete": "delGroupAfter", "Cmd-S": "save", "Cmd-F": "find",\n        "Cmd-G": "findNext", "Shift-Cmd-G": "findPrev", "Cmd-Alt-F": "replace", "Shift-Cmd-Alt-F": "replaceAll",\n        "Cmd-[": "indentLess", "Cmd-]": "indentMore", "Cmd-Backspace": "delWrappedLineLeft", "Cmd-Delete": "delWrappedLineRight",\n        "Cmd-U": "undoSelection", "Shift-Cmd-U": "redoSelection", "Ctrl-Up": "goDocStart", "Ctrl-Down": "goDocEnd",\n        "fallthrough": ["basic", "emacsy"]\n    };\n    keyMap["default"] = mac ? keyMap.macDefault : keyMap.pcDefault;\n\n    // KEYMAP DISPATCH\n\n    function normalizeKeyName(name) {\n        var parts = name.split(/-(?!$)/);\n        name = parts[parts.length - 1];\n        var alt, ctrl, shift, cmd;\n        for (var i = 0; i < parts.length - 1; i++) {\n            var mod = parts[i];\n            if (/^(cmd|meta|m)$/i.test(mod)) { cmd = true; }\n            else if (/^a(lt)?$/i.test(mod)) { alt = true; }\n            else if (/^(c|ctrl|control)$/i.test(mod)) { ctrl = true; }\n            else if (/^s(hift)?$/i.test(mod)) { shift = true; }\n            else { throw new Error("Unrecognized modifier name: " + mod) }\n        }\n        if (alt) { name = "Alt-" + name; }\n        if (ctrl) { name = "Ctrl-" + name; }\n        if (cmd) { name = "Cmd-" + name; }\n        if (shift) { name = "Shift-" + name; }\n        return name\n    }\n\n    // This is a kludge to keep keymaps mostly working as raw objects\n    // (backwards compatibility) while at the same time support features\n    // like normalization and multi-stroke key bindings. It compiles a\n    // new normalized keymap, and then updates the old object to reflect\n    // this.\n    function normalizeKeyMap(keymap) {\n        var copy = {};\n        for (var keyname in keymap) { if (keymap.hasOwnProperty(keyname)) {\n            var value = keymap[keyname];\n            if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) { continue }\n            if (value == "...") { delete keymap[keyname]; continue }\n\n            var keys = map(keyname.split(" "), normalizeKeyName);\n            for (var i = 0; i < keys.length; i++) {\n                var val = (void 0), name = (void 0);\n                if (i == keys.length - 1) {\n                    name = keys.join(" ");\n                    val = value;\n                } else {\n                    name = keys.slice(0, i + 1).join(" ");\n                    val = "...";\n                }\n                var prev = copy[name];\n                if (!prev) { copy[name] = val; }\n                else if (prev != val) { throw new Error("Inconsistent bindings for " + name) }\n            }\n            delete keymap[keyname];\n        } }\n        for (var prop in copy) { keymap[prop] = copy[prop]; }\n        return keymap\n    }\n\n    function lookupKey(key, map$$1, handle, context) {\n        map$$1 = getKeyMap(map$$1);\n        var found = map$$1.call ? map$$1.call(key, context) : map$$1[key];\n        if (found === false) { return "nothing" }\n        if (found === "...") { return "multi" }\n        if (found != null && handle(found)) { return "handled" }\n\n        if (map$$1.fallthrough) {\n            if (Object.prototype.toString.call(map$$1.fallthrough) != "[object Array]")\n            { return lookupKey(key, map$$1.fallthrough, handle, context) }\n            for (var i = 0; i < map$$1.fallthrough.length; i++) {\n                var result = lookupKey(key, map$$1.fallthrough[i], handle, context);\n                if (result) { return result }\n            }\n        }\n    }\n\n    // Modifier key presses don\'t count as \'real\' key presses for the\n    // purpose of keymap fallthrough.\n    function isModifierKey(value) {\n        var name = typeof value == "string" ? value : keyNames[value.keyCode];\n        return name == "Ctrl" || name == "Alt" || name == "Shift" || name == "Mod"\n    }\n\n    function addModifierNames(name, event, noShift) {\n        var base = name;\n        if (event.altKey && base != "Alt") { name = "Alt-" + name; }\n        if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != "Ctrl") { name = "Ctrl-" + name; }\n        if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != "Cmd") { name = "Cmd-" + name; }\n        if (!noShift && event.shiftKey && base != "Shift") { name = "Shift-" + name; }\n        return name\n    }\n\n    // Look up the name of a key as indicated by an event object.\n    function keyName(event, noShift) {\n        if (presto && event.keyCode == 34 && event["char"]) { return false }\n        var name = keyNames[event.keyCode];\n        if (name == null || event.altGraphKey) { return false }\n        // Ctrl-ScrollLock has keyCode 3, same as Ctrl-Pause,\n        // so we\'ll use event.code when available (Chrome 48+, FF 38+, Safari 10.1+)\n        if (event.keyCode == 3 && event.code) { name = event.code; }\n        return addModifierNames(name, event, noShift)\n    }\n\n    function getKeyMap(val) {\n        return typeof val == "string" ? keyMap[val] : val\n    }\n\n    // Helper for deleting text near the selection(s), used to implement\n    // backspace, delete, and similar functionality.\n    function deleteNearSelection(cm, compute) {\n        var ranges = cm.doc.sel.ranges, kill = [];\n        // Build up a set of ranges to kill first, merging overlapping\n        // ranges.\n        for (var i = 0; i < ranges.length; i++) {\n            var toKill = compute(ranges[i]);\n            while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\n                var replaced = kill.pop();\n                if (cmp(replaced.from, toKill.from) < 0) {\n                    toKill.from = replaced.from;\n                    break\n                }\n            }\n            kill.push(toKill);\n        }\n        // Next, remove those actual ranges.\n        runInOp(cm, function () {\n            for (var i = kill.length - 1; i >= 0; i--)\n            { replaceRange(cm.doc, "", kill[i].from, kill[i].to, "+delete"); }\n            ensureCursorVisible(cm);\n        });\n    }\n\n    function moveCharLogically(line, ch, dir) {\n        var target = skipExtendingChars(line.text, ch + dir, dir);\n        return target < 0 || target > line.text.length ? null : target\n    }\n\n    function moveLogically(line, start, dir) {\n        var ch = moveCharLogically(line, start.ch, dir);\n        return ch == null ? null : new Pos(start.line, ch, dir < 0 ? "after" : "before")\n    }\n\n    function endOfLine(visually, cm, lineObj, lineNo, dir) {\n        if (visually) {\n            var order = getOrder(lineObj, cm.doc.direction);\n            if (order) {\n                var part = dir < 0 ? lst(order) : order[0];\n                var moveInStorageOrder = (dir < 0) == (part.level == 1);\n                var sticky = moveInStorageOrder ? "after" : "before";\n                var ch;\n                // With a wrapped rtl chunk (possibly spanning multiple bidi parts),\n                // it could be that the last bidi part is not on the last visual line,\n                // since visual lines contain content order-consecutive chunks.\n                // Thus, in rtl, we are looking for the first (content-order) character\n                // in the rtl chunk that is on the last line (that is, the same line\n                // as the last (content-order) character).\n                if (part.level > 0 || cm.doc.direction == "rtl") {\n                    var prep = prepareMeasureForLine(cm, lineObj);\n                    ch = dir < 0 ? lineObj.text.length - 1 : 0;\n                    var targetTop = measureCharPrepared(cm, prep, ch).top;\n                    ch = findFirst(function (ch) { return measureCharPrepared(cm, prep, ch).top == targetTop; }, (dir < 0) == (part.level == 1) ? part.from : part.to - 1, ch);\n                    if (sticky == "before") { ch = moveCharLogically(lineObj, ch, 1); }\n                } else { ch = dir < 0 ? part.to : part.from; }\n                return new Pos(lineNo, ch, sticky)\n            }\n        }\n        return new Pos(lineNo, dir < 0 ? lineObj.text.length : 0, dir < 0 ? "before" : "after")\n    }\n\n    function moveVisually(cm, line, start, dir) {\n        var bidi = getOrder(line, cm.doc.direction);\n        if (!bidi) { return moveLogically(line, start, dir) }\n        if (start.ch >= line.text.length) {\n            start.ch = line.text.length;\n            start.sticky = "before";\n        } else if (start.ch <= 0) {\n            start.ch = 0;\n            start.sticky = "after";\n        }\n        var partPos = getBidiPartAt(bidi, start.ch, start.sticky), part = bidi[partPos];\n        if (cm.doc.direction == "ltr" && part.level % 2 == 0 && (dir > 0 ? part.to > start.ch : part.from < start.ch)) {\n            // Case 1: We move within an ltr part in an ltr editor. Even with wrapped lines,\n            // nothing interesting happens.\n            return moveLogically(line, start, dir)\n        }\n\n        var mv = function (pos, dir) { return moveCharLogically(line, pos instanceof Pos ? pos.ch : pos, dir); };\n        var prep;\n        var getWrappedLineExtent = function (ch) {\n            if (!cm.options.lineWrapping) { return {begin: 0, end: line.text.length} }\n            prep = prep || prepareMeasureForLine(cm, line);\n            return wrappedLineExtentChar(cm, line, prep, ch)\n        };\n        var wrappedLineExtent = getWrappedLineExtent(start.sticky == "before" ? mv(start, -1) : start.ch);\n\n        if (cm.doc.direction == "rtl" || part.level == 1) {\n            var moveInStorageOrder = (part.level == 1) == (dir < 0);\n            var ch = mv(start, moveInStorageOrder ? 1 : -1);\n            if (ch != null && (!moveInStorageOrder ? ch >= part.from && ch >= wrappedLineExtent.begin : ch <= part.to && ch <= wrappedLineExtent.end)) {\n                // Case 2: We move within an rtl part or in an rtl editor on the same visual line\n                var sticky = moveInStorageOrder ? "before" : "after";\n                return new Pos(start.line, ch, sticky)\n            }\n        }\n\n        // Case 3: Could not move within this bidi part in this visual line, so leave\n        // the current bidi part\n\n        var searchInVisualLine = function (partPos, dir, wrappedLineExtent) {\n            var getRes = function (ch, moveInStorageOrder) { return moveInStorageOrder\n                ? new Pos(start.line, mv(ch, 1), "before")\n                : new Pos(start.line, ch, "after"); };\n\n            for (; partPos >= 0 && partPos < bidi.length; partPos += dir) {\n                var part = bidi[partPos];\n                var moveInStorageOrder = (dir > 0) == (part.level != 1);\n                var ch = moveInStorageOrder ? wrappedLineExtent.begin : mv(wrappedLineExtent.end, -1);\n                if (part.from <= ch && ch < part.to) { return getRes(ch, moveInStorageOrder) }\n                ch = moveInStorageOrder ? part.from : mv(part.to, -1);\n                if (wrappedLineExtent.begin <= ch && ch < wrappedLineExtent.end) { return getRes(ch, moveInStorageOrder) }\n            }\n        };\n\n        // Case 3a: Look for other bidi parts on the same visual line\n        var res = searchInVisualLine(partPos + dir, dir, wrappedLineExtent);\n        if (res) { return res }\n\n        // Case 3b: Look for other bidi parts on the next visual line\n        var nextCh = dir > 0 ? wrappedLineExtent.end : mv(wrappedLineExtent.begin, -1);\n        if (nextCh != null && !(dir > 0 && nextCh == line.text.length)) {\n            res = searchInVisualLine(dir > 0 ? 0 : bidi.length - 1, dir, getWrappedLineExtent(nextCh));\n            if (res) { return res }\n        }\n\n        // Case 4: Nowhere to move\n        return null\n    }\n\n    // Commands are parameter-less actions that can be performed on an\n    // editor, mostly used for keybindings.\n    var commands = {\n        selectAll: selectAll,\n        singleSelection: function (cm) { return cm.setSelection(cm.getCursor("anchor"), cm.getCursor("head"), sel_dontScroll); },\n        killLine: function (cm) { return deleteNearSelection(cm, function (range) {\n            if (range.empty()) {\n                var len = getLine(cm.doc, range.head.line).text.length;\n                if (range.head.ch == len && range.head.line < cm.lastLine())\n                { return {from: range.head, to: Pos(range.head.line + 1, 0)} }\n                else\n                { return {from: range.head, to: Pos(range.head.line, len)} }\n            } else {\n                return {from: range.from(), to: range.to()}\n            }\n        }); },\n        deleteLine: function (cm) { return deleteNearSelection(cm, function (range) { return ({\n            from: Pos(range.from().line, 0),\n            to: clipPos(cm.doc, Pos(range.to().line + 1, 0))\n        }); }); },\n        delLineLeft: function (cm) { return deleteNearSelection(cm, function (range) { return ({\n            from: Pos(range.from().line, 0), to: range.from()\n        }); }); },\n        delWrappedLineLeft: function (cm) { return deleteNearSelection(cm, function (range) {\n            var top = cm.charCoords(range.head, "div").top + 5;\n            var leftPos = cm.coordsChar({left: 0, top: top}, "div");\n            return {from: leftPos, to: range.from()}\n        }); },\n        delWrappedLineRight: function (cm) { return deleteNearSelection(cm, function (range) {\n            var top = cm.charCoords(range.head, "div").top + 5;\n            var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");\n            return {from: range.from(), to: rightPos }\n        }); },\n        undo: function (cm) { return cm.undo(); },\n        redo: function (cm) { return cm.redo(); },\n        undoSelection: function (cm) { return cm.undoSelection(); },\n        redoSelection: function (cm) { return cm.redoSelection(); },\n        goDocStart: function (cm) { return cm.extendSelection(Pos(cm.firstLine(), 0)); },\n        goDocEnd: function (cm) { return cm.extendSelection(Pos(cm.lastLine())); },\n        goLineStart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStart(cm, range.head.line); },\n            {origin: "+move", bias: 1}\n        ); },\n        goLineStartSmart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStartSmart(cm, range.head); },\n            {origin: "+move", bias: 1}\n        ); },\n        goLineEnd: function (cm) { return cm.extendSelectionsBy(function (range) { return lineEnd(cm, range.head.line); },\n            {origin: "+move", bias: -1}\n        ); },\n        goLineRight: function (cm) { return cm.extendSelectionsBy(function (range) {\n            var top = cm.cursorCoords(range.head, "div").top + 5;\n            return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div")\n        }, sel_move); },\n        goLineLeft: function (cm) { return cm.extendSelectionsBy(function (range) {\n            var top = cm.cursorCoords(range.head, "div").top + 5;\n            return cm.coordsChar({left: 0, top: top}, "div")\n        }, sel_move); },\n        goLineLeftSmart: function (cm) { return cm.extendSelectionsBy(function (range) {\n            var top = cm.cursorCoords(range.head, "div").top + 5;\n            var pos = cm.coordsChar({left: 0, top: top}, "div");\n            if (pos.ch < cm.getLine(pos.line).search(/\\S/)) { return lineStartSmart(cm, range.head) }\n            return pos\n        }, sel_move); },\n        goLineUp: function (cm) { return cm.moveV(-1, "line"); },\n        goLineDown: function (cm) { return cm.moveV(1, "line"); },\n        goPageUp: function (cm) { return cm.moveV(-1, "page"); },\n        goPageDown: function (cm) { return cm.moveV(1, "page"); },\n        goCharLeft: function (cm) { return cm.moveH(-1, "char"); },\n        goCharRight: function (cm) { return cm.moveH(1, "char"); },\n        goColumnLeft: function (cm) { return cm.moveH(-1, "column"); },\n        goColumnRight: function (cm) { return cm.moveH(1, "column"); },\n        goWordLeft: function (cm) { return cm.moveH(-1, "word"); },\n        goGroupRight: function (cm) { return cm.moveH(1, "group"); },\n        goGroupLeft: function (cm) { return cm.moveH(-1, "group"); },\n        goWordRight: function (cm) { return cm.moveH(1, "word"); },\n        delCharBefore: function (cm) { return cm.deleteH(-1, "char"); },\n        delCharAfter: function (cm) { return cm.deleteH(1, "char"); },\n        delWordBefore: function (cm) { return cm.deleteH(-1, "word"); },\n        delWordAfter: function (cm) { return cm.deleteH(1, "word"); },\n        delGroupBefore: function (cm) { return cm.deleteH(-1, "group"); },\n        delGroupAfter: function (cm) { return cm.deleteH(1, "group"); },\n        indentAuto: function (cm) { return cm.indentSelection("smart"); },\n        indentMore: function (cm) { return cm.indentSelection("add"); },\n        indentLess: function (cm) { return cm.indentSelection("subtract"); },\n        insertTab: function (cm) { return cm.replaceSelection("\\t"); },\n        insertSoftTab: function (cm) {\n            var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\n            for (var i = 0; i < ranges.length; i++) {\n                var pos = ranges[i].from();\n                var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\n                spaces.push(spaceStr(tabSize - col % tabSize));\n            }\n            cm.replaceSelections(spaces);\n        },\n        defaultTab: function (cm) {\n            if (cm.somethingSelected()) { cm.indentSelection("add"); }\n            else { cm.execCommand("insertTab"); }\n        },\n        // Swap the two chars left and right of each selection\'s head.\n        // Move cursor behind the two swapped characters afterwards.\n        //\n        // Doesn\'t consider line feeds a character.\n        // Doesn\'t scan more than one line above to find a character.\n        // Doesn\'t do anything on an empty line.\n        // Doesn\'t do anything with non-empty selections.\n        transposeChars: function (cm) { return runInOp(cm, function () {\n            var ranges = cm.listSelections(), newSel = [];\n            for (var i = 0; i < ranges.length; i++) {\n                if (!ranges[i].empty()) { continue }\n                var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\n                if (line) {\n                    if (cur.ch == line.length) { cur = new Pos(cur.line, cur.ch - 1); }\n                    if (cur.ch > 0) {\n                        cur = new Pos(cur.line, cur.ch + 1);\n                        cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\n                            Pos(cur.line, cur.ch - 2), cur, "+transpose");\n                    } else if (cur.line > cm.doc.first) {\n                        var prev = getLine(cm.doc, cur.line - 1).text;\n                        if (prev) {\n                            cur = new Pos(cur.line, 1);\n                            cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +\n                                prev.charAt(prev.length - 1),\n                                Pos(cur.line - 1, prev.length - 1), cur, "+transpose");\n                        }\n                    }\n                }\n                newSel.push(new Range(cur, cur));\n            }\n            cm.setSelections(newSel);\n        }); },\n        newlineAndIndent: function (cm) { return runInOp(cm, function () {\n            var sels = cm.listSelections();\n            for (var i = sels.length - 1; i >= 0; i--)\n            { cm.replaceRange(cm.doc.lineSeparator(), sels[i].anchor, sels[i].head, "+input"); }\n            sels = cm.listSelections();\n            for (var i$1 = 0; i$1 < sels.length; i$1++)\n            { cm.indentLine(sels[i$1].from().line, null, true); }\n            ensureCursorVisible(cm);\n        }); },\n        openLine: function (cm) { return cm.replaceSelection("\\n", "start"); },\n        toggleOverwrite: function (cm) { return cm.toggleOverwrite(); }\n    };\n\n\n    function lineStart(cm, lineN) {\n        var line = getLine(cm.doc, lineN);\n        var visual = visualLine(line);\n        if (visual != line) { lineN = lineNo(visual); }\n        return endOfLine(true, cm, visual, lineN, 1)\n    }\n    function lineEnd(cm, lineN) {\n        var line = getLine(cm.doc, lineN);\n        var visual = visualLineEnd(line);\n        if (visual != line) { lineN = lineNo(visual); }\n        return endOfLine(true, cm, line, lineN, -1)\n    }\n    function lineStartSmart(cm, pos) {\n        var start = lineStart(cm, pos.line);\n        var line = getLine(cm.doc, start.line);\n        var order = getOrder(line, cm.doc.direction);\n        if (!order || order[0].level == 0) {\n            var firstNonWS = Math.max(0, line.text.search(/\\S/));\n            var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\n            return Pos(start.line, inWS ? 0 : firstNonWS, start.sticky)\n        }\n        return start\n    }\n\n    // Run a handler that was bound to a key.\n    function doHandleBinding(cm, bound, dropShift) {\n        if (typeof bound == "string") {\n            bound = commands[bound];\n            if (!bound) { return false }\n        }\n        // Ensure previous input has been read, so that the handler sees a\n        // consistent view of the document\n        cm.display.input.ensurePolled();\n        var prevShift = cm.display.shift, done = false;\n        try {\n            if (cm.isReadOnly()) { cm.state.suppressEdits = true; }\n            if (dropShift) { cm.display.shift = false; }\n            done = bound(cm) != Pass;\n        } finally {\n            cm.display.shift = prevShift;\n            cm.state.suppressEdits = false;\n        }\n        return done\n    }\n\n    function lookupKeyForEditor(cm, name, handle) {\n        for (var i = 0; i < cm.state.keyMaps.length; i++) {\n            var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);\n            if (result) { return result }\n        }\n        return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))\n            || lookupKey(name, cm.options.keyMap, handle, cm)\n    }\n\n    // Note that, despite the name, this function is also used to check\n    // for bound mouse clicks.\n\n    var stopSeq = new Delayed;\n\n    function dispatchKey(cm, name, e, handle) {\n        var seq = cm.state.keySeq;\n        if (seq) {\n            if (isModifierKey(name)) { return "handled" }\n            if (/\\\'$/.test(name))\n            { cm.state.keySeq = null; }\n            else\n            { stopSeq.set(50, function () {\n                if (cm.state.keySeq == seq) {\n                    cm.state.keySeq = null;\n                    cm.display.input.reset();\n                }\n            }); }\n            if (dispatchKeyInner(cm, seq + " " + name, e, handle)) { return true }\n        }\n        return dispatchKeyInner(cm, name, e, handle)\n    }\n\n    function dispatchKeyInner(cm, name, e, handle) {\n        var result = lookupKeyForEditor(cm, name, handle);\n\n        if (result == "multi")\n        { cm.state.keySeq = name; }\n        if (result == "handled")\n        { signalLater(cm, "keyHandled", cm, name, e); }\n\n        if (result == "handled" || result == "multi") {\n            e_preventDefault(e);\n            restartBlink(cm);\n        }\n\n        return !!result\n    }\n\n    // Handle a key from the keydown event.\n    function handleKeyBinding(cm, e) {\n        var name = keyName(e, true);\n        if (!name) { return false }\n\n        if (e.shiftKey && !cm.state.keySeq) {\n            // First try to resolve full name (including \'Shift-\'). Failing\n            // that, see if there is a cursor-motion command (starting with\n            // \'go\') bound to the keyname without \'Shift-\'.\n            return dispatchKey(cm, "Shift-" + name, e, function (b) { return doHandleBinding(cm, b, true); })\n                || dispatchKey(cm, name, e, function (b) {\n                    if (typeof b == "string" ? /^go[A-Z]/.test(b) : b.motion)\n                    { return doHandleBinding(cm, b) }\n                })\n        } else {\n            return dispatchKey(cm, name, e, function (b) { return doHandleBinding(cm, b); })\n        }\n    }\n\n    // Handle a key from the keypress event\n    function handleCharBinding(cm, e, ch) {\n        return dispatchKey(cm, "\'" + ch + "\'", e, function (b) { return doHandleBinding(cm, b, true); })\n    }\n\n    var lastStoppedKey = null;\n    function onKeyDown(e) {\n        var cm = this;\n        cm.curOp.focus = activeElt();\n        if (signalDOMEvent(cm, e)) { return }\n        // IE does strange things with escape.\n        if (ie && ie_version < 11 && e.keyCode == 27) { e.returnValue = false; }\n        var code = e.keyCode;\n        cm.display.shift = code == 16 || e.shiftKey;\n        var handled = handleKeyBinding(cm, e);\n        if (presto) {\n            lastStoppedKey = handled ? code : null;\n            // Opera has no cut event... we try to at least catch the key combo\n            if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\n            { cm.replaceSelection("", null, "cut"); }\n        }\n\n        // Turn mouse into crosshair when Alt is held on Mac.\n        if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\n        { showCrossHair(cm); }\n    }\n\n    function showCrossHair(cm) {\n        var lineDiv = cm.display.lineDiv;\n        addClass(lineDiv, "CodeMirror-crosshair");\n\n        function up(e) {\n            if (e.keyCode == 18 || !e.altKey) {\n                rmClass(lineDiv, "CodeMirror-crosshair");\n                off(document, "keyup", up);\n                off(document, "mouseover", up);\n            }\n        }\n        on(document, "keyup", up);\n        on(document, "mouseover", up);\n    }\n\n    function onKeyUp(e) {\n        if (e.keyCode == 16) { this.doc.sel.shift = false; }\n        signalDOMEvent(this, e);\n    }\n\n    function onKeyPress(e) {\n        var cm = this;\n        if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) { return }\n        var keyCode = e.keyCode, charCode = e.charCode;\n        if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return}\n        if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) { return }\n        var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\n        // Some browsers fire keypress events for backspace\n        if (ch == "\\x08") { return }\n        if (handleCharBinding(cm, e, ch)) { return }\n        cm.display.input.onKeyPress(e);\n    }\n\n    var DOUBLECLICK_DELAY = 400;\n\n    var PastClick = function(time, pos, button) {\n        this.time = time;\n        this.pos = pos;\n        this.button = button;\n    };\n\n    PastClick.prototype.compare = function (time, pos, button) {\n        return this.time + DOUBLECLICK_DELAY > time &&\n            cmp(pos, this.pos) == 0 && button == this.button\n    };\n\n    var lastClick, lastDoubleClick;\n    function clickRepeat(pos, button) {\n        var now = +new Date;\n        if (lastDoubleClick && lastDoubleClick.compare(now, pos, button)) {\n            lastClick = lastDoubleClick = null;\n            return "triple"\n        } else if (lastClick && lastClick.compare(now, pos, button)) {\n            lastDoubleClick = new PastClick(now, pos, button);\n            lastClick = null;\n            return "double"\n        } else {\n            lastClick = new PastClick(now, pos, button);\n            lastDoubleClick = null;\n            return "single"\n        }\n    }\n\n    // A mouse down can be a single click, double click, triple click,\n    // start of selection drag, start of text drag, new cursor\n    // (ctrl-click), rectangle drag (alt-drag), or xwin\n    // middle-click-paste. Or it might be a click on something we should\n    // not interfere with, such as a scrollbar or widget.\n    function onMouseDown(e) {\n        var cm = this, display = cm.display;\n        if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) { return }\n        display.input.ensurePolled();\n        display.shift = e.shiftKey;\n\n        if (eventInWidget(display, e)) {\n            if (!webkit) {\n                // Briefly turn off draggability, to allow widgets to do\n                // normal dragging things.\n                display.scroller.draggable = false;\n                setTimeout(function () { return display.scroller.draggable = true; }, 100);\n            }\n            return\n        }\n        if (clickInGutter(cm, e)) { return }\n        var pos = posFromMouse(cm, e), button = e_button(e), repeat = pos ? clickRepeat(pos, button) : "single";\n        window.focus();\n\n        // #3261: make sure, that we\'re not starting a second selection\n        if (button == 1 && cm.state.selectingText)\n        { cm.state.selectingText(e); }\n\n        if (pos && handleMappedButton(cm, button, pos, repeat, e)) { return }\n\n        if (button == 1) {\n            if (pos) { leftButtonDown(cm, pos, repeat, e); }\n            else if (e_target(e) == display.scroller) { e_preventDefault(e); }\n        } else if (button == 2) {\n            if (pos) { extendSelection(cm.doc, pos); }\n            setTimeout(function () { return display.input.focus(); }, 20);\n        } else if (button == 3) {\n            if (captureRightClick) { cm.display.input.onContextMenu(e); }\n            else { delayBlurEvent(cm); }\n        }\n    }\n\n    function handleMappedButton(cm, button, pos, repeat, event) {\n        var name = "Click";\n        if (repeat == "double") { name = "Double" + name; }\n        else if (repeat == "triple") { name = "Triple" + name; }\n        name = (button == 1 ? "Left" : button == 2 ? "Middle" : "Right") + name;\n\n        return dispatchKey(cm,  addModifierNames(name, event), event, function (bound) {\n            if (typeof bound == "string") { bound = commands[bound]; }\n            if (!bound) { return false }\n            var done = false;\n            try {\n                if (cm.isReadOnly()) { cm.state.suppressEdits = true; }\n                done = bound(cm, pos) != Pass;\n            } finally {\n                cm.state.suppressEdits = false;\n            }\n            return done\n        })\n    }\n\n    function configureMouse(cm, repeat, event) {\n        var option = cm.getOption("configureMouse");\n        var value = option ? option(cm, repeat, event) : {};\n        if (value.unit == null) {\n            var rect = chromeOS ? event.shiftKey && event.metaKey : event.altKey;\n            value.unit = rect ? "rectangle" : repeat == "single" ? "char" : repeat == "double" ? "word" : "line";\n        }\n        if (value.extend == null || cm.doc.extend) { value.extend = cm.doc.extend || event.shiftKey; }\n        if (value.addNew == null) { value.addNew = mac ? event.metaKey : event.ctrlKey; }\n        if (value.moveOnDrag == null) { value.moveOnDrag = !(mac ? event.altKey : event.ctrlKey); }\n        return value\n    }\n\n    function leftButtonDown(cm, pos, repeat, event) {\n        if (ie) { setTimeout(bind(ensureFocus, cm), 0); }\n        else { cm.curOp.focus = activeElt(); }\n\n        var behavior = configureMouse(cm, repeat, event);\n\n        var sel = cm.doc.sel, contained;\n        if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&\n            repeat == "single" && (contained = sel.contains(pos)) > -1 &&\n            (cmp((contained = sel.ranges[contained]).from(), pos) < 0 || pos.xRel > 0) &&\n            (cmp(contained.to(), pos) > 0 || pos.xRel < 0))\n        { leftButtonStartDrag(cm, event, pos, behavior); }\n        else\n        { leftButtonSelect(cm, event, pos, behavior); }\n    }\n\n    // Start a text drag. When it ends, see if any dragging actually\n    // happen, and treat as a click if it didn\'t.\n    function leftButtonStartDrag(cm, event, pos, behavior) {\n        var display = cm.display, moved = false;\n        var dragEnd = operation(cm, function (e) {\n            if (webkit) { display.scroller.draggable = false; }\n            cm.state.draggingText = false;\n            off(display.wrapper.ownerDocument, "mouseup", dragEnd);\n            off(display.wrapper.ownerDocument, "mousemove", mouseMove);\n            off(display.scroller, "dragstart", dragStart);\n            off(display.scroller, "drop", dragEnd);\n            if (!moved) {\n                e_preventDefault(e);\n                if (!behavior.addNew)\n                { extendSelection(cm.doc, pos, null, null, behavior.extend); }\n                // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)\n                if (webkit || ie && ie_version == 9)\n                { setTimeout(function () {display.wrapper.ownerDocument.body.focus(); display.input.focus();}, 20); }\n                else\n                { display.input.focus(); }\n            }\n        });\n        var mouseMove = function(e2) {\n            moved = moved || Math.abs(event.clientX - e2.clientX) + Math.abs(event.clientY - e2.clientY) >= 10;\n        };\n        var dragStart = function () { return moved = true; };\n        // Let the drag handler handle this.\n        if (webkit) { display.scroller.draggable = true; }\n        cm.state.draggingText = dragEnd;\n        dragEnd.copy = !behavior.moveOnDrag;\n        // IE\'s approach to draggable\n        if (display.scroller.dragDrop) { display.scroller.dragDrop(); }\n        on(display.wrapper.ownerDocument, "mouseup", dragEnd);\n        on(display.wrapper.ownerDocument, "mousemove", mouseMove);\n        on(display.scroller, "dragstart", dragStart);\n        on(display.scroller, "drop", dragEnd);\n\n        delayBlurEvent(cm);\n        setTimeout(function () { return display.input.focus(); }, 20);\n    }\n\n    function rangeForUnit(cm, pos, unit) {\n        if (unit == "char") { return new Range(pos, pos) }\n        if (unit == "word") { return cm.findWordAt(pos) }\n        if (unit == "line") { return new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))) }\n        var result = unit(cm, pos);\n        return new Range(result.from, result.to)\n    }\n\n    // Normal selection, as opposed to text dragging.\n    function leftButtonSelect(cm, event, start, behavior) {\n        var display = cm.display, doc = cm.doc;\n        e_preventDefault(event);\n\n        var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;\n        if (behavior.addNew && !behavior.extend) {\n            ourIndex = doc.sel.contains(start);\n            if (ourIndex > -1)\n            { ourRange = ranges[ourIndex]; }\n            else\n            { ourRange = new Range(start, start); }\n        } else {\n            ourRange = doc.sel.primary();\n            ourIndex = doc.sel.primIndex;\n        }\n\n        if (behavior.unit == "rectangle") {\n            if (!behavior.addNew) { ourRange = new Range(start, start); }\n            start = posFromMouse(cm, event, true, true);\n            ourIndex = -1;\n        } else {\n            var range$$1 = rangeForUnit(cm, start, behavior.unit);\n            if (behavior.extend)\n            { ourRange = extendRange(ourRange, range$$1.anchor, range$$1.head, behavior.extend); }\n            else\n            { ourRange = range$$1; }\n        }\n\n        if (!behavior.addNew) {\n            ourIndex = 0;\n            setSelection(doc, new Selection([ourRange], 0), sel_mouse);\n            startSel = doc.sel;\n        } else if (ourIndex == -1) {\n            ourIndex = ranges.length;\n            setSelection(doc, normalizeSelection(cm, ranges.concat([ourRange]), ourIndex),\n                {scroll: false, origin: "*mouse"});\n        } else if (ranges.length > 1 && ranges[ourIndex].empty() && behavior.unit == "char" && !behavior.extend) {\n            setSelection(doc, normalizeSelection(cm, ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),\n                {scroll: false, origin: "*mouse"});\n            startSel = doc.sel;\n        } else {\n            replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\n        }\n\n        var lastPos = start;\n        function extendTo(pos) {\n            if (cmp(lastPos, pos) == 0) { return }\n            lastPos = pos;\n\n            if (behavior.unit == "rectangle") {\n                var ranges = [], tabSize = cm.options.tabSize;\n                var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\n                var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\n                var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\n                for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\n                     line <= end; line++) {\n                    var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\n                    if (left == right)\n                    { ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos))); }\n                    else if (text.length > leftPos)\n                    { ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize)))); }\n                }\n                if (!ranges.length) { ranges.push(new Range(start, start)); }\n                setSelection(doc, normalizeSelection(cm, startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\n                    {origin: "*mouse", scroll: false});\n                cm.scrollIntoView(pos);\n            } else {\n                var oldRange = ourRange;\n                var range$$1 = rangeForUnit(cm, pos, behavior.unit);\n                var anchor = oldRange.anchor, head;\n                if (cmp(range$$1.anchor, anchor) > 0) {\n                    head = range$$1.head;\n                    anchor = minPos(oldRange.from(), range$$1.anchor);\n                } else {\n                    head = range$$1.anchor;\n                    anchor = maxPos(oldRange.to(), range$$1.head);\n                }\n                var ranges$1 = startSel.ranges.slice(0);\n                ranges$1[ourIndex] = bidiSimplify(cm, new Range(clipPos(doc, anchor), head));\n                setSelection(doc, normalizeSelection(cm, ranges$1, ourIndex), sel_mouse);\n            }\n        }\n\n        var editorSize = display.wrapper.getBoundingClientRect();\n        // Used to ensure timeout re-tries don\'t fire when another extend\n        // happened in the meantime (clearTimeout isn\'t reliable -- at\n        // least on Chrome, the timeouts still happen even when cleared,\n        // if the clear happens after their scheduled firing time).\n        var counter = 0;\n\n        function extend(e) {\n            var curCount = ++counter;\n            var cur = posFromMouse(cm, e, true, behavior.unit == "rectangle");\n            if (!cur) { return }\n            if (cmp(cur, lastPos) != 0) {\n                cm.curOp.focus = activeElt();\n                extendTo(cur);\n                var visible = visibleLines(display, doc);\n                if (cur.line >= visible.to || cur.line < visible.from)\n                { setTimeout(operation(cm, function () {if (counter == curCount) { extend(e); }}), 150); }\n            } else {\n                var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\n                if (outside) { setTimeout(operation(cm, function () {\n                    if (counter != curCount) { return }\n                    display.scroller.scrollTop += outside;\n                    extend(e);\n                }), 50); }\n            }\n        }\n\n        function done(e) {\n            cm.state.selectingText = false;\n            counter = Infinity;\n            e_preventDefault(e);\n            display.input.focus();\n            off(display.wrapper.ownerDocument, "mousemove", move);\n            off(display.wrapper.ownerDocument, "mouseup", up);\n            doc.history.lastSelOrigin = null;\n        }\n\n        var move = operation(cm, function (e) {\n            if (e.buttons === 0 || !e_button(e)) { done(e); }\n            else { extend(e); }\n        });\n        var up = operation(cm, done);\n        cm.state.selectingText = up;\n        on(display.wrapper.ownerDocument, "mousemove", move);\n        on(display.wrapper.ownerDocument, "mouseup", up);\n    }\n\n    // Used when mouse-selecting to adjust the anchor to the proper side\n    // of a bidi jump depending on the visual position of the head.\n    function bidiSimplify(cm, range$$1) {\n        var anchor = range$$1.anchor;\n        var head = range$$1.head;\n        var anchorLine = getLine(cm.doc, anchor.line);\n        if (cmp(anchor, head) == 0 && anchor.sticky == head.sticky) { return range$$1 }\n        var order = getOrder(anchorLine);\n        if (!order) { return range$$1 }\n        var index = getBidiPartAt(order, anchor.ch, anchor.sticky), part = order[index];\n        if (part.from != anchor.ch && part.to != anchor.ch) { return range$$1 }\n        var boundary = index + ((part.from == anchor.ch) == (part.level != 1) ? 0 : 1);\n        if (boundary == 0 || boundary == order.length) { return range$$1 }\n\n        // Compute the relative visual position of the head compared to the\n        // anchor (<0 is to the left, >0 to the right)\n        var leftSide;\n        if (head.line != anchor.line) {\n            leftSide = (head.line - anchor.line) * (cm.doc.direction == "ltr" ? 1 : -1) > 0;\n        } else {\n            var headIndex = getBidiPartAt(order, head.ch, head.sticky);\n            var dir = headIndex - index || (head.ch - anchor.ch) * (part.level == 1 ? -1 : 1);\n            if (headIndex == boundary - 1 || headIndex == boundary)\n            { leftSide = dir < 0; }\n            else\n            { leftSide = dir > 0; }\n        }\n\n        var usePart = order[boundary + (leftSide ? -1 : 0)];\n        var from = leftSide == (usePart.level == 1);\n        var ch = from ? usePart.from : usePart.to, sticky = from ? "after" : "before";\n        return anchor.ch == ch && anchor.sticky == sticky ? range$$1 : new Range(new Pos(anchor.line, ch, sticky), head)\n    }\n\n\n    // Determines whether an event happened in the gutter, and fires the\n    // handlers for the corresponding event.\n    function gutterEvent(cm, e, type, prevent) {\n        var mX, mY;\n        if (e.touches) {\n            mX = e.touches[0].clientX;\n            mY = e.touches[0].clientY;\n        } else {\n            try { mX = e.clientX; mY = e.clientY; }\n            catch(e) { return false }\n        }\n        if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) { return false }\n        if (prevent) { e_preventDefault(e); }\n\n        var display = cm.display;\n        var lineBox = display.lineDiv.getBoundingClientRect();\n\n        if (mY > lineBox.bottom || !hasHandler(cm, type)) { return e_defaultPrevented(e) }\n        mY -= lineBox.top - display.viewOffset;\n\n        for (var i = 0; i < cm.options.gutters.length; ++i) {\n            var g = display.gutters.childNodes[i];\n            if (g && g.getBoundingClientRect().right >= mX) {\n                var line = lineAtHeight(cm.doc, mY);\n                var gutter = cm.options.gutters[i];\n                signal(cm, type, cm, line, gutter, e);\n                return e_defaultPrevented(e)\n            }\n        }\n    }\n\n    function clickInGutter(cm, e) {\n        return gutterEvent(cm, e, "gutterClick", true)\n    }\n\n    // CONTEXT MENU HANDLING\n\n    // To make the context menu work, we need to briefly unhide the\n    // textarea (making it as unobtrusive as possible) to let the\n    // right-click take effect on it.\n    function onContextMenu(cm, e) {\n        if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) { return }\n        if (signalDOMEvent(cm, e, "contextmenu")) { return }\n        if (!captureRightClick) { cm.display.input.onContextMenu(e); }\n    }\n\n    function contextMenuInGutter(cm, e) {\n        if (!hasHandler(cm, "gutterContextMenu")) { return false }\n        return gutterEvent(cm, e, "gutterContextMenu", false)\n    }\n\n    function themeChanged(cm) {\n        cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, "") +\n            cm.options.theme.replace(/(^|\\s)\\s*/g, " cm-s-");\n        clearCaches(cm);\n    }\n\n    var Init = {toString: function(){return "CodeMirror.Init"}};\n\n    var defaults = {};\n    var optionHandlers = {};\n\n    function defineOptions(CodeMirror) {\n        var optionHandlers = CodeMirror.optionHandlers;\n\n        function option(name, deflt, handle, notOnInit) {\n            CodeMirror.defaults[name] = deflt;\n            if (handle) { optionHandlers[name] =\n                notOnInit ? function (cm, val, old) {if (old != Init) { handle(cm, val, old); }} : handle; }\n        }\n\n        CodeMirror.defineOption = option;\n\n        // Passed to option handlers when there is no old value.\n        CodeMirror.Init = Init;\n\n        // These two are, on init, called from the constructor because they\n        // have to be initialized before the editor can start at all.\n        option("value", "", function (cm, val) { return cm.setValue(val); }, true);\n        option("mode", null, function (cm, val) {\n            cm.doc.modeOption = val;\n            loadMode(cm);\n        }, true);\n\n        option("indentUnit", 2, loadMode, true);\n        option("indentWithTabs", false);\n        option("smartIndent", true);\n        option("tabSize", 4, function (cm) {\n            resetModeState(cm);\n            clearCaches(cm);\n            regChange(cm);\n        }, true);\n\n        option("lineSeparator", null, function (cm, val) {\n            cm.doc.lineSep = val;\n            if (!val) { return }\n            var newBreaks = [], lineNo = cm.doc.first;\n            cm.doc.iter(function (line) {\n                for (var pos = 0;;) {\n                    var found = line.text.indexOf(val, pos);\n                    if (found == -1) { break }\n                    pos = found + val.length;\n                    newBreaks.push(Pos(lineNo, found));\n                }\n                lineNo++;\n            });\n            for (var i = newBreaks.length - 1; i >= 0; i--)\n            { replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length)); }\n        });\n        option("specialChars", /[\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u061c\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function (cm, val, old) {\n            cm.state.specialChars = new RegExp(val.source + (val.test("\\t") ? "" : "|\\t"), "g");\n            if (old != Init) { cm.refresh(); }\n        });\n        option("specialCharPlaceholder", defaultSpecialCharPlaceholder, function (cm) { return cm.refresh(); }, true);\n        option("electricChars", true);\n        option("inputStyle", mobile ? "contenteditable" : "textarea", function () {\n            throw new Error("inputStyle can not (yet) be changed in a running editor") // FIXME\n        }, true);\n        option("spellcheck", false, function (cm, val) { return cm.getInputField().spellcheck = val; }, true);\n        option("rtlMoveVisually", !windows);\n        option("wholeLineUpdateBefore", true);\n\n        option("theme", "default", function (cm) {\n            themeChanged(cm);\n            guttersChanged(cm);\n        }, true);\n        option("keyMap", "default", function (cm, val, old) {\n            var next = getKeyMap(val);\n            var prev = old != Init && getKeyMap(old);\n            if (prev && prev.detach) { prev.detach(cm, next); }\n            if (next.attach) { next.attach(cm, prev || null); }\n        });\n        option("extraKeys", null);\n        option("configureMouse", null);\n\n        option("lineWrapping", false, wrappingChanged, true);\n        option("gutters", [], function (cm) {\n            setGuttersForLineNumbers(cm.options);\n            guttersChanged(cm);\n        }, true);\n        option("fixedGutter", true, function (cm, val) {\n            cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + "px" : "0";\n            cm.refresh();\n        }, true);\n        option("coverGutterNextToScrollbar", false, function (cm) { return updateScrollbars(cm); }, true);\n        option("scrollbarStyle", "native", function (cm) {\n            initScrollbars(cm);\n            updateScrollbars(cm);\n            cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);\n            cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);\n        }, true);\n        option("lineNumbers", false, function (cm) {\n            setGuttersForLineNumbers(cm.options);\n            guttersChanged(cm);\n        }, true);\n        option("firstLineNumber", 1, guttersChanged, true);\n        option("lineNumberFormatter", function (integer) { return integer; }, guttersChanged, true);\n        option("showCursorWhenSelecting", false, updateSelection, true);\n\n        option("resetSelectionOnContextMenu", true);\n        option("lineWiseCopyCut", true);\n        option("pasteLinesPerSelection", true);\n        option("selectionsMayTouch", false);\n\n        option("readOnly", false, function (cm, val) {\n            if (val == "nocursor") {\n                onBlur(cm);\n                cm.display.input.blur();\n            }\n            cm.display.input.readOnlyChanged(val);\n        });\n        option("disableInput", false, function (cm, val) {if (!val) { cm.display.input.reset(); }}, true);\n        option("dragDrop", true, dragDropChanged);\n        option("allowDropFileTypes", null);\n\n        option("cursorBlinkRate", 530);\n        option("cursorScrollMargin", 0);\n        option("cursorHeight", 1, updateSelection, true);\n        option("singleCursorHeightPerLine", true, updateSelection, true);\n        option("workTime", 100);\n        option("workDelay", 100);\n        option("flattenSpans", true, resetModeState, true);\n        option("addModeClass", false, resetModeState, true);\n        option("pollInterval", 100);\n        option("undoDepth", 200, function (cm, val) { return cm.doc.history.undoDepth = val; });\n        option("historyEventDelay", 1250);\n        option("viewportMargin", 10, function (cm) { return cm.refresh(); }, true);\n        option("maxHighlightLength", 10000, resetModeState, true);\n        option("moveInputWithCursor", true, function (cm, val) {\n            if (!val) { cm.display.input.resetPosition(); }\n        });\n\n        option("tabindex", null, function (cm, val) { return cm.display.input.getField().tabIndex = val || ""; });\n        option("autofocus", null);\n        option("direction", "ltr", function (cm, val) { return cm.doc.setDirection(val); }, true);\n        option("phrases", null);\n    }\n\n    function guttersChanged(cm) {\n        updateGutters(cm);\n        regChange(cm);\n        alignHorizontally(cm);\n    }\n\n    function dragDropChanged(cm, value, old) {\n        var wasOn = old && old != Init;\n        if (!value != !wasOn) {\n            var funcs = cm.display.dragFunctions;\n            var toggle = value ? on : off;\n            toggle(cm.display.scroller, "dragstart", funcs.start);\n            toggle(cm.display.scroller, "dragenter", funcs.enter);\n            toggle(cm.display.scroller, "dragover", funcs.over);\n            toggle(cm.display.scroller, "dragleave", funcs.leave);\n            toggle(cm.display.scroller, "drop", funcs.drop);\n        }\n    }\n\n    function wrappingChanged(cm) {\n        if (cm.options.lineWrapping) {\n            addClass(cm.display.wrapper, "CodeMirror-wrap");\n            cm.display.sizer.style.minWidth = "";\n            cm.display.sizerWidth = null;\n        } else {\n            rmClass(cm.display.wrapper, "CodeMirror-wrap");\n            findMaxLine(cm);\n        }\n        estimateLineHeights(cm);\n        regChange(cm);\n        clearCaches(cm);\n        setTimeout(function () { return updateScrollbars(cm); }, 100);\n    }\n\n    // A CodeMirror instance represents an editor. This is the object\n    // that user code is usually dealing with.\n\n    function CodeMirror(place, options) {\n        var this$1 = this;\n\n        if (!(this instanceof CodeMirror)) { return new CodeMirror(place, options) }\n\n        this.options = options = options ? copyObj(options) : {};\n        // Determine effective options based on given values and defaults.\n        copyObj(defaults, options, false);\n        setGuttersForLineNumbers(options);\n\n        var doc = options.value;\n        if (typeof doc == "string") { doc = new Doc(doc, options.mode, null, options.lineSeparator, options.direction); }\n        else if (options.mode) { doc.modeOption = options.mode; }\n        this.doc = doc;\n\n        var input = new CodeMirror.inputStyles[options.inputStyle](this);\n        var display = this.display = new Display(place, doc, input);\n        display.wrapper.CodeMirror = this;\n        updateGutters(this);\n        themeChanged(this);\n        if (options.lineWrapping)\n        { this.display.wrapper.className += " CodeMirror-wrap"; }\n        initScrollbars(this);\n\n        this.state = {\n            keyMaps: [],  // stores maps added by addKeyMap\n            overlays: [], // highlighting overlays, as added by addOverlay\n            modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\n            overwrite: false,\n            delayingBlurEvent: false,\n            focused: false,\n            suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\n            pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in input.poll\n            selectingText: false,\n            draggingText: false,\n            highlight: new Delayed(), // stores highlight worker timeout\n            keySeq: null,  // Unfinished key sequence\n            specialChars: null\n        };\n\n        if (options.autofocus && !mobile) { display.input.focus(); }\n\n        // Override magic textarea content restore that IE sometimes does\n        // on our hidden textarea on reload\n        if (ie && ie_version < 11) { setTimeout(function () { return this$1.display.input.reset(true); }, 20); }\n\n        registerEventHandlers(this);\n        ensureGlobalHandlers();\n\n        startOperation(this);\n        this.curOp.forceUpdate = true;\n        attachDoc(this, doc);\n\n        if ((options.autofocus && !mobile) || this.hasFocus())\n        { setTimeout(bind(onFocus, this), 20); }\n        else\n        { onBlur(this); }\n\n        for (var opt in optionHandlers) { if (optionHandlers.hasOwnProperty(opt))\n        { optionHandlers[opt](this, options[opt], Init); } }\n        maybeUpdateLineNumberWidth(this);\n        if (options.finishInit) { options.finishInit(this); }\n        for (var i = 0; i < initHooks.length; ++i) { initHooks[i](this); }\n        endOperation(this);\n        // Suppress optimizelegibility in Webkit, since it breaks text\n        // measuring on line wrapping boundaries.\n        if (webkit && options.lineWrapping &&\n            getComputedStyle(display.lineDiv).textRendering == "optimizelegibility")\n        { display.lineDiv.style.textRendering = "auto"; }\n    }\n\n    // The default configuration options.\n    CodeMirror.defaults = defaults;\n    // Functions to run when options are changed.\n    CodeMirror.optionHandlers = optionHandlers;\n\n    // Attach the necessary event handlers when initializing the editor\n    function registerEventHandlers(cm) {\n        var d = cm.display;\n        on(d.scroller, "mousedown", operation(cm, onMouseDown));\n        // Older IE\'s will not fire a second mousedown for a double click\n        if (ie && ie_version < 11)\n        { on(d.scroller, "dblclick", operation(cm, function (e) {\n            if (signalDOMEvent(cm, e)) { return }\n            var pos = posFromMouse(cm, e);\n            if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) { return }\n            e_preventDefault(e);\n            var word = cm.findWordAt(pos);\n            extendSelection(cm.doc, word.anchor, word.head);\n        })); }\n        else\n        { on(d.scroller, "dblclick", function (e) { return signalDOMEvent(cm, e) || e_preventDefault(e); }); }\n        // Some browsers fire contextmenu *after* opening the menu, at\n        // which point we can\'t mess with it anymore. Context menu is\n        // handled in onMouseDown for these browsers.\n        on(d.scroller, "contextmenu", function (e) { return onContextMenu(cm, e); });\n\n        // Used to suppress mouse event handling when a touch happens\n        var touchFinished, prevTouch = {end: 0};\n        function finishTouch() {\n            if (d.activeTouch) {\n                touchFinished = setTimeout(function () { return d.activeTouch = null; }, 1000);\n                prevTouch = d.activeTouch;\n                prevTouch.end = +new Date;\n            }\n        }\n        function isMouseLikeTouchEvent(e) {\n            if (e.touches.length != 1) { return false }\n            var touch = e.touches[0];\n            return touch.radiusX <= 1 && touch.radiusY <= 1\n        }\n        function farAway(touch, other) {\n            if (other.left == null) { return true }\n            var dx = other.left - touch.left, dy = other.top - touch.top;\n            return dx * dx + dy * dy > 20 * 20\n        }\n        on(d.scroller, "touchstart", function (e) {\n            if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e) && !clickInGutter(cm, e)) {\n                d.input.ensurePolled();\n                clearTimeout(touchFinished);\n                var now = +new Date;\n                d.activeTouch = {start: now, moved: false,\n                    prev: now - prevTouch.end <= 300 ? prevTouch : null};\n                if (e.touches.length == 1) {\n                    d.activeTouch.left = e.touches[0].pageX;\n                    d.activeTouch.top = e.touches[0].pageY;\n                }\n            }\n        });\n        on(d.scroller, "touchmove", function () {\n            if (d.activeTouch) { d.activeTouch.moved = true; }\n        });\n        on(d.scroller, "touchend", function (e) {\n            var touch = d.activeTouch;\n            if (touch && !eventInWidget(d, e) && touch.left != null &&\n                !touch.moved && new Date - touch.start < 300) {\n                var pos = cm.coordsChar(d.activeTouch, "page"), range;\n                if (!touch.prev || farAway(touch, touch.prev)) // Single tap\n                { range = new Range(pos, pos); }\n                else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap\n                { range = cm.findWordAt(pos); }\n                else // Triple tap\n                { range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))); }\n                cm.setSelection(range.anchor, range.head);\n                cm.focus();\n                e_preventDefault(e);\n            }\n            finishTouch();\n        });\n        on(d.scroller, "touchcancel", finishTouch);\n\n        // Sync scrolling between fake scrollbars and real scrollable\n        // area, ensure viewport is updated when scrolling.\n        on(d.scroller, "scroll", function () {\n            if (d.scroller.clientHeight) {\n                updateScrollTop(cm, d.scroller.scrollTop);\n                setScrollLeft(cm, d.scroller.scrollLeft, true);\n                signal(cm, "scroll", cm);\n            }\n        });\n\n        // Listen to wheel events in order to try and update the viewport on time.\n        on(d.scroller, "mousewheel", function (e) { return onScrollWheel(cm, e); });\n        on(d.scroller, "DOMMouseScroll", function (e) { return onScrollWheel(cm, e); });\n\n        // Prevent wrapper from ever scrolling\n        on(d.wrapper, "scroll", function () { return d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\n\n        d.dragFunctions = {\n            enter: function (e) {if (!signalDOMEvent(cm, e)) { e_stop(e); }},\n            over: function (e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},\n            start: function (e) { return onDragStart(cm, e); },\n            drop: operation(cm, onDrop),\n            leave: function (e) {if (!signalDOMEvent(cm, e)) { clearDragCursor(cm); }}\n        };\n\n        var inp = d.input.getField();\n        on(inp, "keyup", function (e) { return onKeyUp.call(cm, e); });\n        on(inp, "keydown", operation(cm, onKeyDown));\n        on(inp, "keypress", operation(cm, onKeyPress));\n        on(inp, "focus", function (e) { return onFocus(cm, e); });\n        on(inp, "blur", function (e) { return onBlur(cm, e); });\n    }\n\n    var initHooks = [];\n    CodeMirror.defineInitHook = function (f) { return initHooks.push(f); };\n\n    // Indent the given line. The how parameter can be "smart",\n    // "add"/null, "subtract", or "prev". When aggressive is false\n    // (typically set to true for forced single-line indents), empty\n    // lines are not indented, and places where the mode returns Pass\n    // are left alone.\n    function indentLine(cm, n, how, aggressive) {\n        var doc = cm.doc, state;\n        if (how == null) { how = "add"; }\n        if (how == "smart") {\n            // Fall back to "prev" when the mode doesn\'t have an indentation\n            // method.\n            if (!doc.mode.indent) { how = "prev"; }\n            else { state = getContextBefore(cm, n).state; }\n        }\n\n        var tabSize = cm.options.tabSize;\n        var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\n        if (line.stateAfter) { line.stateAfter = null; }\n        var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\n        if (!aggressive && !/\\S/.test(line.text)) {\n            indentation = 0;\n            how = "not";\n        } else if (how == "smart") {\n            indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\n            if (indentation == Pass || indentation > 150) {\n                if (!aggressive) { return }\n                how = "prev";\n            }\n        }\n        if (how == "prev") {\n            if (n > doc.first) { indentation = countColumn(getLine(doc, n-1).text, null, tabSize); }\n            else { indentation = 0; }\n        } else if (how == "add") {\n            indentation = curSpace + cm.options.indentUnit;\n        } else if (how == "subtract") {\n            indentation = curSpace - cm.options.indentUnit;\n        } else if (typeof how == "number") {\n            indentation = curSpace + how;\n        }\n        indentation = Math.max(0, indentation);\n\n        var indentString = "", pos = 0;\n        if (cm.options.indentWithTabs)\n        { for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += "\\t";} }\n        if (pos < indentation) { indentString += spaceStr(indentation - pos); }\n\n        if (indentString != curSpaceString) {\n            replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), "+input");\n            line.stateAfter = null;\n            return true\n        } else {\n            // Ensure that, if the cursor was in the whitespace at the start\n            // of the line, it is moved to the end of that space.\n            for (var i$1 = 0; i$1 < doc.sel.ranges.length; i$1++) {\n                var range = doc.sel.ranges[i$1];\n                if (range.head.line == n && range.head.ch < curSpaceString.length) {\n                    var pos$1 = Pos(n, curSpaceString.length);\n                    replaceOneSelection(doc, i$1, new Range(pos$1, pos$1));\n                    break\n                }\n            }\n        }\n    }\n\n    // This will be set to a {lineWise: bool, text: [string]} object, so\n    // that, when pasting, we know what kind of selections the copied\n    // text was made out of.\n    var lastCopied = null;\n\n    function setLastCopied(newLastCopied) {\n        lastCopied = newLastCopied;\n    }\n\n    function applyTextInput(cm, inserted, deleted, sel, origin) {\n        var doc = cm.doc;\n        cm.display.shift = false;\n        if (!sel) { sel = doc.sel; }\n\n        var paste = cm.state.pasteIncoming || origin == "paste";\n        var textLines = splitLinesAuto(inserted), multiPaste = null;\n        // When pasting N lines into N selections, insert one line per selection\n        if (paste && sel.ranges.length > 1) {\n            if (lastCopied && lastCopied.text.join("\\n") == inserted) {\n                if (sel.ranges.length % lastCopied.text.length == 0) {\n                    multiPaste = [];\n                    for (var i = 0; i < lastCopied.text.length; i++)\n                    { multiPaste.push(doc.splitLines(lastCopied.text[i])); }\n                }\n            } else if (textLines.length == sel.ranges.length && cm.options.pasteLinesPerSelection) {\n                multiPaste = map(textLines, function (l) { return [l]; });\n            }\n        }\n\n        var updateInput = cm.curOp.updateInput;\n        // Normal behavior is to insert the new text into every selection\n        for (var i$1 = sel.ranges.length - 1; i$1 >= 0; i$1--) {\n            var range$$1 = sel.ranges[i$1];\n            var from = range$$1.from(), to = range$$1.to();\n            if (range$$1.empty()) {\n                if (deleted && deleted > 0) // Handle deletion\n                { from = Pos(from.line, from.ch - deleted); }\n                else if (cm.state.overwrite && !paste) // Handle overwrite\n                { to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length)); }\n                else if (paste && lastCopied && lastCopied.lineWise && lastCopied.text.join("\\n") == inserted)\n                { from = to = Pos(from.line, 0); }\n            }\n            var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i$1 % multiPaste.length] : textLines,\n                origin: origin || (paste ? "paste" : cm.state.cutIncoming ? "cut" : "+input")};\n            makeChange(cm.doc, changeEvent);\n            signalLater(cm, "inputRead", cm, changeEvent);\n        }\n        if (inserted && !paste)\n        { triggerElectric(cm, inserted); }\n\n        ensureCursorVisible(cm);\n        if (cm.curOp.updateInput < 2) { cm.curOp.updateInput = updateInput; }\n        cm.curOp.typing = true;\n        cm.state.pasteIncoming = cm.state.cutIncoming = false;\n    }\n\n    function handlePaste(e, cm) {\n        var pasted = e.clipboardData && e.clipboardData.getData("Text");\n        if (pasted) {\n            e.preventDefault();\n            if (!cm.isReadOnly() && !cm.options.disableInput)\n            { runInOp(cm, function () { return applyTextInput(cm, pasted, 0, null, "paste"); }); }\n            return true\n        }\n    }\n\n    function triggerElectric(cm, inserted) {\n        // When an \'electric\' character is inserted, immediately trigger a reindent\n        if (!cm.options.electricChars || !cm.options.smartIndent) { return }\n        var sel = cm.doc.sel;\n\n        for (var i = sel.ranges.length - 1; i >= 0; i--) {\n            var range$$1 = sel.ranges[i];\n            if (range$$1.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range$$1.head.line)) { continue }\n            var mode = cm.getModeAt(range$$1.head);\n            var indented = false;\n            if (mode.electricChars) {\n                for (var j = 0; j < mode.electricChars.length; j++)\n                { if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\n                    indented = indentLine(cm, range$$1.head.line, "smart");\n                    break\n                } }\n            } else if (mode.electricInput) {\n                if (mode.electricInput.test(getLine(cm.doc, range$$1.head.line).text.slice(0, range$$1.head.ch)))\n                { indented = indentLine(cm, range$$1.head.line, "smart"); }\n            }\n            if (indented) { signalLater(cm, "electricInput", cm, range$$1.head.line); }\n        }\n    }\n\n    function copyableRanges(cm) {\n        var text = [], ranges = [];\n        for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\n            var line = cm.doc.sel.ranges[i].head.line;\n            var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\n            ranges.push(lineRange);\n            text.push(cm.getRange(lineRange.anchor, lineRange.head));\n        }\n        return {text: text, ranges: ranges}\n    }\n\n    function disableBrowserMagic(field, spellcheck) {\n        field.setAttribute("autocorrect", "off");\n        field.setAttribute("autocapitalize", "off");\n        field.setAttribute("spellcheck", !!spellcheck);\n    }\n\n    function hiddenTextarea() {\n        var te = elt("textarea", null, null, "position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");\n        var div = elt("div", [te], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");\n        // The textarea is kept positioned near the cursor to prevent the\n        // fact that it\'ll be scrolled into view on input from scrolling\n        // our fake cursor out of view. On webkit, when wrap=off, paste is\n        // very slow. So make the area wide instead.\n        if (webkit) { te.style.width = "1000px"; }\n        else { te.setAttribute("wrap", "off"); }\n        // If border: 0; -- iOS fails to open keyboard (issue #1287)\n        if (ios) { te.style.border = "1px solid black"; }\n        disableBrowserMagic(te);\n        return div\n    }\n\n    // The publicly visible API. Note that methodOp(f) means\n    // \'wrap f in an operation, performed on its `this` parameter\'.\n\n    // This is not the complete set of editor methods. Most of the\n    // methods defined on the Doc type are also injected into\n    // CodeMirror.prototype, for backwards compatibility and\n    // convenience.\n\n    function addEditorMethods(CodeMirror) {\n        var optionHandlers = CodeMirror.optionHandlers;\n\n        var helpers = CodeMirror.helpers = {};\n\n        CodeMirror.prototype = {\n            constructor: CodeMirror,\n            focus: function(){window.focus(); this.display.input.focus();},\n\n            setOption: function(option, value) {\n                var options = this.options, old = options[option];\n                if (options[option] == value && option != "mode") { return }\n                options[option] = value;\n                if (optionHandlers.hasOwnProperty(option))\n                { operation(this, optionHandlers[option])(this, value, old); }\n                signal(this, "optionChange", this, option);\n            },\n\n            getOption: function(option) {return this.options[option]},\n            getDoc: function() {return this.doc},\n\n            addKeyMap: function(map$$1, bottom) {\n                this.state.keyMaps[bottom ? "push" : "unshift"](getKeyMap(map$$1));\n            },\n            removeKeyMap: function(map$$1) {\n                var maps = this.state.keyMaps;\n                for (var i = 0; i < maps.length; ++i)\n                { if (maps[i] == map$$1 || maps[i].name == map$$1) {\n                    maps.splice(i, 1);\n                    return true\n                } }\n            },\n\n            addOverlay: methodOp(function(spec, options) {\n                var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\n                if (mode.startState) { throw new Error("Overlays may not be stateful.") }\n                insertSorted(this.state.overlays,\n                    {mode: mode, modeSpec: spec, opaque: options && options.opaque,\n                        priority: (options && options.priority) || 0},\n                    function (overlay) { return overlay.priority; });\n                this.state.modeGen++;\n                regChange(this);\n            }),\n            removeOverlay: methodOp(function(spec) {\n                var overlays = this.state.overlays;\n                for (var i = 0; i < overlays.length; ++i) {\n                    var cur = overlays[i].modeSpec;\n                    if (cur == spec || typeof spec == "string" && cur.name == spec) {\n                        overlays.splice(i, 1);\n                        this.state.modeGen++;\n                        regChange(this);\n                        return\n                    }\n                }\n            }),\n\n            indentLine: methodOp(function(n, dir, aggressive) {\n                if (typeof dir != "string" && typeof dir != "number") {\n                    if (dir == null) { dir = this.options.smartIndent ? "smart" : "prev"; }\n                    else { dir = dir ? "add" : "subtract"; }\n                }\n                if (isLine(this.doc, n)) { indentLine(this, n, dir, aggressive); }\n            }),\n            indentSelection: methodOp(function(how) {\n                var ranges = this.doc.sel.ranges, end = -1;\n                for (var i = 0; i < ranges.length; i++) {\n                    var range$$1 = ranges[i];\n                    if (!range$$1.empty()) {\n                        var from = range$$1.from(), to = range$$1.to();\n                        var start = Math.max(end, from.line);\n                        end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\n                        for (var j = start; j < end; ++j)\n                        { indentLine(this, j, how); }\n                        var newRanges = this.doc.sel.ranges;\n                        if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\n                        { replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll); }\n                    } else if (range$$1.head.line > end) {\n                        indentLine(this, range$$1.head.line, how, true);\n                        end = range$$1.head.line;\n                        if (i == this.doc.sel.primIndex) { ensureCursorVisible(this); }\n                    }\n                }\n            }),\n\n            // Fetch the parser token for a given character. Useful for hacks\n            // that want to inspect the mode state (say, for completion).\n            getTokenAt: function(pos, precise) {\n                return takeToken(this, pos, precise)\n            },\n\n            getLineTokens: function(line, precise) {\n                return takeToken(this, Pos(line), precise, true)\n            },\n\n            getTokenTypeAt: function(pos) {\n                pos = clipPos(this.doc, pos);\n                var styles = getLineStyles(this, getLine(this.doc, pos.line));\n                var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\n                var type;\n                if (ch == 0) { type = styles[2]; }\n                else { for (;;) {\n                    var mid = (before + after) >> 1;\n                    if ((mid ? styles[mid * 2 - 1] : 0) >= ch) { after = mid; }\n                    else if (styles[mid * 2 + 1] < ch) { before = mid + 1; }\n                    else { type = styles[mid * 2 + 2]; break }\n                } }\n                var cut = type ? type.indexOf("overlay ") : -1;\n                return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1)\n            },\n\n            getModeAt: function(pos) {\n                var mode = this.doc.mode;\n                if (!mode.innerMode) { return mode }\n                return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode\n            },\n\n            getHelper: function(pos, type) {\n                return this.getHelpers(pos, type)[0]\n            },\n\n            getHelpers: function(pos, type) {\n                var found = [];\n                if (!helpers.hasOwnProperty(type)) { return found }\n                var help = helpers[type], mode = this.getModeAt(pos);\n                if (typeof mode[type] == "string") {\n                    if (help[mode[type]]) { found.push(help[mode[type]]); }\n                } else if (mode[type]) {\n                    for (var i = 0; i < mode[type].length; i++) {\n                        var val = help[mode[type][i]];\n                        if (val) { found.push(val); }\n                    }\n                } else if (mode.helperType && help[mode.helperType]) {\n                    found.push(help[mode.helperType]);\n                } else if (help[mode.name]) {\n                    found.push(help[mode.name]);\n                }\n                for (var i$1 = 0; i$1 < help._global.length; i$1++) {\n                    var cur = help._global[i$1];\n                    if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)\n                    { found.push(cur.val); }\n                }\n                return found\n            },\n\n            getStateAfter: function(line, precise) {\n                var doc = this.doc;\n                line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\n                return getContextBefore(this, line + 1, precise).state\n            },\n\n            cursorCoords: function(start, mode) {\n                var pos, range$$1 = this.doc.sel.primary();\n                if (start == null) { pos = range$$1.head; }\n                else if (typeof start == "object") { pos = clipPos(this.doc, start); }\n                else { pos = start ? range$$1.from() : range$$1.to(); }\n                return cursorCoords(this, pos, mode || "page")\n            },\n\n            charCoords: function(pos, mode) {\n                return charCoords(this, clipPos(this.doc, pos), mode || "page")\n            },\n\n            coordsChar: function(coords, mode) {\n                coords = fromCoordSystem(this, coords, mode || "page");\n                return coordsChar(this, coords.left, coords.top)\n            },\n\n            lineAtHeight: function(height, mode) {\n                height = fromCoordSystem(this, {top: height, left: 0}, mode || "page").top;\n                return lineAtHeight(this.doc, height + this.display.viewOffset)\n            },\n            heightAtLine: function(line, mode, includeWidgets) {\n                var end = false, lineObj;\n                if (typeof line == "number") {\n                    var last = this.doc.first + this.doc.size - 1;\n                    if (line < this.doc.first) { line = this.doc.first; }\n                    else if (line > last) { line = last; end = true; }\n                    lineObj = getLine(this.doc, line);\n                } else {\n                    lineObj = line;\n                }\n                return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || "page", includeWidgets || end).top +\n                    (end ? this.doc.height - heightAtLine(lineObj) : 0)\n            },\n\n            defaultTextHeight: function() { return textHeight(this.display) },\n            defaultCharWidth: function() { return charWidth(this.display) },\n\n            getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo}},\n\n            addWidget: function(pos, node, scroll, vert, horiz) {\n                var display = this.display;\n                pos = cursorCoords(this, clipPos(this.doc, pos));\n                var top = pos.bottom, left = pos.left;\n                node.style.position = "absolute";\n                node.setAttribute("cm-ignore-events", "true");\n                this.display.input.setUneditable(node);\n                display.sizer.appendChild(node);\n                if (vert == "over") {\n                    top = pos.top;\n                } else if (vert == "above" || vert == "near") {\n                    var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\n                        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\n                    // Default to positioning above (if specified and possible); otherwise default to positioning below\n                    if ((vert == \'above\' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\n                    { top = pos.top - node.offsetHeight; }\n                    else if (pos.bottom + node.offsetHeight <= vspace)\n                    { top = pos.bottom; }\n                    if (left + node.offsetWidth > hspace)\n                    { left = hspace - node.offsetWidth; }\n                }\n                node.style.top = top + "px";\n                node.style.left = node.style.right = "";\n                if (horiz == "right") {\n                    left = display.sizer.clientWidth - node.offsetWidth;\n                    node.style.right = "0px";\n                } else {\n                    if (horiz == "left") { left = 0; }\n                    else if (horiz == "middle") { left = (display.sizer.clientWidth - node.offsetWidth) / 2; }\n                    node.style.left = left + "px";\n                }\n                if (scroll)\n                { scrollIntoView(this, {left: left, top: top, right: left + node.offsetWidth, bottom: top + node.offsetHeight}); }\n            },\n\n            triggerOnKeyDown: methodOp(onKeyDown),\n            triggerOnKeyPress: methodOp(onKeyPress),\n            triggerOnKeyUp: onKeyUp,\n            triggerOnMouseDown: methodOp(onMouseDown),\n\n            execCommand: function(cmd) {\n                if (commands.hasOwnProperty(cmd))\n                { return commands[cmd].call(null, this) }\n            },\n\n            triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),\n\n            findPosH: function(from, amount, unit, visually) {\n                var dir = 1;\n                if (amount < 0) { dir = -1; amount = -amount; }\n                var cur = clipPos(this.doc, from);\n                for (var i = 0; i < amount; ++i) {\n                    cur = findPosH(this.doc, cur, dir, unit, visually);\n                    if (cur.hitSide) { break }\n                }\n                return cur\n            },\n\n            moveH: methodOp(function(dir, unit) {\n                var this$1 = this;\n\n                this.extendSelectionsBy(function (range$$1) {\n                    if (this$1.display.shift || this$1.doc.extend || range$$1.empty())\n                    { return findPosH(this$1.doc, range$$1.head, dir, unit, this$1.options.rtlMoveVisually) }\n                    else\n                    { return dir < 0 ? range$$1.from() : range$$1.to() }\n                }, sel_move);\n            }),\n\n            deleteH: methodOp(function(dir, unit) {\n                var sel = this.doc.sel, doc = this.doc;\n                if (sel.somethingSelected())\n                { doc.replaceSelection("", null, "+delete"); }\n                else\n                { deleteNearSelection(this, function (range$$1) {\n                    var other = findPosH(doc, range$$1.head, dir, unit, false);\n                    return dir < 0 ? {from: other, to: range$$1.head} : {from: range$$1.head, to: other}\n                }); }\n            }),\n\n            findPosV: function(from, amount, unit, goalColumn) {\n                var dir = 1, x = goalColumn;\n                if (amount < 0) { dir = -1; amount = -amount; }\n                var cur = clipPos(this.doc, from);\n                for (var i = 0; i < amount; ++i) {\n                    var coords = cursorCoords(this, cur, "div");\n                    if (x == null) { x = coords.left; }\n                    else { coords.left = x; }\n                    cur = findPosV(this, coords, dir, unit);\n                    if (cur.hitSide) { break }\n                }\n                return cur\n            },\n\n            moveV: methodOp(function(dir, unit) {\n                var this$1 = this;\n\n                var doc = this.doc, goals = [];\n                var collapse = !this.display.shift && !doc.extend && doc.sel.somethingSelected();\n                doc.extendSelectionsBy(function (range$$1) {\n                    if (collapse)\n                    { return dir < 0 ? range$$1.from() : range$$1.to() }\n                    var headPos = cursorCoords(this$1, range$$1.head, "div");\n                    if (range$$1.goalColumn != null) { headPos.left = range$$1.goalColumn; }\n                    goals.push(headPos.left);\n                    var pos = findPosV(this$1, headPos, dir, unit);\n                    if (unit == "page" && range$$1 == doc.sel.primary())\n                    { addToScrollTop(this$1, charCoords(this$1, pos, "div").top - headPos.top); }\n                    return pos\n                }, sel_move);\n                if (goals.length) { for (var i = 0; i < doc.sel.ranges.length; i++)\n                { doc.sel.ranges[i].goalColumn = goals[i]; } }\n            }),\n\n            // Find the word at the given position (as returned by coordsChar).\n            findWordAt: function(pos) {\n                var doc = this.doc, line = getLine(doc, pos.line).text;\n                var start = pos.ch, end = pos.ch;\n                if (line) {\n                    var helper = this.getHelper(pos, "wordChars");\n                    if ((pos.sticky == "before" || end == line.length) && start) { --start; } else { ++end; }\n                    var startChar = line.charAt(start);\n                    var check = isWordChar(startChar, helper)\n                        ? function (ch) { return isWordChar(ch, helper); }\n                        : /\\s/.test(startChar) ? function (ch) { return /\\s/.test(ch); }\n                            : function (ch) { return (!/\\s/.test(ch) && !isWordChar(ch)); };\n                    while (start > 0 && check(line.charAt(start - 1))) { --start; }\n                    while (end < line.length && check(line.charAt(end))) { ++end; }\n                }\n                return new Range(Pos(pos.line, start), Pos(pos.line, end))\n            },\n\n            toggleOverwrite: function(value) {\n                if (value != null && value == this.state.overwrite) { return }\n                if (this.state.overwrite = !this.state.overwrite)\n                { addClass(this.display.cursorDiv, "CodeMirror-overwrite"); }\n                else\n                { rmClass(this.display.cursorDiv, "CodeMirror-overwrite"); }\n\n                signal(this, "overwriteToggle", this, this.state.overwrite);\n            },\n            hasFocus: function() { return this.display.input.getField() == activeElt() },\n            isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit) },\n\n            scrollTo: methodOp(function (x, y) { scrollToCoords(this, x, y); }),\n            getScrollInfo: function() {\n                var scroller = this.display.scroller;\n                return {left: scroller.scrollLeft, top: scroller.scrollTop,\n                    height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,\n                    width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,\n                    clientHeight: displayHeight(this), clientWidth: displayWidth(this)}\n            },\n\n            scrollIntoView: methodOp(function(range$$1, margin) {\n                if (range$$1 == null) {\n                    range$$1 = {from: this.doc.sel.primary().head, to: null};\n                    if (margin == null) { margin = this.options.cursorScrollMargin; }\n                } else if (typeof range$$1 == "number") {\n                    range$$1 = {from: Pos(range$$1, 0), to: null};\n                } else if (range$$1.from == null) {\n                    range$$1 = {from: range$$1, to: null};\n                }\n                if (!range$$1.to) { range$$1.to = range$$1.from; }\n                range$$1.margin = margin || 0;\n\n                if (range$$1.from.line != null) {\n                    scrollToRange(this, range$$1);\n                } else {\n                    scrollToCoordsRange(this, range$$1.from, range$$1.to, range$$1.margin);\n                }\n            }),\n\n            setSize: methodOp(function(width, height) {\n                var this$1 = this;\n\n                var interpret = function (val) { return typeof val == "number" || /^\\d+$/.test(String(val)) ? val + "px" : val; };\n                if (width != null) { this.display.wrapper.style.width = interpret(width); }\n                if (height != null) { this.display.wrapper.style.height = interpret(height); }\n                if (this.options.lineWrapping) { clearLineMeasurementCache(this); }\n                var lineNo$$1 = this.display.viewFrom;\n                this.doc.iter(lineNo$$1, this.display.viewTo, function (line) {\n                    if (line.widgets) { for (var i = 0; i < line.widgets.length; i++)\n                    { if (line.widgets[i].noHScroll) { regLineChange(this$1, lineNo$$1, "widget"); break } } }\n                    ++lineNo$$1;\n                });\n                this.curOp.forceUpdate = true;\n                signal(this, "refresh", this);\n            }),\n\n            operation: function(f){return runInOp(this, f)},\n            startOperation: function(){return startOperation(this)},\n            endOperation: function(){return endOperation(this)},\n\n            refresh: methodOp(function() {\n                var oldHeight = this.display.cachedTextHeight;\n                regChange(this);\n                this.curOp.forceUpdate = true;\n                clearCaches(this);\n                scrollToCoords(this, this.doc.scrollLeft, this.doc.scrollTop);\n                updateGutterSpace(this);\n                if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\n                { estimateLineHeights(this); }\n                signal(this, "refresh", this);\n            }),\n\n            swapDoc: methodOp(function(doc) {\n                var old = this.doc;\n                old.cm = null;\n                attachDoc(this, doc);\n                clearCaches(this);\n                this.display.input.reset();\n                scrollToCoords(this, doc.scrollLeft, doc.scrollTop);\n                this.curOp.forceScroll = true;\n                signalLater(this, "swapDoc", this, old);\n                return old\n            }),\n\n            phrase: function(phraseText) {\n                var phrases = this.options.phrases;\n                return phrases && Object.prototype.hasOwnProperty.call(phrases, phraseText) ? phrases[phraseText] : phraseText\n            },\n\n            getInputField: function(){return this.display.input.getField()},\n            getWrapperElement: function(){return this.display.wrapper},\n            getScrollerElement: function(){return this.display.scroller},\n            getGutterElement: function(){return this.display.gutters}\n        };\n        eventMixin(CodeMirror);\n\n        CodeMirror.registerHelper = function(type, name, value) {\n            if (!helpers.hasOwnProperty(type)) { helpers[type] = CodeMirror[type] = {_global: []}; }\n            helpers[type][name] = value;\n        };\n        CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\n            CodeMirror.registerHelper(type, name, value);\n            helpers[type]._global.push({pred: predicate, val: value});\n        };\n    }\n\n    // Used for horizontal relative motion. Dir is -1 or 1 (left or\n    // right), unit can be "char", "column" (like char, but doesn\'t\n    // cross line boundaries), "word" (across next word), or "group" (to\n    // the start of next group of word or non-word-non-whitespace\n    // chars). The visually param controls whether, in right-to-left\n    // text, direction 1 means to move towards the next index in the\n    // string, or towards the character to the right of the current\n    // position. The resulting position will have a hitSide=true\n    // property if it reached the end of the document.\n    function findPosH(doc, pos, dir, unit, visually) {\n        var oldPos = pos;\n        var origDir = dir;\n        var lineObj = getLine(doc, pos.line);\n        function findNextLine() {\n            var l = pos.line + dir;\n            if (l < doc.first || l >= doc.first + doc.size) { return false }\n            pos = new Pos(l, pos.ch, pos.sticky);\n            return lineObj = getLine(doc, l)\n        }\n        function moveOnce(boundToLine) {\n            var next;\n            if (visually) {\n                next = moveVisually(doc.cm, lineObj, pos, dir);\n            } else {\n                next = moveLogically(lineObj, pos, dir);\n            }\n            if (next == null) {\n                if (!boundToLine && findNextLine())\n                { pos = endOfLine(visually, doc.cm, lineObj, pos.line, dir); }\n                else\n                { return false }\n            } else {\n                pos = next;\n            }\n            return true\n        }\n\n        if (unit == "char") {\n            moveOnce();\n        } else if (unit == "column") {\n            moveOnce(true);\n        } else if (unit == "word" || unit == "group") {\n            var sawType = null, group = unit == "group";\n            var helper = doc.cm && doc.cm.getHelper(pos, "wordChars");\n            for (var first = true;; first = false) {\n                if (dir < 0 && !moveOnce(!first)) { break }\n                var cur = lineObj.text.charAt(pos.ch) || "\\n";\n                var type = isWordChar(cur, helper) ? "w"\n                    : group && cur == "\\n" ? "n"\n                        : !group || /\\s/.test(cur) ? null\n                            : "p";\n                if (group && !first && !type) { type = "s"; }\n                if (sawType && sawType != type) {\n                    if (dir < 0) {dir = 1; moveOnce(); pos.sticky = "after";}\n                    break\n                }\n\n                if (type) { sawType = type; }\n                if (dir > 0 && !moveOnce(!first)) { break }\n            }\n        }\n        var result = skipAtomic(doc, pos, oldPos, origDir, true);\n        if (equalCursorPos(oldPos, result)) { result.hitSide = true; }\n        return result\n    }\n\n    // For relative vertical movement. Dir may be -1 or 1. Unit can be\n    // "page" or "line". The resulting position will have a hitSide=true\n    // property if it reached the end of the document.\n    function findPosV(cm, pos, dir, unit) {\n        var doc = cm.doc, x = pos.left, y;\n        if (unit == "page") {\n            var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\n            var moveAmount = Math.max(pageSize - .5 * textHeight(cm.display), 3);\n            y = (dir > 0 ? pos.bottom : pos.top) + dir * moveAmount;\n\n        } else if (unit == "line") {\n            y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\n        }\n        var target;\n        for (;;) {\n            target = coordsChar(cm, x, y);\n            if (!target.outside) { break }\n            if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break }\n            y += dir * 5;\n        }\n        return target\n    }\n\n    // CONTENTEDITABLE INPUT STYLE\n\n    var ContentEditableInput = function(cm) {\n        this.cm = cm;\n        this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;\n        this.polling = new Delayed();\n        this.composing = null;\n        this.gracePeriod = false;\n        this.readDOMTimeout = null;\n    };\n\n    ContentEditableInput.prototype.init = function (display) {\n        var this$1 = this;\n\n        var input = this, cm = input.cm;\n        var div = input.div = display.lineDiv;\n        disableBrowserMagic(div, cm.options.spellcheck);\n\n        on(div, "paste", function (e) {\n            if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }\n            // IE doesn\'t fire input events, so we schedule a read for the pasted content in this way\n            if (ie_version <= 11) { setTimeout(operation(cm, function () { return this$1.updateFromDOM(); }), 20); }\n        });\n\n        on(div, "compositionstart", function (e) {\n            this$1.composing = {data: e.data, done: false};\n        });\n        on(div, "compositionupdate", function (e) {\n            if (!this$1.composing) { this$1.composing = {data: e.data, done: false}; }\n        });\n        on(div, "compositionend", function (e) {\n            if (this$1.composing) {\n                if (e.data != this$1.composing.data) { this$1.readFromDOMSoon(); }\n                this$1.composing.done = true;\n            }\n        });\n\n        on(div, "touchstart", function () { return input.forceCompositionEnd(); });\n\n        on(div, "input", function () {\n            if (!this$1.composing) { this$1.readFromDOMSoon(); }\n        });\n\n        function onCopyCut(e) {\n            if (signalDOMEvent(cm, e)) { return }\n            if (cm.somethingSelected()) {\n                setLastCopied({lineWise: false, text: cm.getSelections()});\n                if (e.type == "cut") { cm.replaceSelection("", null, "cut"); }\n            } else if (!cm.options.lineWiseCopyCut) {\n                return\n            } else {\n                var ranges = copyableRanges(cm);\n                setLastCopied({lineWise: true, text: ranges.text});\n                if (e.type == "cut") {\n                    cm.operation(function () {\n                        cm.setSelections(ranges.ranges, 0, sel_dontScroll);\n                        cm.replaceSelection("", null, "cut");\n                    });\n                }\n            }\n            if (e.clipboardData) {\n                e.clipboardData.clearData();\n                var content = lastCopied.text.join("\\n");\n                // iOS exposes the clipboard API, but seems to discard content inserted into it\n                e.clipboardData.setData("Text", content);\n                if (e.clipboardData.getData("Text") == content) {\n                    e.preventDefault();\n                    return\n                }\n            }\n            // Old-fashioned briefly-focus-a-textarea hack\n            var kludge = hiddenTextarea(), te = kludge.firstChild;\n            cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);\n            te.value = lastCopied.text.join("\\n");\n            var hadFocus = document.activeElement;\n            selectInput(te);\n            setTimeout(function () {\n                cm.display.lineSpace.removeChild(kludge);\n                hadFocus.focus();\n                if (hadFocus == div) { input.showPrimarySelection(); }\n            }, 50);\n        }\n        on(div, "copy", onCopyCut);\n        on(div, "cut", onCopyCut);\n    };\n\n    ContentEditableInput.prototype.prepareSelection = function () {\n        var result = prepareSelection(this.cm, false);\n        result.focus = this.cm.state.focused;\n        return result\n    };\n\n    ContentEditableInput.prototype.showSelection = function (info, takeFocus) {\n        if (!info || !this.cm.display.view.length) { return }\n        if (info.focus || takeFocus) { this.showPrimarySelection(); }\n        this.showMultipleSelections(info);\n    };\n\n    ContentEditableInput.prototype.getSelection = function () {\n        return this.cm.display.wrapper.ownerDocument.getSelection()\n    };\n\n    ContentEditableInput.prototype.showPrimarySelection = function () {\n        var sel = this.getSelection(), cm = this.cm, prim = cm.doc.sel.primary();\n        var from = prim.from(), to = prim.to();\n\n        if (cm.display.viewTo == cm.display.viewFrom || from.line >= cm.display.viewTo || to.line < cm.display.viewFrom) {\n            sel.removeAllRanges();\n            return\n        }\n\n        var curAnchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\n        var curFocus = domToPos(cm, sel.focusNode, sel.focusOffset);\n        if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&\n            cmp(minPos(curAnchor, curFocus), from) == 0 &&\n            cmp(maxPos(curAnchor, curFocus), to) == 0)\n        { return }\n\n        var view = cm.display.view;\n        var start = (from.line >= cm.display.viewFrom && posToDOM(cm, from)) ||\n            {node: view[0].measure.map[2], offset: 0};\n        var end = to.line < cm.display.viewTo && posToDOM(cm, to);\n        if (!end) {\n            var measure = view[view.length - 1].measure;\n            var map$$1 = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;\n            end = {node: map$$1[map$$1.length - 1], offset: map$$1[map$$1.length - 2] - map$$1[map$$1.length - 3]};\n        }\n\n        if (!start || !end) {\n            sel.removeAllRanges();\n            return\n        }\n\n        var old = sel.rangeCount && sel.getRangeAt(0), rng;\n        try { rng = range(start.node, start.offset, end.offset, end.node); }\n        catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible\n        if (rng) {\n            if (!gecko && cm.state.focused) {\n                sel.collapse(start.node, start.offset);\n                if (!rng.collapsed) {\n                    sel.removeAllRanges();\n                    sel.addRange(rng);\n                }\n            } else {\n                sel.removeAllRanges();\n                sel.addRange(rng);\n            }\n            if (old && sel.anchorNode == null) { sel.addRange(old); }\n            else if (gecko) { this.startGracePeriod(); }\n        }\n        this.rememberSelection();\n    };\n\n    ContentEditableInput.prototype.startGracePeriod = function () {\n        var this$1 = this;\n\n        clearTimeout(this.gracePeriod);\n        this.gracePeriod = setTimeout(function () {\n            this$1.gracePeriod = false;\n            if (this$1.selectionChanged())\n            { this$1.cm.operation(function () { return this$1.cm.curOp.selectionChanged = true; }); }\n        }, 20);\n    };\n\n    ContentEditableInput.prototype.showMultipleSelections = function (info) {\n        removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);\n        removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);\n    };\n\n    ContentEditableInput.prototype.rememberSelection = function () {\n        var sel = this.getSelection();\n        this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;\n        this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;\n    };\n\n    ContentEditableInput.prototype.selectionInEditor = function () {\n        var sel = this.getSelection();\n        if (!sel.rangeCount) { return false }\n        var node = sel.getRangeAt(0).commonAncestorContainer;\n        return contains(this.div, node)\n    };\n\n    ContentEditableInput.prototype.focus = function () {\n        if (this.cm.options.readOnly != "nocursor") {\n            if (!this.selectionInEditor())\n            { this.showSelection(this.prepareSelection(), true); }\n            this.div.focus();\n        }\n    };\n    ContentEditableInput.prototype.blur = function () { this.div.blur(); };\n    ContentEditableInput.prototype.getField = function () { return this.div };\n\n    ContentEditableInput.prototype.supportsTouch = function () { return true };\n\n    ContentEditableInput.prototype.receivedFocus = function () {\n        var input = this;\n        if (this.selectionInEditor())\n        { this.pollSelection(); }\n        else\n        { runInOp(this.cm, function () { return input.cm.curOp.selectionChanged = true; }); }\n\n        function poll() {\n            if (input.cm.state.focused) {\n                input.pollSelection();\n                input.polling.set(input.cm.options.pollInterval, poll);\n            }\n        }\n        this.polling.set(this.cm.options.pollInterval, poll);\n    };\n\n    ContentEditableInput.prototype.selectionChanged = function () {\n        var sel = this.getSelection();\n        return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||\n            sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset\n    };\n\n    ContentEditableInput.prototype.pollSelection = function () {\n        if (this.readDOMTimeout != null || this.gracePeriod || !this.selectionChanged()) { return }\n        var sel = this.getSelection(), cm = this.cm;\n        // On Android Chrome (version 56, at least), backspacing into an\n        // uneditable block element will put the cursor in that element,\n        // and then, because it\'s not editable, hide the virtual keyboard.\n        // Because Android doesn\'t allow us to actually detect backspace\n        // presses in a sane way, this code checks for when that happens\n        // and simulates a backspace press in this case.\n        if (android && chrome && this.cm.options.gutters.length && isInGutter(sel.anchorNode)) {\n            this.cm.triggerOnKeyDown({type: "keydown", keyCode: 8, preventDefault: Math.abs});\n            this.blur();\n            this.focus();\n            return\n        }\n        if (this.composing) { return }\n        this.rememberSelection();\n        var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\n        var head = domToPos(cm, sel.focusNode, sel.focusOffset);\n        if (anchor && head) { runInOp(cm, function () {\n            setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);\n            if (anchor.bad || head.bad) { cm.curOp.selectionChanged = true; }\n        }); }\n    };\n\n    ContentEditableInput.prototype.pollContent = function () {\n        if (this.readDOMTimeout != null) {\n            clearTimeout(this.readDOMTimeout);\n            this.readDOMTimeout = null;\n        }\n\n        var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();\n        var from = sel.from(), to = sel.to();\n        if (from.ch == 0 && from.line > cm.firstLine())\n        { from = Pos(from.line - 1, getLine(cm.doc, from.line - 1).length); }\n        if (to.ch == getLine(cm.doc, to.line).text.length && to.line < cm.lastLine())\n        { to = Pos(to.line + 1, 0); }\n        if (from.line < display.viewFrom || to.line > display.viewTo - 1) { return false }\n\n        var fromIndex, fromLine, fromNode;\n        if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {\n            fromLine = lineNo(display.view[0].line);\n            fromNode = display.view[0].node;\n        } else {\n            fromLine = lineNo(display.view[fromIndex].line);\n            fromNode = display.view[fromIndex - 1].node.nextSibling;\n        }\n        var toIndex = findViewIndex(cm, to.line);\n        var toLine, toNode;\n        if (toIndex == display.view.length - 1) {\n            toLine = display.viewTo - 1;\n            toNode = display.lineDiv.lastChild;\n        } else {\n            toLine = lineNo(display.view[toIndex + 1].line) - 1;\n            toNode = display.view[toIndex + 1].node.previousSibling;\n        }\n\n        if (!fromNode) { return false }\n        var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));\n        var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));\n        while (newText.length > 1 && oldText.length > 1) {\n            if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }\n            else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }\n            else { break }\n        }\n\n        var cutFront = 0, cutEnd = 0;\n        var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);\n        while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))\n        { ++cutFront; }\n        var newBot = lst(newText), oldBot = lst(oldText);\n        var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),\n            oldBot.length - (oldText.length == 1 ? cutFront : 0));\n        while (cutEnd < maxCutEnd &&\n        newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))\n        { ++cutEnd; }\n        // Try to move start of change to start of selection if ambiguous\n        if (newText.length == 1 && oldText.length == 1 && fromLine == from.line) {\n            while (cutFront && cutFront > from.ch &&\n            newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1)) {\n                cutFront--;\n                cutEnd++;\n            }\n        }\n\n        newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd).replace(/^\\u200b+/, "");\n        newText[0] = newText[0].slice(cutFront).replace(/\\u200b+$/, "");\n\n        var chFrom = Pos(fromLine, cutFront);\n        var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);\n        if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {\n            replaceRange(cm.doc, newText, chFrom, chTo, "+input");\n            return true\n        }\n    };\n\n    ContentEditableInput.prototype.ensurePolled = function () {\n        this.forceCompositionEnd();\n    };\n    ContentEditableInput.prototype.reset = function () {\n        this.forceCompositionEnd();\n    };\n    ContentEditableInput.prototype.forceCompositionEnd = function () {\n        if (!this.composing) { return }\n        clearTimeout(this.readDOMTimeout);\n        this.composing = null;\n        this.updateFromDOM();\n        this.div.blur();\n        this.div.focus();\n    };\n    ContentEditableInput.prototype.readFromDOMSoon = function () {\n        var this$1 = this;\n\n        if (this.readDOMTimeout != null) { return }\n        this.readDOMTimeout = setTimeout(function () {\n            this$1.readDOMTimeout = null;\n            if (this$1.composing) {\n                if (this$1.composing.done) { this$1.composing = null; }\n                else { return }\n            }\n            this$1.updateFromDOM();\n        }, 80);\n    };\n\n    ContentEditableInput.prototype.updateFromDOM = function () {\n        var this$1 = this;\n\n        if (this.cm.isReadOnly() || !this.pollContent())\n        { runInOp(this.cm, function () { return regChange(this$1.cm); }); }\n    };\n\n    ContentEditableInput.prototype.setUneditable = function (node) {\n        node.contentEditable = "false";\n    };\n\n    ContentEditableInput.prototype.onKeyPress = function (e) {\n        if (e.charCode == 0 || this.composing) { return }\n        e.preventDefault();\n        if (!this.cm.isReadOnly())\n        { operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0); }\n    };\n\n    ContentEditableInput.prototype.readOnlyChanged = function (val) {\n        this.div.contentEditable = String(val != "nocursor");\n    };\n\n    ContentEditableInput.prototype.onContextMenu = function () {};\n    ContentEditableInput.prototype.resetPosition = function () {};\n\n    ContentEditableInput.prototype.needsContentAttribute = true;\n\n    function posToDOM(cm, pos) {\n        var view = findViewForLine(cm, pos.line);\n        if (!view || view.hidden) { return null }\n        var line = getLine(cm.doc, pos.line);\n        var info = mapFromLineView(view, line, pos.line);\n\n        var order = getOrder(line, cm.doc.direction), side = "left";\n        if (order) {\n            var partPos = getBidiPartAt(order, pos.ch);\n            side = partPos % 2 ? "right" : "left";\n        }\n        var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);\n        result.offset = result.collapse == "right" ? result.end : result.start;\n        return result\n    }\n\n    function isInGutter(node) {\n        for (var scan = node; scan; scan = scan.parentNode)\n        { if (/CodeMirror-gutter-wrapper/.test(scan.className)) { return true } }\n        return false\n    }\n\n    function badPos(pos, bad) { if (bad) { pos.bad = true; } return pos }\n\n    function domTextBetween(cm, from, to, fromLine, toLine) {\n        var text = "", closing = false, lineSep = cm.doc.lineSeparator(), extraLinebreak = false;\n        function recognizeMarker(id) { return function (marker) { return marker.id == id; } }\n        function close() {\n            if (closing) {\n                text += lineSep;\n                if (extraLinebreak) { text += lineSep; }\n                closing = extraLinebreak = false;\n            }\n        }\n        function addText(str) {\n            if (str) {\n                close();\n                text += str;\n            }\n        }\n        function walk(node) {\n            if (node.nodeType == 1) {\n                var cmText = node.getAttribute("cm-text");\n                if (cmText) {\n                    addText(cmText);\n                    return\n                }\n                var markerID = node.getAttribute("cm-marker"), range$$1;\n                if (markerID) {\n                    var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));\n                    if (found.length && (range$$1 = found[0].find(0)))\n                    { addText(getBetween(cm.doc, range$$1.from, range$$1.to).join(lineSep)); }\n                    return\n                }\n                if (node.getAttribute("contenteditable") == "false") { return }\n                var isBlock = /^(pre|div|p|li|table|br)$/i.test(node.nodeName);\n                if (!/^br$/i.test(node.nodeName) && node.textContent.length == 0) { return }\n\n                if (isBlock) { close(); }\n                for (var i = 0; i < node.childNodes.length; i++)\n                { walk(node.childNodes[i]); }\n\n                if (/^(pre|p)$/i.test(node.nodeName)) { extraLinebreak = true; }\n                if (isBlock) { closing = true; }\n            } else if (node.nodeType == 3) {\n                addText(node.nodeValue.replace(/\\u200b/g, "").replace(/\\u00a0/g, " "));\n            }\n        }\n        for (;;) {\n            walk(from);\n            if (from == to) { break }\n            from = from.nextSibling;\n            extraLinebreak = false;\n        }\n        return text\n    }\n\n    function domToPos(cm, node, offset) {\n        var lineNode;\n        if (node == cm.display.lineDiv) {\n            lineNode = cm.display.lineDiv.childNodes[offset];\n            if (!lineNode) { return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true) }\n            node = null; offset = 0;\n        } else {\n            for (lineNode = node;; lineNode = lineNode.parentNode) {\n                if (!lineNode || lineNode == cm.display.lineDiv) { return null }\n                if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) { break }\n            }\n        }\n        for (var i = 0; i < cm.display.view.length; i++) {\n            var lineView = cm.display.view[i];\n            if (lineView.node == lineNode)\n            { return locateNodeInLineView(lineView, node, offset) }\n        }\n    }\n\n    function locateNodeInLineView(lineView, node, offset) {\n        var wrapper = lineView.text.firstChild, bad = false;\n        if (!node || !contains(wrapper, node)) { return badPos(Pos(lineNo(lineView.line), 0), true) }\n        if (node == wrapper) {\n            bad = true;\n            node = wrapper.childNodes[offset];\n            offset = 0;\n            if (!node) {\n                var line = lineView.rest ? lst(lineView.rest) : lineView.line;\n                return badPos(Pos(lineNo(line), line.text.length), bad)\n            }\n        }\n\n        var textNode = node.nodeType == 3 ? node : null, topNode = node;\n        if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {\n            textNode = node.firstChild;\n            if (offset) { offset = textNode.nodeValue.length; }\n        }\n        while (topNode.parentNode != wrapper) { topNode = topNode.parentNode; }\n        var measure = lineView.measure, maps = measure.maps;\n\n        function find(textNode, topNode, offset) {\n            for (var i = -1; i < (maps ? maps.length : 0); i++) {\n                var map$$1 = i < 0 ? measure.map : maps[i];\n                for (var j = 0; j < map$$1.length; j += 3) {\n                    var curNode = map$$1[j + 2];\n                    if (curNode == textNode || curNode == topNode) {\n                        var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);\n                        var ch = map$$1[j] + offset;\n                        if (offset < 0 || curNode != textNode) { ch = map$$1[j + (offset ? 1 : 0)]; }\n                        return Pos(line, ch)\n                    }\n                }\n            }\n        }\n        var found = find(textNode, topNode, offset);\n        if (found) { return badPos(found, bad) }\n\n        // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems\n        for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {\n            found = find(after, after.firstChild, 0);\n            if (found)\n            { return badPos(Pos(found.line, found.ch - dist), bad) }\n            else\n            { dist += after.textContent.length; }\n        }\n        for (var before = topNode.previousSibling, dist$1 = offset; before; before = before.previousSibling) {\n            found = find(before, before.firstChild, -1);\n            if (found)\n            { return badPos(Pos(found.line, found.ch + dist$1), bad) }\n            else\n            { dist$1 += before.textContent.length; }\n        }\n    }\n\n    // TEXTAREA INPUT STYLE\n\n    var TextareaInput = function(cm) {\n        this.cm = cm;\n        // See input.poll and input.reset\n        this.prevInput = "";\n\n        // Flag that indicates whether we expect input to appear real soon\n        // now (after some event like \'keypress\' or \'input\') and are\n        // polling intensively.\n        this.pollingFast = false;\n        // Self-resetting timeout for the poller\n        this.polling = new Delayed();\n        // Used to work around IE issue with selection being forgotten when focus moves away from textarea\n        this.hasSelection = false;\n        this.composing = null;\n    };\n\n    TextareaInput.prototype.init = function (display) {\n        var this$1 = this;\n\n        var input = this, cm = this.cm;\n        this.createField(display);\n        var te = this.textarea;\n\n        display.wrapper.insertBefore(this.wrapper, display.wrapper.firstChild);\n\n        // Needed to hide big blue blinking cursor on Mobile Safari (doesn\'t seem to work in iOS 8 anymore)\n        if (ios) { te.style.width = "0px"; }\n\n        on(te, "input", function () {\n            if (ie && ie_version >= 9 && this$1.hasSelection) { this$1.hasSelection = null; }\n            input.poll();\n        });\n\n        on(te, "paste", function (e) {\n            if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }\n\n            cm.state.pasteIncoming = true;\n            input.fastPoll();\n        });\n\n        function prepareCopyCut(e) {\n            if (signalDOMEvent(cm, e)) { return }\n            if (cm.somethingSelected()) {\n                setLastCopied({lineWise: false, text: cm.getSelections()});\n            } else if (!cm.options.lineWiseCopyCut) {\n                return\n            } else {\n                var ranges = copyableRanges(cm);\n                setLastCopied({lineWise: true, text: ranges.text});\n                if (e.type == "cut") {\n                    cm.setSelections(ranges.ranges, null, sel_dontScroll);\n                } else {\n                    input.prevInput = "";\n                    te.value = ranges.text.join("\\n");\n                    selectInput(te);\n                }\n            }\n            if (e.type == "cut") { cm.state.cutIncoming = true; }\n        }\n        on(te, "cut", prepareCopyCut);\n        on(te, "copy", prepareCopyCut);\n\n        on(display.scroller, "paste", function (e) {\n            if (eventInWidget(display, e) || signalDOMEvent(cm, e)) { return }\n            cm.state.pasteIncoming = true;\n            input.focus();\n        });\n\n        // Prevent normal selection in the editor (we handle our own)\n        on(display.lineSpace, "selectstart", function (e) {\n            if (!eventInWidget(display, e)) { e_preventDefault(e); }\n        });\n\n        on(te, "compositionstart", function () {\n            var start = cm.getCursor("from");\n            if (input.composing) { input.composing.range.clear(); }\n            input.composing = {\n                start: start,\n                range: cm.markText(start, cm.getCursor("to"), {className: "CodeMirror-composing"})\n            };\n        });\n        on(te, "compositionend", function () {\n            if (input.composing) {\n                input.poll();\n                input.composing.range.clear();\n                input.composing = null;\n            }\n        });\n    };\n\n    TextareaInput.prototype.createField = function (_display) {\n        // Wraps and hides input textarea\n        this.wrapper = hiddenTextarea();\n        // The semihidden textarea that is focused when the editor is\n        // focused, and receives input.\n        this.textarea = this.wrapper.firstChild;\n    };\n\n    TextareaInput.prototype.prepareSelection = function () {\n        // Redraw the selection and/or cursor\n        var cm = this.cm, display = cm.display, doc = cm.doc;\n        var result = prepareSelection(cm);\n\n        // Move the hidden textarea near the cursor to prevent scrolling artifacts\n        if (cm.options.moveInputWithCursor) {\n            var headPos = cursorCoords(cm, doc.sel.primary().head, "div");\n            var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\n            result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\n                headPos.top + lineOff.top - wrapOff.top));\n            result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\n                headPos.left + lineOff.left - wrapOff.left));\n        }\n\n        return result\n    };\n\n    TextareaInput.prototype.showSelection = function (drawn) {\n        var cm = this.cm, display = cm.display;\n        removeChildrenAndAdd(display.cursorDiv, drawn.cursors);\n        removeChildrenAndAdd(display.selectionDiv, drawn.selection);\n        if (drawn.teTop != null) {\n            this.wrapper.style.top = drawn.teTop + "px";\n            this.wrapper.style.left = drawn.teLeft + "px";\n        }\n    };\n\n    // Reset the input to correspond to the selection (or to be empty,\n    // when not typing and nothing is selected)\n    TextareaInput.prototype.reset = function (typing) {\n        if (this.contextMenuPending || this.composing) { return }\n        var cm = this.cm;\n        if (cm.somethingSelected()) {\n            this.prevInput = "";\n            var content = cm.getSelection();\n            this.textarea.value = content;\n            if (cm.state.focused) { selectInput(this.textarea); }\n            if (ie && ie_version >= 9) { this.hasSelection = content; }\n        } else if (!typing) {\n            this.prevInput = this.textarea.value = "";\n            if (ie && ie_version >= 9) { this.hasSelection = null; }\n        }\n    };\n\n    TextareaInput.prototype.getField = function () { return this.textarea };\n\n    TextareaInput.prototype.supportsTouch = function () { return false };\n\n    TextareaInput.prototype.focus = function () {\n        if (this.cm.options.readOnly != "nocursor" && (!mobile || activeElt() != this.textarea)) {\n            try { this.textarea.focus(); }\n            catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM\n        }\n    };\n\n    TextareaInput.prototype.blur = function () { this.textarea.blur(); };\n\n    TextareaInput.prototype.resetPosition = function () {\n        this.wrapper.style.top = this.wrapper.style.left = 0;\n    };\n\n    TextareaInput.prototype.receivedFocus = function () { this.slowPoll(); };\n\n    // Poll for input changes, using the normal rate of polling. This\n    // runs as long as the editor is focused.\n    TextareaInput.prototype.slowPoll = function () {\n        var this$1 = this;\n\n        if (this.pollingFast) { return }\n        this.polling.set(this.cm.options.pollInterval, function () {\n            this$1.poll();\n            if (this$1.cm.state.focused) { this$1.slowPoll(); }\n        });\n    };\n\n    // When an event has just come in that is likely to add or change\n    // something in the input textarea, we poll faster, to ensure that\n    // the change appears on the screen quickly.\n    TextareaInput.prototype.fastPoll = function () {\n        var missed = false, input = this;\n        input.pollingFast = true;\n        function p() {\n            var changed = input.poll();\n            if (!changed && !missed) {missed = true; input.polling.set(60, p);}\n            else {input.pollingFast = false; input.slowPoll();}\n        }\n        input.polling.set(20, p);\n    };\n\n    // Read input from the textarea, and update the document to match.\n    // When something is selected, it is present in the textarea, and\n    // selected (unless it is huge, in which case a placeholder is\n    // used). When nothing is selected, the cursor sits after previously\n    // seen text (can be empty), which is stored in prevInput (we must\n    // not reset the textarea when typing, because that breaks IME).\n    TextareaInput.prototype.poll = function () {\n        var this$1 = this;\n\n        var cm = this.cm, input = this.textarea, prevInput = this.prevInput;\n        // Since this is called a *lot*, try to bail out as cheaply as\n        // possible when it is clear that nothing happened. hasSelection\n        // will be the case when there is a lot of text in the textarea,\n        // in which case reading its value would be expensive.\n        if (this.contextMenuPending || !cm.state.focused ||\n            (hasSelection(input) && !prevInput && !this.composing) ||\n            cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)\n        { return false }\n\n        var text = input.value;\n        // If nothing changed, bail.\n        if (text == prevInput && !cm.somethingSelected()) { return false }\n        // Work around nonsensical selection resetting in IE9/10, and\n        // inexplicable appearance of private area unicode characters on\n        // some key combos in Mac (#2689).\n        if (ie && ie_version >= 9 && this.hasSelection === text ||\n            mac && /[\\uf700-\\uf7ff]/.test(text)) {\n            cm.display.input.reset();\n            return false\n        }\n\n        if (cm.doc.sel == cm.display.selForContextMenu) {\n            var first = text.charCodeAt(0);\n            if (first == 0x200b && !prevInput) { prevInput = "\\u200b"; }\n            if (first == 0x21da) { this.reset(); return this.cm.execCommand("undo") }\n        }\n        // Find the part of the input that is actually new\n        var same = 0, l = Math.min(prevInput.length, text.length);\n        while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) { ++same; }\n\n        runInOp(cm, function () {\n            applyTextInput(cm, text.slice(same), prevInput.length - same,\n                null, this$1.composing ? "*compose" : null);\n\n            // Don\'t leave long text in the textarea, since it makes further polling slow\n            if (text.length > 1000 || text.indexOf("\\n") > -1) { input.value = this$1.prevInput = ""; }\n            else { this$1.prevInput = text; }\n\n            if (this$1.composing) {\n                this$1.composing.range.clear();\n                this$1.composing.range = cm.markText(this$1.composing.start, cm.getCursor("to"),\n                    {className: "CodeMirror-composing"});\n            }\n        });\n        return true\n    };\n\n    TextareaInput.prototype.ensurePolled = function () {\n        if (this.pollingFast && this.poll()) { this.pollingFast = false; }\n    };\n\n    TextareaInput.prototype.onKeyPress = function () {\n        if (ie && ie_version >= 9) { this.hasSelection = null; }\n        this.fastPoll();\n    };\n\n    TextareaInput.prototype.onContextMenu = function (e) {\n        var input = this, cm = input.cm, display = cm.display, te = input.textarea;\n        if (input.contextMenuPending) { input.contextMenuPending(); }\n        var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\n        if (!pos || presto) { return } // Opera is difficult.\n\n        // Reset the current text selection only if the click is done outside of the selection\n        // and \'resetSelectionOnContextMenu\' option is true.\n        var reset = cm.options.resetSelectionOnContextMenu;\n        if (reset && cm.doc.sel.contains(pos) == -1)\n        { operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll); }\n\n        var oldCSS = te.style.cssText, oldWrapperCSS = input.wrapper.style.cssText;\n        var wrapperBox = input.wrapper.offsetParent.getBoundingClientRect();\n        input.wrapper.style.cssText = "position: static";\n        te.style.cssText = "position: absolute; width: 30px; height: 30px;\\n      top: " + (e.clientY - wrapperBox.top - 5) + "px; left: " + (e.clientX - wrapperBox.left - 5) + "px;\\n      z-index: 1000; background: " + (ie ? "rgba(255, 255, 255, .05)" : "transparent") + ";\\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";\n        var oldScrollY;\n        if (webkit) { oldScrollY = window.scrollY; } // Work around Chrome issue (#2712)\n        display.input.focus();\n        if (webkit) { window.scrollTo(null, oldScrollY); }\n        display.input.reset();\n        // Adds "Select all" to context menu in FF\n        if (!cm.somethingSelected()) { te.value = input.prevInput = " "; }\n        input.contextMenuPending = rehide;\n        display.selForContextMenu = cm.doc.sel;\n        clearTimeout(display.detectingSelectAll);\n\n        // Select-all will be greyed out if there\'s nothing to select, so\n        // this adds a zero-width space so that we can later check whether\n        // it got selected.\n        function prepareSelectAllHack() {\n            if (te.selectionStart != null) {\n                var selected = cm.somethingSelected();\n                var extval = "\\u200b" + (selected ? te.value : "");\n                te.value = "\\u21da"; // Used to catch context-menu undo\n                te.value = extval;\n                input.prevInput = selected ? "" : "\\u200b";\n                te.selectionStart = 1; te.selectionEnd = extval.length;\n                // Re-set this, in case some other handler touched the\n                // selection in the meantime.\n                display.selForContextMenu = cm.doc.sel;\n            }\n        }\n        function rehide() {\n            if (input.contextMenuPending != rehide) { return }\n            input.contextMenuPending = false;\n            input.wrapper.style.cssText = oldWrapperCSS;\n            te.style.cssText = oldCSS;\n            if (ie && ie_version < 9) { display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos); }\n\n            // Try to detect the user choosing select-all\n            if (te.selectionStart != null) {\n                if (!ie || (ie && ie_version < 9)) { prepareSelectAllHack(); }\n                var i = 0, poll = function () {\n                    if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&\n                        te.selectionEnd > 0 && input.prevInput == "\\u200b") {\n                        operation(cm, selectAll)(cm);\n                    } else if (i++ < 10) {\n                        display.detectingSelectAll = setTimeout(poll, 500);\n                    } else {\n                        display.selForContextMenu = null;\n                        display.input.reset();\n                    }\n                };\n                display.detectingSelectAll = setTimeout(poll, 200);\n            }\n        }\n\n        if (ie && ie_version >= 9) { prepareSelectAllHack(); }\n        if (captureRightClick) {\n            e_stop(e);\n            var mouseup = function () {\n                off(window, "mouseup", mouseup);\n                setTimeout(rehide, 20);\n            };\n            on(window, "mouseup", mouseup);\n        } else {\n            setTimeout(rehide, 50);\n        }\n    };\n\n    TextareaInput.prototype.readOnlyChanged = function (val) {\n        if (!val) { this.reset(); }\n        this.textarea.disabled = val == "nocursor";\n    };\n\n    TextareaInput.prototype.setUneditable = function () {};\n\n    TextareaInput.prototype.needsContentAttribute = false;\n\n    function fromTextArea(textarea, options) {\n        options = options ? copyObj(options) : {};\n        options.value = textarea.value;\n        if (!options.tabindex && textarea.tabIndex)\n        { options.tabindex = textarea.tabIndex; }\n        if (!options.placeholder && textarea.placeholder)\n        { options.placeholder = textarea.placeholder; }\n        // Set autofocus to true if this textarea is focused, or if it has\n        // autofocus and no other element is focused.\n        if (options.autofocus == null) {\n            var hasFocus = activeElt();\n            options.autofocus = hasFocus == textarea ||\n                textarea.getAttribute("autofocus") != null && hasFocus == document.body;\n        }\n\n        function save() {textarea.value = cm.getValue();}\n\n        var realSubmit;\n        if (textarea.form) {\n            on(textarea.form, "submit", save);\n            // Deplorable hack to make the submit method do the right thing.\n            if (!options.leaveSubmitMethodAlone) {\n                var form = textarea.form;\n                realSubmit = form.submit;\n                try {\n                    var wrappedSubmit = form.submit = function () {\n                        save();\n                        form.submit = realSubmit;\n                        form.submit();\n                        form.submit = wrappedSubmit;\n                    };\n                } catch(e) {}\n            }\n        }\n\n        options.finishInit = function (cm) {\n            cm.save = save;\n            cm.getTextArea = function () { return textarea; };\n            cm.toTextArea = function () {\n                cm.toTextArea = isNaN; // Prevent this from being ran twice\n                save();\n                textarea.parentNode.removeChild(cm.getWrapperElement());\n                textarea.style.display = "";\n                if (textarea.form) {\n                    off(textarea.form, "submit", save);\n                    if (typeof textarea.form.submit == "function")\n                    { textarea.form.submit = realSubmit; }\n                }\n            };\n        };\n\n        textarea.style.display = "none";\n        var cm = CodeMirror(function (node) { return textarea.parentNode.insertBefore(node, textarea.nextSibling); },\n            options);\n        return cm\n    }\n\n    function addLegacyProps(CodeMirror) {\n        CodeMirror.off = off;\n        CodeMirror.on = on;\n        CodeMirror.wheelEventPixels = wheelEventPixels;\n        CodeMirror.Doc = Doc;\n        CodeMirror.splitLines = splitLinesAuto;\n        CodeMirror.countColumn = countColumn;\n        CodeMirror.findColumn = findColumn;\n        CodeMirror.isWordChar = isWordCharBasic;\n        CodeMirror.Pass = Pass;\n        CodeMirror.signal = signal;\n        CodeMirror.Line = Line;\n        CodeMirror.changeEnd = changeEnd;\n        CodeMirror.scrollbarModel = scrollbarModel;\n        CodeMirror.Pos = Pos;\n        CodeMirror.cmpPos = cmp;\n        CodeMirror.modes = modes;\n        CodeMirror.mimeModes = mimeModes;\n        CodeMirror.resolveMode = resolveMode;\n        CodeMirror.getMode = getMode;\n        CodeMirror.modeExtensions = modeExtensions;\n        CodeMirror.extendMode = extendMode;\n        CodeMirror.copyState = copyState;\n        CodeMirror.startState = startState;\n        CodeMirror.innerMode = innerMode;\n        CodeMirror.commands = commands;\n        CodeMirror.keyMap = keyMap;\n        CodeMirror.keyName = keyName;\n        CodeMirror.isModifierKey = isModifierKey;\n        CodeMirror.lookupKey = lookupKey;\n        CodeMirror.normalizeKeyMap = normalizeKeyMap;\n        CodeMirror.StringStream = StringStream;\n        CodeMirror.SharedTextMarker = SharedTextMarker;\n        CodeMirror.TextMarker = TextMarker;\n        CodeMirror.LineWidget = LineWidget;\n        CodeMirror.e_preventDefault = e_preventDefault;\n        CodeMirror.e_stopPropagation = e_stopPropagation;\n        CodeMirror.e_stop = e_stop;\n        CodeMirror.addClass = addClass;\n        CodeMirror.contains = contains;\n        CodeMirror.rmClass = rmClass;\n        CodeMirror.keyNames = keyNames;\n    }\n\n    // EDITOR CONSTRUCTOR\n\n    defineOptions(CodeMirror);\n\n    addEditorMethods(CodeMirror);\n\n    // Set up methods on CodeMirror\'s prototype to redirect to the editor\'s document.\n    var dontDelegate = "iter insert remove copy getEditor constructor".split(" ");\n    for (var prop in Doc.prototype) { if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\n    { CodeMirror.prototype[prop] = (function(method) {\n        return function() {return method.apply(this.doc, arguments)}\n    })(Doc.prototype[prop]); } }\n\n    eventMixin(Doc);\n    CodeMirror.inputStyles = {"textarea": TextareaInput, "contenteditable": ContentEditableInput};\n\n    // Extra arguments are stored as the mode\'s dependencies, which is\n    // used by (legacy) mechanisms like loadmode.js to automatically\n    // load a mode. (Preferred mechanism is the require/define calls.)\n    CodeMirror.defineMode = function(name/*, mode, …*/) {\n        if (!CodeMirror.defaults.mode && name != "null") { CodeMirror.defaults.mode = name; }\n        defineMode.apply(this, arguments);\n    };\n\n    CodeMirror.defineMIME = defineMIME;\n\n    // Minimal default mode.\n    CodeMirror.defineMode("null", function () { return ({token: function (stream) { return stream.skipToEnd(); }}); });\n    CodeMirror.defineMIME("text/plain", "null");\n\n    // EXTENSIONS\n\n    CodeMirror.defineExtension = function (name, func) {\n        CodeMirror.prototype[name] = func;\n    };\n    CodeMirror.defineDocExtension = function (name, func) {\n        Doc.prototype[name] = func;\n    };\n\n    CodeMirror.fromTextArea = fromTextArea;\n\n    addLegacyProps(CodeMirror);\n\n    CodeMirror.version = "5.42.2";\n\n    return CodeMirror;\n\n})));'},function(e,t,n){"use strict";n=n(210)(Object.keys,Object);e.exports=n},function(e,t,n){"use strict";n=n(19)(n(10),"DataView");e.exports=n},function(e,t,n){"use strict";var i=n(30),r=n(396),o=n(11),a=n(212),s=/^\[object .+?Constructor\]$/,n=Function.prototype,l=Object.prototype,n=n.toString,l=l.hasOwnProperty,c=RegExp("^"+n.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(i(e)?c:s).test(a(e))}},function(e,t,n){"use strict";var n=n(25),i=Object.prototype,a=i.hasOwnProperty,s=i.toString,l=n?n.toStringTag:undefined;e.exports=function(e){var t=a.call(e,l),n=e[l];try{e[l]=undefined;var i=!0}catch(o){}var r=s.call(e);return i&&(t?e[l]=n:delete e[l]),r}},function(e,t,n){"use strict";var i=Object.prototype.toString;e.exports=function(e){return i.call(e)}},function(e,t,n){"use strict";var n=n(397),i=(n=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!i&&i in e}},function(e,t,n){"use strict";n=n(10)["__core-js_shared__"];e.exports=n},function(e,t,n){"use strict";e.exports=function(e,t){return null==e?undefined:e[t]}},function(e,t,n){"use strict";n=n(19)(n(10),"Promise");e.exports=n},function(e,t,n){"use strict";n=n(19)(n(10),"WeakMap");e.exports=n},function(e,t,n){"use strict";var i=n(20),r=n(12);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},function(e,t,n){"use strict";e.exports=function(){return!1}},function(e,t,n){"use strict";var i=n(20),r=n(76),o=n(12),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&r(e.length)&&!!a[i(e)]}},function(e,t,n){"use strict";var i=n(405),r=n(435),o=n(223);e.exports=function(t){var n=r(t);return 1==n.length&&n[0][2]?o(n[0][0],n[0][1]):function(e){return e===t||i(e,t,n)}}},function(e,t,n){"use strict";var p=n(78),f=n(214);e.exports=function(e,t,n,i){var r=n.length,o=r,a=!i;if(null==e)return!o;for(e=Object(e);r--;){var s=n[r];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++r<o;){var l=(s=n[r])[0],c=e[l],u=s[1];if(a&&s[2]){if(c===undefined&&!(l in e))return!1}else{var h,d=new p;if(!((h=i?i(c,u,l,e,t,d):h)===undefined?f(u,c,3,i,d):h))return!1}}return!0}},function(e,t,n){"use strict";e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){"use strict";var i=n(54),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__;return!((e=i(t,e))<0||(e==t.length-1?t.pop():r.call(t,e,1),--this.size,0))}},function(e,t,n){"use strict";var i=n(54);e.exports=function(e){var t=this.__data__;return(e=i(t,e))<0?undefined:t[e][1]}},function(e,t,n){"use strict";var i=n(54);e.exports=function(e){return-1<i(this.__data__,e)}},function(e,t,n){"use strict";var r=n(54);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},function(e,t,n){"use strict";var i=n(53);e.exports=function(){this.__data__=new i,this.size=0}},function(e,t,n){"use strict";e.exports=function(e){var t=this.__data__,e=t["delete"](e);return this.size=t.size,e}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.get(e)}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){"use strict";var r=n(53),o=n(75),a=n(79);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var i=n.__data__;if(!o||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new a(i)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){"use strict";var i=n(417),r=n(53),o=n(75);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(e,t,n){"use strict";var i=n(418),r=n(419),o=n(420),a=n(421),n=n(422);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}s.prototype.clear=i,s.prototype["delete"]=r,s.prototype.get=o,s.prototype.has=a,s.prototype.set=n,e.exports=s},function(e,t,n){"use strict";var i=n(55);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(e,t,n){"use strict";e.exports=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e}},function(e,t,n){"use strict";var i=n(55),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t,n=this.__data__;return i?"__lodash_hash_undefined__"===(t=n[e])?undefined:t:r.call(n,e)?n[e]:undefined}},function(e,t,n){"use strict";var i=n(55),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?t[e]!==undefined:r.call(t,e)}},function(e,t,n){"use strict";var i=n(55);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&t===undefined?"__lodash_hash_undefined__":t,this}},function(e,t,n){"use strict";var i=n(56);e.exports=function(e){return e=i(this,e)["delete"](e),this.size-=e?1:0,e}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=i(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){"use strict";var i=n(56);e.exports=function(e){return i(this,e).get(e)}},function(e,t,n){"use strict";var i=n(56);e.exports=function(e){return i(this,e).has(e)}},function(e,t,n){"use strict";var r=n(56);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},function(e,t,n){"use strict";var h=n(78),d=n(215),p=n(431),f=n(433),m=n(24),g=n(0),y=n(51),b=n(77),v="[object Arguments]",x="[object Array]",I="[object Object]",S=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,i,r,o){var a=g(e),s=g(t),l=a?x:m(e),s=s?x:m(t),c=(l=l==v?I:l)==I,u=(s=s==v?I:s)==I;if((s=l==s)&&y(e)){if(!y(t))return!1;c=!(a=!0)}if(s&&!c)return o=o||new h,a||b(e)?d(e,t,n,i,r,o):p(e,t,l,n,i,r,o);if(!(1&n)){a=c&&S.call(e,"__wrapped__"),l=u&&S.call(t,"__wrapped__");if(a||l)return r(a?e.value():e,l?t.value():t,n,i,o=o||new h)}return s&&(o=o||new h,f(e,t,n,i,r,o))}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){"use strict";var i=n(25),c=n(217),u=n(33),h=n(215),d=n(432),p=n(82),n=i?i.prototype:undefined,f=n?n.valueOf:undefined;e.exports=function(e,t,n,i,r,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return e.byteLength==t.byteLength&&o(new c(e),new c(t))?!0:!1;case"[object Boolean]":case"[object Date]":case"[object Number]":return u(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=d;case"[object Set]":s=s||p;if(e.size!=t.size&&!(1&i))return!1;var l=a.get(e);if(l)return l==t;i|=2,a.set(e,t);l=h(s(e),s(t),i,r,o,a);return a["delete"](e),l;case"[object Symbol]":if(f)return f.call(e)==f.call(t)}return!1}},function(e,t,n){"use strict";e.exports=function(e){var n=-1,i=Array(e.size);return e.forEach(function(e,t){i[++n]=[t,e]}),i}},function(e,t,n){"use strict";var b=n(218),v=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,i,r,o){var a=1&n,s=b(e),l=s.length;if(l!=b(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:v.call(t,u)))return!1}var h=o.get(e),d=o.get(t);if(h&&d)return h==t&&d==e;for(var p=!0,f=(o.set(e,t),o.set(t,e),a);++c<l;){var m,g=e[u=s[c]],y=t[u];if(!((m=i?a?i(y,g,u,t,e,o):i(g,y,u,e,t,o):m)===undefined?g===y||r(g,y,n,i,o):m)){p=!1;break}f=f||"constructor"==u}return p&&!f&&(h=e.constructor)!=(d=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof h&&h instanceof h&&"function"==typeof d&&d instanceof d)&&(p=!1),o["delete"](e),o["delete"](t),p}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},function(e,t,n){"use strict";var o=n(222),a=n(6);e.exports=function(e){for(var t=a(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,o(r)]}return t}},function(e,t,n){"use strict";var r=n(214),o=n(86),a=n(441),s=n(88),l=n(222),c=n(223),u=n(34);e.exports=function(n,i){return s(n)&&l(i)?c(u(n),i):function(e){var t=o(e,n);return t===undefined&&t===i?a(e,n):r(i,t,3)}}},function(e,t,n){"use strict";var n=n(438),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,n=n(function(e){var r=[];return 46===e.charCodeAt(0)&&r.push(""),e.replace(i,function(e,t,n,i){r.push(n?i.replace(o,"$1"):t||e)}),r});e.exports=n},function(e,t,n){"use strict";var i=n(439);e.exports=function(e){var t=(e=i(e,function(e){return 500===t.size&&t.clear(),e})).cache;return e}},function(e,t,n){"use strict";var a=n(79);function s(i,r){if("function"!=typeof i||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var o;return(o=function o(){var e=arguments,t=r?r.apply(this,e):e[0],n=o.cache;return n.has(t)?n.get(t):(e=i.apply(this,e),o.cache=n.set(t,e)||n,e)}).cache=new(s.Cache||a),o}s.Cache=a,e.exports=s},function(e,t,n){"use strict";var i=n(25),r=n(32),o=n(0),a=n(59),n=i?i.prototype:undefined,s=n?n.toString:undefined;e.exports=function l(e){var t;return"string"==typeof e?e:o(e)?r(e,l)+"":a(e)?s?s.call(e):"":"0"==(t=e+"")&&1/e==-1/0?"-0":t}},function(e,t,n){"use strict";var i=n(442),r=n(225);e.exports=function(e,t){return null!=e&&r(e,t,i)}},function(e,t,n){"use strict";e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){"use strict";var i=n(226),r=n(444),o=n(88),a=n(34);e.exports=function(e){return o(e)?i(a(e)):r(e)}},function(e,t,n){"use strict";var i=n(87);e.exports=function(t){return function(e){return i(e,t)}}},function(e,t,n){"use strict";var a=n(21),s=n(9);e.exports=function(e,i){var r=-1,o=s(e)?Array(e.length):[];return a(e,function(e,t,n){o[++r]=i(e,t,n)}),o}},function(e,t,n){"use strict";var i=n(447),r=n(6);e.exports=function(e,t){return e&&i(e,t,r)}},function(e,t,n){"use strict";n=n(448)();e.exports=n},function(e,t,n){"use strict";e.exports=function(l){return function(e,t,n){for(var i=-1,r=Object(e),o=n(e),a=o.length;a--;){var s=o[l?a:++i];if(!1===t(r[s],s,r))break}return e}}},function(e,t,n){"use strict";var s=n(9);e.exports=function(o,a){return function(e,t){if(null!=e){if(!s(e))return o(e,t);for(var n=e.length,i=a?n:-1,r=Object(e);(a?i--:++i<n)&&!1!==t(r[i],i,r););}return e}}},function(e,t,n){"use strict";var i=n(35);e.exports=function(e){return"function"==typeof e?e:i}},function(e,t,n){"use strict";var i=n(32);e.exports=function(t,e){return i(e,function(e){return t[e]})}},function(e,t,n){"use strict";var i=Object.prototype.hasOwnProperty;e.exports=function(e,t){return null!=e&&i.call(e,t)}},function(e,t,n){"use strict";var p=n(78),f=n(227),m=n(60),g=n(454),y=n(455),b=n(458),v=n(459),x=n(460),I=n(461),S=n(218),_=n(231),C=n(24),w=n(462),E=n(463),T=n(468),B=n(0),R=n(51),N=n(470),O=n(11),L=n(472),k=n(6),A=n(61),P="[object Arguments]",z="[object Function]",F="[object Object]",M={};M[P]=M["[object Array]"]=M["[object ArrayBuffer]"]=M["[object DataView]"]=M["[object Boolean]"]=M["[object Date]"]=M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Map]"]=M["[object Number]"]=M[F]=M["[object RegExp]"]=M["[object Set]"]=M["[object String]"]=M["[object Symbol]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M["[object Error]"]=M[z]=M["[object WeakMap]"]=!1,e.exports=function D(n,i,r,e,t,o){var a,s=1&i,l=2&i,c=4&i;if((a=r?t?r(n,e,t,o):r(n):a)===undefined){if(!O(n))return n;if(e=B(n)){if(a=w(n),!s)return v(n,a)}else{var u=C(n),h=u==z||"[object GeneratorFunction]"==u;if(R(n))return b(n,s);if(u==F||u==P||h&&!t){if(a=l||h?{}:T(n),!s)return l?I(n,y(a,n)):x(n,g(a,n))}else{if(!M[u])return t?n:{};a=E(n,u,s)}}if(h=(o=o||new p).get(n))return h;o.set(n,a),L(n)?n.forEach(function(e){a.add(D(e,i,r,e,n,o))}):N(n)&&n.forEach(function(e,t){a.set(t,D(e,i,r,t,n,o))});var d=e?undefined:(c?l?_:S:l?A:k)(n);f(d||n,function(e,t){d&&(e=n[t=e]),m(a,t,D(e,i,r,t,n,o))})}return a}},function(e,t,n){"use strict";var i=n(36),r=n(6);e.exports=function(e,t){return e&&i(t,r(t),e)}},function(e,t,n){"use strict";var i=n(36),r=n(61);e.exports=function(e,t){return e&&i(t,r(t),e)}},function(e,t,n){"use strict";var r=n(11),o=n(29),a=n(457),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return a(e);var t,n=o(e),i=[];for(t in e)("constructor"!=t||!n&&s.call(e,t))&&i.push(t);return i}},function(e,t,n){"use strict";e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,a,s){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=s(10),i="object"==t(a)&&a&&!a.nodeType&&a,r=i&&"object"==t(e)&&e&&!e.nodeType&&e,r=r&&r.exports===i?n.Buffer:undefined,o=r?r.allocUnsafe:undefined;e.exports=function(e,t){return t?e.slice():(t=e.length,t=o?o(t):new e.constructor(t),e.copy(t),t)}}.call(this,s(46)(e))},function(e,t,n){"use strict";e.exports=function(e,t){var n=-1,i=e.length;for(t=t||Array(i);++n<i;)t[n]=e[n];return t}},function(e,t,n){"use strict";var i=n(36),r=n(84);e.exports=function(e,t){return i(e,r(e),t)}},function(e,t,n){"use strict";var i=n(36),r=n(229);e.exports=function(e,t){return i(e,r(e),t)}},function(e,t,n){"use strict";var i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&i.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,n){"use strict";var r=n(90),o=n(464),a=n(465),s=n(466),l=n(467);e.exports=function(e,t,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return o(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return l(e,n);case"[object Map]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return a(e);case"[object Set]":return new i;case"[object Symbol]":return s(e)}}},function(e,t,n){"use strict";var i=n(90);e.exports=function(e,t){return t=t?i(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength)}},function(e,t,n){"use strict";var i=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,i.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,n){"use strict";var n=n(25),n=n?n.prototype:undefined,i=n?n.valueOf:undefined;e.exports=function(e){return i?Object(i.call(e)):{}}},function(e,t,n){"use strict";var i=n(90);e.exports=function(e,t){return t=t?i(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)}},function(e,t,n){"use strict";var i=n(469),r=n(230),o=n(29);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:i(r(e))}},function(e,t,n){"use strict";var i=n(11),r=Object.create;function o(){}e.exports=function(e){if(!i(e))return{};if(r)return r(e);o.prototype=e;e=new o;return o.prototype=undefined,e}},function(e,t,n){"use strict";var i=n(471),r=n(31),n=n(52),n=n&&n.isMap,n=n?r(n):i;e.exports=n},function(e,t,n){"use strict";var i=n(24),r=n(12);e.exports=function(e){return r(e)&&"[object Map]"==i(e)}},function(e,t,n){"use strict";var i=n(473),r=n(31),n=n(52),n=n&&n.isSet,n=n?r(n):i;e.exports=n},function(e,t,n){"use strict";var i=n(24),r=n(12);e.exports=function(e){return r(e)&&"[object Set]"==i(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRINT_WARNING=t.PRINT_ERROR=void 0,t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: ".concat(e))},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: ".concat(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timer=void 0,t.timer=function(e){var t=(new Date).getTime(),e=e();return{time:(new Date).getTime()-t,value:e}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){function t(){}t.prototype=e;var n=new t;function i(){r(n.bar)}return i(),i(),e}Object.defineProperty(t,"__esModule",{value:!0}),t.toFastProperties=void 0,t.toFastProperties=i},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},l=(Object.defineProperty(t,"__esModule",{value:!0}),t.buildInProdFollowPrefix=t.buildBetweenProdsFollowPrefix=t.computeAllProdsFollows=t.ResyncFollowsWalker=void 0,n(91)),c=n(235),u=s(n(3)),h=s(n(62)),d=n(238),p=n(2),f=(o=l.RestWalker,a(m,o),m.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},m.prototype.walkTerminal=function(e,t,n){},m.prototype.walkProdRef=function(e,t,n){e=g(e.referencedRule,e.idx)+this.topProd.name,n=t.concat(n),t=new p.Alternative({definition:n}),n=(0,c.first)(t);this.follows[e]=n},m);function m(e){var t=o.call(this)||this;return t.topProd=e,t.follows={},t}function g(e,t){return e.name+t+d.IN}t.ResyncFollowsWalker=f,t.computeAllProdsFollows=function(e){var t={};return(0,u["default"])(e,function(e){e=new f(e).startWalking();(0,h["default"])(t,e)}),t},t.buildBetweenProdsFollowPrefix=g,t.buildInProdFollowPrefix=function(e){return e.terminalType.name+e.idx+d.IN}},function(e,t,n){"use strict";var i=n(479);e.exports=function(e){return e?(e=i(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,n){"use strict";var i=n(480),r=n(11),o=n(59),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(r(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=r(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=i(e);var t=s.test(e);return t||l.test(e)?c(e.slice(2),t?2:8):a.test(e)?NaN:+e}},function(e,t,n){"use strict";var i=n(481),r=/^\s+/;e.exports=function(e){return e&&e.slice(0,i(e)+1).replace(r,"")}},function(e,t,n){"use strict";var i=/\s/;e.exports=function(e){for(var t=e.length;t--&&i.test(e.charAt(t)););return t}},function(e,t,n){"use strict";var i=n(20),r=n(12);e.exports=function(e){return r(e)&&"[object RegExp]"==i(e)}},function(e,t,n){"use strict";var l=n(87),c=n(484),u=n(58);e.exports=function(e,t,n){for(var i=-1,r=t.length,o={};++i<r;){var a=t[i],s=l(e,a);n(s,a)&&c(o,u(a,e),s)}return o}},function(e,t,n){"use strict";var h=n(60),d=n(58),p=n(57),f=n(11),m=n(34);e.exports=function(e,t,n,i){if(f(e))for(var r=-1,o=(t=d(t,e)).length,a=o-1,s=e;null!=s&&++r<o;){var l,c=m(t[r]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;r!=a&&(l=s[c],(u=i?i(l,c,s):undefined)===undefined)&&(u=f(l)?l:p(t[r+1])?[]:{}),h(s,c,u),s=s[c]}return e}},function(e,t,n){"use strict";var i=n(95),l=n(63);e.exports=function(s){return i(function(e,t){var n=-1,i=t.length,r=1<i?t[i-1]:undefined,o=2<i?t[2]:undefined,r=3<s.length&&"function"==typeof r?(i--,r):undefined;for(o&&l(t[0],t[1],o)&&(r=i<3?undefined:r,i=1),e=Object(e);++n<i;){var a=t[n];a&&s(e,a,n,r)}return e})}},function(e,t,n){"use strict";var l=n(487),c=Math.max;e.exports=function(o,a,s){return a=c(a===undefined?o.length-1:a,0),function(){for(var e=arguments,t=-1,n=c(e.length-a,0),i=Array(n);++t<n;)i[t]=e[a+t];for(var t=-1,r=Array(a+1);++t<a;)r[t]=e[t];return r[a]=s(i),l(o,this,r)}}},function(e,t,n){"use strict";e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){"use strict";var i=n(489),n=n(491)(i);e.exports=n},function(e,t,n){"use strict";var i=n(490),r=n(228),n=n(35);e.exports=r?function(e,t){return r(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:n},function(e,t,n){"use strict";e.exports=function(e){return function(){return e}}},function(e,t,n){"use strict";var o=Date.now;e.exports=function(n){var i=0,r=0;return function(){var e=o(),t=16-(e-r);if(r=e,0<t){if(800<=++i)return arguments[0]}else i=0;return n.apply(undefined,arguments)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GAstVisitor=void 0;var i=n(94);function r(){}r.prototype.visit=function(e){var t=e;switch(t.constructor){case i.NonTerminal:return this.visitNonTerminal(t);case i.Alternative:return this.visitAlternative(t);case i.Option:return this.visitOption(t);case i.RepetitionMandatory:return this.visitRepetitionMandatory(t);case i.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(t);case i.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(t);case i.Repetition:return this.visitRepetition(t);case i.Alternation:return this.visitAlternation(t);case i.Terminal:return this.visitTerminal(t);case i.Rule:return this.visitRule(t);default:throw Error("non exhaustive match")}},r.prototype.visitNonTerminal=function(e){},r.prototype.visitAlternative=function(e){},r.prototype.visitOption=function(e){},r.prototype.visitRepetition=function(e){},r.prototype.visitRepetitionMandatory=function(e){},r.prototype.visitRepetitionMandatoryWithSeparator=function(e){},r.prototype.visitRepetitionWithSeparator=function(e){},r.prototype.visitAlternation=function(e){},r.prototype.visitTerminal=function(e){},r.prototype.visitRule=function(e){},t.GAstVisitor=r},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.getProductionDslName=t.isBranchingProd=t.isOptionalProd=t.isSequenceProd=void 0,i(n(96))),o=i(n(64)),a=i(n(18)),s=n(94);t.isSequenceProd=function(e){return e instanceof s.Alternative||e instanceof s.Option||e instanceof s.Repetition||e instanceof s.RepetitionMandatory||e instanceof s.RepetitionMandatoryWithSeparator||e instanceof s.RepetitionWithSeparator||e instanceof s.Terminal||e instanceof s.Rule},t.isOptionalProd=function l(e,t){return void 0===t&&(t=[]),e instanceof s.Option||e instanceof s.Repetition||e instanceof s.RepetitionWithSeparator||(e instanceof s.Alternation?(0,r["default"])(e.definition,function(e){return l(e,t)}):!(e instanceof s.NonTerminal&&(0,a["default"])(t,e))&&e instanceof s.AbstractProduction&&(e instanceof s.NonTerminal&&t.push(e),(0,o["default"])(e.definition,function(e){return l(e,t)})))},t.isBranchingProd=function(e){return e instanceof s.Alternation},t.getProductionDslName=function(e){if(e instanceof s.NonTerminal)return"SUBRULE";if(e instanceof s.Option)return"OPTION";if(e instanceof s.Alternation)return"OR";if(e instanceof s.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof s.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof s.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof s.Repetition)return"MANY";if(e instanceof s.Terminal)return"CONSUME";throw Error("non exhaustive match")}},function(e,t,n){"use strict";var o=n(21);e.exports=function(e,i){var r;return o(e,function(e,t,n){return!(r=i(e,t,n))}),!!r}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}},function(e,t,n){"use strict";var o=n(21);e.exports=function(e,i){var r=!0;return o(e,function(e,t,n){return r=!!i(e,t,n)}),r}},function(e,t,n){"use strict";e.exports=function(e){return e!=e}},function(e,t,n){"use strict";e.exports=function(e,t,n){for(var i=n-1,r=e.length;++i<r;)if(e[i]===t)return i;return-1}},function(e,t,n){"use strict";var i=n(25),r=n(50),o=n(0),a=i?i.isConcatSpreadable:undefined;e.exports=function(e){return o(e)||r(e)||!!(a&&e&&e[a])}},function(e,t,n){"use strict";var p=n(80),f=n(236),m=n(237),g=n(81),y=n(501),b=n(82);e.exports=function(e,t,n){var i=-1,r=f,o=e.length,a=!0,s=[],l=s;if(n)a=!1,r=m;else if(200<=o){var c=t?null:y(e);if(c)return b(c);a=!1,r=g,l=new p}else l=t?[]:s;e:for(;++i<o;){var u=e[i],h=t?t(u):u,u=n||0!==u?u:0;if(a&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),s.push(u)}else r(l,h,n)||(l!==s&&l.push(h),s.push(u))}return s}},function(e,t,n){"use strict";var i=n(213),r=n(100),n=n(82),n=i&&1/n(new i([,-0]))[1]==1/0?function(e){return new i(e)}:r;e.exports=n},function(e,t,n){"use strict";e.exports=function(e){return e&&e.length?e[0]:undefined}},function(e,t,n){"use strict";e.exports=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}},function(e,t,n){"use strict";var p=n(80),f=n(236),m=n(237),g=n(32),y=n(31),b=n(81);e.exports=function(e,t,n,i){var r=-1,o=f,a=!0,s=e.length,l=[],c=t.length;if(s){n&&(t=g(t,y(n))),i?(o=m,a=!1):200<=t.length&&(o=b,a=!1,t=new p(t));e:for(;++r<s;){var u=e[r],h=null==n?u:n(u),u=i||0!==u?u:0;if(a&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(u)}else o(t,h,i)||l.push(u)}}return l}},function(e,t,n){"use strict";var i=n(9),r=n(12);e.exports=function(e){return r(e)&&i(e)}},function(e,t,n){"use strict";var r=n(97),o=n(38),a=Math.max;e.exports=function(e,t,n){var i=null==e?0:e.length;return i?((n=null==n?0:o(n))<0&&(n=a(i+n,0)),r(e,t,n)):-1}},function(e,t,n){"use strict";var a=n(13),s=n(9),l=n(6);e.exports=function(o){return function(e,t,n){var i,r=Object(e),n=(s(e)||(i=a(t,3),e=l(e),t=function t(e){return i(r[e],e,r)}),o(e,t,n));return-1<n?r[i?e[n]:n]:undefined}}},function(e,t,n){"use strict";e.exports=function(e,t,n,i){var r=-1,o=null==e?0:e.length;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}},function(e,t,n){"use strict";e.exports=function(e,i,r,o,t){return t(e,function(e,t,n){r=o?(o=!1,e):i(r,e,t,n)}),r}},function(e,r,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||(n({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var i,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(r,"__esModule",{value:!0}),r.canMatchCharCode=r.firstCharOptimizedIndices=r.getOptimizedStartCodesIndices=r.failedOptimizationPrefixMsg=void 0,t(101)),l=a(t(0)),c=a(t(64)),u=a(t(3)),h=a(t(104)),d=a(t(15)),p=a(t(18)),f=t(37),m=t(106),g=t(239),y="Complement Sets are not supported for first char optimization";function b(e,a,s){switch(e.type){case"Disjunction":for(var t=0;t<e.value.length;t++)b(e.value[t],a,s);break;case"Alternative":for(var n=e.value,t=0;t<n.length;t++){var i=n[t];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var r=i;switch(r.type){case"Character":v(r.value,a,s);break;case"Set":if(!0===r.complement)throw Error(y);(0,u["default"])(r.value,function(e){if("number"==typeof e)v(e,a,s);else{var t=e;if(!0===s)for(var n=t.from;n<=t.to;n++)v(n,a,s);else{for(n=t.from;n<=t.to&&n<g.minOptimizationVal;n++)v(n,a,s);if(t.to>=g.minOptimizationVal)for(var e=t.from>=g.minOptimizationVal?t.from:g.minOptimizationVal,i=t.to,e=(0,g.charCodeToOptimizedIndex)(e),r=(0,g.charCodeToOptimizedIndex)(i),o=e;o<=r;o++)a[o]=o}}});break;case"Group":b(r.value,a,s);break;default:throw Error("Non Exhaustive Match")}i=r.quantifier!==undefined&&0===r.quantifier.atLeast;if("Group"===r.type&&!1===I(r)||"Group"!==r.type&&!1==i)break}break;default:throw Error("non exhaustive match!")}return(0,d["default"])(a)}function v(e,t,n){var i,r=(0,g.charCodeToOptimizedIndex)(e);t[r]=r,!0===n&&(r=e,n=t,(e=(r=String.fromCharCode(r)).toUpperCase())!==r?(i=(0,g.charCodeToOptimizedIndex)(e.charCodeAt(0)),n[i]=i):(e=r.toLowerCase())!==r&&(i=(0,g.charCodeToOptimizedIndex)(e.charCodeAt(0)),n[i]=i))}function x(e,n){return(0,h["default"])(e.value,function(e){var t;return"number"==typeof e?(0,p["default"])(n,e):(t=e,(0,h["default"])(n,function(e){return t.from<=e&&e<=t.to})!==undefined)})}function I(e){var t=e.quantifier;return!(!t||0!==t.atLeast)||!!e.value&&((0,l["default"])(e.value)?(0,c["default"])(e.value,I):I(e.value))}r.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',r.getOptimizedStartCodesIndices=function(e,t){void 0===t&&(t=!1);try{var n=(0,m.getRegExpAst)(e);return b(n.value,{},n.flags.ignoreCase)}catch(i){i.message===y?t&&(0,f.PRINT_WARNING)("".concat(r.failedOptimizationPrefixMsg)+"\tUnable to optimize: < ".concat(e.toString()," >\n")+"\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details."):(n=t?"\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.":"",(0,f.PRINT_ERROR)("".concat(r.failedOptimizationPrefixMsg,"\n")+"\tFailed parsing: < ".concat(e.toString()," >\n")+"\tUsing the regexp-to-ast library version: ".concat(s.VERSION,"\n")+"\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+n))}return[]},r.firstCharOptimizedIndices=b;S=s.BaseRegExpVisitor,o(C,S),C.prototype.visitChildren=function(e){if(!0!==this.found){switch(e.type){case"Lookahead":return void this.visitLookahead(e);case"NegativeLookahead":return void this.visitNegativeLookahead(e)}S.prototype.visitChildren.call(this,e)}},C.prototype.visitCharacter=function(e){(0,p["default"])(this.targetCharCodes,e.value)&&(this.found=!0)},C.prototype.visitSet=function(e){e.complement?x(e,this.targetCharCodes)===undefined&&(this.found=!0):x(e,this.targetCharCodes)!==undefined&&(this.found=!0)};var S,_=C;function C(e){var t=S.call(this)||this;return t.targetCharCodes=e,t.found=!1,t}r.canMatchCharCode=function(t,e){var n,i;return e instanceof RegExp?(n=(0,m.getRegExpAst)(e),(i=new _(t)).visit(n),i.found):(0,h["default"])(e,function(e){return(0,p["default"])(t,e.charCodeAt(0))})!==undefined}},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.validateGrammar=t.resolveGrammar=void 0,i(n(3))),o=i(n(242)),a=n(512),s=n(67),l=n(41);t.resolveGrammar=function(e){var t=(0,o["default"])(e,{errMsgProvider:l.defaultGrammarResolverErrorProvider}),n={};return(0,r["default"])(e.rules,function(e){n[e.name]=e}),(0,a.resolveGrammar)(n,t.errMsgProvider)},t.validateGrammar=function(e){return e=(0,o["default"])(e,{errMsgProvider:l.defaultGrammarValidatorErrorProvider}),(0,s.validateGrammar)(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.GastRefResolverVisitor=t.resolveGrammar=void 0,n(5)),l=a(n(3)),c=a(n(15)),a=n(2);t.resolveGrammar=function(e,t){return(e=new h(e,t)).resolveRefs(),e.errors};u=a.GAstVisitor,o(d,u),d.prototype.resolveRefs=function(){var t=this;(0,l["default"])((0,c["default"])(this.nameToTopRule),function(e){(t.currTopLevel=e).accept(t)})},d.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule[e.nonTerminalName];t?e.referencedRule=t:(t=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e),this.errors.push({message:t,type:s.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName}))};var u,h=d;function d(e,t){var n=u.call(this)||this;return n.nameToTopRule=e,n.errMsgProvider=t,n.errors=[],n}t.GastRefResolverVisitor=h},function(e,t,n){"use strict";var a=n(514),s=n(515),l=n(13),c=n(0);e.exports=function(r,o){return function(e,t){var n=c(e)?a:s,i=o?o():{};return n(e,r,l(t,2),i)}}},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=-1,o=null==e?0:e.length;++r<o;){var a=e[r];t(i,a,n(a),e)}return i}},function(e,t,n){"use strict";var a=n(21);e.exports=function(e,i,r,o){return a(e,function(e,t,n){i(o,e,r(e),n)}),o}},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},l=(Object.defineProperty(t,"__esModule",{value:!0}),t.collectMethods=t.LooksAhead=void 0,s(n(3))),c=s(n(7)),u=n(5),h=n(109),s=n(2),d=n(2),p=n(247);function f(){}function m(){var e=null!==o&&o.apply(this,arguments)||this;return e.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},e}f.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=((0,c["default"])(e,"dynamicTokensEnabled")?e:u.DEFAULT_PARSER_CONFIG).dynamicTokensEnabled,this.maxLookahead=((0,c["default"])(e,"maxLookahead")?e:u.DEFAULT_PARSER_CONFIG).maxLookahead,this.lookaheadStrategy=(0,c["default"])(e,"lookaheadStrategy")?e.lookaheadStrategy:new p.LLkLookaheadStrategy({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map},f.prototype.preComputeLookaheadFunctions=function(e){var s=this;(0,l["default"])(e,function(a){s.TRACE_INIT("".concat(a.name," Rule Lookahead"),function(){var e=y(a),t=e.alternation,n=e.repetition,i=e.option,r=e.repetitionMandatory,o=e.repetitionMandatoryWithSeparator,e=e.repetitionWithSeparator;(0,l["default"])(t,function(n){var e=0===n.idx?"":n.idx;s.TRACE_INIT("".concat((0,d.getProductionDslName)(n)).concat(e),function(){var e=s.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:n.idx,rule:a,maxLookahead:n.maxLookahead||s.maxLookahead,hasPredicates:n.hasPredicates,dynamicTokensEnabled:s.dynamicTokensEnabled}),t=(0,h.getKeyForAutomaticLookahead)(s.fullRuleNameToShort[a.name],h.OR_IDX,n.idx);s.setLaFuncCache(t,e)})}),(0,l["default"])(n,function(e){s.computeLookaheadFunc(a,e.idx,h.MANY_IDX,"Repetition",e.maxLookahead,(0,d.getProductionDslName)(e))}),(0,l["default"])(i,function(e){s.computeLookaheadFunc(a,e.idx,h.OPTION_IDX,"Option",e.maxLookahead,(0,d.getProductionDslName)(e))}),(0,l["default"])(r,function(e){s.computeLookaheadFunc(a,e.idx,h.AT_LEAST_ONE_IDX,"RepetitionMandatory",e.maxLookahead,(0,d.getProductionDslName)(e))}),(0,l["default"])(o,function(e){s.computeLookaheadFunc(a,e.idx,h.AT_LEAST_ONE_SEP_IDX,"RepetitionMandatoryWithSeparator",e.maxLookahead,(0,d.getProductionDslName)(e))}),(0,l["default"])(e,function(e){s.computeLookaheadFunc(a,e.idx,h.MANY_SEP_IDX,"RepetitionWithSeparator",e.maxLookahead,(0,d.getProductionDslName)(e))})})})},f.prototype.computeLookaheadFunc=function(n,i,r,o,a,e){var s=this;this.TRACE_INIT("".concat(e).concat(0===i?"":i),function(){var e=s.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:i,rule:n,maxLookahead:a||s.maxLookahead,dynamicTokensEnabled:s.dynamicTokensEnabled,prodType:o}),t=(0,h.getKeyForAutomaticLookahead)(s.fullRuleNameToShort[n.name],r,i);s.setLaFuncCache(t,e)})},f.prototype.getKeyForAutomaticLookahead=function(e,t){var n=this.getLastExplicitRuleShortName();return(0,h.getKeyForAutomaticLookahead)(n,e,t)},f.prototype.getLaFuncFromCache=function(e){return this.lookAheadFuncsCache.get(e)},f.prototype.setLaFuncCache=function(e,t){this.lookAheadFuncsCache.set(e,t)},t.LooksAhead=f,o=s.GAstVisitor,a(m,o),m.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},m.prototype.visitOption=function(e){this.dslMethods.option.push(e)},m.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},m.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},m.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},m.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},m.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)};var g=new m;function y(e){g.reset(),e.accept(g);e=g.dslMethods;return g.reset(),e}t.collectMethods=y},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.TreeBuilder=void 0,n(518)),o=i(n(100)),a=i(n(7)),s=i(n(6)),l=i(n(22)),c=n(519),u=n(5);function h(){}h.prototype.initTreeBuilder=function(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=((0,a["default"])(e,"nodeLocationTracking")?e:u.DEFAULT_PARSER_CONFIG).nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=r.setNodeLocationFull,this.setNodeLocationFromNode=r.setNodeLocationFull,this.cstPostRule=o["default"],this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=o["default"],this.setNodeLocationFromNode=o["default"],this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=r.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=r.setNodeLocationOnlyOffset,this.cstPostRule=o["default"],this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=o["default"],this.setNodeLocationFromNode=o["default"],this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error('Invalid <nodeLocationTracking> config option: "'.concat(e.nodeLocationTracking,'"'));this.setNodeLocationFromToken=o["default"],this.setNodeLocationFromNode=o["default"],this.cstPostRule=o["default"],this.setInitialNodeLocation=o["default"]}else this.cstInvocationStateUpdate=o["default"],this.cstFinallyStateUpdate=o["default"],this.cstPostTerminal=o["default"],this.cstPostNonTerminal=o["default"],this.cstPostRule=o["default"]},h.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},h.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},h.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},h.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},h.prototype.cstInvocationStateUpdate=function(e){e={name:e,children:Object.create(null)};this.setInitialNodeLocation(e),this.CST_STACK.push(e)},h.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},h.prototype.cstPostRuleFull=function(e){var t=this.LA(0),e=e.location;e.startOffset<=t.startOffset==!0?(e.endOffset=t.endOffset,e.endLine=t.endLine,e.endColumn=t.endColumn):(e.startOffset=NaN,e.startLine=NaN,e.startColumn=NaN)},h.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),e=e.location;e.startOffset<=t.startOffset==!0?e.endOffset=t.endOffset:e.startOffset=NaN},h.prototype.cstPostTerminal=function(e,t){var n=this.CST_STACK[this.CST_STACK.length-1];(0,r.addTerminalToCst)(n,t,e),this.setNodeLocationFromToken(n.location,t)},h.prototype.cstPostNonTerminal=function(e,t){var n=this.CST_STACK[this.CST_STACK.length-1];(0,r.addNoneTerminalToCst)(n,t,e),this.setNodeLocationFromNode(n.location,e.location)},h.prototype.getBaseCstVisitorConstructor=function(){var e;return(0,l["default"])(this.baseCstVisitorConstructor)?(e=(0,c.createBaseSemanticVisitorConstructor)(this.className,(0,s["default"])(this.gastProductionsCache)),this.baseCstVisitorConstructor=e):this.baseCstVisitorConstructor},h.prototype.getBaseCstVisitorConstructorWithDefaults=function(){var e;return(0,l["default"])(this.baseCstVisitorWithDefaultsConstructor)?(e=(0,c.createBaseVisitorConstructorWithDefaults)(this.className,(0,s["default"])(this.gastProductionsCache),this.getBaseCstVisitorConstructor()),this.baseCstVisitorWithDefaultsConstructor=e):this.baseCstVisitorWithDefaultsConstructor},h.prototype.getLastExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-1]},h.prototype.getPreviousExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-2]},h.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},t.TreeBuilder=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNoneTerminalToCst=t.addTerminalToCst=t.setNodeLocationFull=t.setNodeLocationOnlyOffset=void 0,t.setNodeLocationOnlyOffset=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset)},t.setNodeLocationFull=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)},t.addTerminalToCst=function(e,t,n){e.children[n]===undefined?e.children[n]=[t]:e.children[n].push(t)},t.addNoneTerminalToCst=function(e,t,n){e.children[t]===undefined?e.children[t]=[n]:e.children[t].push(n)}},function(e,t,n){"use strict";var i,r=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.validateMissingCstMethods=t.validateVisitor=t.CstVisitorDefinitionError=t.createBaseVisitorConstructorWithDefaults=t.createBaseSemanticVisitorConstructor=t.defaultVisit=void 0,r(n(8))),a=r(n(66)),s=r(n(0)),l=r(n(4)),c=r(n(3)),u=r(n(105)),h=r(n(6)),d=r(n(30)),p=r(n(22)),f=n(520);function m(e,t){for(var n=(0,h["default"])(e),i=n.length,r=0;r<i;r++)for(var o=e[n[r]],a=o.length,s=0;s<a;s++){var l=o[s];l.tokenTypeIdx===undefined&&this[l.name](l.children,t)}}function g(e,t){return y(e,t)}function y(t,e){e=(0,u["default"])(e,function(e){return!1===(0,d["default"])(t[e])}),e=(0,l["default"])(e,function(e){return{msg:"Missing visitor method: <".concat(e,"> on ").concat(t.constructor.name," CST Visitor."),type:i.MISSING_METHOD,methodName:e}});return(0,a["default"])(e)}t.defaultVisit=m,t.createBaseSemanticVisitorConstructor=function(e,t){var n=function n(){};return(0,f.defineNameProp)(n,e+"BaseSemantics"),n.prototype={visit:function(e,t){return(0,s["default"])(e)&&(e=e[0]),(0,p["default"])(e)?undefined:this[e.name](e.children,t)},validateVisitor:function(){var e=g(this,t);if(!(0,o["default"])(e))throw e=(0,l["default"])(e,function(e){return e.msg}),Error("Errors Detected in CST Visitor <".concat(this.constructor.name,">:\n\t")+"".concat(e.join("\n\n").replace(/\n/g,"\n\t")))}},(n.prototype.constructor=n)._RULE_NAMES=t,n},t.createBaseVisitorConstructorWithDefaults=function(e,t,n){var i=function i(){},r=((0,f.defineNameProp)(i,e+"BaseSemanticsWithDefaults"),Object.create(n.prototype));return(0,c["default"])(t,function(e){r[e]=m}),i.prototype=r,i.prototype.constructor=i},(r=i=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={}))[r.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",r[r.MISSING_METHOD=1]="MISSING_METHOD",t.validateVisitor=g,t.validateMissingCstMethods=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineNameProp=void 0;t.defineNameProp=function(e,t){Object.defineProperty(e,"name",{enumerable:!1,configurable:!0,writable:!1,value:t})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LexerAdapter=void 0;var i=n(5);function r(){}r.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(r.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!1,configurable:!0}),r.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):i.END_OF_FILE},r.prototype.LA=function(e){e=this.currIdx+e;return e<0||this.tokVectorLength<=e?i.END_OF_FILE:this.tokVector[e]},r.prototype.consumeToken=function(){this.currIdx++},r.prototype.exportLexerState=function(){return this.currIdx},r.prototype.importLexerState=function(e){this.currIdx=e},r.prototype.resetLexerState=function(){this.currIdx=-1},r.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},r.prototype.getLexerPosition=function(){return this.exportLexerState()},t.LexerAdapter=r},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerApi=void 0,i(n(15))),o=i(n(18)),a=n(43),s=n(5),l=n(41),c=n(67),u=n(2);function h(){}h.prototype.ACTION=function(e){return e.call(this)},h.prototype.consume=function(e,t,n){return this.consumeInternal(t,e,n)},h.prototype.subrule=function(e,t,n){return this.subruleInternal(t,e,n)},h.prototype.option=function(e,t){return this.optionInternal(t,e)},h.prototype.or=function(e,t){return this.orInternal(t,e)},h.prototype.many=function(e,t){return this.manyInternal(e,t)},h.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},h.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},h.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},h.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},h.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},h.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},h.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},h.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},h.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},h.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},h.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},h.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},h.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},h.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},h.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},h.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},h.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},h.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},h.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},h.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},h.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},h.prototype.OPTION=function(e){return this.optionInternal(e,0)},h.prototype.OPTION1=function(e){return this.optionInternal(e,1)},h.prototype.OPTION2=function(e){return this.optionInternal(e,2)},h.prototype.OPTION3=function(e){return this.optionInternal(e,3)},h.prototype.OPTION4=function(e){return this.optionInternal(e,4)},h.prototype.OPTION5=function(e){return this.optionInternal(e,5)},h.prototype.OPTION6=function(e){return this.optionInternal(e,6)},h.prototype.OPTION7=function(e){return this.optionInternal(e,7)},h.prototype.OPTION8=function(e){return this.optionInternal(e,8)},h.prototype.OPTION9=function(e){return this.optionInternal(e,9)},h.prototype.OR=function(e){return this.orInternal(e,0)},h.prototype.OR1=function(e){return this.orInternal(e,1)},h.prototype.OR2=function(e){return this.orInternal(e,2)},h.prototype.OR3=function(e){return this.orInternal(e,3)},h.prototype.OR4=function(e){return this.orInternal(e,4)},h.prototype.OR5=function(e){return this.orInternal(e,5)},h.prototype.OR6=function(e){return this.orInternal(e,6)},h.prototype.OR7=function(e){return this.orInternal(e,7)},h.prototype.OR8=function(e){return this.orInternal(e,8)},h.prototype.OR9=function(e){return this.orInternal(e,9)},h.prototype.MANY=function(e){this.manyInternal(0,e)},h.prototype.MANY1=function(e){this.manyInternal(1,e)},h.prototype.MANY2=function(e){this.manyInternal(2,e)},h.prototype.MANY3=function(e){this.manyInternal(3,e)},h.prototype.MANY4=function(e){this.manyInternal(4,e)},h.prototype.MANY5=function(e){this.manyInternal(5,e)},h.prototype.MANY6=function(e){this.manyInternal(6,e)},h.prototype.MANY7=function(e){this.manyInternal(7,e)},h.prototype.MANY8=function(e){this.manyInternal(8,e)},h.prototype.MANY9=function(e){this.manyInternal(9,e)},h.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},h.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},h.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},h.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},h.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},h.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},h.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},h.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},h.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},h.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},h.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},h.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},h.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},h.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},h.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},h.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},h.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},h.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},h.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},h.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},h.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},h.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},h.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},h.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},h.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},h.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},h.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},h.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},h.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},h.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},h.prototype.RULE=function(e,t,n){void 0===n&&(n=s.DEFAULT_RULE_CONFIG),(0,o["default"])(this.definedRulesNames,e)&&(i={message:l.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e},this.definitionErrors.push(i)),this.definedRulesNames.push(e);var i=this.defineRule(e,t,n);return this[e]=i},h.prototype.OVERRIDE_RULE=function(e,t,n){void 0===n&&(n=s.DEFAULT_RULE_CONFIG);var i=(0,c.validateRuleIsOverridden)(e,this.definedRulesNames,this.className),i=(this.definitionErrors=this.definitionErrors.concat(i),this.defineRule(e,t,n));return this[e]=i},h.prototype.BACKTRACK=function(n,i){return function(){this.isBackTrackingStack.push(1);var e=this.saveRecogState();try{return n.apply(this,i),!0}catch(t){if((0,a.isRecognitionException)(t))return!1;throw t}finally{this.reloadRecogState(e),this.isBackTrackingStack.pop()}}},h.prototype.getGAstProductions=function(){return this.gastProductionsCache},h.prototype.getSerializedGastProductions=function(){return(0,u.serializeGrammar)((0,r["default"])(this.gastProductionsCache))},t.RecognizerApi=h},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerEngine=void 0,i(n(8))),o=i(n(0)),a=i(n(16)),s=i(n(64)),l=i(n(99)),c=i(n(11)),u=i(n(7)),h=i(n(15)),d=i(n(23)),p=i(n(17)),f=n(109),m=n(43),g=n(42),y=n(68),b=n(5),v=n(246),x=n(26),I=n(27);function S(){}S.prototype.initRecognizerEngine=function(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=I.tokenStructuredMatcherNoCategories,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},(0,u["default"])(t,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if((0,o["default"])(e)){if((0,r["default"])(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if((0,o["default"])(e))this.tokensMap=(0,d["default"])(e,function(e,t){return e[t.name]=t,e},{});else if((0,u["default"])(e,"modes")&&(0,s["default"])((0,a["default"])((0,h["default"])(e.modes)),I.isTokenType)){t=(0,a["default"])((0,h["default"])(e.modes)),t=(0,l["default"])(t);this.tokensMap=(0,d["default"])(t,function(e,t){return e[t.name]=t,e},{})}else{if(!(0,c["default"])(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=(0,p["default"])(e)}this.tokensMap.EOF=x.EOF;t=(0,u["default"])(e,"modes")?(0,a["default"])((0,h["default"])(e.modes)):(0,h["default"])(e),e=(0,s["default"])(t,function(e){return(0,r["default"])(e.categoryMatches)});this.tokenMatcher=e?I.tokenStructuredMatcherNoCategories:I.tokenStructuredMatcher,(0,I.augmentTokenTypes)((0,h["default"])(this.tokensMap))},S.prototype.defineRule=function(r,o,e){if(this.selfAnalysisDone)throw Error("Grammar rule <".concat(r,"> may not be defined after the 'performSelfAnalysis' method has been called'\n")+"Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var a,s=((0,u["default"])(e,"resyncEnabled")?e:b.DEFAULT_RULE_CONFIG).resyncEnabled,l=((0,u["default"])(e,"recoveryValueFunc")?e:b.DEFAULT_RULE_CONFIG).recoveryValueFunc,c=this.ruleShortNameIdx<<f.BITS_FOR_METHOD_TYPE+f.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull[c]=r,this.fullRuleNameToShort[r]=c,a=!0===this.outputCst?function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{this.ruleInvocationStateUpdate(c,r,this.subruleIdx),o.apply(this,e);var n=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(n),n}catch(i){return this.invokeRuleCatch(i,s,l)}finally{this.ruleFinallyStateUpdate()}}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return this.ruleInvocationStateUpdate(c,r,this.subruleIdx),o.apply(this,e)}catch(n){return this.invokeRuleCatch(n,s,l)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:r,originalGrammarAction:o})},S.prototype.invokeRuleCatch=function(e,t,n){var i=1===this.RULE_STACK.length,t=t&&!this.isBackTracking()&&this.recoveryEnabled;if((0,m.isRecognitionException)(e)){var r=e;if(t){var o,t=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(t))return r.resyncedTokens=this.reSyncTo(t),this.outputCst?((o=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,o):n();this.outputCst&&((o=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,r.partialCstResult=o)}else if(i)return this.moveToTerminatedState(),n();throw r}throw e},S.prototype.optionInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.OPTION_IDX,t);return this.optionInternalLogic(e,t,n)},S.prototype.optionInternalLogic=function(e,t,n){var i,r,o,a=this,s=this.getLaFuncFromCache(n);return"function"!=typeof e?(i=e.DEF,(r=e.GATE)!==undefined&&(o=s,s=function s(){return r.call(a)&&o.call(a)})):i=e,!0===s.call(this)?i.call(this):undefined},S.prototype.atLeastOneInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.AT_LEAST_ONE_IDX,e);return this.atLeastOneInternalLogic(e,t,n)},S.prototype.atLeastOneInternalLogic=function(e,t,n){var i,r,o,a=this,s=this.getLaFuncFromCache(n);if("function"!=typeof t?(i=t.DEF,(r=t.GATE)!==undefined&&(o=s,s=function s(){return r.call(a)&&o.call(a)})):i=t,!0!==s.call(this))throw this.raiseEarlyExitException(e,g.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var l=this.doSingleRepetition(i);!0===s.call(this)&&!0===l;)l=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],s,f.AT_LEAST_ONE_IDX,e,y.NextTerminalAfterAtLeastOneWalker)},S.prototype.atLeastOneSepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,n)},S.prototype.atLeastOneSepFirstInternalLogic=function(e,t,n){var i=this,r=t.DEF,o=t.SEP;if(!0!==this.getLaFuncFromCache(n).call(this))throw this.raiseEarlyExitException(e,g.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);r.call(this);for(var a=function a(){return i.tokenMatcher(i.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,a,r,y.NextTerminalAfterAtLeastOneSepWalker],a,f.AT_LEAST_ONE_SEP_IDX,e,y.NextTerminalAfterAtLeastOneSepWalker)},S.prototype.manyInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.MANY_IDX,e);return this.manyInternalLogic(e,t,n)},S.prototype.manyInternalLogic=function(e,t,n){for(var i,r,o,a=this,s=this.getLaFuncFromCache(n),l=("function"!=typeof t?(i=t.DEF,(r=t.GATE)!==undefined&&(o=s,s=function s(){return r.call(a)&&o.call(a)})):i=t,!0);!0===s.call(this)&&!0===l;)l=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],s,f.MANY_IDX,e,y.NextTerminalAfterManyWalker,l)},S.prototype.manySepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,n)},S.prototype.manySepFirstInternalLogic=function(e,t,n){var i=this,r=t.DEF,o=t.SEP;if(!0===this.getLaFuncFromCache(n).call(this)){r.call(this);for(var a=function a(){return i.tokenMatcher(i.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,a,r,y.NextTerminalAfterManySepWalker],a,f.MANY_SEP_IDX,e,y.NextTerminalAfterManySepWalker)}},S.prototype.repetitionSepSecondInternal=function(e,t,n,i,r){for(;n();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,n,i,r],n,f.AT_LEAST_ONE_SEP_IDX,e,r)},S.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),t<this.getLexerPosition()},S.prototype.orInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.OR_IDX,t),i=(0,o["default"])(e)?e:e.DEF,n=this.getLaFuncFromCache(n).call(this,i);if(n!==undefined)return i[n].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},S.prototype.ruleFinallyStateUpdate=function(){var e,t;this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()&&(e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new m.NotAllInputParsedException(t,e)))},S.prototype.subruleInternal=function(e,t,n){var i;try{var r=n!==undefined?n.ARGS:undefined;return this.subruleIdx=t,i=e.apply(this,r),this.cstPostNonTerminal(i,n!==undefined&&n.LABEL!==undefined?n.LABEL:e.ruleName),i}catch(o){throw this.subruleInternalError(o,n,e.ruleName)}},S.prototype.subruleInternalError=function(e,t,n){throw(0,m.isRecognitionException)(e)&&e.partialCstResult!==undefined&&(this.cstPostNonTerminal(e.partialCstResult,t!==undefined&&t.LABEL!==undefined?t.LABEL:n),delete e.partialCstResult),e},S.prototype.consumeInternal=function(e,t,n){var i;try{var r=this.LA(1);!0===this.tokenMatcher(r,e)?(this.consumeToken(),i=r):this.consumeInternalError(e,r,n)}catch(o){i=this.consumeInternalRecovery(e,t,o)}return this.cstPostTerminal(n!==undefined&&n.LABEL!==undefined?n.LABEL:e.name,i),i},S.prototype.consumeInternalError=function(e,t,n){var i=this.LA(0),n=n!==undefined&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new m.MismatchedTokenException(n,t,i))},S.prototype.consumeInternalRecovery=function(e,t,n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;t=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,t)}catch(i){throw i.name===v.IN_RULE_RECOVERY_EXCEPTION?n:i}},S.prototype.saveRecogState=function(){var e=this.errors,t=(0,p["default"])(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}},S.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},S.prototype.ruleInvocationStateUpdate=function(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)},S.prototype.isBackTracking=function(){return 0!==this.isBackTrackingStack.length},S.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},S.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},S.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),x.EOF)},S.prototype.reset=function(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},t.RecognizerEngine=S},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorHandler=void 0,n(43)),r=i(n(7)),o=i(n(17)),l=n(42),a=n(5);function c(){}c.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=((0,r["default"])(e,"errorMessageProvider")?e:a.DEFAULT_PARSER_CONFIG).errorMessageProvider},c.prototype.SAVE_ERROR=function(e){if((0,s.isRecognitionException)(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:(0,o["default"])(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(c.prototype,"errors",{get:function(){return(0,o["default"])(this._errors)},set:function(e){this._errors=e},enumerable:!1,configurable:!0}),c.prototype.raiseEarlyExitException=function(e,t,n){for(var i=this.getCurrRuleFullName(),r=this.getGAstProductions()[i],e=(0,l.getLookaheadPathsForOptionalProd)(e,r,t,this.maxLookahead)[0],o=[],a=1;a<=this.maxLookahead;a++)o.push(this.LA(a));r=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:e,actual:o,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new s.EarlyExitException(r,this.LA(1),this.LA(0)))},c.prototype.raiseNoAltException=function(e,t){for(var n=this.getCurrRuleFullName(),n=this.getGAstProductions()[n],e=(0,l.getLookaheadPathsForOr)(e,n,this.maxLookahead),i=[],r=1;r<=this.maxLookahead;r++)i.push(this.LA(r));n=this.LA(0),e=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:e,actual:i,previous:n,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new s.NoViableAltException(e,this.LA(1),n))},t.ErrorHandler=c},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.ContentAssist=void 0,n(68)),o=i(n(40)),a=i(n(22));function s(){}s.prototype.initContentAssist=function(){},s.prototype.computeContentAssist=function(e,t){var n=this.gastProductionsCache[e];if((0,a["default"])(n))throw Error("Rule ->".concat(e,"<- does not exist in this grammar."));return(0,r.nextPossibleTokensAfter)([n],t,this.tokenMatcher,this.maxLookahead)},s.prototype.getNextPossibleTokenTypes=function(e){var t=(0,o["default"])(e.ruleStack),t=this.getGAstProductions()[t];return new r.NextAfterTokenWalker(t,e).startWalking()},t.ContentAssist=s},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.GastRecorder=void 0,i(n(107))),l=i(n(0)),c=i(n(96)),u=i(n(3)),h=i(n(30)),d=i(n(7)),p=n(2),i=n(65),r=n(27),o=n(26),a=n(5),n=n(109),f={description:"This Object indicates the Parser is during Recording Phase"},m=(Object.freeze(f),Math.pow(2,n.BITS_FOR_OCCURRENCE_IDX)-1),n=(0,o.createToken)({name:"RECORDING_PHASE_TOKEN",pattern:i.Lexer.NA}),g=((0,r.augmentTokenTypes)([n]),(0,o.createTokenInstance)(n,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1)),y=(Object.freeze(g),{name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}});function b(){}function v(e,t,n,i){void 0===i&&(i=!1),I(n);var r=(0,s["default"])(this.recordingProdStack),o=(0,h["default"])(t)?t:t.DEF,n=new e({definition:[],idx:n});return i&&(n.separator=t.SEP),(0,d["default"])(t,"MAX_LOOKAHEAD")&&(n.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(n),o.call(this),r.definition.push(n),this.recordingProdStack.pop(),f}function x(e){return 0===e?"":"".concat(e)}function I(e){if(e<0||m<e)throw(e=new Error("Invalid DSL Method idx value: <".concat(e,">\n\t")+"Idx value must be a none negative value smaller than ".concat(m+1))).KNOWN_RECORDER_ERROR=!0,e}b.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},b.prototype.enableRecording=function(){var i=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function t(n){var e=0<n?n:"";i["CONSUME".concat(e)]=function(e,t){return this.consumeInternalRecord(e,n,t)},i["SUBRULE".concat(e)]=function(e,t){return this.subruleInternalRecord(e,n,t)},i["OPTION".concat(e)]=function(e){return this.optionInternalRecord(e,n)},i["OR".concat(e)]=function(e){return this.orInternalRecord(e,n)},i["MANY".concat(e)]=function(e){this.manyInternalRecord(n,e)},i["MANY_SEP".concat(e)]=function(e){this.manySepFirstInternalRecord(n,e)},i["AT_LEAST_ONE".concat(e)]=function(e){this.atLeastOneInternalRecord(n,e)},i["AT_LEAST_ONE_SEP".concat(e)]=function(e){this.atLeastOneSepFirstInternalRecord(n,e)}},e=0;e<10;e++)t(e);i.consume=function(e,t,n){return this.consumeInternalRecord(t,e,n)},i.subrule=function(e,t,n){return this.subruleInternalRecord(t,e,n)},i.option=function(e,t){return this.optionInternalRecord(t,e)},i.or=function(e,t){return this.orInternalRecord(t,e)},i.many=function(e,t){this.manyInternalRecord(e,t)},i.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},i.ACTION=i.ACTION_RECORD,i.BACKTRACK=i.BACKTRACK_RECORD,i.LA=i.LA_RECORD})},b.prototype.disableRecording=function(){var i=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var e=i,t=0;t<10;t++){var n=0<t?t:"";delete e["CONSUME".concat(n)],delete e["SUBRULE".concat(n)],delete e["OPTION".concat(n)],delete e["OR".concat(n)],delete e["MANY".concat(n)],delete e["MANY_SEP".concat(n)],delete e["AT_LEAST_ONE".concat(n)],delete e["AT_LEAST_ONE_SEP".concat(n)]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},b.prototype.ACTION_RECORD=function(e){},b.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},b.prototype.LA_RECORD=function(e){return a.END_OF_FILE},b.prototype.topLevelRuleRecord=function(e,t){try{var n=new p.Rule({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),t.call(this),this.recordingProdStack.pop(),n}catch(i){if(!0!==i.KNOWN_RECORDER_ERROR)try{i.message=i.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(r){}throw i}},b.prototype.optionInternalRecord=function(e,t){return v.call(this,p.Option,e,t)},b.prototype.atLeastOneInternalRecord=function(e,t){v.call(this,p.RepetitionMandatory,t,e)},b.prototype.atLeastOneSepFirstInternalRecord=function(e,t){v.call(this,p.RepetitionMandatoryWithSeparator,t,e,!0)},b.prototype.manyInternalRecord=function(e,t){v.call(this,p.Repetition,t,e)},b.prototype.manySepFirstInternalRecord=function(e,t){v.call(this,p.RepetitionWithSeparator,t,e,!0)},b.prototype.orInternalRecord=function(e,t){return function(e,t){var n=this,i=(I(t),(0,s["default"])(this.recordingProdStack)),r=!1===(0,l["default"])(e),o=!1==r?e:e.DEF,a=new p.Alternation({definition:[],idx:t,ignoreAmbiguities:r&&!0===e.IGNORE_AMBIGUITIES});(0,d["default"])(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD);t=(0,c["default"])(o,function(e){return(0,h["default"])(e.GATE)});return a.hasPredicates=t,i.definition.push(a),(0,u["default"])(o,function(e){var t=new p.Alternative({definition:[]});a.definition.push(t),(0,d["default"])(e,"IGNORE_AMBIGUITIES")?t.ignoreAmbiguities=e.IGNORE_AMBIGUITIES:(0,d["default"])(e,"GATE")&&(t.ignoreAmbiguities=!0),n.recordingProdStack.push(t),e.ALT.call(n),n.recordingProdStack.pop()}),f}.call(this,e,t)},b.prototype.subruleInternalRecord=function(e,t,n){var i,r;if(I(t),e&&!1!==(0,d["default"])(e,"ruleName"))return i=(0,s["default"])(this.recordingProdStack),r=e.ruleName,r=new p.NonTerminal({idx:t,nonTerminalName:r,label:null==n?void 0:n.LABEL,referencedRule:undefined}),i.definition.push(r),this.outputCst?y:f;throw(n=new Error("<SUBRULE".concat(x(t),"> argument is invalid")+" expecting a Parser method reference but got: <".concat(JSON.stringify(e),">")+"\n inside top level rule: <".concat(this.recordingProdStack[0].name,">"))).KNOWN_RECORDER_ERROR=!0,n},b.prototype.consumeInternalRecord=function(e,t,n){var i;if(I(t),(0,r.hasShortKeyProperty)(e))return i=(0,s["default"])(this.recordingProdStack),n=new p.Terminal({idx:t,terminalType:e,label:null==n?void 0:n.LABEL}),i.definition.push(n),g;throw(n=new Error("<CONSUME".concat(x(t),"> argument is invalid")+" expecting a TokenType reference but got: <".concat(JSON.stringify(e),">")+"\n inside top level rule: <".concat(this.recordingProdStack[0].name,">"))).KNOWN_RECORDER_ERROR=!0,n},t.GastRecorder=b},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTracer=void 0,i(n(7))),a=n(37),o=n(5);function s(){}s.prototype.initPerformanceTracer=function(e){var t;(0,r["default"])(e,"traceInitPerf")?(e=e.traceInitPerf,this.traceInitMaxIdent=(t="number"==typeof e)?e:Infinity,this.traceInitPerf=t?0<e:e):(this.traceInitMaxIdent=0,this.traceInitPerf=o.DEFAULT_PARSER_CONFIG.traceInitPerf),this.traceInitIndent=-1},s.prototype.TRACE_INIT=function(e,t){var n,i,r,o;return!0===this.traceInitPerf?(this.traceInitIndent++,n=new Array(this.traceInitIndent+1).join("\t"),this.traceInitIndent<this.traceInitMaxIdent&&console.log("".concat(n,"--\x3e <").concat(e,">")),i=(r=(0,a.timer)(t)).time,r=r.value,o=10<i?console.warn:console.log,this.traceInitIndent<this.traceInitMaxIdent&&o("".concat(n,"<-- <").concat(e,"> time: ").concat(i,"ms")),this.traceInitIndent--,r):t()},t.PerformanceTracer=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=void 0,t.applyMixins=function(r,e){e.forEach(function(n){var i=n.prototype;Object.getOwnPropertyNames(i).forEach(function(e){var t;"constructor"!==e&&((t=Object.getOwnPropertyDescriptor(i,e))&&(t.get||t.set)?Object.defineProperty(r.prototype,e,t):r.prototype[e]=n.prototype[e])})})}},function(e,t,n){"use strict";var i=function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.generateCstDts=void 0,n(530)),o=n(531),a={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};t.generateCstDts=function(e,t){return t=i(i({},a),t),e=(0,r.buildModel)(e),(0,o.genDts)(e,t)}},function(e,t,n){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||(i({},[])instanceof Array?function(e,t){for(var n=e,i=t,r=Object.getOwnPropertyNames(i),o=0;o<r.length;o++){var a=r[o],s=Object.getOwnPropertyDescriptor(i,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var r,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.buildModel=void 0,n(2)),l=a(n(4)),c=a(n(16)),u=a(n(15)),h=a(n(96)),d=a(n(244)),p=a(n(62));t.buildModel=function(e){var t=new m,e=(0,u["default"])(e);return(0,l["default"])(e,function(e){return t.visitRule(e)})};f=s.GAstVisitor,o(g,f),g.prototype.visitRule=function(e){var t=this.visitEach(e.definition),t=(0,d["default"])(t,function(e){return e.propertyName}),t=(0,l["default"])(t,function(e,t){var n=!(0,h["default"])(e,function(e){return!e.canBeNull}),i=e[0].type;return{name:t,type:i=1<e.length?(0,l["default"])(e,function(e){return e.type}):i,optional:n}});return{name:e.name,properties:t}},g.prototype.visitAlternative=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitOption=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitRepetition=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitRepetitionMandatory=function(e){return this.visitEach(e.definition)},g.prototype.visitRepetitionMandatoryWithSeparator=function(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:y(e.separator)})},g.prototype.visitRepetitionWithSeparator=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:y(e.separator)})},g.prototype.visitAlternation=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitTerminal=function(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:y(e)}]},g.prototype.visitNonTerminal=function(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:y(e)}]},g.prototype.visitEachAndOverrideWith=function(e,t){return(0,l["default"])(this.visitEach(e),function(e){return(0,p["default"])({},e,t)})},g.prototype.visitEach=function(e){var t=this;return(0,c["default"])((0,l["default"])(e,function(e){return t.visit(e)}))};var f,m=g;function g(){return null!==f&&f.apply(this,arguments)||this}function y(e){return e instanceof s.NonTerminal?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}},function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=(Object.defineProperty(t,"__esModule",{value:!0}),t.genDts=void 0,i(n(16))),o=i(n(0)),a=i(n(4)),s=i(n(23)),l=i(n(99)),c=i(n(532));function u(e){return"token"===e.kind?"IToken":h(e.name)}function h(e){return(0,c["default"])(e)+"CstNode"}function d(e){return(0,c["default"])(e)+"CstChildren"}t.genDts=function(e,t){var n=[];return n=(n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";')).concat((0,r["default"])((0,a["default"])(e,function(e){return t=function(e){var t=h(e.name),n=d(e.name);return"export interface ".concat(t,' extends CstNode {\n  name: "').concat(e.name,'";\n  children: ').concat(n,";\n}")}(e=e),e=function(e){var t=d(e.name);return"export type ".concat(t," = {\n  ").concat((0,a["default"])(e.properties,function(e){return t=function(e){{var t;return(0,o["default"])(e)?(t=(0,l["default"])((0,a["default"])(e,u)),"("+(0,s["default"])(t,function(e,t){return e+" | "+t})+")"):u(e)}}((e=e).type),"".concat(e.name).concat(e.optional?"?":"",": ").concat(t,"[];");var t}).join("\n  "),"\n};")}(e),[t,e];var t}))),(n=t.includeVisitorInterface?n.concat((t=t.visitorInterfaceName,e=e,"export interface ".concat(t,"<IN, OUT> extends ICstVisitor<IN, OUT> {\n  ").concat((0,a["default"])(e,function(e){return t=d((e=e).name),"".concat(e.name,"(children: ").concat(t,", param?: IN): OUT;");var t}).join("\n  "),"\n}"))):n).join("\n\n")+"\n"}},function(e,t,n){"use strict";n=n(533)("toUpperCase");e.exports=n},function(e,t,n){"use strict";var r=n(534),o=n(110),a=n(535),s=n(224);e.exports=function(i){return function(e){e=s(e);var t=o(e)?a(e):undefined,n=t?t[0]:e.charAt(0),t=t?r(t,1).join(""):e.slice(1);return n[i]()+t}}},function(e,t,n){"use strict";var r=n(93);e.exports=function(e,t,n){var i=e.length;return n=n===undefined?i:n,!t&&i<=n?e:r(e,t,n)}},function(e,t,n){"use strict";var i=n(536),r=n(110),o=n(537);e.exports=function(e){return(r(e)?o:i)(e)}},function(e,t,n){"use strict";e.exports=function(e){return e.split("")}},function(e,t,n){"use strict";var i="\\ud800-\\udfff",r="["+i+"]",o="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",a="\\ud83c[\\udffb-\\udfff]",i="[^"+i+"]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",u="[\\ufe0e\\ufe0f]?",u=u+c+("(?:\\u200d(?:"+[i,s,l].join("|")+")"+u+c+")*"),c="(?:"+[i+o+"?",o,s,l,r].join("|")+")",h=RegExp(a+"(?="+a+")|"+c+u,"g");e.exports=function(e){return e.match(h)||[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSyntaxDiagramsCode=void 0;var i=n(209);t.createSyntaxDiagramsCode=function(e,t){var n=void 0===(n=(t=void 0===t?{}:t).resourceBase)?"https://unpkg.com/chevrotain@".concat(i.VERSION,"/diagrams/"):n,t=void 0===(t=t.css)?"https://unpkg.com/chevrotain@".concat(i.VERSION,"/diagrams/diagrams.css"):t;return'\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset="utf-8">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n'+"\n<link rel='stylesheet' href='".concat(t,"'>\n")+"\n<script src='".concat(n,"vendor/railroad-diagrams.js'><\/script>\n<script src='").concat(n,"src/diagrams_builder.js'><\/script>\n<script src='").concat(n,"src/diagrams_behavior.js'><\/script>\n<script src='").concat(n,"src/main.js'><\/script>\n")+'\n<div id="diagrams" align="center"></div>    \n'+"\n<script>\n    window.serializedGrammar = ".concat(JSON.stringify(e,null,"  "),";\n<\/script>\n")+'\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,n){"use strict";var i=n(74),r=n(24),o=n(9),a=n(39),s=n(540);e.exports=function(e){var t;return null==e?0:o(e)?a(e)?s(e):e.length:"[object Map]"==(t=r(e))||"[object Set]"==t?e.size:i(e).length}},function(e,t,n){"use strict";var i=n(541),r=n(110),o=n(542);e.exports=function(e){return(r(e)?o:i)(e)}},function(e,t,n){"use strict";n=n(226)("length");e.exports=n},function(e,t,n){"use strict";var i="\\ud800-\\udfff",r="["+i+"]",o="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",a="\\ud83c[\\udffb-\\udfff]",i="[^"+i+"]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",u="[\\ufe0e\\ufe0f]?",u=u+c+("(?:\\u200d(?:"+[i,s,l].join("|")+")"+u+c+")*"),c="(?:"+[i+o+"?",o,s,l,r].join("|")+")",h=RegExp(a+"(?="+a+")|"+c+u,"g");e.exports=function(e){for(var t=h.lastIndex=0;h.test(e);)++t;return t}},function(e,t){e.exports='// Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the "License");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an "AS IS" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n// ┌────────────────────────────────────────────────────────────┐ \\\\\n// │ Eve 0.4.2 - JavaScript Events Library                      │ \\\\\n// ├────────────────────────────────────────────────────────────┤ \\\\\n// │ Author Dmitry Baranovskiy (http://dmitry.baranovskiy.com/) │ \\\\\n// └────────────────────────────────────────────────────────────┘ \\\\\n(function (glob, factory) {\n    if (typeof define === "function" && define.amd) {\n        define("eve", function() {\n            return factory();\n        });\n    } else if (typeof exports === "object") {\n        module.exports = factory();\n    } else {\n        glob.eve = factory();\n    }\n}(this, function(){\n    var version = "0.4.2",\n        has = "hasOwnProperty",\n        separator = /[\\.\\/]/,\n        wildcard = "*",\n        fun = function () {},\n        numsort = function (a, b) {\n            return a - b;\n        },\n        current_event,\n        stop,\n        events = {n: {}},\n    /*\\\n     * eve\n     [ method ]\n\n     * Fires event with given `name`, given scope and other parameters.\n\n     > Arguments\n\n     - name (string) name of the *event*, dot (`.`) or slash (`/`) separated\n     - scope (object) context for the event handlers\n     - varargs (...) the rest of arguments will be sent to event handlers\n\n     = (object) array of returned values from the listeners\n     \\*/\n        eve = function (name, scope) {\n            name = String(name);\n            var e = events,\n                oldstop = stop,\n                args = Array.prototype.slice.call(arguments, 2),\n                listeners = eve.listeners(name),\n                z = 0,\n                f = false,\n                l,\n                indexed = [],\n                queue = {},\n                out = [],\n                ce = current_event,\n                errors = [];\n            current_event = name;\n            stop = 0;\n            for (var i = 0, ii = listeners.length; i < ii; i++) if ("zIndex" in listeners[i]) {\n                indexed.push(listeners[i].zIndex);\n                if (listeners[i].zIndex < 0) {\n                    queue[listeners[i].zIndex] = listeners[i];\n                }\n            }\n            indexed.sort(numsort);\n            while (indexed[z] < 0) {\n                l = queue[indexed[z++]];\n                out.push(l.apply(scope, args));\n                if (stop) {\n                    stop = oldstop;\n                    return out;\n                }\n            }\n            for (i = 0; i < ii; i++) {\n                l = listeners[i];\n                if ("zIndex" in l) {\n                    if (l.zIndex == indexed[z]) {\n                        out.push(l.apply(scope, args));\n                        if (stop) {\n                            break;\n                        }\n                        do {\n                            z++;\n                            l = queue[indexed[z]];\n                            l && out.push(l.apply(scope, args));\n                            if (stop) {\n                                break;\n                            }\n                        } while (l)\n                    } else {\n                        queue[l.zIndex] = l;\n                    }\n                } else {\n                    out.push(l.apply(scope, args));\n                    if (stop) {\n                        break;\n                    }\n                }\n            }\n            stop = oldstop;\n            current_event = ce;\n            return out.length ? out : null;\n        };\n    // Undocumented. Debug only.\n    eve._events = events;\n    /*\\\n     * eve.listeners\n     [ method ]\n\n     * Internal method which gives you array of all event handlers that will be triggered by the given `name`.\n\n     > Arguments\n\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated\n\n     = (array) array of event handlers\n     \\*/\n    eve.listeners = function (name) {\n        var names = name.split(separator),\n            e = events,\n            item,\n            items,\n            k,\n            i,\n            ii,\n            j,\n            jj,\n            nes,\n            es = [e],\n            out = [];\n        for (i = 0, ii = names.length; i < ii; i++) {\n            nes = [];\n            for (j = 0, jj = es.length; j < jj; j++) {\n                e = es[j].n;\n                items = [e[names[i]], e[wildcard]];\n                k = 2;\n                while (k--) {\n                    item = items[k];\n                    if (item) {\n                        nes.push(item);\n                        out = out.concat(item.f || []);\n                    }\n                }\n            }\n            es = nes;\n        }\n        return out;\n    };\n\n    /*\\\n     * eve.on\n     [ method ]\n     **\n     * Binds given event handler with a given name. You can use wildcards “`*`” for the names:\n     | eve.on("*.under.*", f);\n     | eve("mouse.under.floor"); // triggers f\n     * Use @eve to trigger the listener.\n     **\n     > Arguments\n     **\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated, with optional wildcards\n     - f (function) event handler function\n     **\n     = (function) returned function accepts a single numeric parameter that represents z-index of the handler. It is an optional feature and only used when you need to ensure that some subset of handlers will be invoked in a given order, despite of the order of assignment.\n     > Example:\n     | eve.on("mouse", eatIt)(2);\n     | eve.on("mouse", scream);\n     | eve.on("mouse", catchIt)(1);\n     * This will ensure that `catchIt()` function will be called before `eatIt()`.\n     *\n     * If you want to put your handler before non-indexed handlers, specify a negative value.\n     * Note: I assume most of the time you don’t need to worry about z-index, but it’s nice to have this feature “just in case”.\n     \\*/\n    eve.on = function (name, f) {\n        name = String(name);\n        if (typeof f != "function") {\n            return function () {};\n        }\n        var names = name.split(separator),\n            e = events;\n        for (var i = 0, ii = names.length; i < ii; i++) {\n            e = e.n;\n            e = e.hasOwnProperty(names[i]) && e[names[i]] || (e[names[i]] = {n: {}});\n        }\n        e.f = e.f || [];\n        for (i = 0, ii = e.f.length; i < ii; i++) if (e.f[i] == f) {\n            return fun;\n        }\n        e.f.push(f);\n        return function (zIndex) {\n            if (+zIndex == +zIndex) {\n                f.zIndex = +zIndex;\n            }\n        };\n    };\n    /*\\\n     * eve.f\n     [ method ]\n     **\n     * Returns function that will fire given event with optional arguments.\n     * Arguments that will be passed to the result function will be also\n     * concated to the list of final arguments.\n     | el.onclick = eve.f("click", 1, 2);\n     | eve.on("click", function (a, b, c) {\n     |     console.log(a, b, c); // 1, 2, [event object]\n     | });\n     > Arguments\n     - event (string) event name\n     - varargs (…) and any other arguments\n     = (function) possible event handler function\n     \\*/\n    eve.f = function (event) {\n        var attrs = [].slice.call(arguments, 1);\n        return function () {\n            eve.apply(null, [event, null].concat(attrs).concat([].slice.call(arguments, 0)));\n        };\n    };\n    /*\\\n     * eve.stop\n     [ method ]\n     **\n     * Is used inside an event handler to stop the event, preventing any subsequent listeners from firing.\n     \\*/\n    eve.stop = function () {\n        stop = 1;\n    };\n    /*\\\n     * eve.nt\n     [ method ]\n     **\n     * Could be used inside event handler to figure out actual name of the event.\n     **\n     > Arguments\n     **\n     - subname (string) #optional subname of the event\n     **\n     = (string) name of the event, if `subname` is not specified\n     * or\n     = (boolean) `true`, if current event’s name contains `subname`\n     \\*/\n    eve.nt = function (subname) {\n        if (subname) {\n            return new RegExp("(?:\\\\.|\\\\/|^)" + subname + "(?:\\\\.|\\\\/|$)").test(current_event);\n        }\n        return current_event;\n    };\n    /*\\\n     * eve.nts\n     [ method ]\n     **\n     * Could be used inside event handler to figure out actual name of the event.\n     **\n     **\n     = (array) names of the event\n     \\*/\n    eve.nts = function () {\n        return current_event.split(separator);\n    };\n    /*\\\n     * eve.off\n     [ method ]\n     **\n     * Removes given function from the list of event listeners assigned to given name.\n     * If no arguments specified all the events will be cleared.\n     **\n     > Arguments\n     **\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated, with optional wildcards\n     - f (function) event handler function\n     \\*/\n    /*\\\n     * eve.unbind\n     [ method ]\n     **\n     * See @eve.off\n     \\*/\n    eve.off = eve.unbind = function (name, f) {\n        if (!name) {\n            eve._events = events = {n: {}};\n            return;\n        }\n        var names = name.split(separator),\n            e,\n            key,\n            splice,\n            i, ii, j, jj,\n            cur = [events];\n        for (i = 0, ii = names.length; i < ii; i++) {\n            for (j = 0; j < cur.length; j += splice.length - 2) {\n                splice = [j, 1];\n                e = cur[j].n;\n                if (names[i] != wildcard) {\n                    if (e[names[i]]) {\n                        splice.push(e[names[i]]);\n                    }\n                } else {\n                    for (key in e) if (e[has](key)) {\n                        splice.push(e[key]);\n                    }\n                }\n                cur.splice.apply(cur, splice);\n            }\n        }\n        for (i = 0, ii = cur.length; i < ii; i++) {\n            e = cur[i];\n            while (e.n) {\n                if (f) {\n                    if (e.f) {\n                        for (j = 0, jj = e.f.length; j < jj; j++) if (e.f[j] == f) {\n                            e.f.splice(j, 1);\n                            break;\n                        }\n                        !e.f.length && delete e.f;\n                    }\n                    for (key in e.n) if (e.n[has](key) && e.n[key].f) {\n                        var funcs = e.n[key].f;\n                        for (j = 0, jj = funcs.length; j < jj; j++) if (funcs[j] == f) {\n                            funcs.splice(j, 1);\n                            break;\n                        }\n                        !funcs.length && delete e.n[key].f;\n                    }\n                } else {\n                    delete e.f;\n                    for (key in e.n) if (e.n[has](key) && e.n[key].f) {\n                        delete e.n[key].f;\n                    }\n                }\n                e = e.n;\n            }\n        }\n    };\n    /*\\\n     * eve.once\n     [ method ]\n     **\n     * Binds given event handler with a given name to only run once then unbind itself.\n     | eve.once("login", f);\n     | eve("login"); // triggers f\n     | eve("login"); // no listeners\n     * Use @eve to trigger the listener.\n     **\n     > Arguments\n     **\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated, with optional wildcards\n     - f (function) event handler function\n     **\n     = (function) same return function as @eve.on\n     \\*/\n    eve.once = function (name, f) {\n        var f2 = function () {\n            eve.unbind(name, f2);\n            return f.apply(this, arguments);\n        };\n        return eve.on(name, f2);\n    };\n    /*\\\n     * eve.version\n     [ property (string) ]\n     **\n     * Current version of the library.\n     \\*/\n    eve.version = version;\n    eve.toString = function () {\n        return "You are running Eve " + version;\n    };\n\n    return eve;\n}));\n\n// ┌────────────────────────────────────────────────────────────────────┐ \\\\\n// │ Raphaël 2.1.4 - JavaScript Vector Library                      │ \\\\\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\n// │ Core Module                                                        │ \\\\\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\\\\n// └────────────────────────────────────────────────────────────────────┘ \\\\\n\n(function (glob, factory) {\n    if (typeof define === "function" && define.amd) {\n        define("raphael.core", ["eve"], function(eve) {\n            return factory(eve);\n        });\n    } else if (typeof exports === "object") {\n        module.exports = factory(require("eve"));\n    } else {\n        glob.Raphael = factory(glob.eve);\n    }\n}(this, function (eve) {\n    /*\\\n     * Raphael\n     [ method ]\n     **\n     * Creates a canvas object on which to draw.\n     * You must do this first, as all future calls to drawing methods\n     * from this instance will be bound to this canvas.\n     > Parameters\n     **\n     - container (HTMLElement|string) DOM element or its ID which is going to be a parent for drawing surface\n     - width (number)\n     - height (number)\n     - callback (function) #optional callback function which is going to be executed in the context of newly created paper\n     * or\n     - x (number)\n     - y (number)\n     - width (number)\n     - height (number)\n     - callback (function) #optional callback function which is going to be executed in the context of newly created paper\n     * or\n     - all (array) (first 3 or 4 elements in the array are equal to [containerID, width, height] or [x, y, width, height]. The rest are element descriptions in format {type: type, <attributes>}). See @Paper.add.\n     - callback (function) #optional callback function which is going to be executed in the context of newly created paper\n     * or\n     - onReadyCallback (function) function that is going to be called on DOM ready event. You can also subscribe to this event via Eve’s “DOMLoad” event. In this case method returns `undefined`.\n     = (object) @Paper\n     > Usage\n     | // Each of the following examples create a canvas\n     | // that is 320px wide by 200px high.\n     | // Canvas is created at the viewport’s 10,50 coordinate.\n     | var paper = Raphael(10, 50, 320, 200);\n     | // Canvas is created at the top left corner of the #notepad element\n     | // (or its top right corner in dir="rtl" elements)\n     | var paper = Raphael(document.getElementById("notepad"), 320, 200);\n     | // Same as above\n     | var paper = Raphael("notepad", 320, 200);\n     | // Image dump\n     | var set = Raphael(["notepad", 320, 200, {\n     |     type: "rect",\n     |     x: 10,\n     |     y: 10,\n     |     width: 25,\n     |     height: 25,\n     |     stroke: "#f00"\n     | }, {\n     |     type: "text",\n     |     x: 30,\n     |     y: 40,\n     |     text: "Dump"\n     | }]);\n     \\*/\n    function R(first) {\n        if (R.is(first, "function")) {\n            return loaded ? first() : eve.on("raphael.DOMload", first);\n        } else if (R.is(first, array)) {\n            return R._engine.create[apply](R, first.splice(0, 3 + R.is(first[0], nu))).add(first);\n        } else {\n            var args = Array.prototype.slice.call(arguments, 0);\n            if (R.is(args[args.length - 1], "function")) {\n                var f = args.pop();\n                return loaded ? f.call(R._engine.create[apply](R, args)) : eve.on("raphael.DOMload", function () {\n                    f.call(R._engine.create[apply](R, args));\n                });\n            } else {\n                return R._engine.create[apply](R, arguments);\n            }\n        }\n    }\n    R.version = "2.1.4";\n    R.eve = eve;\n    var loaded,\n        separator = /[, ]+/,\n        elements = {circle: 1, rect: 1, path: 1, ellipse: 1, text: 1, image: 1},\n        formatrg = /\\{(\\d+)\\}/g,\n        proto = "prototype",\n        has = "hasOwnProperty",\n        g = {\n            doc: document,\n            win: window\n        },\n        oldRaphael = {\n            was: Object.prototype[has].call(g.win, "Raphael"),\n            is: g.win.Raphael\n        },\n        Paper = function () {\n            /*\\\n             * Paper.ca\n             [ property (object) ]\n             **\n             * Shortcut for @Paper.customAttributes\n             \\*/\n            /*\\\n             * Paper.customAttributes\n             [ property (object) ]\n             **\n             * If you have a set of attributes that you would like to represent\n             * as a function of some number you can do it easily with custom attributes:\n             > Usage\n             | paper.customAttributes.hue = function (num) {\n             |     num = num % 1;\n             |     return {fill: "hsb(" + num + ", 0.75, 1)"};\n             | };\n             | // Custom attribute “hue” will change fill\n             | // to be given hue with fixed saturation and brightness.\n             | // Now you can use it like this:\n             | var c = paper.circle(10, 10, 10).attr({hue: .45});\n             | // or even like this:\n             | c.animate({hue: 1}, 1e3);\n             |\n             | // You could also create custom attribute\n             | // with multiple parameters:\n             | paper.customAttributes.hsb = function (h, s, b) {\n             |     return {fill: "hsb(" + [h, s, b].join(",") + ")"};\n             | };\n             | c.attr({hsb: "0.5 .8 1"});\n             | c.animate({hsb: [1, 0, 0.5]}, 1e3);\n             \\*/\n            this.ca = this.customAttributes = {};\n        },\n        paperproto,\n        appendChild = "appendChild",\n        apply = "apply",\n        concat = "concat",\n        supportsTouch = (\'ontouchstart\' in g.win) || g.win.DocumentTouch && g.doc instanceof DocumentTouch, //taken from Modernizr touch test\n        E = "",\n        S = " ",\n        Str = String,\n        split = "split",\n        events = "click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),\n        touchMap = {\n            mousedown: "touchstart",\n            mousemove: "touchmove",\n            mouseup: "touchend"\n        },\n        lowerCase = Str.prototype.toLowerCase,\n        math = Math,\n        mmax = math.max,\n        mmin = math.min,\n        abs = math.abs,\n        pow = math.pow,\n        PI = math.PI,\n        nu = "number",\n        string = "string",\n        array = "array",\n        toString = "toString",\n        fillString = "fill",\n        objectToString = Object.prototype.toString,\n        paper = {},\n        push = "push",\n        ISURL = R._ISURL = /^url\\([\'"]?(.+?)[\'"]?\\)$/i,\n        colourRegExp = /^\\s*((#[a-f\\d]{6})|(#[a-f\\d]{3})|rgba?\\(\\s*([\\d\\.]+%?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+%?(?:\\s*,\\s*[\\d\\.]+%?)?)\\s*\\)|hsba?\\(\\s*([\\d\\.]+(?:deg|\\xb0|%)?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\)|hsla?\\(\\s*([\\d\\.]+(?:deg|\\xb0|%)?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\))\\s*$/i,\n        isnan = {"NaN": 1, "Infinity": 1, "-Infinity": 1},\n        bezierrg = /^(?:cubic-)?bezier\\(([^,]+),([^,]+),([^,]+),([^\\)]+)\\)/,\n        round = math.round,\n        setAttribute = "setAttribute",\n        toFloat = parseFloat,\n        toInt = parseInt,\n        upperCase = Str.prototype.toUpperCase,\n        availableAttrs = R._availableAttrs = {\n            "arrow-end": "none",\n            "arrow-start": "none",\n            blur: 0,\n            "clip-rect": "0 0 1e9 1e9",\n            cursor: "default",\n            cx: 0,\n            cy: 0,\n            fill: "#fff",\n            "fill-opacity": 1,\n            font: \'10px "Arial"\',\n            "font-family": \'"Arial"\',\n            "font-size": "10",\n            "font-style": "normal",\n            "font-weight": 400,\n            gradient: 0,\n            height: 0,\n            href: "http://raphaeljs.com/",\n            "letter-spacing": 0,\n            opacity: 1,\n            path: "M0,0",\n            r: 0,\n            rx: 0,\n            ry: 0,\n            src: "",\n            stroke: "#000",\n            "stroke-dasharray": "",\n            "stroke-linecap": "butt",\n            "stroke-linejoin": "butt",\n            "stroke-miterlimit": 0,\n            "stroke-opacity": 1,\n            "stroke-width": 1,\n            target: "_blank",\n            "text-anchor": "middle",\n            title: "Raphael",\n            transform: "",\n            width: 0,\n            x: 0,\n            y: 0\n        },\n        availableAnimAttrs = R._availableAnimAttrs = {\n            blur: nu,\n            "clip-rect": "csv",\n            cx: nu,\n            cy: nu,\n            fill: "colour",\n            "fill-opacity": nu,\n            "font-size": nu,\n            height: nu,\n            opacity: nu,\n            path: "path",\n            r: nu,\n            rx: nu,\n            ry: nu,\n            stroke: "colour",\n            "stroke-opacity": nu,\n            "stroke-width": nu,\n            transform: "transform",\n            width: nu,\n            x: nu,\n            y: nu\n        },\n        whitespace = /[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]/g,\n        commaSpaces = /[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*/,\n        hsrg = {hs: 1, rg: 1},\n        p2s = /,?([achlmqrstvxz]),?/gi,\n        pathCommand = /([achlmrqstvz])[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029,]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*)+)/ig,\n        tCommand = /([rstm])[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029,]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*)+)/ig,\n        pathValues = /(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*/ig,\n        radial_gradient = R._radial_gradient = /^r(?:\\(([^,]+?)[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*([^\\)]+?)\\))?/,\n        eldata = {},\n        sortByKey = function (a, b) {\n            return a.key - b.key;\n        },\n        sortByNumber = function (a, b) {\n            return toFloat(a) - toFloat(b);\n        },\n        fun = function () {},\n        pipe = function (x) {\n            return x;\n        },\n        rectPath = R._rectPath = function (x, y, w, h, r) {\n            if (r) {\n                return [["M", x + r, y], ["l", w - r * 2, 0], ["a", r, r, 0, 0, 1, r, r], ["l", 0, h - r * 2], ["a", r, r, 0, 0, 1, -r, r], ["l", r * 2 - w, 0], ["a", r, r, 0, 0, 1, -r, -r], ["l", 0, r * 2 - h], ["a", r, r, 0, 0, 1, r, -r], ["z"]];\n            }\n            return [["M", x, y], ["l", w, 0], ["l", 0, h], ["l", -w, 0], ["z"]];\n        },\n        ellipsePath = function (x, y, rx, ry) {\n            if (ry == null) {\n                ry = rx;\n            }\n            return [["M", x, y], ["m", 0, -ry], ["a", rx, ry, 0, 1, 1, 0, 2 * ry], ["a", rx, ry, 0, 1, 1, 0, -2 * ry], ["z"]];\n        },\n        getPath = R._getPath = {\n            path: function (el) {\n                return el.attr("path");\n            },\n            circle: function (el) {\n                var a = el.attrs;\n                return ellipsePath(a.cx, a.cy, a.r);\n            },\n            ellipse: function (el) {\n                var a = el.attrs;\n                return ellipsePath(a.cx, a.cy, a.rx, a.ry);\n            },\n            rect: function (el) {\n                var a = el.attrs;\n                return rectPath(a.x, a.y, a.width, a.height, a.r);\n            },\n            image: function (el) {\n                var a = el.attrs;\n                return rectPath(a.x, a.y, a.width, a.height);\n            },\n            text: function (el) {\n                var bbox = el._getBBox();\n                return rectPath(bbox.x, bbox.y, bbox.width, bbox.height);\n            },\n            set : function(el) {\n                var bbox = el._getBBox();\n                return rectPath(bbox.x, bbox.y, bbox.width, bbox.height);\n            }\n        },\n    /*\\\n     * Raphael.mapPath\n     [ method ]\n     **\n     * Transform the path string with given matrix.\n     > Parameters\n     - path (string) path string\n     - matrix (object) see @Matrix\n     = (string) transformed path string\n     \\*/\n        mapPath = R.mapPath = function (path, matrix) {\n            if (!matrix) {\n                return path;\n            }\n            var x, y, i, j, ii, jj, pathi;\n            path = path2curve(path);\n            for (i = 0, ii = path.length; i < ii; i++) {\n                pathi = path[i];\n                for (j = 1, jj = pathi.length; j < jj; j += 2) {\n                    x = matrix.x(pathi[j], pathi[j + 1]);\n                    y = matrix.y(pathi[j], pathi[j + 1]);\n                    pathi[j] = x;\n                    pathi[j + 1] = y;\n                }\n            }\n            return path;\n        };\n\n    R._g = g;\n    /*\\\n     * Raphael.type\n     [ property (string) ]\n     **\n     * Can be “SVG”, “VML” or empty, depending on browser support.\n     \\*/\n    R.type = (g.win.SVGAngle || g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") ? "SVG" : "VML");\n    if (R.type == "VML") {\n        var d = g.doc.createElement("div"),\n            b;\n        d.innerHTML = \'<v:shape adj="1"/>\';\n        b = d.firstChild;\n        b.style.behavior = "url(#default#VML)";\n        if (!(b && typeof b.adj == "object")) {\n            return (R.type = E);\n        }\n        d = null;\n    }\n    /*\\\n     * Raphael.svg\n     [ property (boolean) ]\n     **\n     * `true` if browser supports SVG.\n     \\*/\n    /*\\\n     * Raphael.vml\n     [ property (boolean) ]\n     **\n     * `true` if browser supports VML.\n     \\*/\n    R.svg = !(R.vml = R.type == "VML");\n    R._Paper = Paper;\n    /*\\\n     * Raphael.fn\n     [ property (object) ]\n     **\n     * You can add your own method to the canvas. For example if you want to draw a pie chart,\n     * you can create your own pie chart function and ship it as a Raphaël plugin. To do this\n     * you need to extend the `Raphael.fn` object. You should modify the `fn` object before a\n     * Raphaël instance is created, otherwise it will take no effect. Please note that the\n     * ability for namespaced plugins was removed in Raphael 2.0. It is up to the plugin to\n     * ensure any namespacing ensures proper context.\n     > Usage\n     | Raphael.fn.arrow = function (x1, y1, x2, y2, size) {\n     |     return this.path( ... );\n     | };\n     | // or create namespace\n     | Raphael.fn.mystuff = {\n     |     arrow: function () {…},\n     |     star: function () {…},\n     |     // etc…\n     | };\n     | var paper = Raphael(10, 10, 630, 480);\n     | // then use it\n     | paper.arrow(10, 10, 30, 30, 5).attr({fill: "#f00"});\n     | paper.mystuff.arrow();\n     | paper.mystuff.star();\n     \\*/\n    R.fn = paperproto = Paper.prototype = R.prototype;\n    R._id = 0;\n    R._oid = 0;\n    /*\\\n     * Raphael.is\n     [ method ]\n     **\n     * Handful of replacements for `typeof` operator.\n     > Parameters\n     - o (…) any object or primitive\n     - type (string) name of the type, i.e. “string”, “function”, “number”, etc.\n     = (boolean) is given value is of given type\n     \\*/\n    R.is = function (o, type) {\n        type = lowerCase.call(type);\n        if (type == "finite") {\n            return !isnan[has](+o);\n        }\n        if (type == "array") {\n            return o instanceof Array;\n        }\n        return  (type == "null" && o === null) ||\n            (type == typeof o && o !== null) ||\n            (type == "object" && o === Object(o)) ||\n            (type == "array" && Array.isArray && Array.isArray(o)) ||\n            objectToString.call(o).slice(8, -1).toLowerCase() == type;\n    };\n\n    function clone(obj) {\n        if (typeof obj == "function" || Object(obj) !== obj) {\n            return obj;\n        }\n        var res = new obj.constructor;\n        for (var key in obj) if (obj[has](key)) {\n            res[key] = clone(obj[key]);\n        }\n        return res;\n    }\n\n    /*\\\n     * Raphael.angle\n     [ method ]\n     **\n     * Returns angle between two or three points\n     > Parameters\n     - x1 (number) x coord of first point\n     - y1 (number) y coord of first point\n     - x2 (number) x coord of second point\n     - y2 (number) y coord of second point\n     - x3 (number) #optional x coord of third point\n     - y3 (number) #optional y coord of third point\n     = (number) angle in degrees.\n     \\*/\n    R.angle = function (x1, y1, x2, y2, x3, y3) {\n        if (x3 == null) {\n            var x = x1 - x2,\n                y = y1 - y2;\n            if (!x && !y) {\n                return 0;\n            }\n            return (180 + math.atan2(-y, -x) * 180 / PI + 360) % 360;\n        } else {\n            return R.angle(x1, y1, x3, y3) - R.angle(x2, y2, x3, y3);\n        }\n    };\n    /*\\\n     * Raphael.rad\n     [ method ]\n     **\n     * Transform angle to radians\n     > Parameters\n     - deg (number) angle in degrees\n     = (number) angle in radians.\n     \\*/\n    R.rad = function (deg) {\n        return deg % 360 * PI / 180;\n    };\n    /*\\\n     * Raphael.deg\n     [ method ]\n     **\n     * Transform angle to degrees\n     > Parameters\n     - rad (number) angle in radians\n     = (number) angle in degrees.\n     \\*/\n    R.deg = function (rad) {\n        return Math.round ((rad * 180 / PI% 360)* 1000) / 1000;\n    };\n    /*\\\n     * Raphael.snapTo\n     [ method ]\n     **\n     * Snaps given value to given grid.\n     > Parameters\n     - values (array|number) given array of values or step of the grid\n     - value (number) value to adjust\n     - tolerance (number) #optional tolerance for snapping. Default is `10`.\n     = (number) adjusted value.\n     \\*/\n    R.snapTo = function (values, value, tolerance) {\n        tolerance = R.is(tolerance, "finite") ? tolerance : 10;\n        if (R.is(values, array)) {\n            var i = values.length;\n            while (i--) if (abs(values[i] - value) <= tolerance) {\n                return values[i];\n            }\n        } else {\n            values = +values;\n            var rem = value % values;\n            if (rem < tolerance) {\n                return value - rem;\n            }\n            if (rem > values - tolerance) {\n                return value - rem + values;\n            }\n        }\n        return value;\n    };\n\n    /*\\\n     * Raphael.createUUID\n     [ method ]\n     **\n     * Returns RFC4122, version 4 ID\n     \\*/\n    var createUUID = R.createUUID = (function (uuidRegEx, uuidReplacer) {\n        return function () {\n            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx, uuidReplacer).toUpperCase();\n        };\n    })(/[xy]/g, function (c) {\n        var r = math.random() * 16 | 0,\n            v = c == "x" ? r : (r & 3 | 8);\n        return v.toString(16);\n    });\n\n    /*\\\n     * Raphael.setWindow\n     [ method ]\n     **\n     * Used when you need to draw in `&lt;iframe>`. Switched window to the iframe one.\n     > Parameters\n     - newwin (window) new window object\n     \\*/\n    R.setWindow = function (newwin) {\n        eve("raphael.setWindow", R, g.win, newwin);\n        g.win = newwin;\n        g.doc = g.win.document;\n        if (R._engine.initWin) {\n            R._engine.initWin(g.win);\n        }\n    };\n    var toHex = function (color) {\n            if (R.vml) {\n                // http://dean.edwards.name/weblog/2009/10/convert-any-colour-value-to-hex-in-msie/\n                var trim = /^\\s+|\\s+$/g;\n                var bod;\n                try {\n                    var docum = new ActiveXObject("htmlfile");\n                    docum.write("<body>");\n                    docum.close();\n                    bod = docum.body;\n                } catch(e) {\n                    bod = createPopup().document.body;\n                }\n                var range = bod.createTextRange();\n                toHex = cacher(function (color) {\n                    try {\n                        bod.style.color = Str(color).replace(trim, E);\n                        var value = range.queryCommandValue("ForeColor");\n                        value = ((value & 255) << 16) | (value & 65280) | ((value & 16711680) >>> 16);\n                        return "#" + ("000000" + value.toString(16)).slice(-6);\n                    } catch(e) {\n                        return "none";\n                    }\n                });\n            } else {\n                var i = g.doc.createElement("i");\n                i.title = "Rapha\\xebl Colour Picker";\n                i.style.display = "none";\n                g.doc.body.appendChild(i);\n                toHex = cacher(function (color) {\n                    i.style.color = color;\n                    return g.doc.defaultView.getComputedStyle(i, E).getPropertyValue("color");\n                });\n            }\n            return toHex(color);\n        },\n        hsbtoString = function () {\n            return "hsb(" + [this.h, this.s, this.b] + ")";\n        },\n        hsltoString = function () {\n            return "hsl(" + [this.h, this.s, this.l] + ")";\n        },\n        rgbtoString = function () {\n            return this.hex;\n        },\n        prepareRGB = function (r, g, b) {\n            if (g == null && R.is(r, "object") && "r" in r && "g" in r && "b" in r) {\n                b = r.b;\n                g = r.g;\n                r = r.r;\n            }\n            if (g == null && R.is(r, string)) {\n                var clr = R.getRGB(r);\n                r = clr.r;\n                g = clr.g;\n                b = clr.b;\n            }\n            if (r > 1 || g > 1 || b > 1) {\n                r /= 255;\n                g /= 255;\n                b /= 255;\n            }\n\n            return [r, g, b];\n        },\n        packageRGB = function (r, g, b, o) {\n            r *= 255;\n            g *= 255;\n            b *= 255;\n            var rgb = {\n                r: r,\n                g: g,\n                b: b,\n                hex: R.rgb(r, g, b),\n                toString: rgbtoString\n            };\n            R.is(o, "finite") && (rgb.opacity = o);\n            return rgb;\n        };\n\n    /*\\\n     * Raphael.color\n     [ method ]\n     **\n     * Parses the color string and returns object with all values for the given color.\n     > Parameters\n     - clr (string) color string in one of the supported formats (see @Raphael.getRGB)\n     = (object) Combined RGB & HSB object in format:\n     o {\n     o     r (number) red,\n     o     g (number) green,\n     o     b (number) blue,\n     o     hex (string) color in HTML/CSS format: #••••••,\n     o     error (boolean) `true` if string can’t be parsed,\n     o     h (number) hue,\n     o     s (number) saturation,\n     o     v (number) value (brightness),\n     o     l (number) lightness\n     o }\n     \\*/\n    R.color = function (clr) {\n        var rgb;\n        if (R.is(clr, "object") && "h" in clr && "s" in clr && "b" in clr) {\n            rgb = R.hsb2rgb(clr);\n            clr.r = rgb.r;\n            clr.g = rgb.g;\n            clr.b = rgb.b;\n            clr.hex = rgb.hex;\n        } else if (R.is(clr, "object") && "h" in clr && "s" in clr && "l" in clr) {\n            rgb = R.hsl2rgb(clr);\n            clr.r = rgb.r;\n            clr.g = rgb.g;\n            clr.b = rgb.b;\n            clr.hex = rgb.hex;\n        } else {\n            if (R.is(clr, "string")) {\n                clr = R.getRGB(clr);\n            }\n            if (R.is(clr, "object") && "r" in clr && "g" in clr && "b" in clr) {\n                rgb = R.rgb2hsl(clr);\n                clr.h = rgb.h;\n                clr.s = rgb.s;\n                clr.l = rgb.l;\n                rgb = R.rgb2hsb(clr);\n                clr.v = rgb.b;\n            } else {\n                clr = {hex: "none"};\n                clr.r = clr.g = clr.b = clr.h = clr.s = clr.v = clr.l = -1;\n            }\n        }\n        clr.toString = rgbtoString;\n        return clr;\n    };\n    /*\\\n     * Raphael.hsb2rgb\n     [ method ]\n     **\n     * Converts HSB values to RGB object.\n     > Parameters\n     - h (number) hue\n     - s (number) saturation\n     - v (number) value or brightness\n     = (object) RGB object in format:\n     o {\n     o     r (number) red,\n     o     g (number) green,\n     o     b (number) blue,\n     o     hex (string) color in HTML/CSS format: #••••••\n     o }\n     \\*/\n    R.hsb2rgb = function (h, s, v, o) {\n        if (this.is(h, "object") && "h" in h && "s" in h && "b" in h) {\n            v = h.b;\n            s = h.s;\n            o = h.o;\n            h = h.h;\n        }\n        h *= 360;\n        var R, G, B, X, C;\n        h = (h % 360) / 60;\n        C = v * s;\n        X = C * (1 - abs(h % 2 - 1));\n        R = G = B = v - C;\n\n        h = ~~h;\n        R += [C, X, 0, 0, X, C][h];\n        G += [X, C, C, X, 0, 0][h];\n        B += [0, 0, X, C, C, X][h];\n        return packageRGB(R, G, B, o);\n    };\n    /*\\\n     * Raphael.hsl2rgb\n     [ method ]\n     **\n     * Converts HSL values to RGB object.\n     > Parameters\n     - h (number) hue\n     - s (number) saturation\n     - l (number) luminosity\n     = (object) RGB object in format:\n     o {\n     o     r (number) red,\n     o     g (number) green,\n     o     b (number) blue,\n     o     hex (string) color in HTML/CSS format: #••••••\n     o }\n     \\*/\n    R.hsl2rgb = function (h, s, l, o) {\n        if (this.is(h, "object") && "h" in h && "s" in h && "l" in h) {\n            l = h.l;\n            s = h.s;\n            h = h.h;\n        }\n        if (h > 1 || s > 1 || l > 1) {\n            h /= 360;\n            s /= 100;\n            l /= 100;\n        }\n        h *= 360;\n        var R, G, B, X, C;\n        h = (h % 360) / 60;\n        C = 2 * s * (l < .5 ? l : 1 - l);\n        X = C * (1 - abs(h % 2 - 1));\n        R = G = B = l - C / 2;\n\n        h = ~~h;\n        R += [C, X, 0, 0, X, C][h];\n        G += [X, C, C, X, 0, 0][h];\n        B += [0, 0, X, C, C, X][h];\n        return packageRGB(R, G, B, o);\n    };\n    /*\\\n     * Raphael.rgb2hsb\n     [ method ]\n     **\n     * Converts RGB values to HSB object.\n     > Parameters\n     - r (number) red\n     - g (number) green\n     - b (number) blue\n     = (object) HSB object in format:\n     o {\n     o     h (number) hue\n     o     s (number) saturation\n     o     b (number) brightness\n     o }\n     \\*/\n    R.rgb2hsb = function (r, g, b) {\n        b = prepareRGB(r, g, b);\n        r = b[0];\n        g = b[1];\n        b = b[2];\n\n        var H, S, V, C;\n        V = mmax(r, g, b);\n        C = V - mmin(r, g, b);\n        H = (C == 0 ? null :\n                V == r ? (g - b) / C :\n                    V == g ? (b - r) / C + 2 :\n                    (r - g) / C + 4\n        );\n        H = ((H + 360) % 6) * 60 / 360;\n        S = C == 0 ? 0 : C / V;\n        return {h: H, s: S, b: V, toString: hsbtoString};\n    };\n    /*\\\n     * Raphael.rgb2hsl\n     [ method ]\n     **\n     * Converts RGB values to HSL object.\n     > Parameters\n     - r (number) red\n     - g (number) green\n     - b (number) blue\n     = (object) HSL object in format:\n     o {\n     o     h (number) hue\n     o     s (number) saturation\n     o     l (number) luminosity\n     o }\n     \\*/\n    R.rgb2hsl = function (r, g, b) {\n        b = prepareRGB(r, g, b);\n        r = b[0];\n        g = b[1];\n        b = b[2];\n\n        var H, S, L, M, m, C;\n        M = mmax(r, g, b);\n        m = mmin(r, g, b);\n        C = M - m;\n        H = (C == 0 ? null :\n            M == r ? (g - b) / C :\n                M == g ? (b - r) / C + 2 :\n                (r - g) / C + 4);\n        H = ((H + 360) % 6) * 60 / 360;\n        L = (M + m) / 2;\n        S = (C == 0 ? 0 :\n            L < .5 ? C / (2 * L) :\n            C / (2 - 2 * L));\n        return {h: H, s: S, l: L, toString: hsltoString};\n    };\n    R._path2string = function () {\n        return this.join(",").replace(p2s, "$1");\n    };\n    function repush(array, item) {\n        for (var i = 0, ii = array.length; i < ii; i++) if (array[i] === item) {\n            return array.push(array.splice(i, 1)[0]);\n        }\n    }\n    function cacher(f, scope, postprocessor) {\n        function newf() {\n            var arg = Array.prototype.slice.call(arguments, 0),\n                args = arg.join("\\u2400"),\n                cache = newf.cache = newf.cache || {},\n                count = newf.count = newf.count || [];\n            if (cache[has](args)) {\n                repush(count, args);\n                return postprocessor ? postprocessor(cache[args]) : cache[args];\n            }\n            count.length >= 1e3 && delete cache[count.shift()];\n            count.push(args);\n            cache[args] = f[apply](scope, arg);\n            return postprocessor ? postprocessor(cache[args]) : cache[args];\n        }\n        return newf;\n    }\n\n    var preload = R._preload = function (src, f) {\n        var img = g.doc.createElement("img");\n        img.style.cssText = "position:absolute;left:-9999em;top:-9999em";\n        img.onload = function () {\n            f.call(this);\n            this.onload = null;\n            g.doc.body.removeChild(this);\n        };\n        img.onerror = function () {\n            g.doc.body.removeChild(this);\n        };\n        g.doc.body.appendChild(img);\n        img.src = src;\n    };\n\n    function clrToString() {\n        return this.hex;\n    }\n\n    /*\\\n     * Raphael.getRGB\n     [ method ]\n     **\n     * Parses colour string as RGB object\n     > Parameters\n     - colour (string) colour string in one of formats:\n     # <ul>\n     #     <li>Colour name (“<code>red</code>”, “<code>green</code>”, “<code>cornflowerblue</code>”, etc)</li>\n     #     <li>#••• — shortened HTML colour: (“<code>#000</code>”, “<code>#fc0</code>”, etc)</li>\n     #     <li>#•••••• — full length HTML colour: (“<code>#000000</code>”, “<code>#bd2300</code>”)</li>\n     #     <li>rgb(•••, •••, •••) — red, green and blue channels’ values: (“<code>rgb(200,&nbsp;100,&nbsp;0)</code>”)</li>\n     #     <li>rgb(•••%, •••%, •••%) — same as above, but in %: (“<code>rgb(100%,&nbsp;175%,&nbsp;0%)</code>”)</li>\n     #     <li>hsb(•••, •••, •••) — hue, saturation and brightness values: (“<code>hsb(0.5,&nbsp;0.25,&nbsp;1)</code>”)</li>\n     #     <li>hsb(•••%, •••%, •••%) — same as above, but in %</li>\n     #     <li>hsl(•••, •••, •••) — same as hsb</li>\n     #     <li>hsl(•••%, •••%, •••%) — same as hsb</li>\n     # </ul>\n     = (object) RGB object in format:\n     o {\n     o     r (number) red,\n     o     g (number) green,\n     o     b (number) blue\n     o     hex (string) color in HTML/CSS format: #••••••,\n     o     error (boolean) true if string can’t be parsed\n     o }\n     \\*/\n    R.getRGB = cacher(function (colour) {\n        if (!colour || !!((colour = Str(colour)).indexOf("-") + 1)) {\n            return {r: -1, g: -1, b: -1, hex: "none", error: 1, toString: clrToString};\n        }\n        if (colour == "none") {\n            return {r: -1, g: -1, b: -1, hex: "none", toString: clrToString};\n        }\n        !(hsrg[has](colour.toLowerCase().substring(0, 2)) || colour.charAt() == "#") && (colour = toHex(colour));\n        var res,\n            red,\n            green,\n            blue,\n            opacity,\n            t,\n            values,\n            rgb = colour.match(colourRegExp);\n        if (rgb) {\n            if (rgb[2]) {\n                blue = toInt(rgb[2].substring(5), 16);\n                green = toInt(rgb[2].substring(3, 5), 16);\n                red = toInt(rgb[2].substring(1, 3), 16);\n            }\n            if (rgb[3]) {\n                blue = toInt((t = rgb[3].charAt(3)) + t, 16);\n                green = toInt((t = rgb[3].charAt(2)) + t, 16);\n                red = toInt((t = rgb[3].charAt(1)) + t, 16);\n            }\n            if (rgb[4]) {\n                values = rgb[4][split](commaSpaces);\n                red = toFloat(values[0]);\n                values[0].slice(-1) == "%" && (red *= 2.55);\n                green = toFloat(values[1]);\n                values[1].slice(-1) == "%" && (green *= 2.55);\n                blue = toFloat(values[2]);\n                values[2].slice(-1) == "%" && (blue *= 2.55);\n                rgb[1].toLowerCase().slice(0, 4) == "rgba" && (opacity = toFloat(values[3]));\n                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);\n            }\n            if (rgb[5]) {\n                values = rgb[5][split](commaSpaces);\n                red = toFloat(values[0]);\n                values[0].slice(-1) == "%" && (red *= 2.55);\n                green = toFloat(values[1]);\n                values[1].slice(-1) == "%" && (green *= 2.55);\n                blue = toFloat(values[2]);\n                values[2].slice(-1) == "%" && (blue *= 2.55);\n                (values[0].slice(-3) == "deg" || values[0].slice(-1) == "\\xb0") && (red /= 360);\n                rgb[1].toLowerCase().slice(0, 4) == "hsba" && (opacity = toFloat(values[3]));\n                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);\n                return R.hsb2rgb(red, green, blue, opacity);\n            }\n            if (rgb[6]) {\n                values = rgb[6][split](commaSpaces);\n                red = toFloat(values[0]);\n                values[0].slice(-1) == "%" && (red *= 2.55);\n                green = toFloat(values[1]);\n                values[1].slice(-1) == "%" && (green *= 2.55);\n                blue = toFloat(values[2]);\n                values[2].slice(-1) == "%" && (blue *= 2.55);\n                (values[0].slice(-3) == "deg" || values[0].slice(-1) == "\\xb0") && (red /= 360);\n                rgb[1].toLowerCase().slice(0, 4) == "hsla" && (opacity = toFloat(values[3]));\n                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);\n                return R.hsl2rgb(red, green, blue, opacity);\n            }\n            rgb = {r: red, g: green, b: blue, toString: clrToString};\n            rgb.hex = "#" + (16777216 | blue | (green << 8) | (red << 16)).toString(16).slice(1);\n            R.is(opacity, "finite") && (rgb.opacity = opacity);\n            return rgb;\n        }\n        return {r: -1, g: -1, b: -1, hex: "none", error: 1, toString: clrToString};\n    }, R);\n    /*\\\n     * Raphael.hsb\n     [ method ]\n     **\n     * Converts HSB values to hex representation of the colour.\n     > Parameters\n     - h (number) hue\n     - s (number) saturation\n     - b (number) value or brightness\n     = (string) hex representation of the colour.\n     \\*/\n    R.hsb = cacher(function (h, s, b) {\n        return R.hsb2rgb(h, s, b).hex;\n    });\n    /*\\\n     * Raphael.hsl\n     [ method ]\n     **\n     * Converts HSL values to hex representation of the colour.\n     > Parameters\n     - h (number) hue\n     - s (number) saturation\n     - l (number) luminosity\n     = (string) hex representation of the colour.\n     \\*/\n    R.hsl = cacher(function (h, s, l) {\n        return R.hsl2rgb(h, s, l).hex;\n    });\n    /*\\\n     * Raphael.rgb\n     [ method ]\n     **\n     * Converts RGB values to hex representation of the colour.\n     > Parameters\n     - r (number) red\n     - g (number) green\n     - b (number) blue\n     = (string) hex representation of the colour.\n     \\*/\n    R.rgb = cacher(function (r, g, b) {\n        function round(x) { return (x + 0.5) | 0; }\n        return "#" + (16777216 | round(b) | (round(g) << 8) | (round(r) << 16)).toString(16).slice(1);\n    });\n    /*\\\n     * Raphael.getColor\n     [ method ]\n     **\n     * On each call returns next colour in the spectrum. To reset it back to red call @Raphael.getColor.reset\n     > Parameters\n     - value (number) #optional brightness, default is `0.75`\n     = (string) hex representation of the colour.\n     \\*/\n    R.getColor = function (value) {\n        var start = this.getColor.start = this.getColor.start || {h: 0, s: 1, b: value || .75},\n            rgb = this.hsb2rgb(start.h, start.s, start.b);\n        start.h += .075;\n        if (start.h > 1) {\n            start.h = 0;\n            start.s -= .2;\n            start.s <= 0 && (this.getColor.start = {h: 0, s: 1, b: start.b});\n        }\n        return rgb.hex;\n    };\n    /*\\\n     * Raphael.getColor.reset\n     [ method ]\n     **\n     * Resets spectrum position for @Raphael.getColor back to red.\n     \\*/\n    R.getColor.reset = function () {\n        delete this.start;\n    };\n\n    // http://schepers.cc/getting-to-the-point\n    function catmullRom2bezier(crp, z) {\n        var d = [];\n        for (var i = 0, iLen = crp.length; iLen - 2 * !z > i; i += 2) {\n            var p = [\n                {x: +crp[i - 2], y: +crp[i - 1]},\n                {x: +crp[i],     y: +crp[i + 1]},\n                {x: +crp[i + 2], y: +crp[i + 3]},\n                {x: +crp[i + 4], y: +crp[i + 5]}\n            ];\n            if (z) {\n                if (!i) {\n                    p[0] = {x: +crp[iLen - 2], y: +crp[iLen - 1]};\n                } else if (iLen - 4 == i) {\n                    p[3] = {x: +crp[0], y: +crp[1]};\n                } else if (iLen - 2 == i) {\n                    p[2] = {x: +crp[0], y: +crp[1]};\n                    p[3] = {x: +crp[2], y: +crp[3]};\n                }\n            } else {\n                if (iLen - 4 == i) {\n                    p[3] = p[2];\n                } else if (!i) {\n                    p[0] = {x: +crp[i], y: +crp[i + 1]};\n                }\n            }\n            d.push(["C",\n                (-p[0].x + 6 * p[1].x + p[2].x) / 6,\n                (-p[0].y + 6 * p[1].y + p[2].y) / 6,\n                (p[1].x + 6 * p[2].x - p[3].x) / 6,\n                (p[1].y + 6*p[2].y - p[3].y) / 6,\n                p[2].x,\n                p[2].y\n            ]);\n        }\n\n        return d;\n    }\n    /*\\\n     * Raphael.parsePathString\n     [ method ]\n     **\n     * Utility method\n     **\n     * Parses given path string into an array of arrays of path segments.\n     > Parameters\n     - pathString (string|array) path string or array of segments (in the last case it will be returned straight away)\n     = (array) array of segments.\n     \\*/\n    R.parsePathString = function (pathString) {\n        if (!pathString) {\n            return null;\n        }\n        var pth = paths(pathString);\n        if (pth.arr) {\n            return pathClone(pth.arr);\n        }\n\n        var paramCounts = {a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0},\n            data = [];\n        if (R.is(pathString, array) && R.is(pathString[0], array)) { // rough assumption\n            data = pathClone(pathString);\n        }\n        if (!data.length) {\n            Str(pathString).replace(pathCommand, function (a, b, c) {\n                var params = [],\n                    name = b.toLowerCase();\n                c.replace(pathValues, function (a, b) {\n                    b && params.push(+b);\n                });\n                if (name == "m" && params.length > 2) {\n                    data.push([b][concat](params.splice(0, 2)));\n                    name = "l";\n                    b = b == "m" ? "l" : "L";\n                }\n                if (name == "r") {\n                    data.push([b][concat](params));\n                } else while (params.length >= paramCounts[name]) {\n                    data.push([b][concat](params.splice(0, paramCounts[name])));\n                    if (!paramCounts[name]) {\n                        break;\n                    }\n                }\n            });\n        }\n        data.toString = R._path2string;\n        pth.arr = pathClone(data);\n        return data;\n    };\n    /*\\\n     * Raphael.parseTransformString\n     [ method ]\n     **\n     * Utility method\n     **\n     * Parses given path string into an array of transformations.\n     > Parameters\n     - TString (string|array) transform string or array of transformations (in the last case it will be returned straight away)\n     = (array) array of transformations.\n     \\*/\n    R.parseTransformString = cacher(function (TString) {\n        if (!TString) {\n            return null;\n        }\n        var paramCounts = {r: 3, s: 4, t: 2, m: 6},\n            data = [];\n        if (R.is(TString, array) && R.is(TString[0], array)) { // rough assumption\n            data = pathClone(TString);\n        }\n        if (!data.length) {\n            Str(TString).replace(tCommand, function (a, b, c) {\n                var params = [],\n                    name = lowerCase.call(b);\n                c.replace(pathValues, function (a, b) {\n                    b && params.push(+b);\n                });\n                data.push([b][concat](params));\n            });\n        }\n        data.toString = R._path2string;\n        return data;\n    });\n    // PATHS\n    var paths = function (ps) {\n        var p = paths.ps = paths.ps || {};\n        if (p[ps]) {\n            p[ps].sleep = 100;\n        } else {\n            p[ps] = {\n                sleep: 100\n            };\n        }\n        setTimeout(function () {\n            for (var key in p) if (p[has](key) && key != ps) {\n                p[key].sleep--;\n                !p[key].sleep && delete p[key];\n            }\n        });\n        return p[ps];\n    };\n    /*\\\n     * Raphael.findDotsAtSegment\n     [ method ]\n     **\n     * Utility method\n     **\n     * Find dot coordinates on the given cubic bezier curve at the given t.\n     > Parameters\n     - p1x (number) x of the first point of the curve\n     - p1y (number) y of the first point of the curve\n     - c1x (number) x of the first anchor of the curve\n     - c1y (number) y of the first anchor of the curve\n     - c2x (number) x of the second anchor of the curve\n     - c2y (number) y of the second anchor of the curve\n     - p2x (number) x of the second point of the curve\n     - p2y (number) y of the second point of the curve\n     - t (number) position on the curve (0..1)\n     = (object) point information in format:\n     o {\n     o     x: (number) x coordinate of the point\n     o     y: (number) y coordinate of the point\n     o     m: {\n     o         x: (number) x coordinate of the left anchor\n     o         y: (number) y coordinate of the left anchor\n     o     }\n     o     n: {\n     o         x: (number) x coordinate of the right anchor\n     o         y: (number) y coordinate of the right anchor\n     o     }\n     o     start: {\n     o         x: (number) x coordinate of the start of the curve\n     o         y: (number) y coordinate of the start of the curve\n     o     }\n     o     end: {\n     o         x: (number) x coordinate of the end of the curve\n     o         y: (number) y coordinate of the end of the curve\n     o     }\n     o     alpha: (number) angle of the curve derivative at the point\n     o }\n     \\*/\n    R.findDotsAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n        var t1 = 1 - t,\n            t13 = pow(t1, 3),\n            t12 = pow(t1, 2),\n            t2 = t * t,\n            t3 = t2 * t,\n            x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x,\n            y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y,\n            mx = p1x + 2 * t * (c1x - p1x) + t2 * (c2x - 2 * c1x + p1x),\n            my = p1y + 2 * t * (c1y - p1y) + t2 * (c2y - 2 * c1y + p1y),\n            nx = c1x + 2 * t * (c2x - c1x) + t2 * (p2x - 2 * c2x + c1x),\n            ny = c1y + 2 * t * (c2y - c1y) + t2 * (p2y - 2 * c2y + c1y),\n            ax = t1 * p1x + t * c1x,\n            ay = t1 * p1y + t * c1y,\n            cx = t1 * c2x + t * p2x,\n            cy = t1 * c2y + t * p2y,\n            alpha = (90 - math.atan2(mx - nx, my - ny) * 180 / PI);\n        (mx > nx || my < ny) && (alpha += 180);\n        return {\n            x: x,\n            y: y,\n            m: {x: mx, y: my},\n            n: {x: nx, y: ny},\n            start: {x: ax, y: ay},\n            end: {x: cx, y: cy},\n            alpha: alpha\n        };\n    };\n    /*\\\n     * Raphael.bezierBBox\n     [ method ]\n     **\n     * Utility method\n     **\n     * Return bounding box of a given cubic bezier curve\n     > Parameters\n     - p1x (number) x of the first point of the curve\n     - p1y (number) y of the first point of the curve\n     - c1x (number) x of the first anchor of the curve\n     - c1y (number) y of the first anchor of the curve\n     - c2x (number) x of the second anchor of the curve\n     - c2y (number) y of the second anchor of the curve\n     - p2x (number) x of the second point of the curve\n     - p2y (number) y of the second point of the curve\n     * or\n     - bez (array) array of six points for bezier curve\n     = (object) point information in format:\n     o {\n     o     min: {\n     o         x: (number) x coordinate of the left point\n     o         y: (number) y coordinate of the top point\n     o     }\n     o     max: {\n     o         x: (number) x coordinate of the right point\n     o         y: (number) y coordinate of the bottom point\n     o     }\n     o }\n     \\*/\n    R.bezierBBox = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\n        if (!R.is(p1x, "array")) {\n            p1x = [p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y];\n        }\n        var bbox = curveDim.apply(null, p1x);\n        return {\n            x: bbox.min.x,\n            y: bbox.min.y,\n            x2: bbox.max.x,\n            y2: bbox.max.y,\n            width: bbox.max.x - bbox.min.x,\n            height: bbox.max.y - bbox.min.y\n        };\n    };\n    /*\\\n     * Raphael.isPointInsideBBox\n     [ method ]\n     **\n     * Utility method\n     **\n     * Returns `true` if given point is inside bounding boxes.\n     > Parameters\n     - bbox (string) bounding box\n     - x (string) x coordinate of the point\n     - y (string) y coordinate of the point\n     = (boolean) `true` if point inside\n     \\*/\n    R.isPointInsideBBox = function (bbox, x, y) {\n        return x >= bbox.x && x <= bbox.x2 && y >= bbox.y && y <= bbox.y2;\n    };\n    /*\\\n     * Raphael.isBBoxIntersect\n     [ method ]\n     **\n     * Utility method\n     **\n     * Returns `true` if two bounding boxes intersect\n     > Parameters\n     - bbox1 (string) first bounding box\n     - bbox2 (string) second bounding box\n     = (boolean) `true` if they intersect\n     \\*/\n    R.isBBoxIntersect = function (bbox1, bbox2) {\n        var i = R.isPointInsideBBox;\n        return i(bbox2, bbox1.x, bbox1.y)\n            || i(bbox2, bbox1.x2, bbox1.y)\n            || i(bbox2, bbox1.x, bbox1.y2)\n            || i(bbox2, bbox1.x2, bbox1.y2)\n            || i(bbox1, bbox2.x, bbox2.y)\n            || i(bbox1, bbox2.x2, bbox2.y)\n            || i(bbox1, bbox2.x, bbox2.y2)\n            || i(bbox1, bbox2.x2, bbox2.y2)\n            || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)\n            && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);\n    };\n    function base3(t, p1, p2, p3, p4) {\n        var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,\n            t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\n        return t * t2 - 3 * p1 + 3 * p2;\n    }\n    function bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {\n        if (z == null) {\n            z = 1;\n        }\n        z = z > 1 ? 1 : z < 0 ? 0 : z;\n        var z2 = z / 2,\n            n = 12,\n            Tvalues = [-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,-0.9041,0.9041,-0.9816,0.9816],\n            Cvalues = [0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],\n            sum = 0;\n        for (var i = 0; i < n; i++) {\n            var ct = z2 * Tvalues[i] + z2,\n                xbase = base3(ct, x1, x2, x3, x4),\n                ybase = base3(ct, y1, y2, y3, y4),\n                comb = xbase * xbase + ybase * ybase;\n            sum += Cvalues[i] * math.sqrt(comb);\n        }\n        return z2 * sum;\n    }\n    function getTatLen(x1, y1, x2, y2, x3, y3, x4, y4, ll) {\n        if (ll < 0 || bezlen(x1, y1, x2, y2, x3, y3, x4, y4) < ll) {\n            return;\n        }\n        var t = 1,\n            step = t / 2,\n            t2 = t - step,\n            l,\n            e = .01;\n        l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);\n        while (abs(l - ll) > e) {\n            step /= 2;\n            t2 += (l < ll ? 1 : -1) * step;\n            l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);\n        }\n        return t2;\n    }\n    function intersect(x1, y1, x2, y2, x3, y3, x4, y4) {\n        if (\n            mmax(x1, x2) < mmin(x3, x4) ||\n            mmin(x1, x2) > mmax(x3, x4) ||\n            mmax(y1, y2) < mmin(y3, y4) ||\n            mmin(y1, y2) > mmax(y3, y4)\n        ) {\n            return;\n        }\n        var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n            ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n            denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n        if (!denominator) {\n            return;\n        }\n        var px = nx / denominator,\n            py = ny / denominator,\n            px2 = +px.toFixed(2),\n            py2 = +py.toFixed(2);\n        if (\n            px2 < +mmin(x1, x2).toFixed(2) ||\n            px2 > +mmax(x1, x2).toFixed(2) ||\n            px2 < +mmin(x3, x4).toFixed(2) ||\n            px2 > +mmax(x3, x4).toFixed(2) ||\n            py2 < +mmin(y1, y2).toFixed(2) ||\n            py2 > +mmax(y1, y2).toFixed(2) ||\n            py2 < +mmin(y3, y4).toFixed(2) ||\n            py2 > +mmax(y3, y4).toFixed(2)\n        ) {\n            return;\n        }\n        return {x: px, y: py};\n    }\n    function inter(bez1, bez2) {\n        return interHelper(bez1, bez2);\n    }\n    function interCount(bez1, bez2) {\n        return interHelper(bez1, bez2, 1);\n    }\n    function interHelper(bez1, bez2, justCount) {\n        var bbox1 = R.bezierBBox(bez1),\n            bbox2 = R.bezierBBox(bez2);\n        if (!R.isBBoxIntersect(bbox1, bbox2)) {\n            return justCount ? 0 : [];\n        }\n        var l1 = bezlen.apply(0, bez1),\n            l2 = bezlen.apply(0, bez2),\n            n1 = mmax(~~(l1 / 5), 1),\n            n2 = mmax(~~(l2 / 5), 1),\n            dots1 = [],\n            dots2 = [],\n            xy = {},\n            res = justCount ? 0 : [];\n        for (var i = 0; i < n1 + 1; i++) {\n            var p = R.findDotsAtSegment.apply(R, bez1.concat(i / n1));\n            dots1.push({x: p.x, y: p.y, t: i / n1});\n        }\n        for (i = 0; i < n2 + 1; i++) {\n            p = R.findDotsAtSegment.apply(R, bez2.concat(i / n2));\n            dots2.push({x: p.x, y: p.y, t: i / n2});\n        }\n        for (i = 0; i < n1; i++) {\n            for (var j = 0; j < n2; j++) {\n                var di = dots1[i],\n                    di1 = dots1[i + 1],\n                    dj = dots2[j],\n                    dj1 = dots2[j + 1],\n                    ci = abs(di1.x - di.x) < .001 ? "y" : "x",\n                    cj = abs(dj1.x - dj.x) < .001 ? "y" : "x",\n                    is = intersect(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y);\n                if (is) {\n                    if (xy[is.x.toFixed(4)] == is.y.toFixed(4)) {\n                        continue;\n                    }\n                    xy[is.x.toFixed(4)] = is.y.toFixed(4);\n                    var t1 = di.t + abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t),\n                        t2 = dj.t + abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\n                    if (t1 >= 0 && t1 <= 1.001 && t2 >= 0 && t2 <= 1.001) {\n                        if (justCount) {\n                            res++;\n                        } else {\n                            res.push({\n                                x: is.x,\n                                y: is.y,\n                                t1: mmin(t1, 1),\n                                t2: mmin(t2, 1)\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        return res;\n    }\n    /*\\\n     * Raphael.pathIntersection\n     [ method ]\n     **\n     * Utility method\n     **\n     * Finds intersections of two paths\n     > Parameters\n     - path1 (string) path string\n     - path2 (string) path string\n     = (array) dots of intersection\n     o [\n     o     {\n     o         x: (number) x coordinate of the point\n     o         y: (number) y coordinate of the point\n     o         t1: (number) t value for segment of path1\n     o         t2: (number) t value for segment of path2\n     o         segment1: (number) order number for segment of path1\n     o         segment2: (number) order number for segment of path2\n     o         bez1: (array) eight coordinates representing beziér curve for the segment of path1\n     o         bez2: (array) eight coordinates representing beziér curve for the segment of path2\n     o     }\n     o ]\n     \\*/\n    R.pathIntersection = function (path1, path2) {\n        return interPathHelper(path1, path2);\n    };\n    R.pathIntersectionNumber = function (path1, path2) {\n        return interPathHelper(path1, path2, 1);\n    };\n    function interPathHelper(path1, path2, justCount) {\n        path1 = R._path2curve(path1);\n        path2 = R._path2curve(path2);\n        var x1, y1, x2, y2, x1m, y1m, x2m, y2m, bez1, bez2,\n            res = justCount ? 0 : [];\n        for (var i = 0, ii = path1.length; i < ii; i++) {\n            var pi = path1[i];\n            if (pi[0] == "M") {\n                x1 = x1m = pi[1];\n                y1 = y1m = pi[2];\n            } else {\n                if (pi[0] == "C") {\n                    bez1 = [x1, y1].concat(pi.slice(1));\n                    x1 = bez1[6];\n                    y1 = bez1[7];\n                } else {\n                    bez1 = [x1, y1, x1, y1, x1m, y1m, x1m, y1m];\n                    x1 = x1m;\n                    y1 = y1m;\n                }\n                for (var j = 0, jj = path2.length; j < jj; j++) {\n                    var pj = path2[j];\n                    if (pj[0] == "M") {\n                        x2 = x2m = pj[1];\n                        y2 = y2m = pj[2];\n                    } else {\n                        if (pj[0] == "C") {\n                            bez2 = [x2, y2].concat(pj.slice(1));\n                            x2 = bez2[6];\n                            y2 = bez2[7];\n                        } else {\n                            bez2 = [x2, y2, x2, y2, x2m, y2m, x2m, y2m];\n                            x2 = x2m;\n                            y2 = y2m;\n                        }\n                        var intr = interHelper(bez1, bez2, justCount);\n                        if (justCount) {\n                            res += intr;\n                        } else {\n                            for (var k = 0, kk = intr.length; k < kk; k++) {\n                                intr[k].segment1 = i;\n                                intr[k].segment2 = j;\n                                intr[k].bez1 = bez1;\n                                intr[k].bez2 = bez2;\n                            }\n                            res = res.concat(intr);\n                        }\n                    }\n                }\n            }\n        }\n        return res;\n    }\n    /*\\\n     * Raphael.isPointInsidePath\n     [ method ]\n     **\n     * Utility method\n     **\n     * Returns `true` if given point is inside a given closed path.\n     > Parameters\n     - path (string) path string\n     - x (number) x of the point\n     - y (number) y of the point\n     = (boolean) true, if point is inside the path\n     \\*/\n    R.isPointInsidePath = function (path, x, y) {\n        var bbox = R.pathBBox(path);\n        return R.isPointInsideBBox(bbox, x, y) &&\n            interPathHelper(path, [["M", x, y], ["H", bbox.x2 + 10]], 1) % 2 == 1;\n    };\n    R._removedFactory = function (methodname) {\n        return function () {\n            eve("raphael.log", null, "Rapha\\xebl: you are calling to method \\u201c" + methodname + "\\u201d of removed object", methodname);\n        };\n    };\n    /*\\\n     * Raphael.pathBBox\n     [ method ]\n     **\n     * Utility method\n     **\n     * Return bounding box of a given path\n     > Parameters\n     - path (string) path string\n     = (object) bounding box\n     o {\n     o     x: (number) x coordinate of the left top point of the box\n     o     y: (number) y coordinate of the left top point of the box\n     o     x2: (number) x coordinate of the right bottom point of the box\n     o     y2: (number) y coordinate of the right bottom point of the box\n     o     width: (number) width of the box\n     o     height: (number) height of the box\n     o     cx: (number) x coordinate of the center of the box\n     o     cy: (number) y coordinate of the center of the box\n     o }\n     \\*/\n    var pathDimensions = R.pathBBox = function (path) {\n            var pth = paths(path);\n            if (pth.bbox) {\n                return clone(pth.bbox);\n            }\n            if (!path) {\n                return {x: 0, y: 0, width: 0, height: 0, x2: 0, y2: 0};\n            }\n            path = path2curve(path);\n            var x = 0,\n                y = 0,\n                X = [],\n                Y = [],\n                p;\n            for (var i = 0, ii = path.length; i < ii; i++) {\n                p = path[i];\n                if (p[0] == "M") {\n                    x = p[1];\n                    y = p[2];\n                    X.push(x);\n                    Y.push(y);\n                } else {\n                    var dim = curveDim(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\n                    X = X[concat](dim.min.x, dim.max.x);\n                    Y = Y[concat](dim.min.y, dim.max.y);\n                    x = p[5];\n                    y = p[6];\n                }\n            }\n            var xmin = mmin[apply](0, X),\n                ymin = mmin[apply](0, Y),\n                xmax = mmax[apply](0, X),\n                ymax = mmax[apply](0, Y),\n                width = xmax - xmin,\n                height = ymax - ymin,\n                bb = {\n                    x: xmin,\n                    y: ymin,\n                    x2: xmax,\n                    y2: ymax,\n                    width: width,\n                    height: height,\n                    cx: xmin + width / 2,\n                    cy: ymin + height / 2\n                };\n            pth.bbox = clone(bb);\n            return bb;\n        },\n        pathClone = function (pathArray) {\n            var res = clone(pathArray);\n            res.toString = R._path2string;\n            return res;\n        },\n        pathToRelative = R._pathToRelative = function (pathArray) {\n            var pth = paths(pathArray);\n            if (pth.rel) {\n                return pathClone(pth.rel);\n            }\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\n                pathArray = R.parsePathString(pathArray);\n            }\n            var res = [],\n                x = 0,\n                y = 0,\n                mx = 0,\n                my = 0,\n                start = 0;\n            if (pathArray[0][0] == "M") {\n                x = pathArray[0][1];\n                y = pathArray[0][2];\n                mx = x;\n                my = y;\n                start++;\n                res.push(["M", x, y]);\n            }\n            for (var i = start, ii = pathArray.length; i < ii; i++) {\n                var r = res[i] = [],\n                    pa = pathArray[i];\n                if (pa[0] != lowerCase.call(pa[0])) {\n                    r[0] = lowerCase.call(pa[0]);\n                    switch (r[0]) {\n                        case "a":\n                            r[1] = pa[1];\n                            r[2] = pa[2];\n                            r[3] = pa[3];\n                            r[4] = pa[4];\n                            r[5] = pa[5];\n                            r[6] = +(pa[6] - x).toFixed(3);\n                            r[7] = +(pa[7] - y).toFixed(3);\n                            break;\n                        case "v":\n                            r[1] = +(pa[1] - y).toFixed(3);\n                            break;\n                        case "m":\n                            mx = pa[1];\n                            my = pa[2];\n                        default:\n                            for (var j = 1, jj = pa.length; j < jj; j++) {\n                                r[j] = +(pa[j] - ((j % 2) ? x : y)).toFixed(3);\n                            }\n                    }\n                } else {\n                    r = res[i] = [];\n                    if (pa[0] == "m") {\n                        mx = pa[1] + x;\n                        my = pa[2] + y;\n                    }\n                    for (var k = 0, kk = pa.length; k < kk; k++) {\n                        res[i][k] = pa[k];\n                    }\n                }\n                var len = res[i].length;\n                switch (res[i][0]) {\n                    case "z":\n                        x = mx;\n                        y = my;\n                        break;\n                    case "h":\n                        x += +res[i][len - 1];\n                        break;\n                    case "v":\n                        y += +res[i][len - 1];\n                        break;\n                    default:\n                        x += +res[i][len - 2];\n                        y += +res[i][len - 1];\n                }\n            }\n            res.toString = R._path2string;\n            pth.rel = pathClone(res);\n            return res;\n        },\n        pathToAbsolute = R._pathToAbsolute = function (pathArray) {\n            var pth = paths(pathArray);\n            if (pth.abs) {\n                return pathClone(pth.abs);\n            }\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\n                pathArray = R.parsePathString(pathArray);\n            }\n            if (!pathArray || !pathArray.length) {\n                return [["M", 0, 0]];\n            }\n            var res = [],\n                x = 0,\n                y = 0,\n                mx = 0,\n                my = 0,\n                start = 0;\n            if (pathArray[0][0] == "M") {\n                x = +pathArray[0][1];\n                y = +pathArray[0][2];\n                mx = x;\n                my = y;\n                start++;\n                res[0] = ["M", x, y];\n            }\n            var crz = pathArray.length == 3 && pathArray[0][0] == "M" && pathArray[1][0].toUpperCase() == "R" && pathArray[2][0].toUpperCase() == "Z";\n            for (var r, pa, i = start, ii = pathArray.length; i < ii; i++) {\n                res.push(r = []);\n                pa = pathArray[i];\n                if (pa[0] != upperCase.call(pa[0])) {\n                    r[0] = upperCase.call(pa[0]);\n                    switch (r[0]) {\n                        case "A":\n                            r[1] = pa[1];\n                            r[2] = pa[2];\n                            r[3] = pa[3];\n                            r[4] = pa[4];\n                            r[5] = pa[5];\n                            r[6] = +(pa[6] + x);\n                            r[7] = +(pa[7] + y);\n                            break;\n                        case "V":\n                            r[1] = +pa[1] + y;\n                            break;\n                        case "H":\n                            r[1] = +pa[1] + x;\n                            break;\n                        case "R":\n                            var dots = [x, y][concat](pa.slice(1));\n                            for (var j = 2, jj = dots.length; j < jj; j++) {\n                                dots[j] = +dots[j] + x;\n                                dots[++j] = +dots[j] + y;\n                            }\n                            res.pop();\n                            res = res[concat](catmullRom2bezier(dots, crz));\n                            break;\n                        case "M":\n                            mx = +pa[1] + x;\n                            my = +pa[2] + y;\n                        default:\n                            for (j = 1, jj = pa.length; j < jj; j++) {\n                                r[j] = +pa[j] + ((j % 2) ? x : y);\n                            }\n                    }\n                } else if (pa[0] == "R") {\n                    dots = [x, y][concat](pa.slice(1));\n                    res.pop();\n                    res = res[concat](catmullRom2bezier(dots, crz));\n                    r = ["R"][concat](pa.slice(-2));\n                } else {\n                    for (var k = 0, kk = pa.length; k < kk; k++) {\n                        r[k] = pa[k];\n                    }\n                }\n                switch (r[0]) {\n                    case "Z":\n                        x = mx;\n                        y = my;\n                        break;\n                    case "H":\n                        x = r[1];\n                        break;\n                    case "V":\n                        y = r[1];\n                        break;\n                    case "M":\n                        mx = r[r.length - 2];\n                        my = r[r.length - 1];\n                    default:\n                        x = r[r.length - 2];\n                        y = r[r.length - 1];\n                }\n            }\n            res.toString = R._path2string;\n            pth.abs = pathClone(res);\n            return res;\n        },\n        l2c = function (x1, y1, x2, y2) {\n            return [x1, y1, x2, y2, x2, y2];\n        },\n        q2c = function (x1, y1, ax, ay, x2, y2) {\n            var _13 = 1 / 3,\n                _23 = 2 / 3;\n            return [\n                _13 * x1 + _23 * ax,\n                _13 * y1 + _23 * ay,\n                _13 * x2 + _23 * ax,\n                _13 * y2 + _23 * ay,\n                x2,\n                y2\n            ];\n        },\n        a2c = function (x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n            // for more information of where this math came from visit:\n            // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n            var _120 = PI * 120 / 180,\n                rad = PI / 180 * (+angle || 0),\n                res = [],\n                xy,\n                rotate = cacher(function (x, y, rad) {\n                    var X = x * math.cos(rad) - y * math.sin(rad),\n                        Y = x * math.sin(rad) + y * math.cos(rad);\n                    return {x: X, y: Y};\n                });\n            if (!recursive) {\n                xy = rotate(x1, y1, -rad);\n                x1 = xy.x;\n                y1 = xy.y;\n                xy = rotate(x2, y2, -rad);\n                x2 = xy.x;\n                y2 = xy.y;\n                var cos = math.cos(PI / 180 * angle),\n                    sin = math.sin(PI / 180 * angle),\n                    x = (x1 - x2) / 2,\n                    y = (y1 - y2) / 2;\n                var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);\n                if (h > 1) {\n                    h = math.sqrt(h);\n                    rx = h * rx;\n                    ry = h * ry;\n                }\n                var rx2 = rx * rx,\n                    ry2 = ry * ry,\n                    k = (large_arc_flag == sweep_flag ? -1 : 1) *\n                        math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),\n                    cx = k * rx * y / ry + (x1 + x2) / 2,\n                    cy = k * -ry * x / rx + (y1 + y2) / 2,\n                    f1 = math.asin(((y1 - cy) / ry).toFixed(9)),\n                    f2 = math.asin(((y2 - cy) / ry).toFixed(9));\n\n                f1 = x1 < cx ? PI - f1 : f1;\n                f2 = x2 < cx ? PI - f2 : f2;\n                f1 < 0 && (f1 = PI * 2 + f1);\n                f2 < 0 && (f2 = PI * 2 + f2);\n                if (sweep_flag && f1 > f2) {\n                    f1 = f1 - PI * 2;\n                }\n                if (!sweep_flag && f2 > f1) {\n                    f2 = f2 - PI * 2;\n                }\n            } else {\n                f1 = recursive[0];\n                f2 = recursive[1];\n                cx = recursive[2];\n                cy = recursive[3];\n            }\n            var df = f2 - f1;\n            if (abs(df) > _120) {\n                var f2old = f2,\n                    x2old = x2,\n                    y2old = y2;\n                f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\n                x2 = cx + rx * math.cos(f2);\n                y2 = cy + ry * math.sin(f2);\n                res = a2c(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);\n            }\n            df = f2 - f1;\n            var c1 = math.cos(f1),\n                s1 = math.sin(f1),\n                c2 = math.cos(f2),\n                s2 = math.sin(f2),\n                t = math.tan(df / 4),\n                hx = 4 / 3 * rx * t,\n                hy = 4 / 3 * ry * t,\n                m1 = [x1, y1],\n                m2 = [x1 + hx * s1, y1 - hy * c1],\n                m3 = [x2 + hx * s2, y2 - hy * c2],\n                m4 = [x2, y2];\n            m2[0] = 2 * m1[0] - m2[0];\n            m2[1] = 2 * m1[1] - m2[1];\n            if (recursive) {\n                return [m2, m3, m4][concat](res);\n            } else {\n                res = [m2, m3, m4][concat](res).join()[split](",");\n                var newres = [];\n                for (var i = 0, ii = res.length; i < ii; i++) {\n                    newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\n                }\n                return newres;\n            }\n        },\n        findDotAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n            var t1 = 1 - t;\n            return {\n                x: pow(t1, 3) * p1x + pow(t1, 2) * 3 * t * c1x + t1 * 3 * t * t * c2x + pow(t, 3) * p2x,\n                y: pow(t1, 3) * p1y + pow(t1, 2) * 3 * t * c1y + t1 * 3 * t * t * c2y + pow(t, 3) * p2y\n            };\n        },\n        curveDim = cacher(function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\n            var a = (c2x - 2 * c1x + p1x) - (p2x - 2 * c2x + c1x),\n                b = 2 * (c1x - p1x) - 2 * (c2x - c1x),\n                c = p1x - c1x,\n                t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a,\n                t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a,\n                y = [p1y, p2y],\n                x = [p1x, p2x],\n                dot;\n            abs(t1) > "1e12" && (t1 = .5);\n            abs(t2) > "1e12" && (t2 = .5);\n            if (t1 > 0 && t1 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);\n                x.push(dot.x);\n                y.push(dot.y);\n            }\n            if (t2 > 0 && t2 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);\n                x.push(dot.x);\n                y.push(dot.y);\n            }\n            a = (c2y - 2 * c1y + p1y) - (p2y - 2 * c2y + c1y);\n            b = 2 * (c1y - p1y) - 2 * (c2y - c1y);\n            c = p1y - c1y;\n            t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a;\n            t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a;\n            abs(t1) > "1e12" && (t1 = .5);\n            abs(t2) > "1e12" && (t2 = .5);\n            if (t1 > 0 && t1 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);\n                x.push(dot.x);\n                y.push(dot.y);\n            }\n            if (t2 > 0 && t2 < 1) {\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);\n                x.push(dot.x);\n                y.push(dot.y);\n            }\n            return {\n                min: {x: mmin[apply](0, x), y: mmin[apply](0, y)},\n                max: {x: mmax[apply](0, x), y: mmax[apply](0, y)}\n            };\n        }),\n        path2curve = R._path2curve = cacher(function (path, path2) {\n            var pth = !path2 && paths(path);\n            if (!path2 && pth.curve) {\n                return pathClone(pth.curve);\n            }\n            var p = pathToAbsolute(path),\n                p2 = path2 && pathToAbsolute(path2),\n                attrs = {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null},\n                attrs2 = {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null},\n                processPath = function (path, d, pcom) {\n                    var nx, ny, tq = {T:1, Q:1};\n                    if (!path) {\n                        return ["C", d.x, d.y, d.x, d.y, d.x, d.y];\n                    }\n                    !(path[0] in tq) && (d.qx = d.qy = null);\n                    switch (path[0]) {\n                        case "M":\n                            d.X = path[1];\n                            d.Y = path[2];\n                            break;\n                        case "A":\n                            path = ["C"][concat](a2c[apply](0, [d.x, d.y][concat](path.slice(1))));\n                            break;\n                        case "S":\n                            if (pcom == "C" || pcom == "S") { // In "S" case we have to take into account, if the previous command is C/S.\n                                nx = d.x * 2 - d.bx;          // And reflect the previous\n                                ny = d.y * 2 - d.by;          // command\'s control point relative to the current point.\n                            }\n                            else {                            // or some else or nothing\n                                nx = d.x;\n                                ny = d.y;\n                            }\n                            path = ["C", nx, ny][concat](path.slice(1));\n                            break;\n                        case "T":\n                            if (pcom == "Q" || pcom == "T") { // In "T" case we have to take into account, if the previous command is Q/T.\n                                d.qx = d.x * 2 - d.qx;        // And make a reflection similar\n                                d.qy = d.y * 2 - d.qy;        // to case "S".\n                            }\n                            else {                            // or something else or nothing\n                                d.qx = d.x;\n                                d.qy = d.y;\n                            }\n                            path = ["C"][concat](q2c(d.x, d.y, d.qx, d.qy, path[1], path[2]));\n                            break;\n                        case "Q":\n                            d.qx = path[1];\n                            d.qy = path[2];\n                            path = ["C"][concat](q2c(d.x, d.y, path[1], path[2], path[3], path[4]));\n                            break;\n                        case "L":\n                            path = ["C"][concat](l2c(d.x, d.y, path[1], path[2]));\n                            break;\n                        case "H":\n                            path = ["C"][concat](l2c(d.x, d.y, path[1], d.y));\n                            break;\n                        case "V":\n                            path = ["C"][concat](l2c(d.x, d.y, d.x, path[1]));\n                            break;\n                        case "Z":\n                            path = ["C"][concat](l2c(d.x, d.y, d.X, d.Y));\n                            break;\n                    }\n                    return path;\n                },\n                fixArc = function (pp, i) {\n                    if (pp[i].length > 7) {\n                        pp[i].shift();\n                        var pi = pp[i];\n                        while (pi.length) {\n                            pcoms1[i]="A"; // if created multiple C:s, their original seg is saved\n                            p2 && (pcoms2[i]="A"); // the same as above\n                            pp.splice(i++, 0, ["C"][concat](pi.splice(0, 6)));\n                        }\n                        pp.splice(i, 1);\n                        ii = mmax(p.length, p2 && p2.length || 0);\n                    }\n                },\n                fixM = function (path1, path2, a1, a2, i) {\n                    if (path1 && path2 && path1[i][0] == "M" && path2[i][0] != "M") {\n                        path2.splice(i, 0, ["M", a2.x, a2.y]);\n                        a1.bx = 0;\n                        a1.by = 0;\n                        a1.x = path1[i][1];\n                        a1.y = path1[i][2];\n                        ii = mmax(p.length, p2 && p2.length || 0);\n                    }\n                },\n                pcoms1 = [], // path commands of original path p\n                pcoms2 = [], // path commands of original path p2\n                pfirst = "", // temporary holder for original path command\n                pcom = ""; // holder for previous path command of original path\n            for (var i = 0, ii = mmax(p.length, p2 && p2.length || 0); i < ii; i++) {\n                p[i] && (pfirst = p[i][0]); // save current path command\n\n                if (pfirst != "C") // C is not saved yet, because it may be result of conversion\n                {\n                    pcoms1[i] = pfirst; // Save current path command\n                    i && ( pcom = pcoms1[i-1]); // Get previous path command pcom\n                }\n                p[i] = processPath(p[i], attrs, pcom); // Previous path command is inputted to processPath\n\n                if (pcoms1[i] != "A" && pfirst == "C") pcoms1[i] = "C"; // A is the only command\n                // which may produce multiple C:s\n                // so we have to make sure that C is also C in original path\n\n                fixArc(p, i); // fixArc adds also the right amount of A:s to pcoms1\n\n                if (p2) { // the same procedures is done to p2\n                    p2[i] && (pfirst = p2[i][0]);\n                    if (pfirst != "C")\n                    {\n                        pcoms2[i] = pfirst;\n                        i && (pcom = pcoms2[i-1]);\n                    }\n                    p2[i] = processPath(p2[i], attrs2, pcom);\n\n                    if (pcoms2[i]!="A" && pfirst=="C") pcoms2[i]="C";\n\n                    fixArc(p2, i);\n                }\n                fixM(p, p2, attrs, attrs2, i);\n                fixM(p2, p, attrs2, attrs, i);\n                var seg = p[i],\n                    seg2 = p2 && p2[i],\n                    seglen = seg.length,\n                    seg2len = p2 && seg2.length;\n                attrs.x = seg[seglen - 2];\n                attrs.y = seg[seglen - 1];\n                attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;\n                attrs.by = toFloat(seg[seglen - 3]) || attrs.y;\n                attrs2.bx = p2 && (toFloat(seg2[seg2len - 4]) || attrs2.x);\n                attrs2.by = p2 && (toFloat(seg2[seg2len - 3]) || attrs2.y);\n                attrs2.x = p2 && seg2[seg2len - 2];\n                attrs2.y = p2 && seg2[seg2len - 1];\n            }\n            if (!p2) {\n                pth.curve = pathClone(p);\n            }\n            return p2 ? [p, p2] : p;\n        }, null, pathClone),\n        parseDots = R._parseDots = cacher(function (gradient) {\n            var dots = [];\n            for (var i = 0, ii = gradient.length; i < ii; i++) {\n                var dot = {},\n                    par = gradient[i].match(/^([^:]*):?([\\d\\.]*)/);\n                dot.color = R.getRGB(par[1]);\n                if (dot.color.error) {\n                    return null;\n                }\n                dot.opacity = dot.color.opacity;\n                dot.color = dot.color.hex;\n                par[2] && (dot.offset = par[2] + "%");\n                dots.push(dot);\n            }\n            for (i = 1, ii = dots.length - 1; i < ii; i++) {\n                if (!dots[i].offset) {\n                    var start = toFloat(dots[i - 1].offset || 0),\n                        end = 0;\n                    for (var j = i + 1; j < ii; j++) {\n                        if (dots[j].offset) {\n                            end = dots[j].offset;\n                            break;\n                        }\n                    }\n                    if (!end) {\n                        end = 100;\n                        j = ii;\n                    }\n                    end = toFloat(end);\n                    var d = (end - start) / (j - i + 1);\n                    for (; i < j; i++) {\n                        start += d;\n                        dots[i].offset = start + "%";\n                    }\n                }\n            }\n            return dots;\n        }),\n        tear = R._tear = function (el, paper) {\n            el == paper.top && (paper.top = el.prev);\n            el == paper.bottom && (paper.bottom = el.next);\n            el.next && (el.next.prev = el.prev);\n            el.prev && (el.prev.next = el.next);\n        },\n        tofront = R._tofront = function (el, paper) {\n            if (paper.top === el) {\n                return;\n            }\n            tear(el, paper);\n            el.next = null;\n            el.prev = paper.top;\n            paper.top.next = el;\n            paper.top = el;\n        },\n        toback = R._toback = function (el, paper) {\n            if (paper.bottom === el) {\n                return;\n            }\n            tear(el, paper);\n            el.next = paper.bottom;\n            el.prev = null;\n            paper.bottom.prev = el;\n            paper.bottom = el;\n        },\n        insertafter = R._insertafter = function (el, el2, paper) {\n            tear(el, paper);\n            el2 == paper.top && (paper.top = el);\n            el2.next && (el2.next.prev = el);\n            el.next = el2.next;\n            el.prev = el2;\n            el2.next = el;\n        },\n        insertbefore = R._insertbefore = function (el, el2, paper) {\n            tear(el, paper);\n            el2 == paper.bottom && (paper.bottom = el);\n            el2.prev && (el2.prev.next = el);\n            el.prev = el2.prev;\n            el2.prev = el;\n            el.next = el2;\n        },\n    /*\\\n     * Raphael.toMatrix\n     [ method ]\n     **\n     * Utility method\n     **\n     * Returns matrix of transformations applied to a given path\n     > Parameters\n     - path (string) path string\n     - transform (string|array) transformation string\n     = (object) @Matrix\n     \\*/\n        toMatrix = R.toMatrix = function (path, transform) {\n            var bb = pathDimensions(path),\n                el = {\n                    _: {\n                        transform: E\n                    },\n                    getBBox: function () {\n                        return bb;\n                    }\n                };\n            extractTransform(el, transform);\n            return el.matrix;\n        },\n    /*\\\n     * Raphael.transformPath\n     [ method ]\n     **\n     * Utility method\n     **\n     * Returns path transformed by a given transformation\n     > Parameters\n     - path (string) path string\n     - transform (string|array) transformation string\n     = (string) path\n     \\*/\n        transformPath = R.transformPath = function (path, transform) {\n            return mapPath(path, toMatrix(path, transform));\n        },\n        extractTransform = R._extractTransform = function (el, tstr) {\n            if (tstr == null) {\n                return el._.transform;\n            }\n            tstr = Str(tstr).replace(/\\.{3}|\\u2026/g, el._.transform || E);\n            var tdata = R.parseTransformString(tstr),\n                deg = 0,\n                dx = 0,\n                dy = 0,\n                sx = 1,\n                sy = 1,\n                _ = el._,\n                m = new Matrix;\n            _.transform = tdata || [];\n            if (tdata) {\n                for (var i = 0, ii = tdata.length; i < ii; i++) {\n                    var t = tdata[i],\n                        tlen = t.length,\n                        command = Str(t[0]).toLowerCase(),\n                        absolute = t[0] != command,\n                        inver = absolute ? m.invert() : 0,\n                        x1,\n                        y1,\n                        x2,\n                        y2,\n                        bb;\n                    if (command == "t" && tlen == 3) {\n                        if (absolute) {\n                            x1 = inver.x(0, 0);\n                            y1 = inver.y(0, 0);\n                            x2 = inver.x(t[1], t[2]);\n                            y2 = inver.y(t[1], t[2]);\n                            m.translate(x2 - x1, y2 - y1);\n                        } else {\n                            m.translate(t[1], t[2]);\n                        }\n                    } else if (command == "r") {\n                        if (tlen == 2) {\n                            bb = bb || el.getBBox(1);\n                            m.rotate(t[1], bb.x + bb.width / 2, bb.y + bb.height / 2);\n                            deg += t[1];\n                        } else if (tlen == 4) {\n                            if (absolute) {\n                                x2 = inver.x(t[2], t[3]);\n                                y2 = inver.y(t[2], t[3]);\n                                m.rotate(t[1], x2, y2);\n                            } else {\n                                m.rotate(t[1], t[2], t[3]);\n                            }\n                            deg += t[1];\n                        }\n                    } else if (command == "s") {\n                        if (tlen == 2 || tlen == 3) {\n                            bb = bb || el.getBBox(1);\n                            m.scale(t[1], t[tlen - 1], bb.x + bb.width / 2, bb.y + bb.height / 2);\n                            sx *= t[1];\n                            sy *= t[tlen - 1];\n                        } else if (tlen == 5) {\n                            if (absolute) {\n                                x2 = inver.x(t[3], t[4]);\n                                y2 = inver.y(t[3], t[4]);\n                                m.scale(t[1], t[2], x2, y2);\n                            } else {\n                                m.scale(t[1], t[2], t[3], t[4]);\n                            }\n                            sx *= t[1];\n                            sy *= t[2];\n                        }\n                    } else if (command == "m" && tlen == 7) {\n                        m.add(t[1], t[2], t[3], t[4], t[5], t[6]);\n                    }\n                    _.dirtyT = 1;\n                    el.matrix = m;\n                }\n            }\n\n            /*\\\n             * Element.matrix\n             [ property (object) ]\n             **\n             * Keeps @Matrix object, which represents element transformation\n             \\*/\n            el.matrix = m;\n\n            _.sx = sx;\n            _.sy = sy;\n            _.deg = deg;\n            _.dx = dx = m.e;\n            _.dy = dy = m.f;\n\n            if (sx == 1 && sy == 1 && !deg && _.bbox) {\n                _.bbox.x += +dx;\n                _.bbox.y += +dy;\n            } else {\n                _.dirtyT = 1;\n            }\n        },\n        getEmpty = function (item) {\n            var l = item[0];\n            switch (l.toLowerCase()) {\n                case "t": return [l, 0, 0];\n                case "m": return [l, 1, 0, 0, 1, 0, 0];\n                case "r": if (item.length == 4) {\n                    return [l, 0, item[2], item[3]];\n                } else {\n                    return [l, 0];\n                }\n                case "s": if (item.length == 5) {\n                    return [l, 1, 1, item[3], item[4]];\n                } else if (item.length == 3) {\n                    return [l, 1, 1];\n                } else {\n                    return [l, 1];\n                }\n            }\n        },\n        equaliseTransform = R._equaliseTransform = function (t1, t2) {\n            t2 = Str(t2).replace(/\\.{3}|\\u2026/g, t1);\n            t1 = R.parseTransformString(t1) || [];\n            t2 = R.parseTransformString(t2) || [];\n            var maxlength = mmax(t1.length, t2.length),\n                from = [],\n                to = [],\n                i = 0, j, jj,\n                tt1, tt2;\n            for (; i < maxlength; i++) {\n                tt1 = t1[i] || getEmpty(t2[i]);\n                tt2 = t2[i] || getEmpty(tt1);\n                if ((tt1[0] != tt2[0]) ||\n                    (tt1[0].toLowerCase() == "r" && (tt1[2] != tt2[2] || tt1[3] != tt2[3])) ||\n                    (tt1[0].toLowerCase() == "s" && (tt1[3] != tt2[3] || tt1[4] != tt2[4]))\n                ) {\n                    return;\n                }\n                from[i] = [];\n                to[i] = [];\n                for (j = 0, jj = mmax(tt1.length, tt2.length); j < jj; j++) {\n                    j in tt1 && (from[i][j] = tt1[j]);\n                    j in tt2 && (to[i][j] = tt2[j]);\n                }\n            }\n            return {\n                from: from,\n                to: to\n            };\n        };\n    R._getContainer = function (x, y, w, h) {\n        var container;\n        container = h == null && !R.is(x, "object") ? g.doc.getElementById(x) : x;\n        if (container == null) {\n            return;\n        }\n        if (container.tagName) {\n            if (y == null) {\n                return {\n                    container: container,\n                    width: container.style.pixelWidth || container.offsetWidth,\n                    height: container.style.pixelHeight || container.offsetHeight\n                };\n            } else {\n                return {\n                    container: container,\n                    width: y,\n                    height: w\n                };\n            }\n        }\n        return {\n            container: 1,\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n    };\n    /*\\\n     * Raphael.pathToRelative\n     [ method ]\n     **\n     * Utility method\n     **\n     * Converts path to relative form\n     > Parameters\n     - pathString (string|array) path string or array of segments\n     = (array) array of segments.\n     \\*/\n    R.pathToRelative = pathToRelative;\n    R._engine = {};\n    /*\\\n     * Raphael.path2curve\n     [ method ]\n     **\n     * Utility method\n     **\n     * Converts path to a new path where all segments are cubic bezier curves.\n     > Parameters\n     - pathString (string|array) path string or array of segments\n     = (array) array of segments.\n     \\*/\n    R.path2curve = path2curve;\n    /*\\\n     * Raphael.matrix\n     [ method ]\n     **\n     * Utility method\n     **\n     * Returns matrix based on given parameters.\n     > Parameters\n     - a (number)\n     - b (number)\n     - c (number)\n     - d (number)\n     - e (number)\n     - f (number)\n     = (object) @Matrix\n     \\*/\n    R.matrix = function (a, b, c, d, e, f) {\n        return new Matrix(a, b, c, d, e, f);\n    };\n    function Matrix(a, b, c, d, e, f) {\n        if (a != null) {\n            this.a = +a;\n            this.b = +b;\n            this.c = +c;\n            this.d = +d;\n            this.e = +e;\n            this.f = +f;\n        } else {\n            this.a = 1;\n            this.b = 0;\n            this.c = 0;\n            this.d = 1;\n            this.e = 0;\n            this.f = 0;\n        }\n    }\n    (function (matrixproto) {\n        /*\\\n         * Matrix.add\n         [ method ]\n         **\n         * Adds given matrix to existing one.\n         > Parameters\n         - a (number)\n         - b (number)\n         - c (number)\n         - d (number)\n         - e (number)\n         - f (number)\n         or\n         - matrix (object) @Matrix\n         \\*/\n        matrixproto.add = function (a, b, c, d, e, f) {\n            var out = [[], [], []],\n                m = [[this.a, this.c, this.e], [this.b, this.d, this.f], [0, 0, 1]],\n                matrix = [[a, c, e], [b, d, f], [0, 0, 1]],\n                x, y, z, res;\n\n            if (a && a instanceof Matrix) {\n                matrix = [[a.a, a.c, a.e], [a.b, a.d, a.f], [0, 0, 1]];\n            }\n\n            for (x = 0; x < 3; x++) {\n                for (y = 0; y < 3; y++) {\n                    res = 0;\n                    for (z = 0; z < 3; z++) {\n                        res += m[x][z] * matrix[z][y];\n                    }\n                    out[x][y] = res;\n                }\n            }\n            this.a = out[0][0];\n            this.b = out[1][0];\n            this.c = out[0][1];\n            this.d = out[1][1];\n            this.e = out[0][2];\n            this.f = out[1][2];\n        };\n        /*\\\n         * Matrix.invert\n         [ method ]\n         **\n         * Returns inverted version of the matrix\n         = (object) @Matrix\n         \\*/\n        matrixproto.invert = function () {\n            var me = this,\n                x = me.a * me.d - me.b * me.c;\n            return new Matrix(me.d / x, -me.b / x, -me.c / x, me.a / x, (me.c * me.f - me.d * me.e) / x, (me.b * me.e - me.a * me.f) / x);\n        };\n        /*\\\n         * Matrix.clone\n         [ method ]\n         **\n         * Returns copy of the matrix\n         = (object) @Matrix\n         \\*/\n        matrixproto.clone = function () {\n            return new Matrix(this.a, this.b, this.c, this.d, this.e, this.f);\n        };\n        /*\\\n         * Matrix.translate\n         [ method ]\n         **\n         * Translate the matrix\n         > Parameters\n         - x (number)\n         - y (number)\n         \\*/\n        matrixproto.translate = function (x, y) {\n            this.add(1, 0, 0, 1, x, y);\n        };\n        /*\\\n         * Matrix.scale\n         [ method ]\n         **\n         * Scales the matrix\n         > Parameters\n         - x (number)\n         - y (number) #optional\n         - cx (number) #optional\n         - cy (number) #optional\n         \\*/\n        matrixproto.scale = function (x, y, cx, cy) {\n            y == null && (y = x);\n            (cx || cy) && this.add(1, 0, 0, 1, cx, cy);\n            this.add(x, 0, 0, y, 0, 0);\n            (cx || cy) && this.add(1, 0, 0, 1, -cx, -cy);\n        };\n        /*\\\n         * Matrix.rotate\n         [ method ]\n         **\n         * Rotates the matrix\n         > Parameters\n         - a (number)\n         - x (number)\n         - y (number)\n         \\*/\n        matrixproto.rotate = function (a, x, y) {\n            a = R.rad(a);\n            x = x || 0;\n            y = y || 0;\n            var cos = +math.cos(a).toFixed(9),\n                sin = +math.sin(a).toFixed(9);\n            this.add(cos, sin, -sin, cos, x, y);\n            this.add(1, 0, 0, 1, -x, -y);\n        };\n        /*\\\n         * Matrix.x\n         [ method ]\n         **\n         * Return x coordinate for given point after transformation described by the matrix. See also @Matrix.y\n         > Parameters\n         - x (number)\n         - y (number)\n         = (number) x\n         \\*/\n        matrixproto.x = function (x, y) {\n            return x * this.a + y * this.c + this.e;\n        };\n        /*\\\n         * Matrix.y\n         [ method ]\n         **\n         * Return y coordinate for given point after transformation described by the matrix. See also @Matrix.x\n         > Parameters\n         - x (number)\n         - y (number)\n         = (number) y\n         \\*/\n        matrixproto.y = function (x, y) {\n            return x * this.b + y * this.d + this.f;\n        };\n        matrixproto.get = function (i) {\n            return +this[Str.fromCharCode(97 + i)].toFixed(4);\n        };\n        matrixproto.toString = function () {\n            return R.svg ?\n            "matrix(" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)].join() + ")" :\n                [this.get(0), this.get(2), this.get(1), this.get(3), 0, 0].join();\n        };\n        matrixproto.toFilter = function () {\n            return "progid:DXImageTransform.Microsoft.Matrix(M11=" + this.get(0) +\n                ", M12=" + this.get(2) + ", M21=" + this.get(1) + ", M22=" + this.get(3) +\n                ", Dx=" + this.get(4) + ", Dy=" + this.get(5) + ", sizingmethod=\'auto expand\')";\n        };\n        matrixproto.offset = function () {\n            return [this.e.toFixed(4), this.f.toFixed(4)];\n        };\n        function norm(a) {\n            return a[0] * a[0] + a[1] * a[1];\n        }\n        function normalize(a) {\n            var mag = math.sqrt(norm(a));\n            a[0] && (a[0] /= mag);\n            a[1] && (a[1] /= mag);\n        }\n        /*\\\n         * Matrix.split\n         [ method ]\n         **\n         * Splits matrix into primitive transformations\n         = (object) in format:\n         o dx (number) translation by x\n         o dy (number) translation by y\n         o scalex (number) scale by x\n         o scaley (number) scale by y\n         o shear (number) shear\n         o rotate (number) rotation in deg\n         o isSimple (boolean) could it be represented via simple transformations\n         \\*/\n        matrixproto.split = function () {\n            var out = {};\n            // translation\n            out.dx = this.e;\n            out.dy = this.f;\n\n            // scale and shear\n            var row = [[this.a, this.c], [this.b, this.d]];\n            out.scalex = math.sqrt(norm(row[0]));\n            normalize(row[0]);\n\n            out.shear = row[0][0] * row[1][0] + row[0][1] * row[1][1];\n            row[1] = [row[1][0] - row[0][0] * out.shear, row[1][1] - row[0][1] * out.shear];\n\n            out.scaley = math.sqrt(norm(row[1]));\n            normalize(row[1]);\n            out.shear /= out.scaley;\n\n            // rotation\n            var sin = -row[0][1],\n                cos = row[1][1];\n            if (cos < 0) {\n                out.rotate = R.deg(math.acos(cos));\n                if (sin < 0) {\n                    out.rotate = 360 - out.rotate;\n                }\n            } else {\n                out.rotate = R.deg(math.asin(sin));\n            }\n\n            out.isSimple = !+out.shear.toFixed(9) && (out.scalex.toFixed(9) == out.scaley.toFixed(9) || !out.rotate);\n            out.isSuperSimple = !+out.shear.toFixed(9) && out.scalex.toFixed(9) == out.scaley.toFixed(9) && !out.rotate;\n            out.noRotation = !+out.shear.toFixed(9) && !out.rotate;\n            return out;\n        };\n        /*\\\n         * Matrix.toTransformString\n         [ method ]\n         **\n         * Return transform string that represents given matrix\n         = (string) transform string\n         \\*/\n        matrixproto.toTransformString = function (shorter) {\n            var s = shorter || this[split]();\n            if (s.isSimple) {\n                s.scalex = +s.scalex.toFixed(4);\n                s.scaley = +s.scaley.toFixed(4);\n                s.rotate = +s.rotate.toFixed(4);\n                return  (s.dx || s.dy ? "t" + [s.dx, s.dy] : E) +\n                    (s.scalex != 1 || s.scaley != 1 ? "s" + [s.scalex, s.scaley, 0, 0] : E) +\n                    (s.rotate ? "r" + [s.rotate, 0, 0] : E);\n            } else {\n                return "m" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)];\n            }\n        };\n    })(Matrix.prototype);\n\n    var preventDefault = function () {\n            this.returnValue = false;\n        },\n        preventTouch = function () {\n            return this.originalEvent.preventDefault();\n        },\n        stopPropagation = function () {\n            this.cancelBubble = true;\n        },\n        stopTouch = function () {\n            return this.originalEvent.stopPropagation();\n        },\n        getEventPosition = function (e) {\n            var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\n                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft;\n\n            return {\n                x: e.clientX + scrollX,\n                y: e.clientY + scrollY\n            };\n        },\n        addEvent = (function () {\n            if (g.doc.addEventListener) {\n                return function (obj, type, fn, element) {\n                    var f = function (e) {\n                        var pos = getEventPosition(e);\n                        return fn.call(element, e, pos.x, pos.y);\n                    };\n                    obj.addEventListener(type, f, false);\n\n                    if (supportsTouch && touchMap[type]) {\n                        var _f = function (e) {\n                            var pos = getEventPosition(e),\n                                olde = e;\n\n                            for (var i = 0, ii = e.targetTouches && e.targetTouches.length; i < ii; i++) {\n                                if (e.targetTouches[i].target == obj) {\n                                    e = e.targetTouches[i];\n                                    e.originalEvent = olde;\n                                    e.preventDefault = preventTouch;\n                                    e.stopPropagation = stopTouch;\n                                    break;\n                                }\n                            }\n\n                            return fn.call(element, e, pos.x, pos.y);\n                        };\n                        obj.addEventListener(touchMap[type], _f, false);\n                    }\n\n                    return function () {\n                        obj.removeEventListener(type, f, false);\n\n                        if (supportsTouch && touchMap[type])\n                            obj.removeEventListener(touchMap[type], _f, false);\n\n                        return true;\n                    };\n                };\n            } else if (g.doc.attachEvent) {\n                return function (obj, type, fn, element) {\n                    var f = function (e) {\n                        e = e || g.win.event;\n                        var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\n                            scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,\n                            x = e.clientX + scrollX,\n                            y = e.clientY + scrollY;\n                        e.preventDefault = e.preventDefault || preventDefault;\n                        e.stopPropagation = e.stopPropagation || stopPropagation;\n                        return fn.call(element, e, x, y);\n                    };\n                    obj.attachEvent("on" + type, f);\n                    var detacher = function () {\n                        obj.detachEvent("on" + type, f);\n                        return true;\n                    };\n                    return detacher;\n                };\n            }\n        })(),\n        drag = [],\n        dragMove = function (e) {\n            var x = e.clientX,\n                y = e.clientY,\n                scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\n                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,\n                dragi,\n                j = drag.length;\n            while (j--) {\n                dragi = drag[j];\n                if (supportsTouch && e.touches) {\n                    var i = e.touches.length,\n                        touch;\n                    while (i--) {\n                        touch = e.touches[i];\n                        if (touch.identifier == dragi.el._drag.id) {\n                            x = touch.clientX;\n                            y = touch.clientY;\n                            (e.originalEvent ? e.originalEvent : e).preventDefault();\n                            break;\n                        }\n                    }\n                } else {\n                    e.preventDefault();\n                }\n                var node = dragi.el.node,\n                    o,\n                    next = node.nextSibling,\n                    parent = node.parentNode,\n                    display = node.style.display;\n                g.win.opera && parent.removeChild(node);\n                node.style.display = "none";\n                o = dragi.el.paper.getElementByPoint(x, y);\n                node.style.display = display;\n                g.win.opera && (next ? parent.insertBefore(node, next) : parent.appendChild(node));\n                o && eve("raphael.drag.over." + dragi.el.id, dragi.el, o);\n                x += scrollX;\n                y += scrollY;\n                eve("raphael.drag.move." + dragi.el.id, dragi.move_scope || dragi.el, x - dragi.el._drag.x, y - dragi.el._drag.y, x, y, e);\n            }\n        },\n        dragUp = function (e) {\n            R.unmousemove(dragMove).unmouseup(dragUp);\n            var i = drag.length,\n                dragi;\n            while (i--) {\n                dragi = drag[i];\n                dragi.el._drag = {};\n                eve("raphael.drag.end." + dragi.el.id, dragi.end_scope || dragi.start_scope || dragi.move_scope || dragi.el, e);\n            }\n            drag = [];\n        },\n    /*\\\n     * Raphael.el\n     [ property (object) ]\n     **\n     * You can add your own method to elements. This is usefull when you want to hack default functionality or\n     * want to wrap some common transformation or attributes in one method. In difference to canvas methods,\n     * you can redefine element method at any time. Expending element methods wouldn’t affect set.\n     > Usage\n     | Raphael.el.red = function () {\n     |     this.attr({fill: "#f00"});\n     | };\n     | // then use it\n     | paper.circle(100, 100, 20).red();\n     \\*/\n        elproto = R.el = {};\n    /*\\\n     * Element.click\n     [ method ]\n     **\n     * Adds event handler for click for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.unclick\n     [ method ]\n     **\n     * Removes event handler for click for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.dblclick\n     [ method ]\n     **\n     * Adds event handler for double click for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.undblclick\n     [ method ]\n     **\n     * Removes event handler for double click for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.mousedown\n     [ method ]\n     **\n     * Adds event handler for mousedown for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.unmousedown\n     [ method ]\n     **\n     * Removes event handler for mousedown for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.mousemove\n     [ method ]\n     **\n     * Adds event handler for mousemove for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.unmousemove\n     [ method ]\n     **\n     * Removes event handler for mousemove for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.mouseout\n     [ method ]\n     **\n     * Adds event handler for mouseout for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.unmouseout\n     [ method ]\n     **\n     * Removes event handler for mouseout for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.mouseover\n     [ method ]\n     **\n     * Adds event handler for mouseover for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.unmouseover\n     [ method ]\n     **\n     * Removes event handler for mouseover for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.mouseup\n     [ method ]\n     **\n     * Adds event handler for mouseup for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.unmouseup\n     [ method ]\n     **\n     * Removes event handler for mouseup for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.touchstart\n     [ method ]\n     **\n     * Adds event handler for touchstart for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.untouchstart\n     [ method ]\n     **\n     * Removes event handler for touchstart for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.touchmove\n     [ method ]\n     **\n     * Adds event handler for touchmove for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.untouchmove\n     [ method ]\n     **\n     * Removes event handler for touchmove for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.touchend\n     [ method ]\n     **\n     * Adds event handler for touchend for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.untouchend\n     [ method ]\n     **\n     * Removes event handler for touchend for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n\n    /*\\\n     * Element.touchcancel\n     [ method ]\n     **\n     * Adds event handler for touchcancel for the element.\n     > Parameters\n     - handler (function) handler for the event\n     = (object) @Element\n     \\*/\n    /*\\\n     * Element.untouchcancel\n     [ method ]\n     **\n     * Removes event handler for touchcancel for the element.\n     > Parameters\n     - handler (function) #optional handler for the event\n     = (object) @Element\n     \\*/\n    for (var i = events.length; i--;) {\n        (function (eventName) {\n            R[eventName] = elproto[eventName] = function (fn, scope) {\n                if (R.is(fn, "function")) {\n                    this.events = this.events || [];\n                    this.events.push({name: eventName, f: fn, unbind: addEvent(this.shape || this.node || g.doc, eventName, fn, scope || this)});\n                }\n                return this;\n            };\n            R["un" + eventName] = elproto["un" + eventName] = function (fn) {\n                var events = this.events || [],\n                    l = events.length;\n                while (l--){\n                    if (events[l].name == eventName && (R.is(fn, "undefined") || events[l].f == fn)) {\n                        events[l].unbind();\n                        events.splice(l, 1);\n                        !events.length && delete this.events;\n                    }\n                }\n                return this;\n            };\n        })(events[i]);\n    }\n\n    /*\\\n     * Element.data\n     [ method ]\n     **\n     * Adds or retrieves given value asociated with given key.\n     **\n     * See also @Element.removeData\n     > Parameters\n     - key (string) key to store data\n     - value (any) #optional value to store\n     = (object) @Element\n     * or, if value is not specified:\n     = (any) value\n     * or, if key and value are not specified:\n     = (object) Key/value pairs for all the data associated with the element.\n     > Usage\n     | for (var i = 0, i < 5, i++) {\n     |     paper.circle(10 + 15 * i, 10, 10)\n     |          .attr({fill: "#000"})\n     |          .data("i", i)\n     |          .click(function () {\n     |             alert(this.data("i"));\n     |          });\n     | }\n     \\*/\n    elproto.data = function (key, value) {\n        var data = eldata[this.id] = eldata[this.id] || {};\n        if (arguments.length == 0) {\n            return data;\n        }\n        if (arguments.length == 1) {\n            if (R.is(key, "object")) {\n                for (var i in key) if (key[has](i)) {\n                    this.data(i, key[i]);\n                }\n                return this;\n            }\n            eve("raphael.data.get." + this.id, this, data[key], key);\n            return data[key];\n        }\n        data[key] = value;\n        eve("raphael.data.set." + this.id, this, value, key);\n        return this;\n    };\n\n    elproto.datum = function(){\n        return arguments.length == 0 ? this._bindData : ((this._bindData = arguments[0]), this);\n    };\n\n    /*\\\n     * Element.removeData\n     [ method ]\n     **\n     * Removes value associated with an element by given key.\n     * If key is not provided, removes all the data of the element.\n     > Parameters\n     - key (string) #optional key\n     = (object) @Element\n     \\*/\n    elproto.removeData = function (key) {\n        if (key == null) {\n            eldata[this.id] = {};\n        } else {\n            eldata[this.id] && delete eldata[this.id][key];\n        }\n        return this;\n    };\n    /*\\\n     * Element.getData\n     [ method ]\n     **\n     * Retrieves the element data\n     = (object) data\n     \\*/\n    elproto.getData = function () {\n        return clone(eldata[this.id] || {});\n    };\n    /*\\\n     * Element.hover\n     [ method ]\n     **\n     * Adds event handlers for hover for the element.\n     > Parameters\n     - f_in (function) handler for hover in\n     - f_out (function) handler for hover out\n     - icontext (object) #optional context for hover in handler\n     - ocontext (object) #optional context for hover out handler\n     = (object) @Element\n     \\*/\n    elproto.hover = function (f_in, f_out, scope_in, scope_out) {\n        return this.mouseover(f_in, scope_in).mouseout(f_out, scope_out || scope_in);\n    };\n    /*\\\n     * Element.unhover\n     [ method ]\n     **\n     * Removes event handlers for hover for the element.\n     > Parameters\n     - f_in (function) handler for hover in\n     - f_out (function) handler for hover out\n     = (object) @Element\n     \\*/\n    elproto.unhover = function (f_in, f_out) {\n        return this.unmouseover(f_in).unmouseout(f_out);\n    };\n    var draggable = [];\n    /*\\\n     * Element.drag\n     [ method ]\n     **\n     * Adds event handlers for drag of the element.\n     > Parameters\n     - onmove (function) handler for moving\n     - onstart (function) handler for drag start\n     - onend (function) handler for drag end\n     - mcontext (object) #optional context for moving handler\n     - scontext (object) #optional context for drag start handler\n     - econtext (object) #optional context for drag end handler\n     * Additionaly following `drag` events will be triggered: `drag.start.<id>` on start,\n     * `drag.end.<id>` on end and `drag.move.<id>` on every move. When element will be dragged over another element\n     * `drag.over.<id>` will be fired as well.\n     *\n     * Start event and start handler will be called in specified context or in context of the element with following parameters:\n     o x (number) x position of the mouse\n     o y (number) y position of the mouse\n     o event (object) DOM event object\n     * Move event and move handler will be called in specified context or in context of the element with following parameters:\n     o dx (number) shift by x from the start point\n     o dy (number) shift by y from the start point\n     o x (number) x position of the mouse\n     o y (number) y position of the mouse\n     o event (object) DOM event object\n     * End event and end handler will be called in specified context or in context of the element with following parameters:\n     o event (object) DOM event object\n     = (object) @Element\n     \\*/\n    elproto.drag = function (onmove, onstart, onend, move_scope, start_scope, end_scope) {\n        function start(e) {\n            (e.originalEvent || e).preventDefault();\n            var x = e.clientX,\n                y = e.clientY,\n                scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\n                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft;\n            this._drag.id = e.identifier;\n            if (supportsTouch && e.touches) {\n                var i = e.touches.length, touch;\n                while (i--) {\n                    touch = e.touches[i];\n                    this._drag.id = touch.identifier;\n                    if (touch.identifier == this._drag.id) {\n                        x = touch.clientX;\n                        y = touch.clientY;\n                        break;\n                    }\n                }\n            }\n            this._drag.x = x + scrollX;\n            this._drag.y = y + scrollY;\n            !drag.length && R.mousemove(dragMove).mouseup(dragUp);\n            drag.push({el: this, move_scope: move_scope, start_scope: start_scope, end_scope: end_scope});\n            onstart && eve.on("raphael.drag.start." + this.id, onstart);\n            onmove && eve.on("raphael.drag.move." + this.id, onmove);\n            onend && eve.on("raphael.drag.end." + this.id, onend);\n            eve("raphael.drag.start." + this.id, start_scope || move_scope || this, e.clientX + scrollX, e.clientY + scrollY, e);\n        }\n        this._drag = {};\n        draggable.push({el: this, start: start});\n        this.mousedown(start);\n        return this;\n    };\n    /*\\\n     * Element.onDragOver\n     [ method ]\n     **\n     * Shortcut for assigning event handler for `drag.over.<id>` event, where id is id of the element (see @Element.id).\n     > Parameters\n     - f (function) handler for event, first argument would be the element you are dragging over\n     \\*/\n    elproto.onDragOver = function (f) {\n        f ? eve.on("raphael.drag.over." + this.id, f) : eve.unbind("raphael.drag.over." + this.id);\n    };\n    /*\\\n     * Element.undrag\n     [ method ]\n     **\n     * Removes all drag event handlers from given element.\n     \\*/\n    elproto.undrag = function () {\n        var i = draggable.length;\n        while (i--) if (draggable[i].el == this) {\n            this.unmousedown(draggable[i].start);\n            draggable.splice(i, 1);\n            eve.unbind("raphael.drag.*." + this.id);\n        }\n        !draggable.length && R.unmousemove(dragMove).unmouseup(dragUp);\n        drag = [];\n    };\n    /*\\\n     * Paper.circle\n     [ method ]\n     **\n     * Draws a circle.\n     **\n     > Parameters\n     **\n     - x (number) x coordinate of the centre\n     - y (number) y coordinate of the centre\n     - r (number) radius\n     = (object) Raphaël element object with type “circle”\n     **\n     > Usage\n     | var c = paper.circle(50, 50, 40);\n     \\*/\n    paperproto.circle = function (x, y, r) {\n        var out = R._engine.circle(this, x || 0, y || 0, r || 0);\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Paper.rect\n     [ method ]\n     *\n     * Draws a rectangle.\n     **\n     > Parameters\n     **\n     - x (number) x coordinate of the top left corner\n     - y (number) y coordinate of the top left corner\n     - width (number) width\n     - height (number) height\n     - r (number) #optional radius for rounded corners, default is 0\n     = (object) Raphaël element object with type “rect”\n     **\n     > Usage\n     | // regular rectangle\n     | var c = paper.rect(10, 10, 50, 50);\n     | // rectangle with rounded corners\n     | var c = paper.rect(40, 40, 50, 50, 10);\n     \\*/\n    paperproto.rect = function (x, y, w, h, r) {\n        var out = R._engine.rect(this, x || 0, y || 0, w || 0, h || 0, r || 0);\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Paper.ellipse\n     [ method ]\n     **\n     * Draws an ellipse.\n     **\n     > Parameters\n     **\n     - x (number) x coordinate of the centre\n     - y (number) y coordinate of the centre\n     - rx (number) horizontal radius\n     - ry (number) vertical radius\n     = (object) Raphaël element object with type “ellipse”\n     **\n     > Usage\n     | var c = paper.ellipse(50, 50, 40, 20);\n     \\*/\n    paperproto.ellipse = function (x, y, rx, ry) {\n        var out = R._engine.ellipse(this, x || 0, y || 0, rx || 0, ry || 0);\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Paper.path\n     [ method ]\n     **\n     * Creates a path element by given path data string.\n     > Parameters\n     - pathString (string) #optional path string in SVG format.\n     * Path string consists of one-letter commands, followed by comma seprarated arguments in numercal form. Example:\n     | "M10,20L30,40"\n     * Here we can see two commands: “M”, with arguments `(10, 20)` and “L” with arguments `(30, 40)`. Upper case letter mean command is absolute, lower case—relative.\n     *\n     # <p>Here is short list of commands available, for more details see <a href="http://www.w3.org/TR/SVG/paths.html#PathData" title="Details of a path\'s data attribute\'s format are described in the SVG specification.">SVG path string format</a>.</p>\n     # <table><thead><tr><th>Command</th><th>Name</th><th>Parameters</th></tr></thead><tbody>\n     # <tr><td>M</td><td>moveto</td><td>(x y)+</td></tr>\n     # <tr><td>Z</td><td>closepath</td><td>(none)</td></tr>\n     # <tr><td>L</td><td>lineto</td><td>(x y)+</td></tr>\n     # <tr><td>H</td><td>horizontal lineto</td><td>x+</td></tr>\n     # <tr><td>V</td><td>vertical lineto</td><td>y+</td></tr>\n     # <tr><td>C</td><td>curveto</td><td>(x1 y1 x2 y2 x y)+</td></tr>\n     # <tr><td>S</td><td>smooth curveto</td><td>(x2 y2 x y)+</td></tr>\n     # <tr><td>Q</td><td>quadratic Bézier curveto</td><td>(x1 y1 x y)+</td></tr>\n     # <tr><td>T</td><td>smooth quadratic Bézier curveto</td><td>(x y)+</td></tr>\n     # <tr><td>A</td><td>elliptical arc</td><td>(rx ry x-axis-rotation large-arc-flag sweep-flag x y)+</td></tr>\n     # <tr><td>R</td><td><a href="http://en.wikipedia.org/wiki/Catmull–Rom_spline#Catmull.E2.80.93Rom_spline">Catmull-Rom curveto</a>*</td><td>x1 y1 (x y)+</td></tr></tbody></table>\n     * * “Catmull-Rom curveto” is a not standard SVG command and added in 2.0 to make life easier.\n     * Note: there is a special case when path consist of just three commands: “M10,10R…z”. In this case path will smoothly connects to its beginning.\n     > Usage\n     | var c = paper.path("M10 10L90 90");\n     | // draw a diagonal line:\n     | // move to 10,10, line to 90,90\n     * For example of path strings, check out these icons: http://raphaeljs.com/icons/\n     \\*/\n    paperproto.path = function (pathString) {\n        pathString && !R.is(pathString, string) && !R.is(pathString[0], array) && (pathString += E);\n        var out = R._engine.path(R.format[apply](R, arguments), this);\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Paper.image\n     [ method ]\n     **\n     * Embeds an image into the surface.\n     **\n     > Parameters\n     **\n     - src (string) URI of the source image\n     - x (number) x coordinate position\n     - y (number) y coordinate position\n     - width (number) width of the image\n     - height (number) height of the image\n     = (object) Raphaël element object with type “image”\n     **\n     > Usage\n     | var c = paper.image("apple.png", 10, 10, 80, 80);\n     \\*/\n    paperproto.image = function (src, x, y, w, h) {\n        var out = R._engine.image(this, src || "about:blank", x || 0, y || 0, w || 0, h || 0);\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Paper.text\n     [ method ]\n     **\n     * Draws a text string. If you need line breaks, put “\\n” in the string.\n     **\n     > Parameters\n     **\n     - x (number) x coordinate position\n     - y (number) y coordinate position\n     - text (string) The text string to draw\n     = (object) Raphaël element object with type “text”\n     **\n     > Usage\n     | var t = paper.text(50, 50, "Raphaël\\nkicks\\nbutt!");\n     \\*/\n    paperproto.text = function (x, y, text) {\n        var out = R._engine.text(this, x || 0, y || 0, Str(text));\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Paper.set\n     [ method ]\n     **\n     * Creates array-like object to keep and operate several elements at once.\n     * Warning: it doesn’t create any elements for itself in the page, it just groups existing elements.\n     * Sets act as pseudo elements — all methods available to an element can be used on a set.\n     = (object) array-like object that represents set of elements\n     **\n     > Usage\n     | var st = paper.set();\n     | st.push(\n     |     paper.circle(10, 10, 5),\n     |     paper.circle(30, 10, 5)\n     | );\n     | st.attr({fill: "red"}); // changes the fill of both circles\n     \\*/\n    paperproto.set = function (itemsArray) {\n        !R.is(itemsArray, "array") && (itemsArray = Array.prototype.splice.call(arguments, 0, arguments.length));\n        var out = new Set(itemsArray);\n        this.__set__ && this.__set__.push(out);\n        out["paper"] = this;\n        out["type"] = "set";\n        return out;\n    };\n    /*\\\n     * Paper.setStart\n     [ method ]\n     **\n     * Creates @Paper.set. All elements that will be created after calling this method and before calling\n     * @Paper.setFinish will be added to the set.\n     **\n     > Usage\n     | paper.setStart();\n     | paper.circle(10, 10, 5),\n     | paper.circle(30, 10, 5)\n     | var st = paper.setFinish();\n     | st.attr({fill: "red"}); // changes the fill of both circles\n     \\*/\n    paperproto.setStart = function (set) {\n        this.__set__ = set || this.set();\n    };\n    /*\\\n     * Paper.setFinish\n     [ method ]\n     **\n     * See @Paper.setStart. This method finishes catching and returns resulting set.\n     **\n     = (object) set\n     \\*/\n    paperproto.setFinish = function (set) {\n        var out = this.__set__;\n        delete this.__set__;\n        return out;\n    };\n    /*\\\n     * Paper.getSize\n     [ method ]\n     **\n     * Obtains current paper actual size.\n     **\n     = (object)\n     \\*/\n    paperproto.getSize = function () {\n        var container = this.canvas.parentNode;\n        return {\n            width: container.offsetWidth,\n            height: container.offsetHeight\n        };\n    };\n    /*\\\n     * Paper.setSize\n     [ method ]\n     **\n     * If you need to change dimensions of the canvas call this method\n     **\n     > Parameters\n     **\n     - width (number) new width of the canvas\n     - height (number) new height of the canvas\n     \\*/\n    paperproto.setSize = function (width, height) {\n        return R._engine.setSize.call(this, width, height);\n    };\n    /*\\\n     * Paper.setViewBox\n     [ method ]\n     **\n     * Sets the view box of the paper. Practically it gives you ability to zoom and pan whole paper surface by\n     * specifying new boundaries.\n     **\n     > Parameters\n     **\n     - x (number) new x position, default is `0`\n     - y (number) new y position, default is `0`\n     - w (number) new width of the canvas\n     - h (number) new height of the canvas\n     - fit (boolean) `true` if you want graphics to fit into new boundary box\n     \\*/\n    paperproto.setViewBox = function (x, y, w, h, fit) {\n        return R._engine.setViewBox.call(this, x, y, w, h, fit);\n    };\n    /*\\\n     * Paper.top\n     [ property ]\n     **\n     * Points to the topmost element on the paper\n     \\*/\n    /*\\\n     * Paper.bottom\n     [ property ]\n     **\n     * Points to the bottom element on the paper\n     \\*/\n    paperproto.top = paperproto.bottom = null;\n    /*\\\n     * Paper.raphael\n     [ property ]\n     **\n     * Points to the @Raphael object/function\n     \\*/\n    paperproto.raphael = R;\n    var getOffset = function (elem) {\n        var box = elem.getBoundingClientRect(),\n            doc = elem.ownerDocument,\n            body = doc.body,\n            docElem = doc.documentElement,\n            clientTop = docElem.clientTop || body.clientTop || 0, clientLeft = docElem.clientLeft || body.clientLeft || 0,\n            top  = box.top  + (g.win.pageYOffset || docElem.scrollTop || body.scrollTop ) - clientTop,\n            left = box.left + (g.win.pageXOffset || docElem.scrollLeft || body.scrollLeft) - clientLeft;\n        return {\n            y: top,\n            x: left\n        };\n    };\n    /*\\\n     * Paper.getElementByPoint\n     [ method ]\n     **\n     * Returns you topmost element under given point.\n     **\n     = (object) Raphaël element object\n     > Parameters\n     **\n     - x (number) x coordinate from the top left corner of the window\n     - y (number) y coordinate from the top left corner of the window\n     > Usage\n     | paper.getElementByPoint(mouseX, mouseY).attr({stroke: "#f00"});\n     \\*/\n    paperproto.getElementByPoint = function (x, y) {\n        var paper = this,\n            svg = paper.canvas,\n            target = g.doc.elementFromPoint(x, y);\n        if (g.win.opera && target.tagName == "svg") {\n            var so = getOffset(svg),\n                sr = svg.createSVGRect();\n            sr.x = x - so.x;\n            sr.y = y - so.y;\n            sr.width = sr.height = 1;\n            var hits = svg.getIntersectionList(sr, null);\n            if (hits.length) {\n                target = hits[hits.length - 1];\n            }\n        }\n        if (!target) {\n            return null;\n        }\n        while (target.parentNode && target != svg.parentNode && !target.raphael) {\n            target = target.parentNode;\n        }\n        target == paper.canvas.parentNode && (target = svg);\n        target = target && target.raphael ? paper.getById(target.raphaelid) : null;\n        return target;\n    };\n\n    /*\\\n     * Paper.getElementsByBBox\n     [ method ]\n     **\n     * Returns set of elements that have an intersecting bounding box\n     **\n     > Parameters\n     **\n     - bbox (object) bbox to check with\n     = (object) @Set\n     \\*/\n    paperproto.getElementsByBBox = function (bbox) {\n        var set = this.set();\n        this.forEach(function (el) {\n            if (R.isBBoxIntersect(el.getBBox(), bbox)) {\n                set.push(el);\n            }\n        });\n        return set;\n    };\n\n    /*\\\n     * Paper.getById\n     [ method ]\n     **\n     * Returns you element by its internal ID.\n     **\n     > Parameters\n     **\n     - id (number) id\n     = (object) Raphaël element object\n     \\*/\n    paperproto.getById = function (id) {\n        var bot = this.bottom;\n        while (bot) {\n            if (bot.id == id) {\n                return bot;\n            }\n            bot = bot.next;\n        }\n        return null;\n    };\n    /*\\\n     * Paper.forEach\n     [ method ]\n     **\n     * Executes given function for each element on the paper\n     *\n     * If callback function returns `false` it will stop loop running.\n     **\n     > Parameters\n     **\n     - callback (function) function to run\n     - thisArg (object) context object for the callback\n     = (object) Paper object\n     > Usage\n     | paper.forEach(function (el) {\n     |     el.attr({ stroke: "blue" });\n     | });\n     \\*/\n    paperproto.forEach = function (callback, thisArg) {\n        var bot = this.bottom;\n        while (bot) {\n            if (callback.call(thisArg, bot) === false) {\n                return this;\n            }\n            bot = bot.next;\n        }\n        return this;\n    };\n    /*\\\n     * Paper.getElementsByPoint\n     [ method ]\n     **\n     * Returns set of elements that have common point inside\n     **\n     > Parameters\n     **\n     - x (number) x coordinate of the point\n     - y (number) y coordinate of the point\n     = (object) @Set\n     \\*/\n    paperproto.getElementsByPoint = function (x, y) {\n        var set = this.set();\n        this.forEach(function (el) {\n            if (el.isPointInside(x, y)) {\n                set.push(el);\n            }\n        });\n        return set;\n    };\n    function x_y() {\n        return this.x + S + this.y;\n    }\n    function x_y_w_h() {\n        return this.x + S + this.y + S + this.width + " \\xd7 " + this.height;\n    }\n    /*\\\n     * Element.isPointInside\n     [ method ]\n     **\n     * Determine if given point is inside this element’s shape\n     **\n     > Parameters\n     **\n     - x (number) x coordinate of the point\n     - y (number) y coordinate of the point\n     = (boolean) `true` if point inside the shape\n     \\*/\n    elproto.isPointInside = function (x, y) {\n        var rp = this.realPath = getPath[this.type](this);\n        if (this.attr(\'transform\') && this.attr(\'transform\').length) {\n            rp = R.transformPath(rp, this.attr(\'transform\'));\n        }\n        return R.isPointInsidePath(rp, x, y);\n    };\n    /*\\\n     * Element.getBBox\n     [ method ]\n     **\n     * Return bounding box for a given element\n     **\n     > Parameters\n     **\n     - isWithoutTransform (boolean) flag, `true` if you want to have bounding box before transformations. Default is `false`.\n     = (object) Bounding box object:\n     o {\n     o     x: (number) top left corner x\n     o     y: (number) top left corner y\n     o     x2: (number) bottom right corner x\n     o     y2: (number) bottom right corner y\n     o     width: (number) width\n     o     height: (number) height\n     o }\n     \\*/\n    elproto.getBBox = function (isWithoutTransform) {\n        if (this.removed) {\n            return {};\n        }\n        var _ = this._;\n        if (isWithoutTransform) {\n            if (_.dirty || !_.bboxwt) {\n                this.realPath = getPath[this.type](this);\n                _.bboxwt = pathDimensions(this.realPath);\n                _.bboxwt.toString = x_y_w_h;\n                _.dirty = 0;\n            }\n            return _.bboxwt;\n        }\n        if (_.dirty || _.dirtyT || !_.bbox) {\n            if (_.dirty || !this.realPath) {\n                _.bboxwt = 0;\n                this.realPath = getPath[this.type](this);\n            }\n            _.bbox = pathDimensions(mapPath(this.realPath, this.matrix));\n            _.bbox.toString = x_y_w_h;\n            _.dirty = _.dirtyT = 0;\n        }\n        return _.bbox;\n    };\n    /*\\\n     * Element.clone\n     [ method ]\n     **\n     = (object) clone of a given element\n     **\n     \\*/\n    elproto.clone = function () {\n        if (this.removed) {\n            return null;\n        }\n        var out = this.paper[this.type]().attr(this.attr());\n        this.__set__ && this.__set__.push(out);\n        return out;\n    };\n    /*\\\n     * Element.glow\n     [ method ]\n     **\n     * Return set of elements that create glow-like effect around given element. See @Paper.set.\n     *\n     * Note: Glow is not connected to the element. If you change element attributes it won’t adjust itself.\n     **\n     > Parameters\n     **\n     - glow (object) #optional parameters object with all properties optional:\n     o {\n     o     width (number) size of the glow, default is `10`\n     o     fill (boolean) will it be filled, default is `false`\n     o     opacity (number) opacity, default is `0.5`\n     o     offsetx (number) horizontal offset, default is `0`\n     o     offsety (number) vertical offset, default is `0`\n     o     color (string) glow colour, default is `black`\n     o }\n     = (object) @Paper.set of elements that represents glow\n     \\*/\n    elproto.glow = function (glow) {\n        if (this.type == "text") {\n            return null;\n        }\n        glow = glow || {};\n        var s = {\n                width: (glow.width || 10) + (+this.attr("stroke-width") || 1),\n                fill: glow.fill || false,\n                opacity: glow.opacity == null ? .5 : glow.opacity,\n                offsetx: glow.offsetx || 0,\n                offsety: glow.offsety || 0,\n                color: glow.color || "#000"\n            },\n            c = s.width / 2,\n            r = this.paper,\n            out = r.set(),\n            path = this.realPath || getPath[this.type](this);\n        path = this.matrix ? mapPath(path, this.matrix) : path;\n        for (var i = 1; i < c + 1; i++) {\n            out.push(r.path(path).attr({\n                stroke: s.color,\n                fill: s.fill ? s.color : "none",\n                "stroke-linejoin": "round",\n                "stroke-linecap": "round",\n                "stroke-width": +(s.width / c * i).toFixed(3),\n                opacity: +(s.opacity / c).toFixed(3)\n            }));\n        }\n        return out.insertBefore(this).translate(s.offsetx, s.offsety);\n    };\n    var curveslengths = {},\n        getPointAtSegmentLength = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length) {\n            if (length == null) {\n                return bezlen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y);\n            } else {\n                return R.findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, getTatLen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length));\n            }\n        },\n        getLengthFactory = function (istotal, subpath) {\n            return function (path, length, onlystart) {\n                path = path2curve(path);\n                var x, y, p, l, sp = "", subpaths = {}, point,\n                    len = 0;\n                for (var i = 0, ii = path.length; i < ii; i++) {\n                    p = path[i];\n                    if (p[0] == "M") {\n                        x = +p[1];\n                        y = +p[2];\n                    } else {\n                        l = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\n                        if (len + l > length) {\n                            if (subpath && !subpaths.start) {\n                                point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\n                                sp += ["C" + point.start.x, point.start.y, point.m.x, point.m.y, point.x, point.y];\n                                if (onlystart) {return sp;}\n                                subpaths.start = sp;\n                                sp = ["M" + point.x, point.y + "C" + point.n.x, point.n.y, point.end.x, point.end.y, p[5], p[6]].join();\n                                len += l;\n                                x = +p[5];\n                                y = +p[6];\n                                continue;\n                            }\n                            if (!istotal && !subpath) {\n                                point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\n                                return {x: point.x, y: point.y, alpha: point.alpha};\n                            }\n                        }\n                        len += l;\n                        x = +p[5];\n                        y = +p[6];\n                    }\n                    sp += p.shift() + p;\n                }\n                subpaths.end = sp;\n                point = istotal ? len : subpath ? subpaths : R.findDotsAtSegment(x, y, p[0], p[1], p[2], p[3], p[4], p[5], 1);\n                point.alpha && (point = {x: point.x, y: point.y, alpha: point.alpha});\n                return point;\n            };\n        };\n    var getTotalLength = getLengthFactory(1),\n        getPointAtLength = getLengthFactory(),\n        getSubpathsAtLength = getLengthFactory(0, 1);\n    /*\\\n     * Raphael.getTotalLength\n     [ method ]\n     **\n     * Returns length of the given path in pixels.\n     **\n     > Parameters\n     **\n     - path (string) SVG path string.\n     **\n     = (number) length.\n     \\*/\n    R.getTotalLength = getTotalLength;\n    /*\\\n     * Raphael.getPointAtLength\n     [ method ]\n     **\n     * Return coordinates of the point located at the given length on the given path.\n     **\n     > Parameters\n     **\n     - path (string) SVG path string\n     - length (number)\n     **\n     = (object) representation of the point:\n     o {\n     o     x: (number) x coordinate\n     o     y: (number) y coordinate\n     o     alpha: (number) angle of derivative\n     o }\n     \\*/\n    R.getPointAtLength = getPointAtLength;\n    /*\\\n     * Raphael.getSubpath\n     [ method ]\n     **\n     * Return subpath of a given path from given length to given length.\n     **\n     > Parameters\n     **\n     - path (string) SVG path string\n     - from (number) position of the start of the segment\n     - to (number) position of the end of the segment\n     **\n     = (string) pathstring for the segment\n     \\*/\n    R.getSubpath = function (path, from, to) {\n        if (this.getTotalLength(path) - to < 1e-6) {\n            return getSubpathsAtLength(path, from).end;\n        }\n        var a = getSubpathsAtLength(path, to, 1);\n        return from ? getSubpathsAtLength(a, from).end : a;\n    };\n    /*\\\n     * Element.getTotalLength\n     [ method ]\n     **\n     * Returns length of the path in pixels. Only works for element of “path” type.\n     = (number) length.\n     \\*/\n    elproto.getTotalLength = function () {\n        var path = this.getPath();\n        if (!path) {\n            return;\n        }\n\n        if (this.node.getTotalLength) {\n            return this.node.getTotalLength();\n        }\n\n        return getTotalLength(path);\n    };\n    /*\\\n     * Element.getPointAtLength\n     [ method ]\n     **\n     * Return coordinates of the point located at the given length on the given path. Only works for element of “path” type.\n     **\n     > Parameters\n     **\n     - length (number)\n     **\n     = (object) representation of the point:\n     o {\n     o     x: (number) x coordinate\n     o     y: (number) y coordinate\n     o     alpha: (number) angle of derivative\n     o }\n     \\*/\n    elproto.getPointAtLength = function (length) {\n        var path = this.getPath();\n        if (!path) {\n            return;\n        }\n\n        return getPointAtLength(path, length);\n    };\n    /*\\\n     * Element.getPath\n     [ method ]\n     **\n     * Returns path of the element. Only works for elements of “path” type and simple elements like circle.\n     = (object) path\n     **\n     \\*/\n    elproto.getPath = function () {\n        var path,\n            getPath = R._getPath[this.type];\n\n        if (this.type == "text" || this.type == "set") {\n            return;\n        }\n\n        if (getPath) {\n            path = getPath(this);\n        }\n\n        return path;\n    };\n    /*\\\n     * Element.getSubpath\n     [ method ]\n     **\n     * Return subpath of a given element from given length to given length. Only works for element of “path” type.\n     **\n     > Parameters\n     **\n     - from (number) position of the start of the segment\n     - to (number) position of the end of the segment\n     **\n     = (string) pathstring for the segment\n     \\*/\n    elproto.getSubpath = function (from, to) {\n        var path = this.getPath();\n        if (!path) {\n            return;\n        }\n\n        return R.getSubpath(path, from, to);\n    };\n    /*\\\n     * Raphael.easing_formulas\n     [ property ]\n     **\n     * Object that contains easing formulas for animation. You could extend it with your own. By default it has following list of easing:\n     # <ul>\n     #     <li>“linear”</li>\n     #     <li>“&lt;” or “easeIn” or “ease-in”</li>\n     #     <li>“>” or “easeOut” or “ease-out”</li>\n     #     <li>“&lt;>” or “easeInOut” or “ease-in-out”</li>\n     #     <li>“backIn” or “back-in”</li>\n     #     <li>“backOut” or “back-out”</li>\n     #     <li>“elastic”</li>\n     #     <li>“bounce”</li>\n     # </ul>\n     # <p>See also <a href="http://raphaeljs.com/easing.html">Easing demo</a>.</p>\n     \\*/\n    var ef = R.easing_formulas = {\n        linear: function (n) {\n            return n;\n        },\n        "<": function (n) {\n            return pow(n, 1.7);\n        },\n        ">": function (n) {\n            return pow(n, .48);\n        },\n        "<>": function (n) {\n            var q = .48 - n / 1.04,\n                Q = math.sqrt(.1734 + q * q),\n                x = Q - q,\n                X = pow(abs(x), 1 / 3) * (x < 0 ? -1 : 1),\n                y = -Q - q,\n                Y = pow(abs(y), 1 / 3) * (y < 0 ? -1 : 1),\n                t = X + Y + .5;\n            return (1 - t) * 3 * t * t + t * t * t;\n        },\n        backIn: function (n) {\n            var s = 1.70158;\n            return n * n * ((s + 1) * n - s);\n        },\n        backOut: function (n) {\n            n = n - 1;\n            var s = 1.70158;\n            return n * n * ((s + 1) * n + s) + 1;\n        },\n        elastic: function (n) {\n            if (n == !!n) {\n                return n;\n            }\n            return pow(2, -10 * n) * math.sin((n - .075) * (2 * PI) / .3) + 1;\n        },\n        bounce: function (n) {\n            var s = 7.5625,\n                p = 2.75,\n                l;\n            if (n < (1 / p)) {\n                l = s * n * n;\n            } else {\n                if (n < (2 / p)) {\n                    n -= (1.5 / p);\n                    l = s * n * n + .75;\n                } else {\n                    if (n < (2.5 / p)) {\n                        n -= (2.25 / p);\n                        l = s * n * n + .9375;\n                    } else {\n                        n -= (2.625 / p);\n                        l = s * n * n + .984375;\n                    }\n                }\n            }\n            return l;\n        }\n    };\n    ef.easeIn = ef["ease-in"] = ef["<"];\n    ef.easeOut = ef["ease-out"] = ef[">"];\n    ef.easeInOut = ef["ease-in-out"] = ef["<>"];\n    ef["back-in"] = ef.backIn;\n    ef["back-out"] = ef.backOut;\n\n    var animationElements = [],\n        requestAnimFrame = window.requestAnimationFrame       ||\n            window.webkitRequestAnimationFrame ||\n            window.mozRequestAnimationFrame    ||\n            window.oRequestAnimationFrame      ||\n            window.msRequestAnimationFrame     ||\n            function (callback) {\n                setTimeout(callback, 16);\n            },\n        animation = function () {\n            var Now = +new Date,\n                l = 0;\n            for (; l < animationElements.length; l++) {\n                var e = animationElements[l];\n                if (e.el.removed || e.paused) {\n                    continue;\n                }\n                var time = Now - e.start,\n                    ms = e.ms,\n                    easing = e.easing,\n                    from = e.from,\n                    diff = e.diff,\n                    to = e.to,\n                    t = e.t,\n                    that = e.el,\n                    set = {},\n                    now,\n                    init = {},\n                    key;\n                if (e.initstatus) {\n                    time = (e.initstatus * e.anim.top - e.prev) / (e.percent - e.prev) * ms;\n                    e.status = e.initstatus;\n                    delete e.initstatus;\n                    e.stop && animationElements.splice(l--, 1);\n                } else {\n                    e.status = (e.prev + (e.percent - e.prev) * (time / ms)) / e.anim.top;\n                }\n                if (time < 0) {\n                    continue;\n                }\n                if (time < ms) {\n                    var pos = easing(time / ms);\n                    for (var attr in from) if (from[has](attr)) {\n                        switch (availableAnimAttrs[attr]) {\n                            case nu:\n                                now = +from[attr] + pos * ms * diff[attr];\n                                break;\n                            case "colour":\n                                now = "rgb(" + [\n                                        upto255(round(from[attr].r + pos * ms * diff[attr].r)),\n                                        upto255(round(from[attr].g + pos * ms * diff[attr].g)),\n                                        upto255(round(from[attr].b + pos * ms * diff[attr].b))\n                                    ].join(",") + ")";\n                                break;\n                            case "path":\n                                now = [];\n                                for (var i = 0, ii = from[attr].length; i < ii; i++) {\n                                    now[i] = [from[attr][i][0]];\n                                    for (var j = 1, jj = from[attr][i].length; j < jj; j++) {\n                                        now[i][j] = +from[attr][i][j] + pos * ms * diff[attr][i][j];\n                                    }\n                                    now[i] = now[i].join(S);\n                                }\n                                now = now.join(S);\n                                break;\n                            case "transform":\n                                if (diff[attr].real) {\n                                    now = [];\n                                    for (i = 0, ii = from[attr].length; i < ii; i++) {\n                                        now[i] = [from[attr][i][0]];\n                                        for (j = 1, jj = from[attr][i].length; j < jj; j++) {\n                                            now[i][j] = from[attr][i][j] + pos * ms * diff[attr][i][j];\n                                        }\n                                    }\n                                } else {\n                                    var get = function (i) {\n                                        return +from[attr][i] + pos * ms * diff[attr][i];\n                                    };\n                                    // now = [["r", get(2), 0, 0], ["t", get(3), get(4)], ["s", get(0), get(1), 0, 0]];\n                                    now = [["m", get(0), get(1), get(2), get(3), get(4), get(5)]];\n                                }\n                                break;\n                            case "csv":\n                                if (attr == "clip-rect") {\n                                    now = [];\n                                    i = 4;\n                                    while (i--) {\n                                        now[i] = +from[attr][i] + pos * ms * diff[attr][i];\n                                    }\n                                }\n                                break;\n                            default:\n                                var from2 = [][concat](from[attr]);\n                                now = [];\n                                i = that.paper.customAttributes[attr].length;\n                                while (i--) {\n                                    now[i] = +from2[i] + pos * ms * diff[attr][i];\n                                }\n                                break;\n                        }\n                        set[attr] = now;\n                    }\n                    that.attr(set);\n                    (function (id, that, anim) {\n                        setTimeout(function () {\n                            eve("raphael.anim.frame." + id, that, anim);\n                        });\n                    })(that.id, that, e.anim);\n                } else {\n                    (function(f, el, a) {\n                        setTimeout(function() {\n                            eve("raphael.anim.frame." + el.id, el, a);\n                            eve("raphael.anim.finish." + el.id, el, a);\n                            R.is(f, "function") && f.call(el);\n                        });\n                    })(e.callback, that, e.anim);\n                    that.attr(to);\n                    animationElements.splice(l--, 1);\n                    if (e.repeat > 1 && !e.next) {\n                        for (key in to) if (to[has](key)) {\n                            init[key] = e.totalOrigin[key];\n                        }\n                        e.el.attr(init);\n                        runAnimation(e.anim, e.el, e.anim.percents[0], null, e.totalOrigin, e.repeat - 1);\n                    }\n                    if (e.next && !e.stop) {\n                        runAnimation(e.anim, e.el, e.next, null, e.totalOrigin, e.repeat);\n                    }\n                }\n            }\n            animationElements.length && requestAnimFrame(animation);\n        },\n        upto255 = function (color) {\n            return color > 255 ? 255 : color < 0 ? 0 : color;\n        };\n    /*\\\n     * Element.animateWith\n     [ method ]\n     **\n     * Acts similar to @Element.animate, but ensure that given animation runs in sync with another given element.\n     **\n     > Parameters\n     **\n     - el (object) element to sync with\n     - anim (object) animation to sync with\n     - params (object) #optional final attributes for the element, see also @Element.attr\n     - ms (number) #optional number of milliseconds for animation to run\n     - easing (string) #optional easing type. Accept on of @Raphael.easing_formulas or CSS format: `cubic&#x2010;bezier(XX,&#160;XX,&#160;XX,&#160;XX)`\n     - callback (function) #optional callback function. Will be called at the end of animation.\n     * or\n     - element (object) element to sync with\n     - anim (object) animation to sync with\n     - animation (object) #optional animation object, see @Raphael.animation\n     **\n     = (object) original element\n     \\*/\n    elproto.animateWith = function (el, anim, params, ms, easing, callback) {\n        var element = this;\n        if (element.removed) {\n            callback && callback.call(element);\n            return element;\n        }\n        var a = params instanceof Animation ? params : R.animation(params, ms, easing, callback),\n            x, y;\n        runAnimation(a, element, a.percents[0], null, element.attr());\n        for (var i = 0, ii = animationElements.length; i < ii; i++) {\n            if (animationElements[i].anim == anim && animationElements[i].el == el) {\n                animationElements[ii - 1].start = animationElements[i].start;\n                break;\n            }\n        }\n        return element;\n        //\n        //\n        // var a = params ? R.animation(params, ms, easing, callback) : anim,\n        //     status = element.status(anim);\n        // return this.animate(a).status(a, status * anim.ms / a.ms);\n    };\n    function CubicBezierAtTime(t, p1x, p1y, p2x, p2y, duration) {\n        var cx = 3 * p1x,\n            bx = 3 * (p2x - p1x) - cx,\n            ax = 1 - cx - bx,\n            cy = 3 * p1y,\n            by = 3 * (p2y - p1y) - cy,\n            ay = 1 - cy - by;\n        function sampleCurveX(t) {\n            return ((ax * t + bx) * t + cx) * t;\n        }\n        function solve(x, epsilon) {\n            var t = solveCurveX(x, epsilon);\n            return ((ay * t + by) * t + cy) * t;\n        }\n        function solveCurveX(x, epsilon) {\n            var t0, t1, t2, x2, d2, i;\n            for(t2 = x, i = 0; i < 8; i++) {\n                x2 = sampleCurveX(t2) - x;\n                if (abs(x2) < epsilon) {\n                    return t2;\n                }\n                d2 = (3 * ax * t2 + 2 * bx) * t2 + cx;\n                if (abs(d2) < 1e-6) {\n                    break;\n                }\n                t2 = t2 - x2 / d2;\n            }\n            t0 = 0;\n            t1 = 1;\n            t2 = x;\n            if (t2 < t0) {\n                return t0;\n            }\n            if (t2 > t1) {\n                return t1;\n            }\n            while (t0 < t1) {\n                x2 = sampleCurveX(t2);\n                if (abs(x2 - x) < epsilon) {\n                    return t2;\n                }\n                if (x > x2) {\n                    t0 = t2;\n                } else {\n                    t1 = t2;\n                }\n                t2 = (t1 - t0) / 2 + t0;\n            }\n            return t2;\n        }\n        return solve(t, 1 / (200 * duration));\n    }\n    elproto.onAnimation = function (f) {\n        f ? eve.on("raphael.anim.frame." + this.id, f) : eve.unbind("raphael.anim.frame." + this.id);\n        return this;\n    };\n    function Animation(anim, ms) {\n        var percents = [],\n            newAnim = {};\n        this.ms = ms;\n        this.times = 1;\n        if (anim) {\n            for (var attr in anim) if (anim[has](attr)) {\n                newAnim[toFloat(attr)] = anim[attr];\n                percents.push(toFloat(attr));\n            }\n            percents.sort(sortByNumber);\n        }\n        this.anim = newAnim;\n        this.top = percents[percents.length - 1];\n        this.percents = percents;\n    }\n    /*\\\n     * Animation.delay\n     [ method ]\n     **\n     * Creates a copy of existing animation object with given delay.\n     **\n     > Parameters\n     **\n     - delay (number) number of ms to pass between animation start and actual animation\n     **\n     = (object) new altered Animation object\n     | var anim = Raphael.animation({cx: 10, cy: 20}, 2e3);\n     | circle1.animate(anim); // run the given animation immediately\n     | circle2.animate(anim.delay(500)); // run the given animation after 500 ms\n     \\*/\n    Animation.prototype.delay = function (delay) {\n        var a = new Animation(this.anim, this.ms);\n        a.times = this.times;\n        a.del = +delay || 0;\n        return a;\n    };\n    /*\\\n     * Animation.repeat\n     [ method ]\n     **\n     * Creates a copy of existing animation object with given repetition.\n     **\n     > Parameters\n     **\n     - repeat (number) number iterations of animation. For infinite animation pass `Infinity`\n     **\n     = (object) new altered Animation object\n     \\*/\n    Animation.prototype.repeat = function (times) {\n        var a = new Animation(this.anim, this.ms);\n        a.del = this.del;\n        a.times = math.floor(mmax(times, 0)) || 1;\n        return a;\n    };\n    function runAnimation(anim, element, percent, status, totalOrigin, times) {\n        percent = toFloat(percent);\n        var params,\n            isInAnim,\n            isInAnimSet,\n            percents = [],\n            next,\n            prev,\n            timestamp,\n            ms = anim.ms,\n            from = {},\n            to = {},\n            diff = {};\n        if (status) {\n            for (i = 0, ii = animationElements.length; i < ii; i++) {\n                var e = animationElements[i];\n                if (e.el.id == element.id && e.anim == anim) {\n                    if (e.percent != percent) {\n                        animationElements.splice(i, 1);\n                        isInAnimSet = 1;\n                    } else {\n                        isInAnim = e;\n                    }\n                    element.attr(e.totalOrigin);\n                    break;\n                }\n            }\n        } else {\n            status = +to; // NaN\n        }\n        for (var i = 0, ii = anim.percents.length; i < ii; i++) {\n            if (anim.percents[i] == percent || anim.percents[i] > status * anim.top) {\n                percent = anim.percents[i];\n                prev = anim.percents[i - 1] || 0;\n                ms = ms / anim.top * (percent - prev);\n                next = anim.percents[i + 1];\n                params = anim.anim[percent];\n                break;\n            } else if (status) {\n                element.attr(anim.anim[anim.percents[i]]);\n            }\n        }\n        if (!params) {\n            return;\n        }\n        if (!isInAnim) {\n            for (var attr in params) if (params[has](attr)) {\n                if (availableAnimAttrs[has](attr) || element.paper.customAttributes[has](attr)) {\n                    from[attr] = element.attr(attr);\n                    (from[attr] == null) && (from[attr] = availableAttrs[attr]);\n                    to[attr] = params[attr];\n                    switch (availableAnimAttrs[attr]) {\n                        case nu:\n                            diff[attr] = (to[attr] - from[attr]) / ms;\n                            break;\n                        case "colour":\n                            from[attr] = R.getRGB(from[attr]);\n                            var toColour = R.getRGB(to[attr]);\n                            diff[attr] = {\n                                r: (toColour.r - from[attr].r) / ms,\n                                g: (toColour.g - from[attr].g) / ms,\n                                b: (toColour.b - from[attr].b) / ms\n                            };\n                            break;\n                        case "path":\n                            var pathes = path2curve(from[attr], to[attr]),\n                                toPath = pathes[1];\n                            from[attr] = pathes[0];\n                            diff[attr] = [];\n                            for (i = 0, ii = from[attr].length; i < ii; i++) {\n                                diff[attr][i] = [0];\n                                for (var j = 1, jj = from[attr][i].length; j < jj; j++) {\n                                    diff[attr][i][j] = (toPath[i][j] - from[attr][i][j]) / ms;\n                                }\n                            }\n                            break;\n                        case "transform":\n                            var _ = element._,\n                                eq = equaliseTransform(_[attr], to[attr]);\n                            if (eq) {\n                                from[attr] = eq.from;\n                                to[attr] = eq.to;\n                                diff[attr] = [];\n                                diff[attr].real = true;\n                                for (i = 0, ii = from[attr].length; i < ii; i++) {\n                                    diff[attr][i] = [from[attr][i][0]];\n                                    for (j = 1, jj = from[attr][i].length; j < jj; j++) {\n                                        diff[attr][i][j] = (to[attr][i][j] - from[attr][i][j]) / ms;\n                                    }\n                                }\n                            } else {\n                                var m = (element.matrix || new Matrix),\n                                    to2 = {\n                                        _: {transform: _.transform},\n                                        getBBox: function () {\n                                            return element.getBBox(1);\n                                        }\n                                    };\n                                from[attr] = [\n                                    m.a,\n                                    m.b,\n                                    m.c,\n                                    m.d,\n                                    m.e,\n                                    m.f\n                                ];\n                                extractTransform(to2, to[attr]);\n                                to[attr] = to2._.transform;\n                                diff[attr] = [\n                                    (to2.matrix.a - m.a) / ms,\n                                    (to2.matrix.b - m.b) / ms,\n                                    (to2.matrix.c - m.c) / ms,\n                                    (to2.matrix.d - m.d) / ms,\n                                    (to2.matrix.e - m.e) / ms,\n                                    (to2.matrix.f - m.f) / ms\n                                ];\n                                // from[attr] = [_.sx, _.sy, _.deg, _.dx, _.dy];\n                                // var to2 = {_:{}, getBBox: function () { return element.getBBox(); }};\n                                // extractTransform(to2, to[attr]);\n                                // diff[attr] = [\n                                //     (to2._.sx - _.sx) / ms,\n                                //     (to2._.sy - _.sy) / ms,\n                                //     (to2._.deg - _.deg) / ms,\n                                //     (to2._.dx - _.dx) / ms,\n                                //     (to2._.dy - _.dy) / ms\n                                // ];\n                            }\n                            break;\n                        case "csv":\n                            var values = Str(params[attr])[split](separator),\n                                from2 = Str(from[attr])[split](separator);\n                            if (attr == "clip-rect") {\n                                from[attr] = from2;\n                                diff[attr] = [];\n                                i = from2.length;\n                                while (i--) {\n                                    diff[attr][i] = (values[i] - from[attr][i]) / ms;\n                                }\n                            }\n                            to[attr] = values;\n                            break;\n                        default:\n                            values = [][concat](params[attr]);\n                            from2 = [][concat](from[attr]);\n                            diff[attr] = [];\n                            i = element.paper.customAttributes[attr].length;\n                            while (i--) {\n                                diff[attr][i] = ((values[i] || 0) - (from2[i] || 0)) / ms;\n                            }\n                            break;\n                    }\n                }\n            }\n            var easing = params.easing,\n                easyeasy = R.easing_formulas[easing];\n            if (!easyeasy) {\n                easyeasy = Str(easing).match(bezierrg);\n                if (easyeasy && easyeasy.length == 5) {\n                    var curve = easyeasy;\n                    easyeasy = function (t) {\n                        return CubicBezierAtTime(t, +curve[1], +curve[2], +curve[3], +curve[4], ms);\n                    };\n                } else {\n                    easyeasy = pipe;\n                }\n            }\n            timestamp = params.start || anim.start || +new Date;\n            e = {\n                anim: anim,\n                percent: percent,\n                timestamp: timestamp,\n                start: timestamp + (anim.del || 0),\n                status: 0,\n                initstatus: status || 0,\n                stop: false,\n                ms: ms,\n                easing: easyeasy,\n                from: from,\n                diff: diff,\n                to: to,\n                el: element,\n                callback: params.callback,\n                prev: prev,\n                next: next,\n                repeat: times || anim.times,\n                origin: element.attr(),\n                totalOrigin: totalOrigin\n            };\n            animationElements.push(e);\n            if (status && !isInAnim && !isInAnimSet) {\n                e.stop = true;\n                e.start = new Date - ms * status;\n                if (animationElements.length == 1) {\n                    return animation();\n                }\n            }\n            if (isInAnimSet) {\n                e.start = new Date - e.ms * status;\n            }\n            animationElements.length == 1 && requestAnimFrame(animation);\n        } else {\n            isInAnim.initstatus = status;\n            isInAnim.start = new Date - isInAnim.ms * status;\n        }\n        eve("raphael.anim.start." + element.id, element, anim);\n    }\n    /*\\\n     * Raphael.animation\n     [ method ]\n     **\n     * Creates an animation object that can be passed to the @Element.animate or @Element.animateWith methods.\n     * See also @Animation.delay and @Animation.repeat methods.\n     **\n     > Parameters\n     **\n     - params (object) final attributes for the element, see also @Element.attr\n     - ms (number) number of milliseconds for animation to run\n     - easing (string) #optional easing type. Accept one of @Raphael.easing_formulas or CSS format: `cubic&#x2010;bezier(XX,&#160;XX,&#160;XX,&#160;XX)`\n     - callback (function) #optional callback function. Will be called at the end of animation.\n     **\n     = (object) @Animation\n     \\*/\n    R.animation = function (params, ms, easing, callback) {\n        if (params instanceof Animation) {\n            return params;\n        }\n        if (R.is(easing, "function") || !easing) {\n            callback = callback || easing || null;\n            easing = null;\n        }\n        params = Object(params);\n        ms = +ms || 0;\n        var p = {},\n            json,\n            attr;\n        for (attr in params) if (params[has](attr) && toFloat(attr) != attr && toFloat(attr) + "%" != attr) {\n            json = true;\n            p[attr] = params[attr];\n        }\n        if (!json) {\n            // if percent-like syntax is used and end-of-all animation callback used\n            if(callback){\n                // find the last one\n                var lastKey = 0;\n                for(var i in params){\n                    var percent = toInt(i);\n                    if(params[has](i) && percent > lastKey){\n                        lastKey = percent;\n                    }\n                }\n                lastKey += \'%\';\n                // if already defined callback in the last keyframe, skip\n                !params[lastKey].callback && (params[lastKey].callback = callback);\n            }\n            return new Animation(params, ms);\n        } else {\n            easing && (p.easing = easing);\n            callback && (p.callback = callback);\n            return new Animation({100: p}, ms);\n        }\n    };\n    /*\\\n     * Element.animate\n     [ method ]\n     **\n     * Creates and starts animation for given element.\n     **\n     > Parameters\n     **\n     - params (object) final attributes for the element, see also @Element.attr\n     - ms (number) number of milliseconds for animation to run\n     - easing (string) #optional easing type. Accept one of @Raphael.easing_formulas or CSS format: `cubic&#x2010;bezier(XX,&#160;XX,&#160;XX,&#160;XX)`\n     - callback (function) #optional callback function. Will be called at the end of animation.\n     * or\n     - animation (object) animation object, see @Raphael.animation\n     **\n     = (object) original element\n     \\*/\n    elproto.animate = function (params, ms, easing, callback) {\n        var element = this;\n        if (element.removed) {\n            callback && callback.call(element);\n            return element;\n        }\n        var anim = params instanceof Animation ? params : R.animation(params, ms, easing, callback);\n        runAnimation(anim, element, anim.percents[0], null, element.attr());\n        return element;\n    };\n    /*\\\n     * Element.setTime\n     [ method ]\n     **\n     * Sets the status of animation of the element in milliseconds. Similar to @Element.status method.\n     **\n     > Parameters\n     **\n     - anim (object) animation object\n     - value (number) number of milliseconds from the beginning of the animation\n     **\n     = (object) original element if `value` is specified\n     * Note, that during animation following events are triggered:\n     *\n     * On each animation frame event `anim.frame.<id>`, on start `anim.start.<id>` and on end `anim.finish.<id>`.\n     \\*/\n    elproto.setTime = function (anim, value) {\n        if (anim && value != null) {\n            this.status(anim, mmin(value, anim.ms) / anim.ms);\n        }\n        return this;\n    };\n    /*\\\n     * Element.status\n     [ method ]\n     **\n     * Gets or sets the status of animation of the element.\n     **\n     > Parameters\n     **\n     - anim (object) #optional animation object\n     - value (number) #optional 0 – 1. If specified, method works like a setter and sets the status of a given animation to the value. This will cause animation to jump to the given position.\n     **\n     = (number) status\n     * or\n     = (array) status if `anim` is not specified. Array of objects in format:\n     o {\n     o     anim: (object) animation object\n     o     status: (number) status\n     o }\n     * or\n     = (object) original element if `value` is specified\n     \\*/\n    elproto.status = function (anim, value) {\n        var out = [],\n            i = 0,\n            len,\n            e;\n        if (value != null) {\n            runAnimation(anim, this, -1, mmin(value, 1));\n            return this;\n        } else {\n            len = animationElements.length;\n            for (; i < len; i++) {\n                e = animationElements[i];\n                if (e.el.id == this.id && (!anim || e.anim == anim)) {\n                    if (anim) {\n                        return e.status;\n                    }\n                    out.push({\n                        anim: e.anim,\n                        status: e.status\n                    });\n                }\n            }\n            if (anim) {\n                return 0;\n            }\n            return out;\n        }\n    };\n    /*\\\n     * Element.pause\n     [ method ]\n     **\n     * Stops animation of the element with ability to resume it later on.\n     **\n     > Parameters\n     **\n     - anim (object) #optional animation object\n     **\n     = (object) original element\n     \\*/\n    elproto.pause = function (anim) {\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {\n            if (eve("raphael.anim.pause." + this.id, this, animationElements[i].anim) !== false) {\n                animationElements[i].paused = true;\n            }\n        }\n        return this;\n    };\n    /*\\\n     * Element.resume\n     [ method ]\n     **\n     * Resumes animation if it was paused with @Element.pause method.\n     **\n     > Parameters\n     **\n     - anim (object) #optional animation object\n     **\n     = (object) original element\n     \\*/\n    elproto.resume = function (anim) {\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {\n            var e = animationElements[i];\n            if (eve("raphael.anim.resume." + this.id, this, e.anim) !== false) {\n                delete e.paused;\n                this.status(e.anim, e.status);\n            }\n        }\n        return this;\n    };\n    /*\\\n     * Element.stop\n     [ method ]\n     **\n     * Stops animation of the element.\n     **\n     > Parameters\n     **\n     - anim (object) #optional animation object\n     **\n     = (object) original element\n     \\*/\n    elproto.stop = function (anim) {\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {\n            if (eve("raphael.anim.stop." + this.id, this, animationElements[i].anim) !== false) {\n                animationElements.splice(i--, 1);\n            }\n        }\n        return this;\n    };\n    function stopAnimation(paper) {\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.paper == paper) {\n            animationElements.splice(i--, 1);\n        }\n    }\n    eve.on("raphael.remove", stopAnimation);\n    eve.on("raphael.clear", stopAnimation);\n    elproto.toString = function () {\n        return "Rapha\\xebl\\u2019s object";\n    };\n\n    // Set\n    var Set = function (items) {\n            this.items = [];\n            this.length = 0;\n            this.type = "set";\n            if (items) {\n                for (var i = 0, ii = items.length; i < ii; i++) {\n                    if (items[i] && (items[i].constructor == elproto.constructor || items[i].constructor == Set)) {\n                        this[this.items.length] = this.items[this.items.length] = items[i];\n                        this.length++;\n                    }\n                }\n            }\n        },\n        setproto = Set.prototype;\n    /*\\\n     * Set.push\n     [ method ]\n     **\n     * Adds each argument to the current set.\n     = (object) original element\n     \\*/\n    setproto.push = function () {\n        var item,\n            len;\n        for (var i = 0, ii = arguments.length; i < ii; i++) {\n            item = arguments[i];\n            if (item && (item.constructor == elproto.constructor || item.constructor == Set)) {\n                len = this.items.length;\n                this[len] = this.items[len] = item;\n                this.length++;\n            }\n        }\n        return this;\n    };\n    /*\\\n     * Set.pop\n     [ method ]\n     **\n     * Removes last element and returns it.\n     = (object) element\n     \\*/\n    setproto.pop = function () {\n        this.length && delete this[this.length--];\n        return this.items.pop();\n    };\n    /*\\\n     * Set.forEach\n     [ method ]\n     **\n     * Executes given function for each element in the set.\n     *\n     * If function returns `false` it will stop loop running.\n     **\n     > Parameters\n     **\n     - callback (function) function to run\n     - thisArg (object) context object for the callback\n     = (object) Set object\n     \\*/\n    setproto.forEach = function (callback, thisArg) {\n        for (var i = 0, ii = this.items.length; i < ii; i++) {\n            if (callback.call(thisArg, this.items[i], i) === false) {\n                return this;\n            }\n        }\n        return this;\n    };\n    for (var method in elproto) if (elproto[has](method)) {\n        setproto[method] = (function (methodname) {\n            return function () {\n                var arg = arguments;\n                return this.forEach(function (el) {\n                    el[methodname][apply](el, arg);\n                });\n            };\n        })(method);\n    }\n    setproto.attr = function (name, value) {\n        if (name && R.is(name, array) && R.is(name[0], "object")) {\n            for (var j = 0, jj = name.length; j < jj; j++) {\n                this.items[j].attr(name[j]);\n            }\n        } else {\n            for (var i = 0, ii = this.items.length; i < ii; i++) {\n                this.items[i].attr(name, value);\n            }\n        }\n        return this;\n    };\n    /*\\\n     * Set.clear\n     [ method ]\n     **\n     * Removes all elements from the set\n     \\*/\n    setproto.clear = function () {\n        while (this.length) {\n            this.pop();\n        }\n    };\n    /*\\\n     * Set.splice\n     [ method ]\n     **\n     * Removes given element from the set\n     **\n     > Parameters\n     **\n     - index (number) position of the deletion\n     - count (number) number of element to remove\n     - insertion… (object) #optional elements to insert\n     = (object) set elements that were deleted\n     \\*/\n    setproto.splice = function (index, count, insertion) {\n        index = index < 0 ? mmax(this.length + index, 0) : index;\n        count = mmax(0, mmin(this.length - index, count));\n        var tail = [],\n            todel = [],\n            args = [],\n            i;\n        for (i = 2; i < arguments.length; i++) {\n            args.push(arguments[i]);\n        }\n        for (i = 0; i < count; i++) {\n            todel.push(this[index + i]);\n        }\n        for (; i < this.length - index; i++) {\n            tail.push(this[index + i]);\n        }\n        var arglen = args.length;\n        for (i = 0; i < arglen + tail.length; i++) {\n            this.items[index + i] = this[index + i] = i < arglen ? args[i] : tail[i - arglen];\n        }\n        i = this.items.length = this.length -= count - arglen;\n        while (this[i]) {\n            delete this[i++];\n        }\n        return new Set(todel);\n    };\n    /*\\\n     * Set.exclude\n     [ method ]\n     **\n     * Removes given element from the set\n     **\n     > Parameters\n     **\n     - element (object) element to remove\n     = (boolean) `true` if object was found & removed from the set\n     \\*/\n    setproto.exclude = function (el) {\n        for (var i = 0, ii = this.length; i < ii; i++) if (this[i] == el) {\n            this.splice(i, 1);\n            return true;\n        }\n    };\n    setproto.animate = function (params, ms, easing, callback) {\n        (R.is(easing, "function") || !easing) && (callback = easing || null);\n        var len = this.items.length,\n            i = len,\n            item,\n            set = this,\n            collector;\n        if (!len) {\n            return this;\n        }\n        callback && (collector = function () {\n            !--len && callback.call(set);\n        });\n        easing = R.is(easing, string) ? easing : collector;\n        var anim = R.animation(params, ms, easing, collector);\n        item = this.items[--i].animate(anim);\n        while (i--) {\n            this.items[i] && !this.items[i].removed && this.items[i].animateWith(item, anim, anim);\n            (this.items[i] && !this.items[i].removed) || len--;\n        }\n        return this;\n    };\n    setproto.insertAfter = function (el) {\n        var i = this.items.length;\n        while (i--) {\n            this.items[i].insertAfter(el);\n        }\n        return this;\n    };\n    setproto.getBBox = function () {\n        var x = [],\n            y = [],\n            x2 = [],\n            y2 = [];\n        for (var i = this.items.length; i--;) if (!this.items[i].removed) {\n            var box = this.items[i].getBBox();\n            x.push(box.x);\n            y.push(box.y);\n            x2.push(box.x + box.width);\n            y2.push(box.y + box.height);\n        }\n        x = mmin[apply](0, x);\n        y = mmin[apply](0, y);\n        x2 = mmax[apply](0, x2);\n        y2 = mmax[apply](0, y2);\n        return {\n            x: x,\n            y: y,\n            x2: x2,\n            y2: y2,\n            width: x2 - x,\n            height: y2 - y\n        };\n    };\n    setproto.clone = function (s) {\n        s = this.paper.set();\n        for (var i = 0, ii = this.items.length; i < ii; i++) {\n            s.push(this.items[i].clone());\n        }\n        return s;\n    };\n    setproto.toString = function () {\n        return "Rapha\\xebl\\u2018s set";\n    };\n\n    setproto.glow = function(glowConfig) {\n        var ret = this.paper.set();\n        this.forEach(function(shape, index){\n            var g = shape.glow(glowConfig);\n            if(g != null){\n                g.forEach(function(shape2, index2){\n                    ret.push(shape2);\n                });\n            }\n        });\n        return ret;\n    };\n\n\n    /*\\\n     * Set.isPointInside\n     [ method ]\n     **\n     * Determine if given point is inside this set’s elements\n     **\n     > Parameters\n     **\n     - x (number) x coordinate of the point\n     - y (number) y coordinate of the point\n     = (boolean) `true` if point is inside any of the set\'s elements\n     \\*/\n    setproto.isPointInside = function (x, y) {\n        var isPointInside = false;\n        this.forEach(function (el) {\n            if (el.isPointInside(x, y)) {\n                isPointInside = true;\n                return false; // stop loop\n            }\n        });\n        return isPointInside;\n    };\n\n    /*\\\n     * Raphael.registerFont\n     [ method ]\n     **\n     * Adds given font to the registered set of font for Raphaël. Should be used as an internal call from within Cufón’s font file.\n     * Returns original parameter, so it could be used with chaining.\n     # <a href="http://wiki.github.com/sorccu/cufon/about">More about Cufón and how to convert your font form TTF, OTF, etc to JavaScript file.</a>\n     **\n     > Parameters\n     **\n     - font (object) the font to register\n     = (object) the font you passed in\n     > Usage\n     | Cufon.registerFont(Raphael.registerFont({…}));\n     \\*/\n    R.registerFont = function (font) {\n        if (!font.face) {\n            return font;\n        }\n        this.fonts = this.fonts || {};\n        var fontcopy = {\n                w: font.w,\n                face: {},\n                glyphs: {}\n            },\n            family = font.face["font-family"];\n        for (var prop in font.face) if (font.face[has](prop)) {\n            fontcopy.face[prop] = font.face[prop];\n        }\n        if (this.fonts[family]) {\n            this.fonts[family].push(fontcopy);\n        } else {\n            this.fonts[family] = [fontcopy];\n        }\n        if (!font.svg) {\n            fontcopy.face["units-per-em"] = toInt(font.face["units-per-em"], 10);\n            for (var glyph in font.glyphs) if (font.glyphs[has](glyph)) {\n                var path = font.glyphs[glyph];\n                fontcopy.glyphs[glyph] = {\n                    w: path.w,\n                    k: {},\n                    d: path.d && "M" + path.d.replace(/[mlcxtrv]/g, function (command) {\n                        return {l: "L", c: "C", x: "z", t: "m", r: "l", v: "c"}[command] || "M";\n                    }) + "z"\n                };\n                if (path.k) {\n                    for (var k in path.k) if (path[has](k)) {\n                        fontcopy.glyphs[glyph].k[k] = path.k[k];\n                    }\n                }\n            }\n        }\n        return font;\n    };\n    /*\\\n     * Paper.getFont\n     [ method ]\n     **\n     * Finds font object in the registered font by given parameters. You could specify only one word from the font name, like “Myriad” for “Myriad Pro”.\n     **\n     > Parameters\n     **\n     - family (string) font family name or any word from it\n     - weight (string) #optional font weight\n     - style (string) #optional font style\n     - stretch (string) #optional font stretch\n     = (object) the font object\n     > Usage\n     | paper.print(100, 100, "Test string", paper.getFont("Times", 800), 30);\n     \\*/\n    paperproto.getFont = function (family, weight, style, stretch) {\n        stretch = stretch || "normal";\n        style = style || "normal";\n        weight = +weight || {normal: 400, bold: 700, lighter: 300, bolder: 800}[weight] || 400;\n        if (!R.fonts) {\n            return;\n        }\n        var font = R.fonts[family];\n        if (!font) {\n            var name = new RegExp("(^|\\\\s)" + family.replace(/[^\\w\\d\\s+!~.:_-]/g, E) + "(\\\\s|$)", "i");\n            for (var fontName in R.fonts) if (R.fonts[has](fontName)) {\n                if (name.test(fontName)) {\n                    font = R.fonts[fontName];\n                    break;\n                }\n            }\n        }\n        var thefont;\n        if (font) {\n            for (var i = 0, ii = font.length; i < ii; i++) {\n                thefont = font[i];\n                if (thefont.face["font-weight"] == weight && (thefont.face["font-style"] == style || !thefont.face["font-style"]) && thefont.face["font-stretch"] == stretch) {\n                    break;\n                }\n            }\n        }\n        return thefont;\n    };\n    /*\\\n     * Paper.print\n     [ method ]\n     **\n     * Creates path that represent given text written using given font at given position with given size.\n     * Result of the method is path element that contains whole text as a separate path.\n     **\n     > Parameters\n     **\n     - x (number) x position of the text\n     - y (number) y position of the text\n     - string (string) text to print\n     - font (object) font object, see @Paper.getFont\n     - size (number) #optional size of the font, default is `16`\n     - origin (string) #optional could be `"baseline"` or `"middle"`, default is `"middle"`\n     - letter_spacing (number) #optional number in range `-1..1`, default is `0`\n     - line_spacing (number) #optional number in range `1..3`, default is `1`\n     = (object) resulting path element, which consist of all letters\n     > Usage\n     | var txt = r.print(10, 50, "print", r.getFont("Museo"), 30).attr({fill: "#fff"});\n     \\*/\n    paperproto.print = function (x, y, string, font, size, origin, letter_spacing, line_spacing) {\n        origin = origin || "middle"; // baseline|middle\n        letter_spacing = mmax(mmin(letter_spacing || 0, 1), -1);\n        line_spacing = mmax(mmin(line_spacing || 1, 3), 1);\n        var letters = Str(string)[split](E),\n            shift = 0,\n            notfirst = 0,\n            path = E,\n            scale;\n        R.is(font, "string") && (font = this.getFont(font));\n        if (font) {\n            scale = (size || 16) / font.face["units-per-em"];\n            var bb = font.face.bbox[split](separator),\n                top = +bb[0],\n                lineHeight = bb[3] - bb[1],\n                shifty = 0,\n                height = +bb[1] + (origin == "baseline" ? lineHeight + (+font.face.descent) : lineHeight / 2);\n            for (var i = 0, ii = letters.length; i < ii; i++) {\n                if (letters[i] == "\\n") {\n                    shift = 0;\n                    curr = 0;\n                    notfirst = 0;\n                    shifty += lineHeight * line_spacing;\n                } else {\n                    var prev = notfirst && font.glyphs[letters[i - 1]] || {},\n                        curr = font.glyphs[letters[i]];\n                    shift += notfirst ? (prev.w || font.w) + (prev.k && prev.k[letters[i]] || 0) + (font.w * letter_spacing) : 0;\n                    notfirst = 1;\n                }\n                if (curr && curr.d) {\n                    path += R.transformPath(curr.d, ["t", shift * scale, shifty * scale, "s", scale, scale, top, height, "t", (x - top) / scale, (y - height) / scale]);\n                }\n            }\n        }\n        return this.path(path).attr({\n            fill: "#000",\n            stroke: "none"\n        });\n    };\n\n    /*\\\n     * Paper.add\n     [ method ]\n     **\n     * Imports elements in JSON array in format `{type: type, <attributes>}`\n     **\n     > Parameters\n     **\n     - json (array)\n     = (object) resulting set of imported elements\n     > Usage\n     | paper.add([\n     |     {\n     |         type: "circle",\n     |         cx: 10,\n     |         cy: 10,\n     |         r: 5\n     |     },\n     |     {\n     |         type: "rect",\n     |         x: 10,\n     |         y: 10,\n     |         width: 10,\n     |         height: 10,\n     |         fill: "#fc0"\n     |     }\n     | ]);\n     \\*/\n    paperproto.add = function (json) {\n        if (R.is(json, "array")) {\n            var res = this.set(),\n                i = 0,\n                ii = json.length,\n                j;\n            for (; i < ii; i++) {\n                j = json[i] || {};\n                elements[has](j.type) && res.push(this[j.type]().attr(j));\n            }\n        }\n        return res;\n    };\n\n    /*\\\n     * Raphael.format\n     [ method ]\n     **\n     * Simple format function. Replaces construction of type “`{<number>}`” to the corresponding argument.\n     **\n     > Parameters\n     **\n     - token (string) string to format\n     - … (string) rest of arguments will be treated as parameters for replacement\n     = (string) formated string\n     > Usage\n     | var x = 10,\n     |     y = 20,\n     |     width = 40,\n     |     height = 50;\n     | // this will draw a rectangular shape equivalent to "M10,20h40v50h-40z"\n     | paper.path(Raphael.format("M{0},{1}h{2}v{3}h{4}z", x, y, width, height, -width));\n     \\*/\n    R.format = function (token, params) {\n        var args = R.is(params, array) ? [0][concat](params) : arguments;\n        token && R.is(token, string) && args.length - 1 && (token = token.replace(formatrg, function (str, i) {\n            return args[++i] == null ? E : args[i];\n        }));\n        return token || E;\n    };\n    /*\\\n     * Raphael.fullfill\n     [ method ]\n     **\n     * A little bit more advanced format function than @Raphael.format. Replaces construction of type “`{<name>}`” to the corresponding argument.\n     **\n     > Parameters\n     **\n     - token (string) string to format\n     - json (object) object which properties will be used as a replacement\n     = (string) formated string\n     > Usage\n     | // this will draw a rectangular shape equivalent to "M10,20h40v50h-40z"\n     | paper.path(Raphael.fullfill("M{x},{y}h{dim.width}v{dim.height}h{dim[\'negative width\']}z", {\n     |     x: 10,\n     |     y: 20,\n     |     dim: {\n     |         width: 40,\n     |         height: 50,\n     |         "negative width": -40\n     |     }\n     | }));\n     \\*/\n    R.fullfill = (function () {\n        var tokenRegex = /\\{([^\\}]+)\\}/g,\n            objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[(\'|")(.+?)\\2\\])(\\(\\))?/g, // matches .xxxxx or ["xxxxx"] to run over object properties\n            replacer = function (all, key, obj) {\n                var res = obj;\n                key.replace(objNotationRegex, function (all, name, quote, quotedName, isFunc) {\n                    name = name || quotedName;\n                    if (res) {\n                        if (name in res) {\n                            res = res[name];\n                        }\n                        typeof res == "function" && isFunc && (res = res());\n                    }\n                });\n                res = (res == null || res == obj ? all : res) + "";\n                return res;\n            };\n        return function (str, obj) {\n            return String(str).replace(tokenRegex, function (all, key) {\n                return replacer(all, key, obj);\n            });\n        };\n    })();\n    /*\\\n     * Raphael.ninja\n     [ method ]\n     **\n     * If you want to leave no trace of Raphaël (Well, Raphaël creates only one global variable `Raphael`, but anyway.) You can use `ninja` method.\n     * Beware, that in this case plugins could stop working, because they are depending on global variable existence.\n     **\n     = (object) Raphael object\n     > Usage\n     | (function (local_raphael) {\n     |     var paper = local_raphael(10, 10, 320, 200);\n     |     …\n     | })(Raphael.ninja());\n     \\*/\n    R.ninja = function () {\n        oldRaphael.was ? (g.win.Raphael = oldRaphael.is) : delete Raphael;\n        return R;\n    };\n    /*\\\n     * Raphael.st\n     [ property (object) ]\n     **\n     * You can add your own method to elements and sets. It is wise to add a set method for each element method\n     * you added, so you will be able to call the same method on sets too.\n     **\n     * See also @Raphael.el.\n     > Usage\n     | Raphael.el.red = function () {\n     |     this.attr({fill: "#f00"});\n     | };\n     | Raphael.st.red = function () {\n     |     this.forEach(function (el) {\n     |         el.red();\n     |     });\n     | };\n     | // then use it\n     | paper.set(paper.circle(100, 100, 20), paper.circle(110, 100, 20)).red();\n     \\*/\n    R.st = setproto;\n\n    eve.on("raphael.DOMload", function () {\n        loaded = true;\n    });\n\n    // Firefox <3.6 fix: http://webreflection.blogspot.com/2009/11/195-chars-to-help-lazy-loading.html\n    (function (doc, loaded, f) {\n        if (doc.readyState == null && doc.addEventListener){\n            doc.addEventListener(loaded, f = function () {\n                doc.removeEventListener(loaded, f, false);\n                doc.readyState = "complete";\n            }, false);\n            doc.readyState = "loading";\n        }\n        function isLoaded() {\n            (/in/).test(doc.readyState) ? setTimeout(isLoaded, 9) : R.eve("raphael.DOMload");\n        }\n        isLoaded();\n    })(document, "DOMContentLoaded");\n\n    return R;\n}));\n\n// ┌─────────────────────────────────────────────────────────────────────┐ \\\\\n// │ Raphaël 2.1.4 - JavaScript Vector Library                       │ \\\\\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\n// │ SVG Module                                                          │ \\\\\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\n// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\\\\n// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\\\\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\\\\n// └─────────────────────────────────────────────────────────────────────┘ \\\\\n\n(function (glob, factory) {\n    if (typeof define === "function" && define.amd) {\n        define("raphael.svg", ["raphael.core"], function(raphael) {\n            return factory(raphael);\n        });\n    } else if (typeof exports === "object") {\n        factory(require("raphael.core"));\n    } else {\n        factory(glob.Raphael);\n    }\n}(this, function(R) {\n    if (R && !R.svg) {\n        return;\n    }\n\n    var has = "hasOwnProperty",\n        Str = String,\n        toFloat = parseFloat,\n        toInt = parseInt,\n        math = Math,\n        mmax = math.max,\n        abs = math.abs,\n        pow = math.pow,\n        separator = /[, ]+/,\n        eve = R.eve,\n        E = "",\n        S = " ";\n    var xlink = "http://www.w3.org/1999/xlink",\n        markers = {\n            block: "M5,0 0,2.5 5,5z",\n            classic: "M5,0 0,2.5 5,5 3.5,3 3.5,2z",\n            diamond: "M2.5,0 5,2.5 2.5,5 0,2.5z",\n            open: "M6,1 1,3.5 6,6",\n            oval: "M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"\n        },\n        markerCounter = {};\n    R.toString = function () {\n        return  "Your browser supports SVG.\\nYou are running Rapha\\xebl " + this.version;\n    };\n    var $ = function (el, attr) {\n            if (attr) {\n                if (typeof el == "string") {\n                    el = $(el);\n                }\n                for (var key in attr) if (attr[has](key)) {\n                    if (key.substring(0, 6) == "xlink:") {\n                        el.setAttributeNS(xlink, key.substring(6), Str(attr[key]));\n                    } else {\n                        el.setAttribute(key, Str(attr[key]));\n                    }\n                }\n            } else {\n                el = R._g.doc.createElementNS("http://www.w3.org/2000/svg", el);\n                el.style && (el.style.webkitTapHighlightColor = "rgba(0,0,0,0)");\n            }\n            return el;\n        },\n        addGradientFill = function (element, gradient) {\n            var type = "linear",\n                id = element.id + gradient,\n                fx = .5, fy = .5,\n                o = element.node,\n                SVG = element.paper,\n                s = o.style,\n                el = R._g.doc.getElementById(id);\n            if (!el) {\n                gradient = Str(gradient).replace(R._radial_gradient, function (all, _fx, _fy) {\n                    type = "radial";\n                    if (_fx && _fy) {\n                        fx = toFloat(_fx);\n                        fy = toFloat(_fy);\n                        var dir = ((fy > .5) * 2 - 1);\n                        pow(fx - .5, 2) + pow(fy - .5, 2) > .25 &&\n                        (fy = math.sqrt(.25 - pow(fx - .5, 2)) * dir + .5) &&\n                        fy != .5 &&\n                        (fy = fy.toFixed(5) - 1e-5 * dir);\n                    }\n                    return E;\n                });\n                gradient = gradient.split(/\\s*\\-\\s*/);\n                if (type == "linear") {\n                    var angle = gradient.shift();\n                    angle = -toFloat(angle);\n                    if (isNaN(angle)) {\n                        return null;\n                    }\n                    var vector = [0, 0, math.cos(R.rad(angle)), math.sin(R.rad(angle))],\n                        max = 1 / (mmax(abs(vector[2]), abs(vector[3])) || 1);\n                    vector[2] *= max;\n                    vector[3] *= max;\n                    if (vector[2] < 0) {\n                        vector[0] = -vector[2];\n                        vector[2] = 0;\n                    }\n                    if (vector[3] < 0) {\n                        vector[1] = -vector[3];\n                        vector[3] = 0;\n                    }\n                }\n                var dots = R._parseDots(gradient);\n                if (!dots) {\n                    return null;\n                }\n                id = id.replace(/[\\(\\)\\s,\\xb0#]/g, "_");\n\n                if (element.gradient && id != element.gradient.id) {\n                    SVG.defs.removeChild(element.gradient);\n                    delete element.gradient;\n                }\n\n                if (!element.gradient) {\n                    el = $(type + "Gradient", {id: id});\n                    element.gradient = el;\n                    $(el, type == "radial" ? {\n                        fx: fx,\n                        fy: fy\n                    } : {\n                        x1: vector[0],\n                        y1: vector[1],\n                        x2: vector[2],\n                        y2: vector[3],\n                        gradientTransform: element.matrix.invert()\n                    });\n                    SVG.defs.appendChild(el);\n                    for (var i = 0, ii = dots.length; i < ii; i++) {\n                        el.appendChild($("stop", {\n                            offset: dots[i].offset ? dots[i].offset : i ? "100%" : "0%",\n                            "stop-color": dots[i].color || "#fff",\n                            "stop-opacity": isFinite(dots[i].opacity) ? dots[i].opacity : 1\n                        }));\n                    }\n                }\n            }\n            $(o, {\n                fill: "url(\'" + document.location.origin + document.location.pathname + "#" + id + "\')",\n                opacity: 1,\n                "fill-opacity": 1\n            });\n            s.fill = E;\n            s.opacity = 1;\n            s.fillOpacity = 1;\n            return 1;\n        },\n        updatePosition = function (o) {\n            var bbox = o.getBBox(1);\n            $(o.pattern, {patternTransform: o.matrix.invert() + " translate(" + bbox.x + "," + bbox.y + ")"});\n        },\n        addArrow = function (o, value, isEnd) {\n            if (o.type == "path") {\n                var values = Str(value).toLowerCase().split("-"),\n                    p = o.paper,\n                    se = isEnd ? "end" : "start",\n                    node = o.node,\n                    attrs = o.attrs,\n                    stroke = attrs["stroke-width"],\n                    i = values.length,\n                    type = "classic",\n                    from,\n                    to,\n                    dx,\n                    refX,\n                    attr,\n                    w = 3,\n                    h = 3,\n                    t = 5;\n                while (i--) {\n                    switch (values[i]) {\n                        case "block":\n                        case "classic":\n                        case "oval":\n                        case "diamond":\n                        case "open":\n                        case "none":\n                            type = values[i];\n                            break;\n                        case "wide": h = 5; break;\n                        case "narrow": h = 2; break;\n                        case "long": w = 5; break;\n                        case "short": w = 2; break;\n                    }\n                }\n                if (type == "open") {\n                    w += 2;\n                    h += 2;\n                    t += 2;\n                    dx = 1;\n                    refX = isEnd ? 4 : 1;\n                    attr = {\n                        fill: "none",\n                        stroke: attrs.stroke\n                    };\n                } else {\n                    refX = dx = w / 2;\n                    attr = {\n                        fill: attrs.stroke,\n                        stroke: "none"\n                    };\n                }\n                if (o._.arrows) {\n                    if (isEnd) {\n                        o._.arrows.endPath && markerCounter[o._.arrows.endPath]--;\n                        o._.arrows.endMarker && markerCounter[o._.arrows.endMarker]--;\n                    } else {\n                        o._.arrows.startPath && markerCounter[o._.arrows.startPath]--;\n                        o._.arrows.startMarker && markerCounter[o._.arrows.startMarker]--;\n                    }\n                } else {\n                    o._.arrows = {};\n                }\n                if (type != "none") {\n                    var pathId = "raphael-marker-" + type,\n                        markerId = "raphael-marker-" + se + type + w + h + "-obj" + o.id;\n                    if (!R._g.doc.getElementById(pathId)) {\n                        p.defs.appendChild($($("path"), {\n                            "stroke-linecap": "round",\n                            d: markers[type],\n                            id: pathId\n                        }));\n                        markerCounter[pathId] = 1;\n                    } else {\n                        markerCounter[pathId]++;\n                    }\n                    var marker = R._g.doc.getElementById(markerId),\n                        use;\n                    if (!marker) {\n                        marker = $($("marker"), {\n                            id: markerId,\n                            markerHeight: h,\n                            markerWidth: w,\n                            orient: "auto",\n                            refX: refX,\n                            refY: h / 2\n                        });\n                        use = $($("use"), {\n                            "xlink:href": "#" + pathId,\n                            transform: (isEnd ? "rotate(180 " + w / 2 + " " + h / 2 + ") " : E) + "scale(" + w / t + "," + h / t + ")",\n                            "stroke-width": (1 / ((w / t + h / t) / 2)).toFixed(4)\n                        });\n                        marker.appendChild(use);\n                        p.defs.appendChild(marker);\n                        markerCounter[markerId] = 1;\n                    } else {\n                        markerCounter[markerId]++;\n                        use = marker.getElementsByTagName("use")[0];\n                    }\n                    $(use, attr);\n                    var delta = dx * (type != "diamond" && type != "oval");\n                    if (isEnd) {\n                        from = o._.arrows.startdx * stroke || 0;\n                        to = R.getTotalLength(attrs.path) - delta * stroke;\n                    } else {\n                        from = delta * stroke;\n                        to = R.getTotalLength(attrs.path) - (o._.arrows.enddx * stroke || 0);\n                    }\n                    attr = {};\n                    attr["marker-" + se] = "url(#" + markerId + ")";\n                    if (to || from) {\n                        attr.d = R.getSubpath(attrs.path, from, to);\n                    }\n                    $(node, attr);\n                    o._.arrows[se + "Path"] = pathId;\n                    o._.arrows[se + "Marker"] = markerId;\n                    o._.arrows[se + "dx"] = delta;\n                    o._.arrows[se + "Type"] = type;\n                    o._.arrows[se + "String"] = value;\n                } else {\n                    if (isEnd) {\n                        from = o._.arrows.startdx * stroke || 0;\n                        to = R.getTotalLength(attrs.path) - from;\n                    } else {\n                        from = 0;\n                        to = R.getTotalLength(attrs.path) - (o._.arrows.enddx * stroke || 0);\n                    }\n                    o._.arrows[se + "Path"] && $(node, {d: R.getSubpath(attrs.path, from, to)});\n                    delete o._.arrows[se + "Path"];\n                    delete o._.arrows[se + "Marker"];\n                    delete o._.arrows[se + "dx"];\n                    delete o._.arrows[se + "Type"];\n                    delete o._.arrows[se + "String"];\n                }\n                for (attr in markerCounter) if (markerCounter[has](attr) && !markerCounter[attr]) {\n                    var item = R._g.doc.getElementById(attr);\n                    item && item.parentNode.removeChild(item);\n                }\n            }\n        },\n        dasharray = {\n            "-": [3, 1],\n            ".": [1, 1],\n            "-.": [3, 1, 1, 1],\n            "-..": [3, 1, 1, 1, 1, 1],\n            ". ": [1, 3],\n            "- ": [4, 3],\n            "--": [8, 3],\n            "- .": [4, 3, 1, 3],\n            "--.": [8, 3, 1, 3],\n            "--..": [8, 3, 1, 3, 1, 3]\n        },\n        addDashes = function (o, value, params) {\n            value = dasharray[Str(value).toLowerCase()];\n            if (value) {\n                var width = o.attrs["stroke-width"] || "1",\n                    butt = {round: width, square: width, butt: 0}[o.attrs["stroke-linecap"] || params["stroke-linecap"]] || 0,\n                    dashes = [],\n                    i = value.length;\n                while (i--) {\n                    dashes[i] = value[i] * width + ((i % 2) ? 1 : -1) * butt;\n                }\n                $(o.node, {"stroke-dasharray": dashes.join(",")});\n            }\n            else {\n                $(o.node, {"stroke-dasharray": "none"});\n            }\n        },\n        setFillAndStroke = function (o, params) {\n            var node = o.node,\n                attrs = o.attrs,\n                vis = node.style.visibility;\n            node.style.visibility = "hidden";\n            for (var att in params) {\n                if (params[has](att)) {\n                    if (!R._availableAttrs[has](att)) {\n                        continue;\n                    }\n                    var value = params[att];\n                    attrs[att] = value;\n                    switch (att) {\n                        case "blur":\n                            o.blur(value);\n                            break;\n                        case "title":\n                            var title = node.getElementsByTagName("title");\n\n                            // Use the existing <title>.\n                            if (title.length && (title = title[0])) {\n                                title.firstChild.nodeValue = value;\n                            } else {\n                                title = $("title");\n                                var val = R._g.doc.createTextNode(value);\n                                title.appendChild(val);\n                                node.appendChild(title);\n                            }\n                            break;\n                        case "href":\n                        case "target":\n                            var pn = node.parentNode;\n                            if (pn.tagName.toLowerCase() != "a") {\n                                var hl = $("a");\n                                pn.insertBefore(hl, node);\n                                hl.appendChild(node);\n                                pn = hl;\n                            }\n                            if (att == "target") {\n                                pn.setAttributeNS(xlink, "show", value == "blank" ? "new" : value);\n                            } else {\n                                pn.setAttributeNS(xlink, att, value);\n                            }\n                            break;\n                        case "cursor":\n                            node.style.cursor = value;\n                            break;\n                        case "transform":\n                            o.transform(value);\n                            break;\n                        case "arrow-start":\n                            addArrow(o, value);\n                            break;\n                        case "arrow-end":\n                            addArrow(o, value, 1);\n                            break;\n                        case "clip-rect":\n                            var rect = Str(value).split(separator);\n                            if (rect.length == 4) {\n                                o.clip && o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);\n                                var el = $("clipPath"),\n                                    rc = $("rect");\n                                el.id = R.createUUID();\n                                $(rc, {\n                                    x: rect[0],\n                                    y: rect[1],\n                                    width: rect[2],\n                                    height: rect[3]\n                                });\n                                el.appendChild(rc);\n                                o.paper.defs.appendChild(el);\n                                $(node, {"clip-path": "url(#" + el.id + ")"});\n                                o.clip = rc;\n                            }\n                            if (!value) {\n                                var path = node.getAttribute("clip-path");\n                                if (path) {\n                                    var clip = R._g.doc.getElementById(path.replace(/(^url\\(#|\\)$)/g, E));\n                                    clip && clip.parentNode.removeChild(clip);\n                                    $(node, {"clip-path": E});\n                                    delete o.clip;\n                                }\n                            }\n                            break;\n                        case "path":\n                            if (o.type == "path") {\n                                $(node, {d: value ? attrs.path = R._pathToAbsolute(value) : "M0,0"});\n                                o._.dirty = 1;\n                                if (o._.arrows) {\n                                    "startString" in o._.arrows && addArrow(o, o._.arrows.startString);\n                                    "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);\n                                }\n                            }\n                            break;\n                        case "width":\n                            node.setAttribute(att, value);\n                            o._.dirty = 1;\n                            if (attrs.fx) {\n                                att = "x";\n                                value = attrs.x;\n                            } else {\n                                break;\n                            }\n                        case "x":\n                            if (attrs.fx) {\n                                value = -attrs.x - (attrs.width || 0);\n                            }\n                        case "rx":\n                            if (att == "rx" && o.type == "rect") {\n                                break;\n                            }\n                        case "cx":\n                            node.setAttribute(att, value);\n                            o.pattern && updatePosition(o);\n                            o._.dirty = 1;\n                            break;\n                        case "height":\n                            node.setAttribute(att, value);\n                            o._.dirty = 1;\n                            if (attrs.fy) {\n                                att = "y";\n                                value = attrs.y;\n                            } else {\n                                break;\n                            }\n                        case "y":\n                            if (attrs.fy) {\n                                value = -attrs.y - (attrs.height || 0);\n                            }\n                        case "ry":\n                            if (att == "ry" && o.type == "rect") {\n                                break;\n                            }\n                        case "cy":\n                            node.setAttribute(att, value);\n                            o.pattern && updatePosition(o);\n                            o._.dirty = 1;\n                            break;\n                        case "r":\n                            if (o.type == "rect") {\n                                $(node, {rx: value, ry: value});\n                            } else {\n                                node.setAttribute(att, value);\n                            }\n                            o._.dirty = 1;\n                            break;\n                        case "src":\n                            if (o.type == "image") {\n                                node.setAttributeNS(xlink, "href", value);\n                            }\n                            break;\n                        case "stroke-width":\n                            if (o._.sx != 1 || o._.sy != 1) {\n                                value /= mmax(abs(o._.sx), abs(o._.sy)) || 1;\n                            }\n                            node.setAttribute(att, value);\n                            if (attrs["stroke-dasharray"]) {\n                                addDashes(o, attrs["stroke-dasharray"], params);\n                            }\n                            if (o._.arrows) {\n                                "startString" in o._.arrows && addArrow(o, o._.arrows.startString);\n                                "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);\n                            }\n                            break;\n                        case "stroke-dasharray":\n                            addDashes(o, value, params);\n                            break;\n                        case "fill":\n                            var isURL = Str(value).match(R._ISURL);\n                            if (isURL) {\n                                el = $("pattern");\n                                var ig = $("image");\n                                el.id = R.createUUID();\n                                $(el, {x: 0, y: 0, patternUnits: "userSpaceOnUse", height: 1, width: 1});\n                                $(ig, {x: 0, y: 0, "xlink:href": isURL[1]});\n                                el.appendChild(ig);\n\n                                (function (el) {\n                                    R._preload(isURL[1], function () {\n                                        var w = this.offsetWidth,\n                                            h = this.offsetHeight;\n                                        $(el, {width: w, height: h});\n                                        $(ig, {width: w, height: h});\n                                    });\n                                })(el);\n                                o.paper.defs.appendChild(el);\n                                $(node, {fill: "url(#" + el.id + ")"});\n                                o.pattern = el;\n                                o.pattern && updatePosition(o);\n                                break;\n                            }\n                            var clr = R.getRGB(value);\n                            if (!clr.error) {\n                                delete params.gradient;\n                                delete attrs.gradient;\n                                !R.is(attrs.opacity, "undefined") &&\n                                R.is(params.opacity, "undefined") &&\n                                $(node, {opacity: attrs.opacity});\n                                !R.is(attrs["fill-opacity"], "undefined") &&\n                                R.is(params["fill-opacity"], "undefined") &&\n                                $(node, {"fill-opacity": attrs["fill-opacity"]});\n                            } else if ((o.type == "circle" || o.type == "ellipse" || Str(value).charAt() != "r") && addGradientFill(o, value)) {\n                                if ("opacity" in attrs || "fill-opacity" in attrs) {\n                                    var gradient = R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\\(#|\\)$/g, E));\n                                    if (gradient) {\n                                        var stops = gradient.getElementsByTagName("stop");\n                                        $(stops[stops.length - 1], {"stop-opacity": ("opacity" in attrs ? attrs.opacity : 1) * ("fill-opacity" in attrs ? attrs["fill-opacity"] : 1)});\n                                    }\n                                }\n                                attrs.gradient = value;\n                                attrs.fill = "none";\n                                break;\n                            }\n                            clr[has]("opacity") && $(node, {"fill-opacity": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity});\n                        case "stroke":\n                            clr = R.getRGB(value);\n                            node.setAttribute(att, clr.hex);\n                            att == "stroke" && clr[has]("opacity") && $(node, {"stroke-opacity": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity});\n                            if (att == "stroke" && o._.arrows) {\n                                "startString" in o._.arrows && addArrow(o, o._.arrows.startString);\n                                "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);\n                            }\n                            break;\n                        case "gradient":\n                            (o.type == "circle" || o.type == "ellipse" || Str(value).charAt() != "r") && addGradientFill(o, value);\n                            break;\n                        case "opacity":\n                            if (attrs.gradient && !attrs[has]("stroke-opacity")) {\n                                $(node, {"stroke-opacity": value > 1 ? value / 100 : value});\n                            }\n                        // fall\n                        case "fill-opacity":\n                            if (attrs.gradient) {\n                                gradient = R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\\(#|\\)$/g, E));\n                                if (gradient) {\n                                    stops = gradient.getElementsByTagName("stop");\n                                    $(stops[stops.length - 1], {"stop-opacity": value});\n                                }\n                                break;\n                            }\n                        default:\n                            att == "font-size" && (value = toInt(value, 10) + "px");\n                            var cssrule = att.replace(/(\\-.)/g, function (w) {\n                                return w.substring(1).toUpperCase();\n                            });\n                            node.style[cssrule] = value;\n                            o._.dirty = 1;\n                            node.setAttribute(att, value);\n                            break;\n                    }\n                }\n            }\n\n            tuneText(o, params);\n            node.style.visibility = vis;\n        },\n        leading = 1.2,\n        tuneText = function (el, params) {\n            if (el.type != "text" || !(params[has]("text") || params[has]("font") || params[has]("font-size") || params[has]("x") || params[has]("y"))) {\n                return;\n            }\n            var a = el.attrs,\n                node = el.node,\n                fontSize = node.firstChild ? toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild, E).getPropertyValue("font-size"), 10) : 10;\n\n            if (params[has]("text")) {\n                a.text = params.text;\n                while (node.firstChild) {\n                    node.removeChild(node.firstChild);\n                }\n                var texts = Str(params.text).split("\\n"),\n                    tspans = [],\n                    tspan;\n                for (var i = 0, ii = texts.length; i < ii; i++) {\n                    tspan = $("tspan");\n                    i && $(tspan, {dy: fontSize * leading, x: a.x});\n                    tspan.appendChild(R._g.doc.createTextNode(texts[i]));\n                    node.appendChild(tspan);\n                    tspans[i] = tspan;\n                }\n            } else {\n                tspans = node.getElementsByTagName("tspan");\n                for (i = 0, ii = tspans.length; i < ii; i++) if (i) {\n                    $(tspans[i], {dy: fontSize * leading, x: a.x});\n                } else {\n                    $(tspans[0], {dy: 0});\n                }\n            }\n            $(node, {x: a.x, y: a.y});\n            el._.dirty = 1;\n            var bb = el._getBBox(),\n                dif = a.y - (bb.y + bb.height / 2);\n            dif && R.is(dif, "finite") && $(tspans[0], {dy: dif});\n        },\n        getRealNode = function (node) {\n            if (node.parentNode && node.parentNode.tagName.toLowerCase() === "a") {\n                return node.parentNode;\n            } else {\n                return node;\n            }\n        },\n        Element = function (node, svg) {\n            var X = 0,\n                Y = 0;\n            /*\\\n             * Element.node\n             [ property (object) ]\n             **\n             * Gives you a reference to the DOM object, so you can assign event handlers or just mess around.\n             **\n             * Note: Don’t mess with it.\n             > Usage\n             | // draw a circle at coordinate 10,10 with radius of 10\n             | var c = paper.circle(10, 10, 10);\n             | c.node.onclick = function () {\n             |     c.attr("fill", "red");\n             | };\n             \\*/\n            this[0] = this.node = node;\n            /*\\\n             * Element.raphael\n             [ property (object) ]\n             **\n             * Internal reference to @Raphael object. In case it is not available.\n             > Usage\n             | Raphael.el.red = function () {\n             |     var hsb = this.paper.raphael.rgb2hsb(this.attr("fill"));\n             |     hsb.h = 1;\n             |     this.attr({fill: this.paper.raphael.hsb2rgb(hsb).hex});\n             | }\n             \\*/\n            node.raphael = true;\n            /*\\\n             * Element.id\n             [ property (number) ]\n             **\n             * Unique id of the element. Especially useful when you want to listen to events of the element,\n             * because all events are fired in format `<module>.<action>.<id>`. Also useful for @Paper.getById method.\n             \\*/\n            this.id = R._oid++;\n            node.raphaelid = this.id;\n            this.matrix = R.matrix();\n            this.realPath = null;\n            /*\\\n             * Element.paper\n             [ property (object) ]\n             **\n             * Internal reference to “paper” where object drawn. Mainly for use in plugins and element extensions.\n             > Usage\n             | Raphael.el.cross = function () {\n             |     this.attr({fill: "red"});\n             |     this.paper.path("M10,10L50,50M50,10L10,50")\n             |         .attr({stroke: "red"});\n             | }\n             \\*/\n            this.paper = svg;\n            this.attrs = this.attrs || {};\n            this._ = {\n                transform: [],\n                sx: 1,\n                sy: 1,\n                deg: 0,\n                dx: 0,\n                dy: 0,\n                dirty: 1\n            };\n            !svg.bottom && (svg.bottom = this);\n            /*\\\n             * Element.prev\n             [ property (object) ]\n             **\n             * Reference to the previous element in the hierarchy.\n             \\*/\n            this.prev = svg.top;\n            svg.top && (svg.top.next = this);\n            svg.top = this;\n            /*\\\n             * Element.next\n             [ property (object) ]\n             **\n             * Reference to the next element in the hierarchy.\n             \\*/\n            this.next = null;\n        },\n        elproto = R.el;\n\n    Element.prototype = elproto;\n    elproto.constructor = Element;\n\n    R._engine.path = function (pathString, SVG) {\n        var el = $("path");\n        SVG.canvas && SVG.canvas.appendChild(el);\n        var p = new Element(el, SVG);\n        p.type = "path";\n        setFillAndStroke(p, {\n            fill: "none",\n            stroke: "#000",\n            path: pathString\n        });\n        return p;\n    };\n    /*\\\n     * Element.rotate\n     [ method ]\n     **\n     * Deprecated! Use @Element.transform instead.\n     * Adds rotation by given angle around given point to the list of\n     * transformations of the element.\n     > Parameters\n     - deg (number) angle in degrees\n     - cx (number) #optional x coordinate of the centre of rotation\n     - cy (number) #optional y coordinate of the centre of rotation\n     * If cx & cy aren’t specified centre of the shape is used as a point of rotation.\n     = (object) @Element\n     \\*/\n    elproto.rotate = function (deg, cx, cy) {\n        if (this.removed) {\n            return this;\n        }\n        deg = Str(deg).split(separator);\n        if (deg.length - 1) {\n            cx = toFloat(deg[1]);\n            cy = toFloat(deg[2]);\n        }\n        deg = toFloat(deg[0]);\n        (cy == null) && (cx = cy);\n        if (cx == null || cy == null) {\n            var bbox = this.getBBox(1);\n            cx = bbox.x + bbox.width / 2;\n            cy = bbox.y + bbox.height / 2;\n        }\n        this.transform(this._.transform.concat([["r", deg, cx, cy]]));\n        return this;\n    };\n    /*\\\n     * Element.scale\n     [ method ]\n     **\n     * Deprecated! Use @Element.transform instead.\n     * Adds scale by given amount relative to given point to the list of\n     * transformations of the element.\n     > Parameters\n     - sx (number) horisontal scale amount\n     - sy (number) vertical scale amount\n     - cx (number) #optional x coordinate of the centre of scale\n     - cy (number) #optional y coordinate of the centre of scale\n     * If cx & cy aren’t specified centre of the shape is used instead.\n     = (object) @Element\n     \\*/\n    elproto.scale = function (sx, sy, cx, cy) {\n        if (this.removed) {\n            return this;\n        }\n        sx = Str(sx).split(separator);\n        if (sx.length - 1) {\n            sy = toFloat(sx[1]);\n            cx = toFloat(sx[2]);\n            cy = toFloat(sx[3]);\n        }\n        sx = toFloat(sx[0]);\n        (sy == null) && (sy = sx);\n        (cy == null) && (cx = cy);\n        if (cx == null || cy == null) {\n            var bbox = this.getBBox(1);\n        }\n        cx = cx == null ? bbox.x + bbox.width / 2 : cx;\n        cy = cy == null ? bbox.y + bbox.height / 2 : cy;\n        this.transform(this._.transform.concat([["s", sx, sy, cx, cy]]));\n        return this;\n    };\n    /*\\\n     * Element.translate\n     [ method ]\n     **\n     * Deprecated! Use @Element.transform instead.\n     * Adds translation by given amount to the list of transformations of the element.\n     > Parameters\n     - dx (number) horisontal shift\n     - dy (number) vertical shift\n     = (object) @Element\n     \\*/\n    elproto.translate = function (dx, dy) {\n        if (this.removed) {\n            return this;\n        }\n        dx = Str(dx).split(separator);\n        if (dx.length - 1) {\n            dy = toFloat(dx[1]);\n        }\n        dx = toFloat(dx[0]) || 0;\n        dy = +dy || 0;\n        this.transform(this._.transform.concat([["t", dx, dy]]));\n        return this;\n    };\n    /*\\\n     * Element.transform\n     [ method ]\n     **\n     * Adds transformation to the element which is separate to other attributes,\n     * i.e. translation doesn’t change `x` or `y` of the rectange. The format\n     * of transformation string is similar to the path string syntax:\n     | "t100,100r30,100,100s2,2,100,100r45s1.5"\n     * Each letter is a command. There are four commands: `t` is for translate, `r` is for rotate, `s` is for\n     * scale and `m` is for matrix.\n     *\n     * There are also alternative “absolute” translation, rotation and scale: `T`, `R` and `S`. They will not take previous transformation into account. For example, `...T100,0` will always move element 100 px horisontally, while `...t100,0` could move it vertically if there is `r90` before. Just compare results of `r90t100,0` and `r90T100,0`.\n     *\n     * So, the example line above could be read like “translate by 100, 100; rotate 30° around 100, 100; scale twice around 100, 100;\n     * rotate 45° around centre; scale 1.5 times relative to centre”. As you can see rotate and scale commands have origin\n     * coordinates as optional parameters, the default is the centre point of the element.\n     * Matrix accepts six parameters.\n     > Usage\n     | var el = paper.rect(10, 20, 300, 200);\n     | // translate 100, 100, rotate 45°, translate -100, 0\n     | el.transform("t100,100r45t-100,0");\n     | // if you want you can append or prepend transformations\n     | el.transform("...t50,50");\n     | el.transform("s2...");\n     | // or even wrap\n     | el.transform("t50,50...t-50-50");\n     | // to reset transformation call method with empty string\n     | el.transform("");\n     | // to get current value call it without parameters\n     | console.log(el.transform());\n     > Parameters\n     - tstr (string) #optional transformation string\n     * If tstr isn’t specified\n     = (string) current transformation string\n     * else\n     = (object) @Element\n     \\*/\n    elproto.transform = function (tstr) {\n        var _ = this._;\n        if (tstr == null) {\n            return _.transform;\n        }\n        R._extractTransform(this, tstr);\n\n        this.clip && $(this.clip, {transform: this.matrix.invert()});\n        this.pattern && updatePosition(this);\n        this.node && $(this.node, {transform: this.matrix});\n\n        if (_.sx != 1 || _.sy != 1) {\n            var sw = this.attrs[has]("stroke-width") ? this.attrs["stroke-width"] : 1;\n            this.attr({"stroke-width": sw});\n        }\n\n        return this;\n    };\n    /*\\\n     * Element.hide\n     [ method ]\n     **\n     * Makes element invisible. See @Element.show.\n     = (object) @Element\n     \\*/\n    elproto.hide = function () {\n        if(!this.removed) this.node.style.display = "none";\n        return this;\n    };\n    /*\\\n     * Element.show\n     [ method ]\n     **\n     * Makes element visible. See @Element.hide.\n     = (object) @Element\n     \\*/\n    elproto.show = function () {\n        if(!this.removed) this.node.style.display = "";\n        return this;\n    };\n    /*\\\n     * Element.remove\n     [ method ]\n     **\n     * Removes element from the paper.\n     \\*/\n    elproto.remove = function () {\n        var node = getRealNode(this.node);\n        if (this.removed || !node.parentNode) {\n            return;\n        }\n        var paper = this.paper;\n        paper.__set__ && paper.__set__.exclude(this);\n        eve.unbind("raphael.*.*." + this.id);\n        if (this.gradient) {\n            paper.defs.removeChild(this.gradient);\n        }\n        R._tear(this, paper);\n\n        node.parentNode.removeChild(node);\n\n        // Remove custom data for element\n        this.removeData();\n\n        for (var i in this) {\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\n        }\n        this.removed = true;\n    };\n    elproto._getBBox = function () {\n        if (this.node.style.display == "none") {\n            this.show();\n            var hide = true;\n        }\n        var canvasHidden = false,\n            containerStyle;\n        if (this.paper.canvas.parentElement) {\n            containerStyle = this.paper.canvas.parentElement.style;\n        } //IE10+ can\'t find parentElement\n        else if (this.paper.canvas.parentNode) {\n            containerStyle = this.paper.canvas.parentNode.style;\n        }\n\n        if(containerStyle && containerStyle.display == "none") {\n            canvasHidden = true;\n            containerStyle.display = "";\n        }\n        var bbox = {};\n        try {\n            bbox = this.node.getBBox();\n        } catch(e) {\n            // Firefox 3.0.x, 25.0.1 (probably more versions affected) play badly here - possible fix\n            bbox = {\n                x: this.node.clientLeft,\n                y: this.node.clientTop,\n                width: this.node.clientWidth,\n                height: this.node.clientHeight\n            }\n        } finally {\n            bbox = bbox || {};\n            if(canvasHidden){\n                containerStyle.display = "none";\n            }\n        }\n        hide && this.hide();\n        return bbox;\n    };\n    /*\\\n     * Element.attr\n     [ method ]\n     **\n     * Sets the attributes of the element.\n     > Parameters\n     - attrName (string) attribute’s name\n     - value (string) value\n     * or\n     - params (object) object of name/value pairs\n     * or\n     - attrName (string) attribute’s name\n     * or\n     - attrNames (array) in this case method returns array of current values for given attribute names\n     = (object) @Element if attrsName & value or params are passed in.\n     = (...) value of the attribute if only attrsName is passed in.\n     = (array) array of values of the attribute if attrsNames is passed in.\n     = (object) object of attributes if nothing is passed in.\n     > Possible parameters\n     # <p>Please refer to the <a href="http://www.w3.org/TR/SVG/" title="The W3C Recommendation for the SVG language describes these properties in detail.">SVG specification</a> for an explanation of these parameters.</p>\n     o arrow-end (string) arrowhead on the end of the path. The format for string is `<type>[-<width>[-<length>]]`. Possible types: `classic`, `block`, `open`, `oval`, `diamond`, `none`, width: `wide`, `narrow`, `medium`, length: `long`, `short`, `midium`.\n     o clip-rect (string) comma or space separated values: x, y, width and height\n     o cursor (string) CSS type of the cursor\n     o cx (number) the x-axis coordinate of the center of the circle, or ellipse\n     o cy (number) the y-axis coordinate of the center of the circle, or ellipse\n     o fill (string) colour, gradient or image\n     o fill-opacity (number)\n     o font (string)\n     o font-family (string)\n     o font-size (number) font size in pixels\n     o font-weight (string)\n     o height (number)\n     o href (string) URL, if specified element behaves as hyperlink\n     o opacity (number)\n     o path (string) SVG path string format\n     o r (number) radius of the circle, ellipse or rounded corner on the rect\n     o rx (number) horisontal radius of the ellipse\n     o ry (number) vertical radius of the ellipse\n     o src (string) image URL, only works for @Element.image element\n     o stroke (string) stroke colour\n     o stroke-dasharray (string) [“”, “none”, “`-`”, “`.`”, “`-.`”, “`-..`”, “`. `”, “`- `”, “`--`”, “`- .`”, “`--.`”, “`--..`”]\n     o stroke-linecap (string) [“`butt`”, “`square`”, “`round`”]\n     o stroke-linejoin (string) [“`bevel`”, “`round`”, “`miter`”]\n     o stroke-miterlimit (number)\n     o stroke-opacity (number)\n     o stroke-width (number) stroke width in pixels, default is \'1\'\n     o target (string) used with href\n     o text (string) contents of the text element. Use `\\n` for multiline text\n     o text-anchor (string) [“`start`”, “`middle`”, “`end`”], default is “`middle`”\n     o title (string) will create tooltip with a given text\n     o transform (string) see @Element.transform\n     o width (number)\n     o x (number)\n     o y (number)\n     > Gradients\n     * Linear gradient format: “`‹angle›-‹colour›[-‹colour›[:‹offset›]]*-‹colour›`”, example: “`90-#fff-#000`” – 90°\n     * gradient from white to black or “`0-#fff-#f00:20-#000`” – 0° gradient from white via red (at 20%) to black.\n     *\n     * radial gradient: “`r[(‹fx›, ‹fy›)]‹colour›[-‹colour›[:‹offset›]]*-‹colour›`”, example: “`r#fff-#000`” –\n     * gradient from white to black or “`r(0.25, 0.75)#fff-#000`” – gradient from white to black with focus point\n     * at 0.25, 0.75. Focus point coordinates are in 0..1 range. Radial gradients can only be applied to circles and ellipses.\n     > Path String\n     # <p>Please refer to <a href="http://www.w3.org/TR/SVG/paths.html#PathData" title="Details of a path’s data attribute’s format are described in the SVG specification.">SVG documentation regarding path string</a>. Raphaël fully supports it.</p>\n     > Colour Parsing\n     # <ul>\n     #     <li>Colour name (“<code>red</code>”, “<code>green</code>”, “<code>cornflowerblue</code>”, etc)</li>\n     #     <li>#••• — shortened HTML colour: (“<code>#000</code>”, “<code>#fc0</code>”, etc)</li>\n     #     <li>#•••••• — full length HTML colour: (“<code>#000000</code>”, “<code>#bd2300</code>”)</li>\n     #     <li>rgb(•••, •••, •••) — red, green and blue channels’ values: (“<code>rgb(200,&nbsp;100,&nbsp;0)</code>”)</li>\n     #     <li>rgb(•••%, •••%, •••%) — same as above, but in %: (“<code>rgb(100%,&nbsp;175%,&nbsp;0%)</code>”)</li>\n     #     <li>rgba(•••, •••, •••, •••) — red, green and blue channels’ values: (“<code>rgba(200,&nbsp;100,&nbsp;0, .5)</code>”)</li>\n     #     <li>rgba(•••%, •••%, •••%, •••%) — same as above, but in %: (“<code>rgba(100%,&nbsp;175%,&nbsp;0%, 50%)</code>”)</li>\n     #     <li>hsb(•••, •••, •••) — hue, saturation and brightness values: (“<code>hsb(0.5,&nbsp;0.25,&nbsp;1)</code>”)</li>\n     #     <li>hsb(•••%, •••%, •••%) — same as above, but in %</li>\n     #     <li>hsba(•••, •••, •••, •••) — same as above, but with opacity</li>\n     #     <li>hsl(•••, •••, •••) — almost the same as hsb, see <a href="http://en.wikipedia.org/wiki/HSL_and_HSV" title="HSL and HSV - Wikipedia, the free encyclopedia">Wikipedia page</a></li>\n     #     <li>hsl(•••%, •••%, •••%) — same as above, but in %</li>\n     #     <li>hsla(•••, •••, •••, •••) — same as above, but with opacity</li>\n     #     <li>Optionally for hsb and hsl you could specify hue as a degree: “<code>hsl(240deg,&nbsp;1,&nbsp;.5)</code>” or, if you want to go fancy, “<code>hsl(240°,&nbsp;1,&nbsp;.5)</code>”</li>\n     # </ul>\n     \\*/\n    elproto.attr = function (name, value) {\n        if (this.removed) {\n            return this;\n        }\n        if (name == null) {\n            var res = {};\n            for (var a in this.attrs) if (this.attrs[has](a)) {\n                res[a] = this.attrs[a];\n            }\n            res.gradient && res.fill == "none" && (res.fill = res.gradient) && delete res.gradient;\n            res.transform = this._.transform;\n            return res;\n        }\n        if (value == null && R.is(name, "string")) {\n            if (name == "fill" && this.attrs.fill == "none" && this.attrs.gradient) {\n                return this.attrs.gradient;\n            }\n            if (name == "transform") {\n                return this._.transform;\n            }\n            var names = name.split(separator),\n                out = {};\n            for (var i = 0, ii = names.length; i < ii; i++) {\n                name = names[i];\n                if (name in this.attrs) {\n                    out[name] = this.attrs[name];\n                } else if (R.is(this.paper.customAttributes[name], "function")) {\n                    out[name] = this.paper.customAttributes[name].def;\n                } else {\n                    out[name] = R._availableAttrs[name];\n                }\n            }\n            return ii - 1 ? out : out[names[0]];\n        }\n        if (value == null && R.is(name, "array")) {\n            out = {};\n            for (i = 0, ii = name.length; i < ii; i++) {\n                out[name[i]] = this.attr(name[i]);\n            }\n            return out;\n        }\n        if (value != null) {\n            var params = {};\n            params[name] = value;\n        } else if (name != null && R.is(name, "object")) {\n            params = name;\n        }\n        for (var key in params) {\n            eve("raphael.attr." + key + "." + this.id, this, params[key]);\n        }\n        for (key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], "function")) {\n            var par = this.paper.customAttributes[key].apply(this, [].concat(params[key]));\n            this.attrs[key] = params[key];\n            for (var subkey in par) if (par[has](subkey)) {\n                params[subkey] = par[subkey];\n            }\n        }\n        setFillAndStroke(this, params);\n        return this;\n    };\n    /*\\\n     * Element.toFront\n     [ method ]\n     **\n     * Moves the element so it is the closest to the viewer’s eyes, on top of other elements.\n     = (object) @Element\n     \\*/\n    elproto.toFront = function () {\n        if (this.removed) {\n            return this;\n        }\n        var node = getRealNode(this.node);\n        node.parentNode.appendChild(node);\n        var svg = this.paper;\n        svg.top != this && R._tofront(this, svg);\n        return this;\n    };\n    /*\\\n     * Element.toBack\n     [ method ]\n     **\n     * Moves the element so it is the furthest from the viewer’s eyes, behind other elements.\n     = (object) @Element\n     \\*/\n    elproto.toBack = function () {\n        if (this.removed) {\n            return this;\n        }\n        var node = getRealNode(this.node);\n        var parentNode = node.parentNode;\n        parentNode.insertBefore(node, parentNode.firstChild);\n        R._toback(this, this.paper);\n        var svg = this.paper;\n        return this;\n    };\n    /*\\\n     * Element.insertAfter\n     [ method ]\n     **\n     * Inserts current object after the given one.\n     = (object) @Element\n     \\*/\n    elproto.insertAfter = function (element) {\n        if (this.removed || !element) {\n            return this;\n        }\n\n        var node = getRealNode(this.node);\n        var afterNode = getRealNode(element.node || element[element.length - 1].node);\n        if (afterNode.nextSibling) {\n            afterNode.parentNode.insertBefore(node, afterNode.nextSibling);\n        } else {\n            afterNode.parentNode.appendChild(node);\n        }\n        R._insertafter(this, element, this.paper);\n        return this;\n    };\n    /*\\\n     * Element.insertBefore\n     [ method ]\n     **\n     * Inserts current object before the given one.\n     = (object) @Element\n     \\*/\n    elproto.insertBefore = function (element) {\n        if (this.removed || !element) {\n            return this;\n        }\n\n        var node = getRealNode(this.node);\n        var beforeNode = getRealNode(element.node || element[0].node);\n        beforeNode.parentNode.insertBefore(node, beforeNode);\n        R._insertbefore(this, element, this.paper);\n        return this;\n    };\n    elproto.blur = function (size) {\n        // Experimental. No Safari support. Use it on your own risk.\n        var t = this;\n        if (+size !== 0) {\n            var fltr = $("filter"),\n                blur = $("feGaussianBlur");\n            t.attrs.blur = size;\n            fltr.id = R.createUUID();\n            $(blur, {stdDeviation: +size || 1.5});\n            fltr.appendChild(blur);\n            t.paper.defs.appendChild(fltr);\n            t._blur = fltr;\n            $(t.node, {filter: "url(#" + fltr.id + ")"});\n        } else {\n            if (t._blur) {\n                t._blur.parentNode.removeChild(t._blur);\n                delete t._blur;\n                delete t.attrs.blur;\n            }\n            t.node.removeAttribute("filter");\n        }\n        return t;\n    };\n    R._engine.circle = function (svg, x, y, r) {\n        var el = $("circle");\n        svg.canvas && svg.canvas.appendChild(el);\n        var res = new Element(el, svg);\n        res.attrs = {cx: x, cy: y, r: r, fill: "none", stroke: "#000"};\n        res.type = "circle";\n        $(el, res.attrs);\n        return res;\n    };\n    R._engine.rect = function (svg, x, y, w, h, r) {\n        var el = $("rect");\n        svg.canvas && svg.canvas.appendChild(el);\n        var res = new Element(el, svg);\n        res.attrs = {x: x, y: y, width: w, height: h, rx: r || 0, ry: r || 0, fill: "none", stroke: "#000"};\n        res.type = "rect";\n        $(el, res.attrs);\n        return res;\n    };\n    R._engine.ellipse = function (svg, x, y, rx, ry) {\n        var el = $("ellipse");\n        svg.canvas && svg.canvas.appendChild(el);\n        var res = new Element(el, svg);\n        res.attrs = {cx: x, cy: y, rx: rx, ry: ry, fill: "none", stroke: "#000"};\n        res.type = "ellipse";\n        $(el, res.attrs);\n        return res;\n    };\n    R._engine.image = function (svg, src, x, y, w, h) {\n        var el = $("image");\n        $(el, {x: x, y: y, width: w, height: h, preserveAspectRatio: "none"});\n        el.setAttributeNS(xlink, "href", src);\n        svg.canvas && svg.canvas.appendChild(el);\n        var res = new Element(el, svg);\n        res.attrs = {x: x, y: y, width: w, height: h, src: src};\n        res.type = "image";\n        return res;\n    };\n    R._engine.text = function (svg, x, y, text) {\n        var el = $("text");\n        svg.canvas && svg.canvas.appendChild(el);\n        var res = new Element(el, svg);\n        res.attrs = {\n            x: x,\n            y: y,\n            "text-anchor": "middle",\n            text: text,\n            "font-family": R._availableAttrs["font-family"],\n            "font-size": R._availableAttrs["font-size"],\n            stroke: "none",\n            fill: "#000"\n        };\n        res.type = "text";\n        setFillAndStroke(res, res.attrs);\n        return res;\n    };\n    R._engine.setSize = function (width, height) {\n        this.width = width || this.width;\n        this.height = height || this.height;\n        this.canvas.setAttribute("width", this.width);\n        this.canvas.setAttribute("height", this.height);\n        if (this._viewBox) {\n            this.setViewBox.apply(this, this._viewBox);\n        }\n        return this;\n    };\n    R._engine.create = function () {\n        var con = R._getContainer.apply(0, arguments),\n            container = con && con.container,\n            x = con.x,\n            y = con.y,\n            width = con.width,\n            height = con.height;\n        if (!container) {\n            throw new Error("SVG container not found.");\n        }\n        var cnvs = $("svg"),\n            css = "overflow:hidden;",\n            isFloating;\n        x = x || 0;\n        y = y || 0;\n        width = width || 512;\n        height = height || 342;\n        $(cnvs, {\n            height: height,\n            version: 1.1,\n            width: width,\n            xmlns: "http://www.w3.org/2000/svg",\n            "xmlns:xlink": "http://www.w3.org/1999/xlink"\n        });\n        if (container == 1) {\n            cnvs.style.cssText = css + "position:absolute;left:" + x + "px;top:" + y + "px";\n            R._g.doc.body.appendChild(cnvs);\n            isFloating = 1;\n        } else {\n            cnvs.style.cssText = css + "position:relative";\n            if (container.firstChild) {\n                container.insertBefore(cnvs, container.firstChild);\n            } else {\n                container.appendChild(cnvs);\n            }\n        }\n        container = new R._Paper;\n        container.width = width;\n        container.height = height;\n        container.canvas = cnvs;\n        container.clear();\n        container._left = container._top = 0;\n        isFloating && (container.renderfix = function () {});\n        container.renderfix();\n        return container;\n    };\n    R._engine.setViewBox = function (x, y, w, h, fit) {\n        eve("raphael.setViewBox", this, this._viewBox, [x, y, w, h, fit]);\n        var paperSize = this.getSize(),\n            size = mmax(w / paperSize.width, h / paperSize.height),\n            top = this.top,\n            aspectRatio = fit ? "xMidYMid meet" : "xMinYMin",\n            vb,\n            sw;\n        if (x == null) {\n            if (this._vbSize) {\n                size = 1;\n            }\n            delete this._vbSize;\n            vb = "0 0 " + this.width + S + this.height;\n        } else {\n            this._vbSize = size;\n            vb = x + S + y + S + w + S + h;\n        }\n        $(this.canvas, {\n            viewBox: vb,\n            preserveAspectRatio: aspectRatio\n        });\n        while (size && top) {\n            sw = "stroke-width" in top.attrs ? top.attrs["stroke-width"] : 1;\n            top.attr({"stroke-width": sw});\n            top._.dirty = 1;\n            top._.dirtyT = 1;\n            top = top.prev;\n        }\n        this._viewBox = [x, y, w, h, !!fit];\n        return this;\n    };\n    /*\\\n     * Paper.renderfix\n     [ method ]\n     **\n     * Fixes the issue of Firefox and IE9 regarding subpixel rendering. If paper is dependant\n     * on other elements after reflow it could shift half pixel which cause for lines to lost their crispness.\n     * This method fixes the issue.\n     **\n     Special thanks to Mariusz Nowak (http://www.medikoo.com/) for this method.\n     \\*/\n    R.prototype.renderfix = function () {\n        var cnvs = this.canvas,\n            s = cnvs.style,\n            pos;\n        try {\n            pos = cnvs.getScreenCTM() || cnvs.createSVGMatrix();\n        } catch (e) {\n            pos = cnvs.createSVGMatrix();\n        }\n        var left = -pos.e % 1,\n            top = -pos.f % 1;\n        if (left || top) {\n            if (left) {\n                this._left = (this._left + left) % 1;\n                s.left = this._left + "px";\n            }\n            if (top) {\n                this._top = (this._top + top) % 1;\n                s.top = this._top + "px";\n            }\n        }\n    };\n    /*\\\n     * Paper.clear\n     [ method ]\n     **\n     * Clears the paper, i.e. removes all the elements.\n     \\*/\n    R.prototype.clear = function () {\n        R.eve("raphael.clear", this);\n        var c = this.canvas;\n        while (c.firstChild) {\n            c.removeChild(c.firstChild);\n        }\n        this.bottom = this.top = null;\n        (this.desc = $("desc")).appendChild(R._g.doc.createTextNode("Created with Rapha\\xebl " + R.version));\n        c.appendChild(this.desc);\n        c.appendChild(this.defs = $("defs"));\n    };\n    /*\\\n     * Paper.remove\n     [ method ]\n     **\n     * Removes the paper from the DOM.\n     \\*/\n    R.prototype.remove = function () {\n        eve("raphael.remove", this);\n        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);\n        for (var i in this) {\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\n        }\n    };\n    var setproto = R.st;\n    for (var method in elproto) if (elproto[has](method) && !setproto[has](method)) {\n        setproto[method] = (function (methodname) {\n            return function () {\n                var arg = arguments;\n                return this.forEach(function (el) {\n                    el[methodname].apply(el, arg);\n                });\n            };\n        })(method);\n    }\n}));\n\n// ┌─────────────────────────────────────────────────────────────────────┐ \\\\\n// │ Raphaël 2.1.4 - JavaScript Vector Library                       │ \\\\\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\n// │ VML Module                                                          │ \\\\\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\n// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\\\\n// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\\\\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\\\\n// └─────────────────────────────────────────────────────────────────────┘ \\\\\n\n(function (glob, factory) {\n    if (typeof define === "function" && define.amd) {\n        define("raphael.vml", ["raphael.core"], function(raphael) {\n            return factory(raphael);\n        });\n    } else if (typeof exports === "object") {\n        factory(require("raphael"));\n    } else {\n        factory(glob.Raphael);\n    }\n}(this, function(R) {\n    if (R && !R.vml) {\n        return;\n    }\n\n    var has = "hasOwnProperty",\n        Str = String,\n        toFloat = parseFloat,\n        math = Math,\n        round = math.round,\n        mmax = math.max,\n        mmin = math.min,\n        abs = math.abs,\n        fillString = "fill",\n        separator = /[, ]+/,\n        eve = R.eve,\n        ms = " progid:DXImageTransform.Microsoft",\n        S = " ",\n        E = "",\n        map = {M: "m", L: "l", C: "c", Z: "x", m: "t", l: "r", c: "v", z: "x"},\n        bites = /([clmz]),?([^clmz]*)/gi,\n        blurregexp = / progid:\\S+Blur\\([^\\)]+\\)/g,\n        val = /-?[^,\\s-]+/g,\n        cssDot = "position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",\n        zoom = 21600,\n        pathTypes = {path: 1, rect: 1, image: 1},\n        ovalTypes = {circle: 1, ellipse: 1},\n        path2vml = function (path) {\n            var total =  /[ahqstv]/ig,\n                command = R._pathToAbsolute;\n            Str(path).match(total) && (command = R._path2curve);\n            total = /[clmz]/g;\n            if (command == R._pathToAbsolute && !Str(path).match(total)) {\n                var res = Str(path).replace(bites, function (all, command, args) {\n                    var vals = [],\n                        isMove = command.toLowerCase() == "m",\n                        res = map[command];\n                    args.replace(val, function (value) {\n                        if (isMove && vals.length == 2) {\n                            res += vals + map[command == "m" ? "l" : "L"];\n                            vals = [];\n                        }\n                        vals.push(round(value * zoom));\n                    });\n                    return res + vals;\n                });\n                return res;\n            }\n            var pa = command(path), p, r;\n            res = [];\n            for (var i = 0, ii = pa.length; i < ii; i++) {\n                p = pa[i];\n                r = pa[i][0].toLowerCase();\n                r == "z" && (r = "x");\n                for (var j = 1, jj = p.length; j < jj; j++) {\n                    r += round(p[j] * zoom) + (j != jj - 1 ? "," : E);\n                }\n                res.push(r);\n            }\n            return res.join(S);\n        },\n        compensation = function (deg, dx, dy) {\n            var m = R.matrix();\n            m.rotate(-deg, .5, .5);\n            return {\n                dx: m.x(dx, dy),\n                dy: m.y(dx, dy)\n            };\n        },\n        setCoords = function (p, sx, sy, dx, dy, deg) {\n            var _ = p._,\n                m = p.matrix,\n                fillpos = _.fillpos,\n                o = p.node,\n                s = o.style,\n                y = 1,\n                flip = "",\n                dxdy,\n                kx = zoom / sx,\n                ky = zoom / sy;\n            s.visibility = "hidden";\n            if (!sx || !sy) {\n                return;\n            }\n            o.coordsize = abs(kx) + S + abs(ky);\n            s.rotation = deg * (sx * sy < 0 ? -1 : 1);\n            if (deg) {\n                var c = compensation(deg, dx, dy);\n                dx = c.dx;\n                dy = c.dy;\n            }\n            sx < 0 && (flip += "x");\n            sy < 0 && (flip += " y") && (y = -1);\n            s.flip = flip;\n            o.coordorigin = (dx * -kx) + S + (dy * -ky);\n            if (fillpos || _.fillsize) {\n                var fill = o.getElementsByTagName(fillString);\n                fill = fill && fill[0];\n                o.removeChild(fill);\n                if (fillpos) {\n                    c = compensation(deg, m.x(fillpos[0], fillpos[1]), m.y(fillpos[0], fillpos[1]));\n                    fill.position = c.dx * y + S + c.dy * y;\n                }\n                if (_.fillsize) {\n                    fill.size = _.fillsize[0] * abs(sx) + S + _.fillsize[1] * abs(sy);\n                }\n                o.appendChild(fill);\n            }\n            s.visibility = "visible";\n        };\n    R.toString = function () {\n        return  "Your browser doesn\\u2019t support SVG. Falling down to VML.\\nYou are running Rapha\\xebl " + this.version;\n    };\n    var addArrow = function (o, value, isEnd) {\n            var values = Str(value).toLowerCase().split("-"),\n                se = isEnd ? "end" : "start",\n                i = values.length,\n                type = "classic",\n                w = "medium",\n                h = "medium";\n            while (i--) {\n                switch (values[i]) {\n                    case "block":\n                    case "classic":\n                    case "oval":\n                    case "diamond":\n                    case "open":\n                    case "none":\n                        type = values[i];\n                        break;\n                    case "wide":\n                    case "narrow": h = values[i]; break;\n                    case "long":\n                    case "short": w = values[i]; break;\n                }\n            }\n            var stroke = o.node.getElementsByTagName("stroke")[0];\n            stroke[se + "arrow"] = type;\n            stroke[se + "arrowlength"] = w;\n            stroke[se + "arrowwidth"] = h;\n        },\n        setFillAndStroke = function (o, params) {\n            // o.paper.canvas.style.display = "none";\n            o.attrs = o.attrs || {};\n            var node = o.node,\n                a = o.attrs,\n                s = node.style,\n                xy,\n                newpath = pathTypes[o.type] && (params.x != a.x || params.y != a.y || params.width != a.width || params.height != a.height || params.cx != a.cx || params.cy != a.cy || params.rx != a.rx || params.ry != a.ry || params.r != a.r),\n                isOval = ovalTypes[o.type] && (a.cx != params.cx || a.cy != params.cy || a.r != params.r || a.rx != params.rx || a.ry != params.ry),\n                res = o;\n\n\n            for (var par in params) if (params[has](par)) {\n                a[par] = params[par];\n            }\n            if (newpath) {\n                a.path = R._getPath[o.type](o);\n                o._.dirty = 1;\n            }\n            params.href && (node.href = params.href);\n            params.title && (node.title = params.title);\n            params.target && (node.target = params.target);\n            params.cursor && (s.cursor = params.cursor);\n            "blur" in params && o.blur(params.blur);\n            if (params.path && o.type == "path" || newpath) {\n                node.path = path2vml(~Str(a.path).toLowerCase().indexOf("r") ? R._pathToAbsolute(a.path) : a.path);\n                o._.dirty = 1;\n                if (o.type == "image") {\n                    o._.fillpos = [a.x, a.y];\n                    o._.fillsize = [a.width, a.height];\n                    setCoords(o, 1, 1, 0, 0, 0);\n                }\n            }\n            "transform" in params && o.transform(params.transform);\n            if (isOval) {\n                var cx = +a.cx,\n                    cy = +a.cy,\n                    rx = +a.rx || +a.r || 0,\n                    ry = +a.ry || +a.r || 0;\n                node.path = R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x", round((cx - rx) * zoom), round((cy - ry) * zoom), round((cx + rx) * zoom), round((cy + ry) * zoom), round(cx * zoom));\n                o._.dirty = 1;\n            }\n            if ("clip-rect" in params) {\n                var rect = Str(params["clip-rect"]).split(separator);\n                if (rect.length == 4) {\n                    rect[2] = +rect[2] + (+rect[0]);\n                    rect[3] = +rect[3] + (+rect[1]);\n                    var div = node.clipRect || R._g.doc.createElement("div"),\n                        dstyle = div.style;\n                    dstyle.clip = R.format("rect({1}px {2}px {3}px {0}px)", rect);\n                    if (!node.clipRect) {\n                        dstyle.position = "absolute";\n                        dstyle.top = 0;\n                        dstyle.left = 0;\n                        dstyle.width = o.paper.width + "px";\n                        dstyle.height = o.paper.height + "px";\n                        node.parentNode.insertBefore(div, node);\n                        div.appendChild(node);\n                        node.clipRect = div;\n                    }\n                }\n                if (!params["clip-rect"]) {\n                    node.clipRect && (node.clipRect.style.clip = "auto");\n                }\n            }\n            if (o.textpath) {\n                var textpathStyle = o.textpath.style;\n                params.font && (textpathStyle.font = params.font);\n                params["font-family"] && (textpathStyle.fontFamily = \'"\' + params["font-family"].split(",")[0].replace(/^[\'"]+|[\'"]+$/g, E) + \'"\');\n                params["font-size"] && (textpathStyle.fontSize = params["font-size"]);\n                params["font-weight"] && (textpathStyle.fontWeight = params["font-weight"]);\n                params["font-style"] && (textpathStyle.fontStyle = params["font-style"]);\n            }\n            if ("arrow-start" in params) {\n                addArrow(res, params["arrow-start"]);\n            }\n            if ("arrow-end" in params) {\n                addArrow(res, params["arrow-end"], 1);\n            }\n            if (params.opacity != null ||\n                params["stroke-width"] != null ||\n                params.fill != null ||\n                params.src != null ||\n                params.stroke != null ||\n                params["stroke-width"] != null ||\n                params["stroke-opacity"] != null ||\n                params["fill-opacity"] != null ||\n                params["stroke-dasharray"] != null ||\n                params["stroke-miterlimit"] != null ||\n                params["stroke-linejoin"] != null ||\n                params["stroke-linecap"] != null) {\n                var fill = node.getElementsByTagName(fillString),\n                    newfill = false;\n                fill = fill && fill[0];\n                !fill && (newfill = fill = createNode(fillString));\n                if (o.type == "image" && params.src) {\n                    fill.src = params.src;\n                }\n                params.fill && (fill.on = true);\n                if (fill.on == null || params.fill == "none" || params.fill === null) {\n                    fill.on = false;\n                }\n                if (fill.on && params.fill) {\n                    var isURL = Str(params.fill).match(R._ISURL);\n                    if (isURL) {\n                        fill.parentNode == node && node.removeChild(fill);\n                        fill.rotate = true;\n                        fill.src = isURL[1];\n                        fill.type = "tile";\n                        var bbox = o.getBBox(1);\n                        fill.position = bbox.x + S + bbox.y;\n                        o._.fillpos = [bbox.x, bbox.y];\n\n                        R._preload(isURL[1], function () {\n                            o._.fillsize = [this.offsetWidth, this.offsetHeight];\n                        });\n                    } else {\n                        fill.color = R.getRGB(params.fill).hex;\n                        fill.src = E;\n                        fill.type = "solid";\n                        if (R.getRGB(params.fill).error && (res.type in {circle: 1, ellipse: 1} || Str(params.fill).charAt() != "r") && addGradientFill(res, params.fill, fill)) {\n                            a.fill = "none";\n                            a.gradient = params.fill;\n                            fill.rotate = false;\n                        }\n                    }\n                }\n                if ("fill-opacity" in params || "opacity" in params) {\n                    var opacity = ((+a["fill-opacity"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+R.getRGB(params.fill).o + 1 || 2) - 1);\n                    opacity = mmin(mmax(opacity, 0), 1);\n                    fill.opacity = opacity;\n                    if (fill.src) {\n                        fill.color = "none";\n                    }\n                }\n                node.appendChild(fill);\n                var stroke = (node.getElementsByTagName("stroke") && node.getElementsByTagName("stroke")[0]),\n                    newstroke = false;\n                !stroke && (newstroke = stroke = createNode("stroke"));\n                if ((params.stroke && params.stroke != "none") ||\n                    params["stroke-width"] ||\n                    params["stroke-opacity"] != null ||\n                    params["stroke-dasharray"] ||\n                    params["stroke-miterlimit"] ||\n                    params["stroke-linejoin"] ||\n                    params["stroke-linecap"]) {\n                    stroke.on = true;\n                }\n                (params.stroke == "none" || params.stroke === null || stroke.on == null || params.stroke == 0 || params["stroke-width"] == 0) && (stroke.on = false);\n                var strokeColor = R.getRGB(params.stroke);\n                stroke.on && params.stroke && (stroke.color = strokeColor.hex);\n                opacity = ((+a["stroke-opacity"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+strokeColor.o + 1 || 2) - 1);\n                var width = (toFloat(params["stroke-width"]) || 1) * .75;\n                opacity = mmin(mmax(opacity, 0), 1);\n                params["stroke-width"] == null && (width = a["stroke-width"]);\n                params["stroke-width"] && (stroke.weight = width);\n                width && width < 1 && (opacity *= width) && (stroke.weight = 1);\n                stroke.opacity = opacity;\n\n                params["stroke-linejoin"] && (stroke.joinstyle = params["stroke-linejoin"] || "miter");\n                stroke.miterlimit = params["stroke-miterlimit"] || 8;\n                params["stroke-linecap"] && (stroke.endcap = params["stroke-linecap"] == "butt" ? "flat" : params["stroke-linecap"] == "square" ? "square" : "round");\n                if ("stroke-dasharray" in params) {\n                    var dasharray = {\n                        "-": "shortdash",\n                        ".": "shortdot",\n                        "-.": "shortdashdot",\n                        "-..": "shortdashdotdot",\n                        ". ": "dot",\n                        "- ": "dash",\n                        "--": "longdash",\n                        "- .": "dashdot",\n                        "--.": "longdashdot",\n                        "--..": "longdashdotdot"\n                    };\n                    stroke.dashstyle = dasharray[has](params["stroke-dasharray"]) ? dasharray[params["stroke-dasharray"]] : E;\n                }\n                newstroke && node.appendChild(stroke);\n            }\n            if (res.type == "text") {\n                res.paper.canvas.style.display = E;\n                var span = res.paper.span,\n                    m = 100,\n                    fontSize = a.font && a.font.match(/\\d+(?:\\.\\d*)?(?=px)/);\n                s = span.style;\n                a.font && (s.font = a.font);\n                a["font-family"] && (s.fontFamily = a["font-family"]);\n                a["font-weight"] && (s.fontWeight = a["font-weight"]);\n                a["font-style"] && (s.fontStyle = a["font-style"]);\n                fontSize = toFloat(a["font-size"] || fontSize && fontSize[0]) || 10;\n                s.fontSize = fontSize * m + "px";\n                res.textpath.string && (span.innerHTML = Str(res.textpath.string).replace(/</g, "&#60;").replace(/&/g, "&#38;").replace(/\\n/g, "<br>"));\n                var brect = span.getBoundingClientRect();\n                res.W = a.w = (brect.right - brect.left) / m;\n                res.H = a.h = (brect.bottom - brect.top) / m;\n                // res.paper.canvas.style.display = "none";\n                res.X = a.x;\n                res.Y = a.y + res.H / 2;\n\n                ("x" in params || "y" in params) && (res.path.v = R.format("m{0},{1}l{2},{1}", round(a.x * zoom), round(a.y * zoom), round(a.x * zoom) + 1));\n                var dirtyattrs = ["x", "y", "text", "font", "font-family", "font-weight", "font-style", "font-size"];\n                for (var d = 0, dd = dirtyattrs.length; d < dd; d++) if (dirtyattrs[d] in params) {\n                    res._.dirty = 1;\n                    break;\n                }\n\n                // text-anchor emulation\n                switch (a["text-anchor"]) {\n                    case "start":\n                        res.textpath.style["v-text-align"] = "left";\n                        res.bbx = res.W / 2;\n                        break;\n                    case "end":\n                        res.textpath.style["v-text-align"] = "right";\n                        res.bbx = -res.W / 2;\n                        break;\n                    default:\n                        res.textpath.style["v-text-align"] = "center";\n                        res.bbx = 0;\n                        break;\n                }\n                res.textpath.style["v-text-kern"] = true;\n            }\n            // res.paper.canvas.style.display = E;\n        },\n        addGradientFill = function (o, gradient, fill) {\n            o.attrs = o.attrs || {};\n            var attrs = o.attrs,\n                pow = Math.pow,\n                opacity,\n                oindex,\n                type = "linear",\n                fxfy = ".5 .5";\n            o.attrs.gradient = gradient;\n            gradient = Str(gradient).replace(R._radial_gradient, function (all, fx, fy) {\n                type = "radial";\n                if (fx && fy) {\n                    fx = toFloat(fx);\n                    fy = toFloat(fy);\n                    pow(fx - .5, 2) + pow(fy - .5, 2) > .25 && (fy = math.sqrt(.25 - pow(fx - .5, 2)) * ((fy > .5) * 2 - 1) + .5);\n                    fxfy = fx + S + fy;\n                }\n                return E;\n            });\n            gradient = gradient.split(/\\s*\\-\\s*/);\n            if (type == "linear") {\n                var angle = gradient.shift();\n                angle = -toFloat(angle);\n                if (isNaN(angle)) {\n                    return null;\n                }\n            }\n            var dots = R._parseDots(gradient);\n            if (!dots) {\n                return null;\n            }\n            o = o.shape || o.node;\n            if (dots.length) {\n                o.removeChild(fill);\n                fill.on = true;\n                fill.method = "none";\n                fill.color = dots[0].color;\n                fill.color2 = dots[dots.length - 1].color;\n                var clrs = [];\n                for (var i = 0, ii = dots.length; i < ii; i++) {\n                    dots[i].offset && clrs.push(dots[i].offset + S + dots[i].color);\n                }\n                fill.colors = clrs.length ? clrs.join() : "0% " + fill.color;\n                if (type == "radial") {\n                    fill.type = "gradientTitle";\n                    fill.focus = "100%";\n                    fill.focussize = "0 0";\n                    fill.focusposition = fxfy;\n                    fill.angle = 0;\n                } else {\n                    // fill.rotate= true;\n                    fill.type = "gradient";\n                    fill.angle = (270 - angle) % 360;\n                }\n                o.appendChild(fill);\n            }\n            return 1;\n        },\n        Element = function (node, vml) {\n            this[0] = this.node = node;\n            node.raphael = true;\n            this.id = R._oid++;\n            node.raphaelid = this.id;\n            this.X = 0;\n            this.Y = 0;\n            this.attrs = {};\n            this.paper = vml;\n            this.matrix = R.matrix();\n            this._ = {\n                transform: [],\n                sx: 1,\n                sy: 1,\n                dx: 0,\n                dy: 0,\n                deg: 0,\n                dirty: 1,\n                dirtyT: 1\n            };\n            !vml.bottom && (vml.bottom = this);\n            this.prev = vml.top;\n            vml.top && (vml.top.next = this);\n            vml.top = this;\n            this.next = null;\n        };\n    var elproto = R.el;\n\n    Element.prototype = elproto;\n    elproto.constructor = Element;\n    elproto.transform = function (tstr) {\n        if (tstr == null) {\n            return this._.transform;\n        }\n        var vbs = this.paper._viewBoxShift,\n            vbt = vbs ? "s" + [vbs.scale, vbs.scale] + "-1-1t" + [vbs.dx, vbs.dy] : E,\n            oldt;\n        if (vbs) {\n            oldt = tstr = Str(tstr).replace(/\\.{3}|\\u2026/g, this._.transform || E);\n        }\n        R._extractTransform(this, vbt + tstr);\n        var matrix = this.matrix.clone(),\n            skew = this.skew,\n            o = this.node,\n            split,\n            isGrad = ~Str(this.attrs.fill).indexOf("-"),\n            isPatt = !Str(this.attrs.fill).indexOf("url(");\n        matrix.translate(1, 1);\n        if (isPatt || isGrad || this.type == "image") {\n            skew.matrix = "1 0 0 1";\n            skew.offset = "0 0";\n            split = matrix.split();\n            if ((isGrad && split.noRotation) || !split.isSimple) {\n                o.style.filter = matrix.toFilter();\n                var bb = this.getBBox(),\n                    bbt = this.getBBox(1),\n                    dx = bb.x - bbt.x,\n                    dy = bb.y - bbt.y;\n                o.coordorigin = (dx * -zoom) + S + (dy * -zoom);\n                setCoords(this, 1, 1, dx, dy, 0);\n            } else {\n                o.style.filter = E;\n                setCoords(this, split.scalex, split.scaley, split.dx, split.dy, split.rotate);\n            }\n        } else {\n            o.style.filter = E;\n            skew.matrix = Str(matrix);\n            skew.offset = matrix.offset();\n        }\n        if (oldt !== null) { // empty string value is true as well\n            this._.transform = oldt;\n            R._extractTransform(this, oldt);\n        }\n        return this;\n    };\n    elproto.rotate = function (deg, cx, cy) {\n        if (this.removed) {\n            return this;\n        }\n        if (deg == null) {\n            return;\n        }\n        deg = Str(deg).split(separator);\n        if (deg.length - 1) {\n            cx = toFloat(deg[1]);\n            cy = toFloat(deg[2]);\n        }\n        deg = toFloat(deg[0]);\n        (cy == null) && (cx = cy);\n        if (cx == null || cy == null) {\n            var bbox = this.getBBox(1);\n            cx = bbox.x + bbox.width / 2;\n            cy = bbox.y + bbox.height / 2;\n        }\n        this._.dirtyT = 1;\n        this.transform(this._.transform.concat([["r", deg, cx, cy]]));\n        return this;\n    };\n    elproto.translate = function (dx, dy) {\n        if (this.removed) {\n            return this;\n        }\n        dx = Str(dx).split(separator);\n        if (dx.length - 1) {\n            dy = toFloat(dx[1]);\n        }\n        dx = toFloat(dx[0]) || 0;\n        dy = +dy || 0;\n        if (this._.bbox) {\n            this._.bbox.x += dx;\n            this._.bbox.y += dy;\n        }\n        this.transform(this._.transform.concat([["t", dx, dy]]));\n        return this;\n    };\n    elproto.scale = function (sx, sy, cx, cy) {\n        if (this.removed) {\n            return this;\n        }\n        sx = Str(sx).split(separator);\n        if (sx.length - 1) {\n            sy = toFloat(sx[1]);\n            cx = toFloat(sx[2]);\n            cy = toFloat(sx[3]);\n            isNaN(cx) && (cx = null);\n            isNaN(cy) && (cy = null);\n        }\n        sx = toFloat(sx[0]);\n        (sy == null) && (sy = sx);\n        (cy == null) && (cx = cy);\n        if (cx == null || cy == null) {\n            var bbox = this.getBBox(1);\n        }\n        cx = cx == null ? bbox.x + bbox.width / 2 : cx;\n        cy = cy == null ? bbox.y + bbox.height / 2 : cy;\n\n        this.transform(this._.transform.concat([["s", sx, sy, cx, cy]]));\n        this._.dirtyT = 1;\n        return this;\n    };\n    elproto.hide = function () {\n        !this.removed && (this.node.style.display = "none");\n        return this;\n    };\n    elproto.show = function () {\n        !this.removed && (this.node.style.display = E);\n        return this;\n    };\n    // Needed to fix the vml setViewBox issues\n    elproto.auxGetBBox = R.el.getBBox;\n    elproto.getBBox = function(){\n        var b = this.auxGetBBox();\n        if (this.paper && this.paper._viewBoxShift)\n        {\n            var c = {};\n            var z = 1/this.paper._viewBoxShift.scale;\n            c.x = b.x - this.paper._viewBoxShift.dx;\n            c.x *= z;\n            c.y = b.y - this.paper._viewBoxShift.dy;\n            c.y *= z;\n            c.width  = b.width  * z;\n            c.height = b.height * z;\n            c.x2 = c.x + c.width;\n            c.y2 = c.y + c.height;\n            return c;\n        }\n        return b;\n    };\n    elproto._getBBox = function () {\n        if (this.removed) {\n            return {};\n        }\n        return {\n            x: this.X + (this.bbx || 0) - this.W / 2,\n            y: this.Y - this.H,\n            width: this.W,\n            height: this.H\n        };\n    };\n    elproto.remove = function () {\n        if (this.removed || !this.node.parentNode) {\n            return;\n        }\n        this.paper.__set__ && this.paper.__set__.exclude(this);\n        R.eve.unbind("raphael.*.*." + this.id);\n        R._tear(this, this.paper);\n        this.node.parentNode.removeChild(this.node);\n        this.shape && this.shape.parentNode.removeChild(this.shape);\n        for (var i in this) {\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\n        }\n        this.removed = true;\n    };\n    elproto.attr = function (name, value) {\n        if (this.removed) {\n            return this;\n        }\n        if (name == null) {\n            var res = {};\n            for (var a in this.attrs) if (this.attrs[has](a)) {\n                res[a] = this.attrs[a];\n            }\n            res.gradient && res.fill == "none" && (res.fill = res.gradient) && delete res.gradient;\n            res.transform = this._.transform;\n            return res;\n        }\n        if (value == null && R.is(name, "string")) {\n            if (name == fillString && this.attrs.fill == "none" && this.attrs.gradient) {\n                return this.attrs.gradient;\n            }\n            var names = name.split(separator),\n                out = {};\n            for (var i = 0, ii = names.length; i < ii; i++) {\n                name = names[i];\n                if (name in this.attrs) {\n                    out[name] = this.attrs[name];\n                } else if (R.is(this.paper.customAttributes[name], "function")) {\n                    out[name] = this.paper.customAttributes[name].def;\n                } else {\n                    out[name] = R._availableAttrs[name];\n                }\n            }\n            return ii - 1 ? out : out[names[0]];\n        }\n        if (this.attrs && value == null && R.is(name, "array")) {\n            out = {};\n            for (i = 0, ii = name.length; i < ii; i++) {\n                out[name[i]] = this.attr(name[i]);\n            }\n            return out;\n        }\n        var params;\n        if (value != null) {\n            params = {};\n            params[name] = value;\n        }\n        value == null && R.is(name, "object") && (params = name);\n        for (var key in params) {\n            eve("raphael.attr." + key + "." + this.id, this, params[key]);\n        }\n        if (params) {\n            for (key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], "function")) {\n                var par = this.paper.customAttributes[key].apply(this, [].concat(params[key]));\n                this.attrs[key] = params[key];\n                for (var subkey in par) if (par[has](subkey)) {\n                    params[subkey] = par[subkey];\n                }\n            }\n            // this.paper.canvas.style.display = "none";\n            if (params.text && this.type == "text") {\n                this.textpath.string = params.text;\n            }\n            setFillAndStroke(this, params);\n            // this.paper.canvas.style.display = E;\n        }\n        return this;\n    };\n    elproto.toFront = function () {\n        !this.removed && this.node.parentNode.appendChild(this.node);\n        this.paper && this.paper.top != this && R._tofront(this, this.paper);\n        return this;\n    };\n    elproto.toBack = function () {\n        if (this.removed) {\n            return this;\n        }\n        if (this.node.parentNode.firstChild != this.node) {\n            this.node.parentNode.insertBefore(this.node, this.node.parentNode.firstChild);\n            R._toback(this, this.paper);\n        }\n        return this;\n    };\n    elproto.insertAfter = function (element) {\n        if (this.removed) {\n            return this;\n        }\n        if (element.constructor == R.st.constructor) {\n            element = element[element.length - 1];\n        }\n        if (element.node.nextSibling) {\n            element.node.parentNode.insertBefore(this.node, element.node.nextSibling);\n        } else {\n            element.node.parentNode.appendChild(this.node);\n        }\n        R._insertafter(this, element, this.paper);\n        return this;\n    };\n    elproto.insertBefore = function (element) {\n        if (this.removed) {\n            return this;\n        }\n        if (element.constructor == R.st.constructor) {\n            element = element[0];\n        }\n        element.node.parentNode.insertBefore(this.node, element.node);\n        R._insertbefore(this, element, this.paper);\n        return this;\n    };\n    elproto.blur = function (size) {\n        var s = this.node.runtimeStyle,\n            f = s.filter;\n        f = f.replace(blurregexp, E);\n        if (+size !== 0) {\n            this.attrs.blur = size;\n            s.filter = f + S + ms + ".Blur(pixelradius=" + (+size || 1.5) + ")";\n            s.margin = R.format("-{0}px 0 0 -{0}px", round(+size || 1.5));\n        } else {\n            s.filter = f;\n            s.margin = 0;\n            delete this.attrs.blur;\n        }\n        return this;\n    };\n\n    R._engine.path = function (pathString, vml) {\n        var el = createNode("shape");\n        el.style.cssText = cssDot;\n        el.coordsize = zoom + S + zoom;\n        el.coordorigin = vml.coordorigin;\n        var p = new Element(el, vml),\n            attr = {fill: "none", stroke: "#000"};\n        pathString && (attr.path = pathString);\n        p.type = "path";\n        p.path = [];\n        p.Path = E;\n        setFillAndStroke(p, attr);\n        vml.canvas.appendChild(el);\n        var skew = createNode("skew");\n        skew.on = true;\n        el.appendChild(skew);\n        p.skew = skew;\n        p.transform(E);\n        return p;\n    };\n    R._engine.rect = function (vml, x, y, w, h, r) {\n        var path = R._rectPath(x, y, w, h, r),\n            res = vml.path(path),\n            a = res.attrs;\n        res.X = a.x = x;\n        res.Y = a.y = y;\n        res.W = a.width = w;\n        res.H = a.height = h;\n        a.r = r;\n        a.path = path;\n        res.type = "rect";\n        return res;\n    };\n    R._engine.ellipse = function (vml, x, y, rx, ry) {\n        var res = vml.path(),\n            a = res.attrs;\n        res.X = x - rx;\n        res.Y = y - ry;\n        res.W = rx * 2;\n        res.H = ry * 2;\n        res.type = "ellipse";\n        setFillAndStroke(res, {\n            cx: x,\n            cy: y,\n            rx: rx,\n            ry: ry\n        });\n        return res;\n    };\n    R._engine.circle = function (vml, x, y, r) {\n        var res = vml.path(),\n            a = res.attrs;\n        res.X = x - r;\n        res.Y = y - r;\n        res.W = res.H = r * 2;\n        res.type = "circle";\n        setFillAndStroke(res, {\n            cx: x,\n            cy: y,\n            r: r\n        });\n        return res;\n    };\n    R._engine.image = function (vml, src, x, y, w, h) {\n        var path = R._rectPath(x, y, w, h),\n            res = vml.path(path).attr({stroke: "none"}),\n            a = res.attrs,\n            node = res.node,\n            fill = node.getElementsByTagName(fillString)[0];\n        a.src = src;\n        res.X = a.x = x;\n        res.Y = a.y = y;\n        res.W = a.width = w;\n        res.H = a.height = h;\n        a.path = path;\n        res.type = "image";\n        fill.parentNode == node && node.removeChild(fill);\n        fill.rotate = true;\n        fill.src = src;\n        fill.type = "tile";\n        res._.fillpos = [x, y];\n        res._.fillsize = [w, h];\n        node.appendChild(fill);\n        setCoords(res, 1, 1, 0, 0, 0);\n        return res;\n    };\n    R._engine.text = function (vml, x, y, text) {\n        var el = createNode("shape"),\n            path = createNode("path"),\n            o = createNode("textpath");\n        x = x || 0;\n        y = y || 0;\n        text = text || "";\n        path.v = R.format("m{0},{1}l{2},{1}", round(x * zoom), round(y * zoom), round(x * zoom) + 1);\n        path.textpathok = true;\n        o.string = Str(text);\n        o.on = true;\n        el.style.cssText = cssDot;\n        el.coordsize = zoom + S + zoom;\n        el.coordorigin = "0 0";\n        var p = new Element(el, vml),\n            attr = {\n                fill: "#000",\n                stroke: "none",\n                font: R._availableAttrs.font,\n                text: text\n            };\n        p.shape = el;\n        p.path = path;\n        p.textpath = o;\n        p.type = "text";\n        p.attrs.text = Str(text);\n        p.attrs.x = x;\n        p.attrs.y = y;\n        p.attrs.w = 1;\n        p.attrs.h = 1;\n        setFillAndStroke(p, attr);\n        el.appendChild(o);\n        el.appendChild(path);\n        vml.canvas.appendChild(el);\n        var skew = createNode("skew");\n        skew.on = true;\n        el.appendChild(skew);\n        p.skew = skew;\n        p.transform(E);\n        return p;\n    };\n    R._engine.setSize = function (width, height) {\n        var cs = this.canvas.style;\n        this.width = width;\n        this.height = height;\n        width == +width && (width += "px");\n        height == +height && (height += "px");\n        cs.width = width;\n        cs.height = height;\n        cs.clip = "rect(0 " + width + " " + height + " 0)";\n        if (this._viewBox) {\n            R._engine.setViewBox.apply(this, this._viewBox);\n        }\n        return this;\n    };\n    R._engine.setViewBox = function (x, y, w, h, fit) {\n        R.eve("raphael.setViewBox", this, this._viewBox, [x, y, w, h, fit]);\n        var paperSize = this.getSize(),\n            width = paperSize.width,\n            height = paperSize.height,\n            H, W;\n        if (fit) {\n            H = height / h;\n            W = width / w;\n            if (w * H < width) {\n                x -= (width - w * H) / 2 / H;\n            }\n            if (h * W < height) {\n                y -= (height - h * W) / 2 / W;\n            }\n        }\n        this._viewBox = [x, y, w, h, !!fit];\n        this._viewBoxShift = {\n            dx: -x,\n            dy: -y,\n            scale: paperSize\n        };\n        this.forEach(function (el) {\n            el.transform("...");\n        });\n        return this;\n    };\n    var createNode;\n    R._engine.initWin = function (win) {\n        var doc = win.document;\n        if (doc.styleSheets.length < 31) {\n            doc.createStyleSheet().addRule(".rvml", "behavior:url(#default#VML)");\n        } else {\n            // no more room, add to the existing one\n            // http://msdn.microsoft.com/en-us/library/ms531194%28VS.85%29.aspx\n            doc.styleSheets[0].addRule(".rvml", "behavior:url(#default#VML)");\n        }\n        try {\n            !doc.namespaces.rvml && doc.namespaces.add("rvml", "urn:schemas-microsoft-com:vml");\n            createNode = function (tagName) {\n                return doc.createElement(\'<rvml:\' + tagName + \' class="rvml">\');\n            };\n        } catch (e) {\n            createNode = function (tagName) {\n                return doc.createElement(\'<\' + tagName + \' xmlns="urn:schemas-microsoft.com:vml" class="rvml">\');\n            };\n        }\n    };\n    R._engine.initWin(R._g.win);\n    R._engine.create = function () {\n        var con = R._getContainer.apply(0, arguments),\n            container = con.container,\n            height = con.height,\n            s,\n            width = con.width,\n            x = con.x,\n            y = con.y;\n        if (!container) {\n            throw new Error("VML container not found.");\n        }\n        var res = new R._Paper,\n            c = res.canvas = R._g.doc.createElement("div"),\n            cs = c.style;\n        x = x || 0;\n        y = y || 0;\n        width = width || 512;\n        height = height || 342;\n        res.width = width;\n        res.height = height;\n        width == +width && (width += "px");\n        height == +height && (height += "px");\n        res.coordsize = zoom * 1e3 + S + zoom * 1e3;\n        res.coordorigin = "0 0";\n        res.span = R._g.doc.createElement("span");\n        res.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";\n        c.appendChild(res.span);\n        cs.cssText = R.format("top:0;left:0;display:inline-block;position:absolute;clip:rect(0 {0} {1} 0);", width, height);\n        if (container == 1) {\n            R._g.doc.body.appendChild(c);\n            cs.left = x + "px";\n            cs.top = y + "px";\n            cs.position = "absolute";\n        } else {\n            if (container.firstChild) {\n                container.insertBefore(c, container.firstChild);\n            } else {\n                container.appendChild(c);\n            }\n        }\n        res.renderfix = function () {};\n        return res;\n    };\n    R.prototype.clear = function () {\n        R.eve("raphael.clear", this);\n        this.canvas.innerHTML = E;\n        this.span = R._g.doc.createElement("span");\n        this.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";\n        this.canvas.appendChild(this.span);\n        this.bottom = this.top = null;\n    };\n    R.prototype.remove = function () {\n        R.eve("raphael.remove", this);\n        this.canvas.parentNode.removeChild(this.canvas);\n        for (var i in this) {\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\n        }\n        return true;\n    };\n\n    var setproto = R.st;\n    for (var method in elproto) if (elproto[has](method) && !setproto[has](method)) {\n        setproto[method] = (function (methodname) {\n            return function () {\n                var arg = arguments;\n                return this.forEach(function (el) {\n                    el[methodname].apply(el, arg);\n                });\n            };\n        })(method);\n    }\n}));\n\n// ┌────────────────────────────────────────────────────────────────────┐ \\\\\n// │ Raphaël 2.1.4 - JavaScript Vector Library                      │ \\\\\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\n// │ Copyright © 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    │ \\\\\n// │ Copyright © 2008-2012 Sencha Labs (http://sencha.com)              │ \\\\\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\\\\n// └────────────────────────────────────────────────────────────────────┘ \\\\\n\n(function (glob, factory) {\n    if (typeof define === "function" && define.amd) {\n        define("raphael", ["raphael.core", "raphael.svg", "raphael.vml"], function(Raphael) {\n            return factory(Raphael);\n        });\n    } else if (typeof exports === "object") {\n        var raphael = require("raphael.core");\n\n        require("raphael.svg");\n        require("raphael.vml");\n\n        module.exports = factory(raphael);\n    } else {\n        //glob.Raphael = factory(glob.Raphael);\n    }\n}(this, function (Raphael) {\n    return Raphael.ninja();\n}));'},function(e,t,n){n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(248),n(114),n(249),n(115),n(116),n(117),n(118),n(119),n(120),n(121),n(122),n(250),n(251),n(123),n(124),n(125),n(252),n(253),n(389),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(112),n(262),n(71),n(70),n(113),n(45),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(126),n(127),n(128),n(129),n(130),n(131),n(132),n(133),n(134),n(135),n(136),n(137),n(138),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(300),n(301),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(72),n(205),n(73),n(44),n(206),n(207),n(545),n(249),n(248),n(115),n(116),n(117),n(118),n(119),n(120),n(121),n(122),n(114),n(250),n(251),n(123),n(124),n(125),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(112),n(262),n(71),n(70),n(113),n(45),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(126),n(127),n(128),n(129),n(130),n(131),n(132),n(133),n(134),n(135),n(136),n(137),n(138),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(300),n(301),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(72),n(205),n(73),n(44),n(206),n(207),e.exports=n(303)},function(e,t){BI.resourceURL="file?path=/com/fr/web/ui/resource/"}]);
//# sourceMappingURL=./materials.min.js.map